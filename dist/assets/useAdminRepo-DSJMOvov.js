import{r as e}from"./router-5U3rcizL.js";import{a,aB as t}from"./index-sK2loqLz.js";import{r}from"./realtime-BxkdmVbQ.js";import{u as s,c as n,d as o,a as i}from"./projectsAPI-Dk1YwCPU.js";import{a as c,d as u,u as l,c as d,b as g,e as h,f as p,g as f,h as y}from"./rankingAPI-5toaWGiO.js";import{t as m,u as b,a as w,g as k}from"./userAPI-JeWysunA.js";async function _(e={}){const{all:t=!1}=e,r="/api/mentores"+(t?"?all=1":"");return(await a(r,{method:"GET"})).data||[]}async function S(e,t){return(await a(`/api/mentores/${e}`,{method:"PUT",body:JSON.stringify(t)})).mentor}function v(a,r=[]){t("")||"undefined"!=typeof window&&"1"===new URLSearchParams(window.location.search).get("debug")||"undefined"!=typeof localStorage&&localStorage.getItem("cc_debug");const[s,n]=e.useState([]),[o,i]=e.useState(!0),[c,u]=e.useState(""),l=async()=>{i(!0),u("");try{const e=await a();n(e||[])}catch(e){u(e.message||"Erro ao carregar dados"),n([])}finally{i(!1)}};return e.useEffect(()=>{l()},r),{data:s,loading:o,error:c,refresh:l}}function P(){const a=v(()=>k());t("")||"undefined"!=typeof window&&"1"===new URLSearchParams(window.location.search).get("debug")||"undefined"!=typeof localStorage&&localStorage.getItem("cc_debug");return e.useEffect(()=>{const e=r.subscribe("users_changed",()=>{a.refresh()});return()=>e()},[a.refresh]),a}const j={async create(e){const a=await w(e);return a.ok&&r.publish("users_changed",{users:null}),a},async update(e,a){const t=await b(e,a);return t.ok&&r.publish("users_changed",{users:null}),t},async toggleStatus(e){const a=await m(e);return a.ok&&r.publish("users_changed",{users:null}),a}};function A(){const a=e=>({id:e.id,name:e.name??e.nome??"",specialty:e.specialty??e.especialidade??"",bio:e.bio??e.descricao??"",email:e.email??"",phone:e.phone??e.telefone??"",avatar_url:e.avatar_url??e.foto_url??e.photo??"",photo:e.photo??"",status:e.status??"published",visible:!1!==e.visible,created_at:e.created_at,updated_at:e.updated_at}),t=v(async()=>{const e=await _({all:!0});return Array.isArray(e)?e.map(a):[]});return e.useEffect(()=>{const e=r.subscribe("mentors_changed",()=>{t.refresh()});return()=>e()},[t.refresh]),t}const E={async upsert(e){try{const t={nome:e.nome??e.name,especialidade:e.especialidade??e.specialty,bio:e.bio??e.descricao,email:e.email,telefone:e.telefone??e.phone,avatar_url:e.avatar_url??e.photo??"",status:e.status??"published",visible:!1!==e.visible};let s;return s=e.id?await S(e.id,t):await async function(e){return(await a("/api/mentores",{method:"POST",body:JSON.stringify(e)})).mentor}(t),r.publish("mentors_changed",{mentors:null}),{ok:!0,mentor:s}}catch(t){return{ok:!1,error:t.message}}},async delete(e){try{const t=await async function(e){return(await a(`/api/mentores/${e}`,{method:"DELETE"})).removed}(e);return r.publish("mentors_changed",{mentors:null}),{ok:!0,removed:t}}catch(t){return{ok:!1,error:t.message}}},async toggleVisibility(e){try{const a=(await _({all:!0})).find(a=>a.id===e);if(!a)return{ok:!1,error:"Mentor não encontrado"};const t=await S(e,{visible:!a.visible});return r.publish("mentors_changed",{mentors:null}),{ok:!0,mentor:t}}catch(a){return{ok:!1,error:a.message}}},async toggleVisible(e){return e&&e.id?await this.toggleVisibility(e.id):{ok:!1,error:"Mentor inválido"}}};function T(){t("")||"undefined"!=typeof window&&"1"===new URLSearchParams(window.location.search).get("debug")||"undefined"!=typeof localStorage&&localStorage.getItem("cc_debug");const a=v(async()=>{try{const e=await i({all:"1"}),a=Array.isArray(e)?e:[];if(0===a.length){const e=await i({visivel:"true"});return Array.isArray(e)?e:[]}return a}catch(e){const a=await i({visivel:"true"});return Array.isArray(a)?a:[]}});return e.useEffect(()=>{const e=r.subscribe("projects_changed",()=>{a.refresh()});return()=>e()},[a.refresh]),a}const O={async create(e){try{const a={titulo:e.titulo||e.title,owner:e.owner,descricao:e.descricao||e.description,data_inicio:e.data_inicio||e.startDate,status:e.status,preco:e.preco||e.price,progresso:e.progresso||e.progress,thumb_url:e.thumb_url,tecnologias:e.tags||[]},t=await n(a);return r.publish("projects_changed",{projects:null}),{ok:!0,project:t}}catch(a){return{ok:!1,error:a.message}}},async update(e,a){try{const t={titulo:a.titulo||a.title,owner:a.owner,descricao:a.descricao||a.description,data_inicio:a.data_inicio||a.startDate,status:a.status,preco:a.preco||a.price,progresso:a.progresso||a.progress,thumb_url:a.thumb_url,tecnologias:a.tags||[]},n=await s(e,t);return r.publish("projects_changed",{projects:null}),{ok:!0,project:n}}catch(t){return{ok:!1,error:t.message}}},async delete(e){try{const a=await o(e);return r.publish("projects_changed",{projects:null}),{ok:!0,project:a}}catch(a){return{ok:!1,error:a.message}}},async upsert(e){try{const a=!!e.id,t={titulo:e.titulo||e.title,owner:e.owner,descricao:e.descricao||e.description,data_inicio:e.data_inicio||e.startDate,status:e.status,preco:e.preco||e.price,progresso:e.progresso||e.progress,thumb_url:e.thumb_url,tecnologias:e.tags||[]},o=a?await s(e.id,t):await n(t);return r.publish("projects_changed",{projects:null}),o}catch(a){return{ok:!1,error:a.message}}},async toggleVisible(e){try{if(!e||!e.id)return{ok:!1,error:"Projeto inválido"};const a=String(e.status||"").toLowerCase(),t="rascunho"===a||"draft"===a?"ongoing":"rascunho",s=await this.update(e.id,{status:t});return r.publish("projects_changed",{projects:null}),s}catch(a){return{ok:!1,error:a.message}}}};function N(){const a=v(()=>f());return e.useEffect(()=>{const e=r.subscribe("ranking_changed",()=>{a.refresh()});return()=>e()},[a.refresh]),a}const U={async updatePoints(e,a){try{const t=await p(e,a);return r.publish("ranking_changed",{ranking:null}),{ok:!0,result:t}}catch(t){return{ok:!1,error:t.message}}},async updateTop3(e){try{const a=await h(e);return r.publish("ranking_changed",{ranking:null}),{ok:!0,result:a}}catch(a){return{ok:!1,error:a.message}}},async updateFilters(e){try{const a=await g(e);return r.publish("ranking_changed",{ranking:null}),{ok:!0,result:a}}catch(a){return{ok:!1,error:a.message}}}};function J(a={}){const[t,s]=e.useState([]),[n,o]=e.useState({total:0,page:1,totalPages:0,hasNext:!1,hasPrev:!1}),[i,u]=e.useState(!0),[l,d]=e.useState(null),g=e.useCallback(async(e={})=>{u(!0),d(null);try{const t={...a,...e},r=await c(t);if(!r.success)throw new Error(r.error||"Erro ao carregar crafters");s(r.data||[]),o(r.pagination||{total:0,page:1,totalPages:0,hasNext:!1,hasPrev:!1})}catch(t){d(t.message),s([])}finally{u(!1)}},[a]);return e.useEffect(()=>{g()},[g]),e.useEffect(()=>{const e=()=>{g()};return r.subscribe("ranking_changed",e),()=>r.unsubscribe("ranking_changed",e)},[g]),{crafters:t,pagination:n,loading:i,error:l,reload:g,loadPage:e=>g({page:e}),search:e=>g({search:e,page:1})}}const $={async create(e){try{const a=await d(e);return r.publish("ranking_changed",{ranking:null}),{ok:!0,crafter:a}}catch(a){return{ok:!1,error:a.message}}},async update(e,a){try{const t=await l(e,a);return r.publish("ranking_changed",{ranking:null}),{ok:!0,crafter:t}}catch(t){return{ok:!1,error:t.message}}},async delete(e){try{const a=await u(e);return r.publish("ranking_changed",{ranking:null}),{ok:!0,deleted:a}}catch(a){return{ok:!1,error:a.message}}}};function I(){return v(async()=>{try{const e=await a("/api/desafios?all=1",{method:"GET"});return e?.data||(Array.isArray(e)?e:[])}catch(e){if(e&&(401===e.status||String(e.message||"").includes("401"))&&!["off","false","0"].includes(String("off").toLowerCase())){const e=await a("/api/desafios?visible=true",{method:"GET"});return e?.data||(Array.isArray(e)?e:[])}throw e}})}const L={async create(e){try{const t=await a("/api/desafios",{method:"POST",body:JSON.stringify(e)});return r.publish("desafios_changed",{desafios:null}),{ok:!0,desafio:t.data?.challenge||t.challenge||t.data||t}}catch(t){return{ok:!1,error:t.message}}},async update(e,t){try{const s=await a(`/api/desafios/${e}`,{method:"PUT",body:JSON.stringify(t)});return r.publish("desafios_changed",{desafios:null}),{ok:!0,desafio:s.data?.challenge||s.challenge||s.data||s}}catch(s){return{ok:!1,error:s.message}}},async toggleVisibility(e){try{const t=await a(`/api/desafios/${e}/visibility`,{method:"PUT"});return r.publish("desafios_changed",{desafios:null}),{ok:!0,desafio:t.data?.challenge||t.challenge||t.data||t}}catch(t){return{ok:!1,error:t.message}}},async upsert(e){try{const t=!!e.id,s=t?`/api/desafios/${e.id}`:"/api/desafios",n=await a(s,{method:t?"PUT":"POST",body:JSON.stringify(e)});return r.publish("desafios_changed",{desafios:null}),{ok:!0,desafio:n.data?.challenge||n.challenge||n.data||n}}catch(t){return{ok:!1,error:t.message}}},async reviewSubmission(e,t){try{const s=await a(`/api/submissions/${e}/review`,{method:"PUT",body:JSON.stringify(t)});return r.publish("desafios_changed",{desafios:null}),{ok:!0,submission:s.data?.submission||s.submission||s.data||s}}catch(s){return{ok:!1,error:s.message}}},async setStatus(e,t){try{return await a(`/api/desafios/${e}/status`,{method:"PUT",body:JSON.stringify({status:t})}),r.publish("desafios_changed",{desafios:null}),{ok:!0}}catch(s){return{ok:!1,error:s.message}}}};function D(){return v(async()=>{const e=await a("/api/financas",{method:"GET"});return e?.data||(Array.isArray(e)?e:[])})}const R={async update(e,t){try{const s=await a(`/api/financas/${e}`,{method:"PUT",body:JSON.stringify(t)});return r.publish("finance_changed",{finance:null}),{ok:!0,item:s?.item||s?.data}}catch(s){return{ok:!1,error:s.message}}}};function V(){return v(()=>y())}export{$ as C,L as D,R as F,E as M,O as P,U as R,j as U,I as a,D as b,T as c,A as d,N as e,J as f,P as g,V as u};

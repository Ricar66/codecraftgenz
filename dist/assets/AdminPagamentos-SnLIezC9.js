import{j as e}from"./index-DQkRuPgL.js";import{f as t,R as a}from"./router-Bh7m2j_b.js";import{o as n,p as s,q as i,t as r}from"./appsAPI-Cg4VL4mB.js";import{S as l}from"./StatusBadge-C-iKibtv.js";function d(){const[d,o]=t(),[c,u]=a.useState(()=>{const e=new Date,t=e=>e.toISOString().slice(0,19)+".000-00:00";return{sort:"date_created",criteria:"desc",range:"date_created",begin_date:t(new Date(e.getTime()-2592e6)),end_date:t(e),external_reference:"",status:"",payment_method_id:"",collectorId:"",payerId:""}}),[m,p]=a.useState(!1),[h,x]=a.useState(""),[j,y]=a.useState(null),[g,_]=a.useState([]),[v,f]=a.useState({total:0,limit:0,offset:0}),[b,N]=a.useState(""),[S,C]=a.useState(""),[w,I]=a.useState(30),[O,k]=a.useState(1),[B,D]=a.useState(null),[T,R]=a.useState(""),[M,L]=a.useState(null),[A,P]=a.useState(""),[E,z]=a.useState("gui"),[F,J]=a.useState([]),[H,V]=a.useState({capture:"",status:"",transaction_amount:"",date_of_expiration:""}),U=a.useMemo(()=>["approved","pending","authorized","in_process","rejected","cancelled","refunded","charged_back"],[]),q=a.useMemo(()=>/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}[+-]\d{2}:\d{2}$/,[]),$=a.useMemo(()=>{const e={};if(H.capture&&"true"!==H.capture&&"false"!==H.capture&&(e.capture="Capture deve ser true ou false"),H.status&&!U.includes(H.status)&&(e.status="Status inv√°lido"),""!==H.transaction_amount){const t=Number(H.transaction_amount);(Number.isNaN(t)||t<=0)&&(e.transaction_amount="Valor deve ser n√∫mero maior que 0")}return H.date_of_expiration&&(q.test(H.date_of_expiration)||(e.date_of_expiration="Formato ISO inv√°lido. Use yyyy-MM-dd'T'HH:mm:ss.SSS¬±HH:mm")),e},[H,U,q]),W=a.useMemo(()=>Object.values($).some(Boolean),[$]),[G,K]=a.useState(null),[Q,Y]=a.useState(!1),[Z,X]=a.useState(""),[ee,te]=a.useState({id:!0,status:!0,method:!0,amount:!0,installments:!0,payer:!0,external_reference:!0,description:!0,created:!0,updated:!0,actions:!0}),[ae,ne]=a.useState(!0);a.useEffect(()=>{try{const e=localStorage.getItem("adminPaymentsColumns");if(e&&!d.get("columns")){const t=JSON.parse(e);Array.isArray(t)&&t.length&&te(e=>Object.fromEntries(Object.keys(e).map(e=>[e,t.includes(e)])))}}catch(e){}},[d]),a.useEffect(()=>{try{const e=Object.entries(ee).filter(([,e])=>e).map(([e])=>e);localStorage.setItem("adminPaymentsColumns",JSON.stringify(e))}catch(e){}},[ee]);const se=a.useCallback(async()=>{p(!0),x(""),y(null);try{const e={};c.status&&(e.status=c.status),c.begin_date&&(e.from_date=c.begin_date.split("T")[0]),c.end_date&&(e.to_date=c.end_date.split("T")[0]),S&&(e.email=S),e.limit=String(w),e.page=String(O);const t=await n(e),a=t?.data||t;let s=[];Array.isArray(a?.items)?s=a.items:Array.isArray(a?.results)?s=a.results:Array.isArray(a)&&(s=a);const i=s.map(e=>({id:e.id||e.payment_id,status:e.status,status_detail:e.statusDetail||e.status_detail,payment_method_id:e.paymentMethodId||e.payment_method_id||e.paymentTypeId||e.payment_type_id,transaction_amount:e.amount||e.transaction_amount,installments:e.installments||1,payer:{email:e.payerEmail||e.payer_email||e.payer?.email},external_reference:e.externalReference||e.external_reference||e.preferenceId||e.preference_id,description:e.description||(e.app?.name?`App: ${e.app.name}`:""),date_created:e.createdAt||e.created_at||e.date_created,last_modified:e.updatedAt||e.updated_at||e.last_modified,app:e.app,user:e.user})).filter(e=>{const t=!b||String(e?.id||"").includes(b)||String(e?.external_reference||"").toLowerCase().includes(b.toLowerCase())||String(e?.description||"").toLowerCase().includes(b.toLowerCase())||String(e?.payer?.email||"").toLowerCase().includes(b.toLowerCase()),a=!c.payment_method_id||String(e?.payment_method_id||"")===String(c.payment_method_id);return t&&a});_(i);const r=a?.total||t?.total||i.length,l=(Math.max(1,O)-1)*Number(w||30);f({total:r,limit:Number(w||30),offset:l})}catch(e){const t=String(e?.message||"").toLowerCase();503===e?.status||t.includes("no_access_token")||t.includes("sem access token")?x("Credenciais do Mercado Pago ausentes. Configure MERCADO_PAGO_ACCESS_TOKEN ou OAuth e tente novamente."):x(401===e?.status?"N√£o autenticado. Fa√ßa login para acessar pagamentos.":403===e?.status?"Acesso restrito. Seu perfil n√£o possui permiss√£o de administrador.":e?.message||"Erro ao buscar pagamentos"),y(null)}finally{p(!1)}},[c,w,O,b,S]);a.useEffect(()=>{if("json"!==E)return void J([]);const e=[];if(A){try{const t=JSON.parse(A);if(t&&"object"==typeof t){if(t.status&&!U.includes(t.status)&&e.push("status inv√°lido no JSON avan√ßado"),Object.prototype.hasOwnProperty.call(t,"transaction_amount")){const a=Number(t.transaction_amount);(Number.isNaN(a)||a<=0)&&e.push("transaction_amount deve ser n√∫mero > 0")}t.date_of_expiration&&!q.test(t.date_of_expiration)&&e.push("date_of_expiration em formato ISO inv√°lido (yyyy-MM-dd'T'HH:mm:ss.SSS¬±HH:mm)")}}catch(t){e.push("JSON inv√°lido: "+String(t?.message||t))}J(e)}else J([])},[E,A,U,q]),a.useEffect(()=>{const e=String(M?.id||"").trim();if(!e)return K(null),void X("");let t=!1;return(async()=>{try{Y(!0),X("");const a=await s(e);t||K(a?.data?.data||a?.data||a)}catch(a){t||X(a?.message||"Erro ao buscar resumo do DB")}finally{t||Y(!1)}})(),()=>{t=!0}},[M]),a.useEffect(()=>{try{const e=Object.fromEntries([...d.entries()]);if(u(t=>{const a={...t};let n=!1;for(const r of["sort","criteria","range","begin_date","end_date","external_reference","status"])e[r]&&e[r]!==t[r]&&(a[r]=e[r],n=!0);const s=e["collector.id"],i=e["payer.id"];return s&&s!==t.collectorId&&(a.collectorId=s,n=!0),i&&i!==t.payerId&&(a.payerId=i,n=!0),n?a:t}),N(t=>e.query&&e.query!==t?e.query:t),C(t=>e.email&&e.email!==t?e.email:t),I(t=>e.limit&&Number(e.limit)!==Number(t)?Number(e.limit):t),k(t=>{const a=e.page?Math.max(1,Number(e.page)):null,n=Math.max(1,Number(t));return a&&a!==n?a:t}),e.columns){const t=String(e.columns).split(",").map(e=>e.trim()).filter(Boolean),a=e=>Object.fromEntries(Object.keys(e).map(e=>[e,t.includes(e)]));te(e=>{const t=a(e);return Object.keys(e).every(a=>e[a]===t[a])?e:t})}}catch(e){}},[d]),a.useEffect(()=>{se()},[se]);const ie=a.useCallback(()=>{const e=new URLSearchParams;e.set("sort",c.sort),e.set("criteria",c.criteria),e.set("range",c.range),c.begin_date&&e.set("begin_date",c.begin_date),c.end_date&&e.set("end_date",c.end_date),c.external_reference&&e.set("external_reference",c.external_reference),c.status&&e.set("status",c.status),c.collectorId&&e.set("collector.id",c.collectorId),c.payerId&&e.set("payer.id",c.payerId),b&&e.set("query",b),S&&e.set("email",S),e.set("limit",String(w)),e.set("page",String(O));const t=Object.entries(ee).filter(([,e])=>e).map(([e])=>e).join(",");t&&e.set("columns",t),o(e)},[c,b,S,w,O,ee,o]),re=async e=>{if(e)try{p(!0),x(""),y(null);const t=await i(e),a=t?.data?.data||t?.data||t;L(a),D(String(a?.id||e));const n=new URLSearchParams(d);n.set("paymentId",String(e)),o(n)}catch(t){x(t?.message||"Erro ao obter pagamento por ID"),y(t?.data?.details||null)}finally{p(!1)}};return e.jsxs("div",{className:"admin-content",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"title",children:"üí≥ Pagamentos ‚Äì Mercado Pago"}),e.jsx("p",{className:"muted",children:"Liste e filtre pagamentos via proxy seguro (admin)"})]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=g.map(e=>[e.id,e.status,e.status_detail,e.payment_method_id,e.transaction_amount,e.installments,e?.payer?.email||"",e.external_reference||"",e.description||"",e.date_created||"",e.last_modified||e.last_updated||""]),t=[["id","status","status_detail","payment_method_id","transaction_amount","installments","payer_email","external_reference","description","date_created","last_modified"].join(","),...e.map(e=>e.join(","))].join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download="pagamentos_mercadopago.csv",s.click(),URL.revokeObjectURL(n)},children:"üì§ Exportar CSV"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{ie(),se()},disabled:m,children:m?"üîÑ Carregando‚Ä¶":"üîÅ Buscar"})]})]}),e.jsxs("section",{className:"filters-section",style:{marginBottom:12},children:[e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"2fr 1fr auto"},children:[e.jsx("input",{placeholder:"üî¢ ID do pagamento",value:T,onChange:e=>R(e.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:async()=>{if(T)try{p(!0),x(""),L(null);const e=await i(T),t=e?.data?.data||e?.data||e;L(t),D(String(t?.id||T));const a=new URLSearchParams(d);a.set("paymentId",String(T)),o(a)}catch(e){x(e?.message||"Erro ao obter pagamento por ID")}finally{p(!1)}},children:"üîç Buscar por ID"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{R(""),L(null),D(null);const e=new URLSearchParams(d);e.delete("paymentId"),o(e)},children:"Limpar ID"})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{placeholder:"üîç Busca livre (ID, refer√™ncia, descri√ß√£o, e-mail)",value:b,onChange:e=>N(e.target.value)}),e.jsxs("select",{value:c.sort,onChange:e=>u(t=>({...t,sort:e.target.value})),children:[e.jsx("option",{value:"date_created",children:"Ordenar por cria√ß√£o"}),e.jsx("option",{value:"last_modified",children:"Ordenar por √∫ltima modifica√ß√£o"}),e.jsx("option",{value:"date_approved",children:"Ordenar por aprova√ß√£o"})]}),e.jsxs("select",{value:c.criteria,onChange:e=>u(t=>({...t,criteria:e.target.value})),children:[e.jsx("option",{value:"desc",children:"Desc"}),e.jsx("option",{value:"asc",children:"Asc"})]}),e.jsxs("select",{value:c.range,onChange:e=>u(t=>({...t,range:e.target.value})),children:[e.jsx("option",{value:"date_created",children:"Intervalo: cria√ß√£o"}),e.jsx("option",{value:"last_modified",children:"Intervalo: √∫ltima modifica√ß√£o"}),e.jsx("option",{value:"date_approved",children:"Intervalo: aprova√ß√£o"})]})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{type:"text",placeholder:"external_reference",value:c.external_reference,onChange:e=>u(t=>({...t,external_reference:e.target.value}))}),e.jsxs("select",{value:c.status,onChange:e=>u(t=>({...t,status:e.target.value})),children:[e.jsx("option",{value:"",children:"Status: todos"}),e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"authorized",children:"authorized"}),e.jsx("option",{value:"in_process",children:"in_process"}),e.jsx("option",{value:"rejected",children:"rejected"}),e.jsx("option",{value:"cancelled",children:"cancelled"}),e.jsx("option",{value:"refunded",children:"refunded"}),e.jsx("option",{value:"charged_back",children:"charged_back"})]}),e.jsx("input",{type:"text",placeholder:"payment_method_id (client-side)",value:c.payment_method_id,onChange:e=>u(t=>({...t,payment_method_id:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"collector.id",value:c.collectorId,onChange:e=>u(t=>({...t,collectorId:e.target.value}))})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{type:"text",placeholder:"payer.id",value:c.payerId,onChange:e=>u(t=>({...t,payerId:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"begin_date (ISO)",value:c.begin_date,onChange:e=>u(t=>({...t,begin_date:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"end_date (ISO)",value:c.end_date,onChange:e=>u(t=>({...t,end_date:e.target.value}))}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("select",{onChange:e=>{const t=new Date,a=e.target.value;let n=null,s=null;"today"===a&&(n=new Date(t),n.setHours(0,0,0,0),s=new Date(t),s.setHours(23,59,59,999)),"7d"===a&&(s=new Date(t),n=new Date(t.getTime()-6048e5)),"30d"===a&&(s=new Date(t),n=new Date(t.getTime()-2592e6)),"month"===a&&(s=new Date(t),n=new Date(t.getFullYear(),t.getMonth(),1,0,0,0,0));const i=e=>e.toISOString().slice(0,19)+".000-00:00";u(e=>({...e,begin_date:n?i(n):e.begin_date,end_date:s?i(s):e.end_date})),k(1),ie(),se()},defaultValue:"",children:[e.jsx("option",{value:"",children:"Presets de datas‚Ä¶"}),e.jsx("option",{value:"today",children:"Hoje"}),e.jsx("option",{value:"7d",children:"√öltimos 7 dias"}),e.jsx("option",{value:"30d",children:"√öltimos 30 dias"}),e.jsx("option",{value:"month",children:"M√™s atual"})]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>u(e=>({...e,begin_date:"",end_date:""})),children:"Limpar datas"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>u(e=>({...e,external_reference:"",status:"",payment_method_id:"",collectorId:"",payerId:""})),children:"Limpar filtros"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{k(1),ie(),se()},disabled:m,children:m?"Buscando‚Ä¶":"Aplicar filtros"})]})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{placeholder:"üìß Filtro por e-mail (client-side)",value:S,onChange:e=>C(e.target.value)}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("label",{children:"Page size:"}),e.jsxs("select",{value:w,onChange:e=>{I(Number(e.target.value)),k(1),ie(),se()},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=Math.max(1,O-1);k(e),ie(),se()},children:"‚óÄ"}),e.jsxs("span",{children:["Pag ",O," / ",Math.max(1,Math.ceil(Number(v?.total||0)/Number(w||30)))]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=Math.max(1,Math.ceil(Number(v?.total||0)/Number(w||30))),t=Math.min(e,O+1);k(t),ie(),se()},children:"‚ñ∂"})]}),e.jsx("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:Object.keys(ee).map(t=>e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:ee[t],onChange:e=>{const a={...ee,[t]:e.target.checked};te(a),ie()}})," ",t]},t))})]})]}),m&&e.jsx("p",{children:"üîÑ Carregando‚Ä¶"}),h&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["‚ùå ",h]}),e.jsx("div",{className:"table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[ee.id&&e.jsx("th",{children:"ID"}),ee.status&&e.jsx("th",{children:"Status"}),ee.method&&e.jsx("th",{children:"M√©todo"}),ee.amount&&e.jsx("th",{children:"Valor"}),ee.installments&&e.jsx("th",{children:"Parcelas"}),ee.payer&&e.jsx("th",{children:"Payer"}),ee.external_reference&&e.jsx("th",{children:"Ref. Externa"}),ee.description&&e.jsx("th",{children:"Descri√ß√£o"}),ee.created&&e.jsx("th",{children:"Criado"}),ee.updated&&e.jsx("th",{children:"Atualizado"}),ee.actions&&e.jsx("th",{children:"A√ß√µes"})]})}),e.jsx("tbody",{children:0===g.length?e.jsx("tr",{children:e.jsx("td",{colSpan:Object.values(ee).filter(Boolean).length||1,children:"üì≠ Nenhum pagamento encontrado"})}):(ae?g.slice(0,10):g).map(t=>e.jsxs("tr",{children:[ee.id&&e.jsx("td",{"data-label":"ID",children:e.jsx("button",{className:"btn btn-link",onClick:()=>re(t.id),title:"Ver completo",children:t.id})}),ee.status&&e.jsx("td",{"data-label":"Status",children:e.jsx(l,{variant:l.getVariant(t.status),children:t.status||"‚Äî"})}),ee.method&&e.jsx("td",{"data-label":"M√©todo",children:t.payment_method_id||"‚Äî"}),ee.amount&&e.jsxs("td",{"data-label":"Valor",children:["R$ ",Number(t.transaction_amount||0).toLocaleString("pt-BR")]}),ee.installments&&e.jsx("td",{"data-label":"Parcelas",children:t.installments||1}),ee.payer&&e.jsx("td",{"data-label":"Payer",children:t?.payer?.email||"‚Äî"}),ee.external_reference&&e.jsx("td",{"data-label":"Ref. Externa",children:t.external_reference||"‚Äî"}),ee.description&&e.jsx("td",{"data-label":"Descri√ß√£o",children:t.description||"‚Äî"}),ee.created&&e.jsx("td",{"data-label":"Criado",children:t.date_created?new Date(t.date_created).toLocaleString("pt-BR"):"‚Äî"}),ee.updated&&e.jsx("td",{"data-label":"Atualizado",children:t.last_modified||t.last_updated?new Date(t.last_modified||t.last_updated).toLocaleString("pt-BR"):"‚Äî"}),ee.actions&&e.jsx("td",{"data-label":"A√ß√µes",children:e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>navigator.clipboard?.writeText(String(t.id)),children:"Copiar ID"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>D(B===t.id?null:t.id),children:B===t.id?"Ocultar":"Ver"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>re(t.id),children:"Ver completo"})]})})]},t.id))})]})}),g.length>10&&e.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-outline",onClick:()=>ne(e=>!e),children:ae?`Mostrar todos (${g.length})`:"Mostrar menos"})}),M&&e.jsxs("section",{className:"card",style:{marginTop:12},children:[e.jsxs("h3",{children:["Pagamento (por ID) #",M?.id]}),e.jsxs("div",{className:"btn-group",style:{marginBottom:8},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{try{navigator.clipboard?.writeText(window.location.href)}catch(e){}},children:"Copiar link"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{L(null),D(null);const e=new URLSearchParams(d);e.delete("paymentId"),o(e)},children:"Fechar painel"})]}),e.jsxs("details",{style:{marginBottom:12},children:[e.jsx("summary",{children:"Atualizar pagamento (PUT)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:8,marginTop:8},children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("input",{type:"radio",name:"updateMode",checked:"gui"===E,onChange:()=>z("gui")})," Campos guiados"]}),e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("input",{type:"radio",name:"updateMode",checked:"json"===E,onChange:()=>z("json")})," JSON avan√ßado"]})]}),"gui"===E?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"capture"}),e.jsxs("select",{value:H.capture,onChange:e=>V(t=>({...t,capture:e.target.value})),children:[e.jsx("option",{value:"",children:"(n√£o enviar)"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}),$.capture&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:$.capture})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"status"}),e.jsxs("select",{value:H.status,onChange:e=>V(t=>({...t,status:e.target.value})),children:[e.jsx("option",{value:"",children:"(n√£o enviar)"}),e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"authorized",children:"authorized"}),e.jsx("option",{value:"in_process",children:"in_process"}),e.jsx("option",{value:"rejected",children:"rejected"}),e.jsx("option",{value:"cancelled",children:"cancelled"}),e.jsx("option",{value:"refunded",children:"refunded"}),e.jsx("option",{value:"charged_back",children:"charged_back"})]}),$.status&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:$.status})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"transaction_amount"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"ex.: 58.8",value:H.transaction_amount,onChange:e=>V(t=>({...t,transaction_amount:e.target.value}))}),$.transaction_amount&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:$.transaction_amount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"date_of_expiration"}),e.jsx("input",{type:"text",placeholder:"yyyy-MM-dd'T'HH:mm:ss.SSS-04:00",value:H.date_of_expiration,onChange:e=>V(t=>({...t,date_of_expiration:e.target.value}))}),$.date_of_expiration&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:$.date_of_expiration})]})]}):e.jsx("textarea",{placeholder:'Ex.: {"capture": false, "status": "cancelled", "transaction_amount": 58.8}',value:A,onChange:e=>P(e.target.value),style:{minHeight:120}}),"json"===E&&F.length>0&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:F.map((t,a)=>e.jsxs("div",{children:["‚Ä¢ ",t]},a))}),e.jsx("div",{className:"muted",children:"Campos comuns: `capture` (boolean), `status` (approved|pending|authorized|in_process|rejected|cancelled|refunded|charged_back), `transaction_amount` (number), `date_of_expiration` (ISO yyyy-MM-dd'T'HH:mm:ss.SSSZ)"}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=Number(M?.transaction_amount||58.8);"gui"===E?V(t=>({...t,capture:"false",status:"cancelled",transaction_amount:String(e)})):P(JSON.stringify({capture:!1,status:"cancelled",transaction_amount:e},null,2))},children:"Preencher exemplo"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=new Date((new Date).getTime()+1728e5).toISOString().slice(0,23)+"-04:00";V(t=>({...t,date_of_expiration:e}))},children:"Expira em 48h"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{V({capture:"",status:"",transaction_amount:"",date_of_expiration:""}),P("")},children:"Limpar"}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(!T&&!M?.id)return void x("Informe o ID do pagamento");const e=T||String(M?.id||"");if("gui"===E&&W)return void x("Corrija os campos antes de atualizar");let t=null;if("gui"===E){const e={};"true"!==H.capture&&"false"!==H.capture||(e.capture="true"===H.capture),H.status&&(e.status=H.status),""===H.transaction_amount||Number.isNaN(Number(H.transaction_amount))||(e.transaction_amount=Number(H.transaction_amount)),H.date_of_expiration&&(e.date_of_expiration=H.date_of_expiration),t=e}else try{t=A?JSON.parse(A):null}catch(a){return x("Payload JSON inv√°lido"),void y(String(a?.message||a))}if(t&&"object"==typeof t&&0!==Object.keys(t).length)try{p(!0),x(""),y(null);const a=await r(e,t);L(a?.data?.data||a?.data||a)}catch(a){x(a?.message||"Erro ao atualizar pagamento"),y(a?.data?.details||null)}finally{p(!1)}else x("Payload √© obrigat√≥rio para atualizar")},disabled:m||"gui"===E&&W,children:m?"Atualizando‚Ä¶":"Atualizar pagamento"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Status"}),e.jsx("div",{children:e.jsx(l,{variant:l.getVariant(M?.status),children:M?.status||"‚Äî"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"M√©todo"}),e.jsx("div",{children:M?.payment_method_id||M?.payment_method?.id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Valor"}),e.jsxs("div",{children:["R$ ",Number(M?.transaction_amount||0).toLocaleString("pt-BR")]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Aprovado em"}),e.jsx("div",{children:M?.date_approved?new Date(M.date_approved).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Criado em"}),e.jsx("div",{children:M?.date_created?new Date(M.date_created).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Atualizado"}),e.jsx("div",{children:M?.date_last_updated?new Date(M.date_last_updated).toLocaleString("pt-BR"):M?.last_modified?new Date(M.last_modified).toLocaleString("pt-BR"):"‚Äî"})]})]}),e.jsxs("details",{style:{marginTop:12},children:[e.jsx("summary",{children:"Ver detalhes brutos"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:JSON.stringify(M,null,2)})]}),e.jsxs("details",{style:{marginTop:12},children:[e.jsx("summary",{children:"Resumo DB (app_payments)"}),Q?e.jsx("div",{className:"muted",children:"Carregando resumo do banco‚Ä¶"}):Z?e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:Z}):G?.payment?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payment_id"}),e.jsx("div",{children:G.payment.payment_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"app_id"}),e.jsx("div",{children:G.payment.app_id??"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"preference_id"}),e.jsx("div",{children:G.payment.preference_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"status"}),e.jsx("div",{children:G.payment.status||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"amount"}),e.jsx("div",{children:null!=G.payment.amount?Number(G.payment.amount).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"currency"}),e.jsx("div",{children:G.payment.currency||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payer_email"}),e.jsx("div",{children:G.payment.payer_email||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"status_detail"}),e.jsx("div",{children:G.payment.status_detail||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payment_type_id"}),e.jsx("div",{children:G.payment.payment_type_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"issuer_id"}),e.jsx("div",{children:G.payment.issuer_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"net_received_amount"}),e.jsx("div",{children:null!=G.payment.net_received_amount?Number(G.payment.net_received_amount).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"installment_amount"}),e.jsx("div",{children:null!=G.payment.installment_amount?Number(G.payment.installment_amount).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payer_document_type"}),e.jsx("div",{children:G.payment.payer_document_type||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payer_document_number"}),e.jsx("div",{children:G.payment.payer_document_number||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"updated_at"}),e.jsx("div",{children:G.payment.updated_at?new Date(G.payment.updated_at).toLocaleString("pt-BR"):"‚Äî"})]})]}):e.jsx("div",{className:"muted",children:"Nenhum registro no banco para este payment_id"}),Array.isArray(G?.audit)&&G.audit.length>0&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"muted",children:"Auditoria (√∫ltimos eventos)"}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Evento"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Quando"}),e.jsx("th",{children:"Notas"})]})}),e.jsx("tbody",{children:G.audit.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.event||t.action||"‚Äî"}),e.jsx("td",{children:t.status||t.to_status||"‚Äî"}),e.jsx("td",{children:t.created_at?new Date(t.created_at).toLocaleString("pt-BR"):"‚Äî"}),e.jsx("td",{children:t.notes||""})]},a))})]})]}),G?.payment?.mp_response_json&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"muted",children:"Resposta MP (persistida)"}),e.jsx("div",{className:"btn-group",style:{marginBottom:8},children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{try{navigator.clipboard?.writeText(String(G.payment.mp_response_json||""))}catch(e){}},children:"Copiar JSON"})}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:(()=>{try{return JSON.stringify(JSON.parse(G.payment.mp_response_json),null,2)}catch{return String(G.payment.mp_response_json)}})()})]}),!G?.payment?.mp_response_json&&G?.payment?.response_json&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"muted",children:"Resposta MP (persistida)"}),e.jsx("div",{className:"btn-group",style:{marginBottom:8},children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{try{navigator.clipboard?.writeText(String(G.payment.response_json||""))}catch(e){}},children:"Copiar JSON"})}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:(()=>{try{return JSON.stringify(JSON.parse(G.payment.response_json),null,2)}catch{return String(G.payment.response_json)}})()})]})]})]}),B&&!M&&e.jsxs("section",{className:"card",style:{marginTop:12},children:[e.jsx("h3",{children:"Detalhes brutos"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:JSON.stringify(g.find(e=>e.id===B)||{},null,2)})]}),e.jsxs("section",{style:{marginTop:12},children:[e.jsxs("div",{className:"muted",children:["Total retornado: ",v.total," | Limit: ",v.limit," | Offset: ",v.offset]}),h&&e.jsxs("div",{className:"muted",style:{color:"#FF6B6B",marginTop:8},children:[e.jsx("div",{children:"Detalhes do erro:"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:"object"==typeof j?JSON.stringify(j,null,2):String(j||"")})]})]})]})}export{d as default};

import{j as a}from"./index-sK2loqLz.js";import{r as e}from"./router-5U3rcizL.js";import{N as s}from"./Navbar-B2cPrdsN.js";import{r}from"./realtime-BxkdmVbQ.js";import{g as n}from"./rankingAPI-5toaWGiO.js";const i="_page_14avj_9",l="_hero_14avj_77",t="_heroContent_14avj_97",o="_heroTitle_14avj_107",c="_heroSubtitle_14avj_149",d="_podiumSection_14avj_169",_="_podiumContainer_14avj_185",m="_podiumItem_14avj_201",j="_firstPlace_14avj_247",v="_avatarFrame_14avj_277",p="_crownBadge_14avj_293",h="_secondPlace_14avj_329",u="_medalBadge_14avj_361",x="_thirdPlace_14avj_371",N="_avatarImage_14avj_435",g="_avatarPlaceholder_14avj_447",f="_podiumInfo_14avj_501",b="_podiumPosition_14avj_509",S="_podiumName_14avj_527",C="_podiumScore_14avj_543",y="_podiumReward_14avj_567",k="_filtersSection_14avj_585",P="_filtersContainer_14avj_601",w="_searchInput_14avj_627",A="_filterSelect_14avj_673",I="_minScoreWrapper_14avj_717",M="_minScoreLabel_14avj_729",T="_minScoreInput_14avj_739",L="_leaderboardSection_14avj_771",B="_leaderboardHeader_14avj_787",F="_leaderboardTitle_14avj_803",R="_leaderboardCount_14avj_817",$="_rankCardsList_14avj_829",E="_rankCard_14avj_829",q="_rankPosition_14avj_933",z="_rankTop10_14avj_959",D="_rankAvatar_14avj_969",O="_rankAvatarImg_14avj_989",U="_rankAvatarPlaceholder_14avj_1001",V="_rankInfo_14avj_1021",H="_rankName_14avj_1031",W="_rankArea_14avj_1051",G="_rankScore_14avj_1077",J="_scoreIcon_14avj_1101",K="_pagination_14avj_1111",Q="_paginationBtn_14avj_1127",X="_paginationInfo_14avj_1179",Y="_loadingContainer_14avj_1193",Z="_spinner_14avj_1211",aa="_loadingText_14avj_1237",ea="_errorContainer_14avj_1249",sa="_errorIcon_14avj_1259",ra="_errorText_14avj_1269",na="_retryBtn_14avj_1281",ia="_emptyState_14avj_1317",la="_emptyIcon_14avj_1327",ta="_emptyTitle_14avj_1339",oa="_emptyText_14avj_1351",ca="_adminPanel_14avj_1363",da="_adminTitle_14avj_1379",_a="_adminForm_14avj_1393",ma="_formRow_14avj_1405",ja="_adminInput_14avj_1417",va="_adminSelect_14avj_1419",pa="_adminActions_14avj_1457",ha="_btnPrimary_14avj_1467",ua="_adminHint_14avj_1503",xa=({data:e,position:s})=>{if(!e)return null;const r=1===s?j:2===s?h:x,n={1:null,2:"ü•à",3:"ü•â"};return a.jsxs("div",{className:`${m} ${r}`,children:[1===s&&a.jsx("div",{className:p,title:"Campe√£o",children:"üëë"}),a.jsxs("div",{className:v,children:[e.avatar?a.jsx("img",{src:e.avatar,alt:e.name,className:N,loading:"lazy",onError:a=>{a.currentTarget.style.display="none"}}):a.jsx("div",{className:g,children:"üë§"}),n[s]&&a.jsx("span",{className:u,children:n[s]})]}),a.jsxs("div",{className:f,children:[a.jsx("span",{className:b,children:{1:"1¬∫ Lugar",2:"2¬∫ Lugar",3:"3¬∫ Lugar"}[s]}),a.jsx("h3",{className:S,children:e.name||"‚Äî"}),a.jsxs("span",{className:C,children:["‚≠ê ",e.score??0," pts"]}),e.reward&&a.jsxs("span",{className:y,children:["üéÅ ",e.reward]})]})]})},Na=({data:e,position:s})=>{const r=s<=10;return a.jsxs("li",{className:E,children:[a.jsxs("div",{className:`${q} ${r?z:""}`,children:["#",s]}),a.jsx("div",{className:D,children:e.avatar?a.jsx("img",{src:e.avatar,alt:e.name,className:O,loading:"lazy",onError:a=>{a.currentTarget.style.display="none"}}):a.jsx("div",{className:U,children:"üë§"})}),a.jsxs("div",{className:V,children:[a.jsx("h4",{className:H,children:e.name}),e.area&&a.jsx("span",{className:W,children:e.area})]}),a.jsxs("div",{className:G,children:[a.jsx("span",{className:J,children:"‚≠ê"}),e.score," pts"]})]})};function ga(){const m="1"===new URLSearchParams(window.location.search).get("admin"),[j,v]=e.useState([]),[p,h]=e.useState([]),[u,x]=e.useState(!0),[N,g]=e.useState(""),[f,b]=e.useState(""),[S,C]=e.useState(""),[y,E]=e.useState("score"),[q,z]=e.useState("desc"),[D,O]=e.useState(0),[U,V]=e.useState(1),H=async()=>{try{x(!0),g("");const a=await n(),e=(Array.isArray(a?.crafters)?a.crafters:[]).map(a=>({...a,id:a.id,nome:a.nome||a.name||a.nome_completo||"",points:a.points??a.pontos??a.score??0,area:a.area_interesse||a.area||a.stack||a.especialidade||"",avatar_url:a.avatar_url||a.avatarUrl||a.foto||a.photo||null})),s=Array.isArray(a?.top3)?a.top3.map(a=>{const s=a.crafter_id||a.crafterId||a.id,r=e.find(a=>a.id===s)||{};return{place:a.position||a.posicao,name:r.nome||"‚Äî",score:r.points??0,reward:a.reward||a.recompensa||"",avatar:r.avatar_url||null}}):[],r=e.map(a=>({id:a.id,name:a.nome||"‚Äî",score:Number.isFinite(a.points)?a.points:0,area:a.area||"",avatar:a.avatar_url||null}));v(s),h(r)}catch(a){const e=String(a?.message||"").toLowerCase();e.includes("conex√£o")||e.includes("fetch")||e.includes("network")||e.includes("failed")?g("Erro de conex√£o: Verifique sua internet e tente novamente"):e.includes("401")||e.includes("403")?g("Acesso n√£o autorizado ao ranking"):g("Ranking em processamento. Volte em instantes!"),v([]),h([])}finally{x(!1)}};e.useEffect(()=>{H();const a=r.subscribe("ranking_changed",()=>{H()});return()=>a()},[]);const W=e.useMemo(()=>Array.from(new Set((p||[]).map(a=>a.area).filter(Boolean))).sort(),[p]),G=e.useMemo(()=>(p||[]).filter(a=>a.name.toLowerCase().includes(f.toLowerCase())).filter(a=>!S||a.area===S).filter(a=>(a.score??0)>=(Number(D)||0)).sort((a,e)=>{const s="asc"===q?1:-1;return"name"===y?a.name.localeCompare(e.name)*s:"area"===y?(a.area||"").localeCompare(e.area||"")*s:((a.score??0)-(e.score??0))*s}),[p,f,S,D,y,q]),J=Math.max(1,Math.ceil(G.length/20)),ga=G.slice(20*(U-1),20*U),fa=a=>(j||[]).find(e=>e.place===a);return a.jsxs("div",{className:i,children:[a.jsx(s,{}),a.jsx("section",{className:l,children:a.jsxs("div",{className:t,children:[a.jsx("h1",{className:o,children:"Ranking dos Crafters"}),a.jsx("p",{className:c,children:"Os maiores destaques da semana nos projetos CodeCraft. Conquiste pontos, suba no ranking e ganhe recompensas!"})]})}),u&&a.jsxs("div",{className:Y,children:[a.jsx("div",{className:Z}),a.jsx("span",{className:aa,children:"Carregando ranking..."})]}),N&&!u&&a.jsxs("div",{className:ea,children:[a.jsx("div",{className:sa,children:"‚ö†Ô∏è"}),a.jsx("p",{className:ra,children:N}),a.jsx("button",{className:na,onClick:H,children:"Tentar novamente"})]}),!u&&!N&&a.jsxs(a.Fragment,{children:[j.length>0&&a.jsx("section",{className:d,children:a.jsxs("div",{className:_,children:[a.jsx(xa,{data:fa(2),position:2}),a.jsx(xa,{data:fa(1),position:1}),a.jsx(xa,{data:fa(3),position:3})]})}),a.jsx("section",{className:k,children:a.jsxs("div",{className:P,children:[a.jsx("input",{type:"text",placeholder:"Buscar por nome...",value:f,onChange:a=>{b(a.target.value),V(1)},className:w,"aria-label":"Buscar por nome"}),a.jsxs("select",{value:S,onChange:a=>{C(a.target.value),V(1)},className:A,"aria-label":"Filtrar por √°rea",children:[a.jsx("option",{value:"",children:"Todas as √°reas"}),W.map(e=>a.jsx("option",{value:e,children:e},e))]}),a.jsxs("div",{className:I,children:[a.jsx("label",{htmlFor:"minScore",className:M,children:"M√≠n. pontos"}),a.jsx("input",{id:"minScore",type:"number",min:"0",value:D,onChange:a=>{O(a.target.value),V(1)},className:T})]}),a.jsxs("select",{value:y,onChange:a=>E(a.target.value),className:A,"aria-label":"Ordenar por",children:[a.jsx("option",{value:"score",children:"Pontua√ß√£o"}),a.jsx("option",{value:"name",children:"Nome"}),a.jsx("option",{value:"area",children:"√Årea"})]}),a.jsxs("select",{value:q,onChange:a=>z(a.target.value),className:A,"aria-label":"Dire√ß√£o da ordena√ß√£o",children:[a.jsx("option",{value:"desc",children:"Maior ‚Üí Menor"}),a.jsx("option",{value:"asc",children:"Menor ‚Üí Maior"})]})]})}),a.jsxs("section",{className:L,children:[a.jsxs("div",{className:B,children:[a.jsx("h2",{className:F,children:"Leaderboard"}),a.jsxs("span",{className:R,children:[G.length," participante",1!==G.length?"s":""]})]}),0===ga.length?a.jsxs("div",{className:ia,children:[a.jsx("div",{className:la,children:"üèÜ"}),a.jsx("h3",{className:ta,children:"Nenhum participante encontrado"}),a.jsx("p",{className:oa,children:"Ajuste os filtros ou volte em breve para ver os rankings."})]}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:$,"aria-live":"polite",children:ga.map((e,s)=>a.jsx(Na,{data:e,position:20*(U-1)+s+1},e.id||`${e.name}-${s}`))}),J>1&&a.jsxs("div",{className:K,children:[a.jsx("button",{className:Q,onClick:()=>V(Math.max(1,U-1)),disabled:1===U,"aria-label":"P√°gina anterior",children:"‚óÄ"}),a.jsxs("span",{className:X,children:["P√°gina ",U," de ",J]}),a.jsx("button",{className:Q,onClick:()=>V(Math.min(J,U+1)),disabled:U===J,"aria-label":"Pr√≥xima p√°gina",children:"‚ñ∂"})]})]})]}),m&&a.jsx("section",{className:L,children:a.jsxs("aside",{className:ca,"aria-label":"√Årea administrativa",children:[a.jsx("h3",{className:da,children:"Administra√ß√£o"}),a.jsxs("form",{className:_a,onSubmit:a=>{a.preventDefault()},children:[a.jsxs("div",{className:ma,children:[a.jsx("input",{type:"text",placeholder:"Nome do participante",className:ja}),a.jsx("input",{type:"number",placeholder:"Pontua√ß√£o",className:ja})]}),a.jsxs("div",{className:ma,children:[a.jsxs("select",{defaultValue:"badge",className:va,children:[a.jsx("option",{value:"badge",children:"Badge"}),a.jsx("option",{value:"moeda",children:"Moedas"}),a.jsx("option",{value:"certificado",children:"Certificado"})]}),a.jsx("input",{type:"text",placeholder:"Descri√ß√£o da recompensa",className:ja})]}),a.jsx("div",{className:pa,children:a.jsx("button",{type:"submit",className:ha,children:"Salvar"})})]}),a.jsx("p",{className:ua,children:'Para exibir esta √°rea: adicionar "?admin=1" √† URL.'})]})})]})]})}export{ga as default};

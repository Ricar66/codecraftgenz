import{j as e,a3 as s,aC as a,aD as t,l as r,af as i,x as l,aE as o,aF as n,am as c,an as d,b as x,a9 as j,aa as h,ae as p,ah as u,$ as _,a as m}from"./index-iOmXG8wF.js";import{r as v}from"./router-5U3rcizL.js";import{b as g,c as N,F as b}from"./useAdminRepo-BLD_c3Vm.js";import{A as C,S as f}from"./StatusBadge-p-exY-w4.js";import"./realtime-BxkdmVbQ.js";import"./projectsAPI-BVIThgyL.js";import"./dataCache-D0LcSMWP.js";import"./rankingAPI-DimWtXnB.js";import"./userAPI-CYZ8PJb_.js";const y="_page_18ox2_7",S="_header_18ox2_13",R="_headerTitle_18ox2_31",P="_headerIcon_18ox2_43",k="_headerActions_18ox2_85",w="_viewBtn_18ox2_95",B="_exportBtn_18ox2_95",$="_toast_18ox2_147",T="_kpisGrid_18ox2_187",E="_kpiCard_18ox2_201",L="_kpiValue_18ox2_235",D="_kpiTotal_18ox2_247",A="_kpiPaid_18ox2_249",F="_kpiPending_18ox2_251",I="_kpiDiscount_18ox2_253",M="_kpiCount_18ox2_255",O="_filtersCard_18ox2_261",G="_filters_18ox2_261",V="_searchInput_18ox2_287",U="_filterSelect_18ox2_287",z="_pagination_18ox2_317",H="_pageBtn_18ox2_339",J="_cardsGrid_18ox2_383",K="_financeCard_18ox2_397",X="_cardHeader_18ox2_417",Y="_cardType_18ox2_445",q="_cardValue_18ox2_457",Q="_cardProject_18ox2_471",W="_progressContainer_18ox2_489",Z="_progressHeader_18ox2_497",ee="_progressBar_18ox2_513",se="_progressFill_18ox2_527",ae="_cardActions_18ox2_541",te="_editBtn_18ox2_557",re="_toggleBtn_18ox2_557",ie="_deleteBtn_18ox2_557",le="_tableCard_18ox2_629",oe="_table_18ox2_629",ne="_itemCell_18ox2_695",ce="_valueCell_18ox2_697",de="_emptyRow_18ox2_701",xe="_formCard_18ox2_747",je="_formTitle_18ox2_757",he="_formGrid_18ox2_777",pe="_formRow_18ox2_789",ue="_formGroup_18ox2_801",_e="_input_18ox2_825",me="_select_18ox2_825",ve="_progressInput_18ox2_855",ge="_formActions_18ox2_901",Ne="_saveBtn_18ox2_917",be="_cancelBtn_18ox2_917",Ce="_loadingState_18ox2_979",fe="_spinner_18ox2_999";function ye(){const{data:ye,loading:Se,error:Re,refresh:Pe}=g(),{data:ke}=N(),[we,Be]=v.useState({item:"",valor:0,status:"pending",type:"other",project_id:"",progress:0}),[$e,Te]=v.useState(null),[Ee,Le]=v.useState(!1),[De,Ae]=v.useState({status:"",type:"",project:""}),[Fe,Ie]=v.useState("table"),[Me,Oe]=v.useState(""),[Ge,Ve]=v.useState(1),[Ue,ze]=v.useState(""),He=e=>{ze(e),setTimeout(()=>ze(""),2500)},Je=v.useMemo(()=>(ye||[]).filter(e=>{const s=!Me||(e.item||"").toLowerCase().includes(Me.toLowerCase())||(e.status||"").toLowerCase().includes(Me.toLowerCase()),a=!De.status||e.status===De.status,t=!De.type||e.type===De.type,r=!De.project||e.project_id===De.project;return s&&a&&t&&r}),[ye,Me,De]),Ke=Math.max(1,Math.ceil(Je.length/10)),Xe=Je.slice(10*(Ge-1),10*Ge),Ye=v.useMemo(()=>({total:(ye||[]).reduce((e,s)=>e+Number(s.valor||0),0),paid:(ye||[]).filter(e=>"paid"===e.status).reduce((e,s)=>e+Number(s.valor||0),0),pending:(ye||[]).filter(e=>"pending"===e.status).reduce((e,s)=>e+Number(s.valor||0),0),discount:(ye||[]).filter(e=>"discount"===e.status).reduce((e,s)=>e+Number(s.valor||0),0),count:(ye||[]).length}),[ye]),qe=e=>{Te(e.id),Be({item:e.item||"",valor:Number(e.valor||0),status:e.status||"pending",type:e.type||"other",project_id:e.project_id||"",progress:Number(e.progress||0)}),document.getElementById("finance-form")?.scrollIntoView({behavior:"smooth"})},Qe=async e=>{if(window.confirm("Confirma a exclusão deste registro financeiro?"))try{await m(`/api/financas/${e}`,{method:"DELETE"}),He("Registro excluído!"),Pe()}catch(s){He("Erro ao excluir: "+s.message)}},We=async e=>{const s="paid"===e.status?"pending":"paid";await b.update(e.id,{status:s}),He("Status alterado para "+("paid"===s?"Pago":"Pendente")),Pe()},Ze=e=>{const s=(ke||[]).find(s=>s.id===e);return s?s.title||s.titulo||s.nome:"Projeto não encontrado"},es=e=>{switch(e){case"paid":return"success";case"pending":return"warning";case"discount":return"info";case"cancelled":return"error";default:return"neutral"}},ss={project:"Projeto",discount:"Desconto",other:"Outros"};return Se?e.jsx("div",{className:y,children:e.jsxs("div",{className:Ce,children:[e.jsx("div",{className:fe}),e.jsx("p",{children:"Carregando dados financeiros..."})]})}):e.jsxs("div",{className:y,children:[e.jsxs("header",{className:S,children:[e.jsxs("div",{className:R,children:[e.jsx(s,{className:P}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestão Financeira"}),e.jsx("p",{children:"Gerencie receitas, despesas e integrações com projetos"})]})]}),e.jsxs("div",{className:k,children:[e.jsx("button",{onClick:()=>Ie("table"===Fe?"cards":"table"),className:w,children:"table"===Fe?e.jsxs(e.Fragment,{children:[e.jsx(a,{})," Cards"]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{})," Tabela"]})}),e.jsxs("button",{onClick:()=>{const e=b.exportCsv(),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download="financas.csv",t.click(),URL.revokeObjectURL(a)},className:B,children:[e.jsx(r,{})," Exportar CSV"]})]})]}),Ue&&e.jsxs("div",{className:$,children:[e.jsx(i,{})," ",Ue]}),e.jsxs("div",{className:T,children:[e.jsxs(C,{variant:"outlined",className:E,children:[e.jsxs("h3",{children:[e.jsx(s,{})," Total"]}),e.jsxs("p",{className:`${L} ${D}`,children:["R$ ",Ye.total.toLocaleString("pt-BR")]})]}),e.jsxs(C,{variant:"outlined",className:E,children:[e.jsxs("h3",{children:[e.jsx(i,{})," Pago"]}),e.jsxs("p",{className:`${L} ${A}`,children:["R$ ",Ye.paid.toLocaleString("pt-BR")]})]}),e.jsxs(C,{variant:"outlined",className:E,children:[e.jsxs("h3",{children:[e.jsx(l,{})," Pendente"]}),e.jsxs("p",{className:`${L} ${F}`,children:["R$ ",Ye.pending.toLocaleString("pt-BR")]})]}),e.jsxs(C,{variant:"outlined",className:E,children:[e.jsxs("h3",{children:[e.jsx(o,{})," Descontos"]}),e.jsxs("p",{className:`${L} ${I}`,children:["R$ ",Ye.discount.toLocaleString("pt-BR")]})]}),e.jsxs(C,{variant:"outlined",className:E,children:[e.jsxs("h3",{children:[e.jsx(n,{})," Registros"]}),e.jsx("p",{className:`${L} ${M}`,children:Ye.count})]})]}),e.jsx(C,{variant:"elevated",className:O,children:e.jsxs("div",{className:G,children:[e.jsx("input",{type:"text",placeholder:"Buscar item ou status...",value:Me,onChange:e=>{Oe(e.target.value),Ve(1)},className:V}),e.jsxs("select",{value:De.status,onChange:e=>{Ae({...De,status:e.target.value}),Ve(1)},className:U,children:[e.jsx("option",{value:"",children:"Todos os Status"}),e.jsx("option",{value:"pending",children:"Pendente"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"discount",children:"Desconto"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]}),e.jsxs("select",{value:De.type,onChange:e=>{Ae({...De,type:e.target.value}),Ve(1)},className:U,children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"project",children:"Projeto"}),e.jsx("option",{value:"discount",children:"Desconto"}),e.jsx("option",{value:"other",children:"Outros"})]}),e.jsxs("select",{value:De.project,onChange:e=>{Ae({...De,project:e.target.value}),Ve(1)},className:U,children:[e.jsx("option",{value:"",children:"Todos os Projetos"}),(ke||[]).map(s=>e.jsx("option",{value:s.id,children:s.title||s.titulo||s.nome},s.id))]}),e.jsxs("div",{className:z,children:[e.jsx("button",{onClick:()=>Ve(Math.max(1,Ge-1)),disabled:1===Ge,className:H,children:e.jsx(c,{})}),e.jsxs("span",{children:["Página ",Ge," de ",Ke]}),e.jsx("button",{onClick:()=>Ve(Math.min(Ke,Ge+1)),disabled:Ge===Ke,className:H,children:e.jsx(d,{})})]})]})}),Re&&e.jsx("p",{style:{color:"#ef4444"},children:Re}),"cards"===Fe&&e.jsx("div",{className:J,children:0===Xe.length?e.jsx(C,{variant:"outlined",style:{gridColumn:"1 / -1",textAlign:"center",padding:40},children:e.jsx("p",{children:"Nenhum registro encontrado"})}):Xe.map(s=>e.jsxs(C,{variant:"elevated",className:K,style:{borderColor:"paid"===s.status?"#10B981":"pending"===s.status?"#F59E0B":"discount"===s.status?"#D12BF2":"#666"},children:[e.jsxs("div",{className:X,children:[e.jsxs("div",{children:[e.jsx("h3",{children:s.item}),e.jsxs("p",{className:Y,children:[e.jsx(x,{})," ",ss[s.type]||s.type]})]}),e.jsx(f,{variant:es(s.status),children:s.status})]}),e.jsxs("p",{className:q,children:["R$ ",Number(s.valor||0).toLocaleString("pt-BR")]}),s.project_id&&e.jsxs("p",{className:Q,children:[e.jsx(x,{})," ",Ze(s.project_id)]}),s.progress>0&&e.jsxs("div",{className:W,children:[e.jsxs("div",{className:Z,children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[s.progress,"%"]})]}),e.jsx("div",{className:ee,children:e.jsx("div",{className:se,style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:ae,children:[e.jsx("button",{onClick:()=>qe(s),className:te,title:"Editar",children:e.jsx(j,{})}),e.jsx("button",{onClick:()=>We(s),className:re,title:"paid"===s.status?"Marcar pendente":"Marcar pago",children:"paid"===s.status?e.jsx(l,{}):e.jsx(i,{})}),e.jsx("button",{onClick:()=>Qe(s.id),className:ie,title:"Excluir",children:e.jsx(h,{})})]})]},s.id))}),"table"===Fe&&e.jsx(C,{variant:"elevated",className:le,children:e.jsxs("table",{className:oe,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Projeto"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progresso"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===Xe.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:de,children:"Nenhum registro encontrado"})}):Xe.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:ne,children:s.item}),e.jsx("td",{children:ss[s.type]||s.type}),e.jsx("td",{children:s.project_id?Ze(s.project_id):"—"}),e.jsxs("td",{className:ce,children:["R$ ",Number(s.valor||0).toLocaleString("pt-BR")]}),e.jsx("td",{children:e.jsx(f,{variant:es(s.status),children:s.status})}),e.jsx("td",{children:s.progress>0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:ee,style:{width:60},children:e.jsx("div",{className:se,style:{width:`${s.progress}%`}})}),e.jsxs("span",{style:{fontSize:"0.8rem"},children:[s.progress,"%"]})]}):"—"}),e.jsx("td",{children:s.date?new Date(s.date).toLocaleDateString("pt-BR"):"—"}),e.jsx("td",{children:e.jsxs("div",{className:ae,style:{marginTop:0,paddingTop:0,borderTop:"none"},children:[e.jsx("button",{onClick:()=>qe(s),className:te,title:"Editar",children:e.jsx(j,{})}),e.jsx("button",{onClick:()=>We(s),className:re,title:"paid"===s.status?"Marcar pendente":"Marcar pago",children:"paid"===s.status?e.jsx(l,{}):e.jsx(i,{})}),e.jsx("button",{onClick:()=>Qe(s.id),className:ie,title:"Excluir",children:e.jsx(h,{})})]})})]},s.id))})]})}),e.jsxs(C,{variant:"elevated",className:xe,id:"finance-form",children:[e.jsx("h2",{className:je,children:$e?e.jsxs(e.Fragment,{children:[e.jsx(j,{})," Editar Registro"]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{})," Novo Registro Financeiro"]})}),e.jsxs("div",{className:he,children:[e.jsxs("div",{className:pe,children:[e.jsxs("div",{className:ue,children:[e.jsx("label",{children:"Nome do item/serviço *"}),e.jsx("input",{type:"text",placeholder:"Ex: Desenvolvimento do app",value:we.item,onChange:e=>Be({...we,item:e.target.value}),className:_e})]}),e.jsxs("div",{className:ue,children:[e.jsx("label",{children:"Valor (R$) *"}),e.jsx("input",{type:"number",placeholder:"0.00",value:we.valor,onChange:e=>Be({...we,valor:Number(e.target.value)}),className:_e})]}),e.jsxs("div",{className:ue,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:we.status,onChange:e=>Be({...we,status:e.target.value}),className:me,children:[e.jsx("option",{value:"pending",children:"Pendente"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"discount",children:"Desconto"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:pe,children:[e.jsxs("div",{className:ue,children:[e.jsx("label",{children:"Tipo"}),e.jsxs("select",{value:we.type,onChange:e=>Be({...we,type:e.target.value}),className:me,children:[e.jsx("option",{value:"other",children:"Outros"}),e.jsx("option",{value:"project",children:"Projeto"}),e.jsx("option",{value:"discount",children:"Desconto"})]})]}),e.jsxs("div",{className:ue,children:[e.jsx("label",{children:"Projeto (opcional)"}),e.jsxs("select",{value:we.project_id,onChange:e=>Be({...we,project_id:e.target.value}),className:me,children:[e.jsx("option",{value:"",children:"Selecionar projeto"}),(ke||[]).map(s=>e.jsx("option",{value:s.id,children:s.title||s.titulo||s.nome},s.id))]})]}),e.jsxs("div",{className:ue,children:[e.jsx("label",{children:"Progresso"}),e.jsxs("div",{className:ve,children:[e.jsx("input",{type:"range",min:"0",max:"100",value:we.progress,onChange:e=>Be({...we,progress:Number(e.target.value)})}),e.jsxs("span",{children:[we.progress,"%"]})]})]})]})]}),e.jsxs("div",{className:ge,children:[e.jsxs("button",{onClick:async()=>{Le(!0);try{const e={...we};e.valor=Number(e.valor),e.progress=Number(e.progress),e.date=(new Date).toISOString(),$e?await b.update($e,e):await m("/api/financas",{method:"POST",body:JSON.stringify(e)}),Be({item:"",valor:0,status:"pending",type:"other",project_id:"",progress:0}),Te(null),He($e?"Registro atualizado!":"Registro criado!"),Pe()}catch(e){He("Erro ao salvar: "+e.message)}finally{Le(!1)}},disabled:Ee||!we.item||!we.valor,className:Ne,children:[e.jsx(u,{})," ",$e?"Atualizar":"Criar"," Registro"]}),$e&&e.jsxs("button",{onClick:()=>{Te(null),Be({item:"",valor:0,status:"pending",type:"other",project_id:"",progress:0})},className:be,children:[e.jsx(_,{})," Cancelar"]})]})]})]})}export{ye as default};

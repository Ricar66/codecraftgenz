import{u as a,j as e,av as s,a2 as l,ah as t,$ as r,k as i,i as n,h as c,a9 as o,al as d,ak as m,g as u,aa as p,am as h,an as _,ae as x,aq as j,l as v}from"./index-sK2loqLz.js";import{r as b}from"./router-5U3rcizL.js";import{j as N,k as f,n as g,l as y,m as w}from"./appsAPI-CT4lZjxR.js";import{a as C}from"./urlSanitize-Bu_u8ZdG.js";import{A as S,S as k}from"./StatusBadge-Du63B6PO.js";const A="_page_163o9_7",F="_header_163o9_13",E="_headerTitle_163o9_31",U="_headerIcon_163o9_43",B="_refreshBtn_163o9_85",R="_toast_163o9_119",L="_error_163o9_119",T="_appsGrid_163o9_177",$="_emptyCard_163o9_191",z="_emptyState_163o9_195",P="_emptyIcon_163o9_207",I="_appCard_163o9_223",M="_cardThumb_163o9_247",G="_cardBody_163o9_277",O="_feature_163o9_291",D="_cardMeta_163o9_305",W="_price_163o9_323",q="_cardActions_163o9_335",J="_editBtn_163o9_345",V="_visibilityBtn_163o9_345",Z="_buyBtn_163o9_345",Q="_deleteBtn_163o9_345",Y="_platformBadges_163o9_439",H="_platformBadge_163o9_439",K="_platformChecks_163o9_477",X="_platformCheck_163o9_477",aa="_formCard_163o9_525",ea="_formTitle_163o9_535",sa="_formGrid_163o9_555",la="_formRow_163o9_567",ta="_formGroup_163o9_579",ra="_input_163o9_603",ia="_select_163o9_603",na="_textarea_163o9_633",ca="_uploadSection_163o9_671",oa="_uploadRow_163o9_685",da="_fileUpload_163o9_697",ma="_uploadBtn_163o9_733",ua="_uploadError_163o9_765",pa="_thumbPreview_163o9_779",ha="_formActions_163o9_805",_a="_saveBtn_163o9_821",xa="_createBtn_163o9_821",ja="_cancelBtn_163o9_821",va="_pagination_163o9_901",ba="_pageBtn_163o9_917",Na="_pageBtnActive_163o9_973",fa="_pageInfo_163o9_985",ga="_loadingState_163o9_999",ya="_spinner_163o9_1019",wa=a=>Number(a.price??a.preco??0),Ca=a=>a.thumbnail||a.thumb_url||a.thumbUrl||"",Sa=a=>{try{return Number(a||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}catch{return`R$ ${String(a||0)}`}};function ka(){const{hasRole:ka}=a(),[Aa,Fa]=b.useState([]),[Ea,Ua]=b.useState(!0),[Ba,Ra]=b.useState(""),[La,Ta]=b.useState({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]}),[$a,za]=b.useState("R$ 0,00"),[Pa,Ia]=b.useState(null),[Ma,Ga]=b.useState(!1),[Oa,Da]=b.useState(""),[Wa,qa]=b.useState(""),[Ja,Va]=b.useState(1);b.useEffect(()=>{za(Sa(La.price||0))},[La.price]);const Za=a=>{qa(a),setTimeout(()=>qa(""),2500)},Qa=b.useCallback(async()=>{try{Ua(!0),Ra("");const a=ka(["admin"]),e=await N({page:1,pageSize:100,publicFallback:!a}),s=(Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[]).map(a=>({...a,thumbnail:a.thumbnail||a.thumb_url||a.thumbUrl||"",executableUrl:a.executableUrl||a.executable_url||"",mainFeature:a.mainFeature||a.main_feature||a.short_description||"",platforms:(()=>{let e=a.platforms||["windows"];if("string"==typeof e)try{e=JSON.parse(e)}catch{e=[e]}return Array.isArray(e)?e:["windows"]})()}));Fa(s),Va(1)}catch(a){Ra(a.message||"Erro ao carregar apps")}finally{Ua(!1)}},[ka]);b.useEffect(()=>{Qa()},[Qa]);const Ya=a=>{const e=String(a||"");return/^[a-zA-Z]:\\/.test(e)||e.startsWith("file:")},Ha=a=>{Ta(e=>{const s=e.platforms||[],l=s.includes(a)?s.filter(e=>e!==a):[...s,a];return{...e,platforms:l.length>0?l:s}})};return Ea?e.jsx("div",{className:A,children:e.jsxs("div",{className:ga,children:[e.jsx("div",{className:ya}),e.jsx("p",{children:"Carregando aplicativos..."})]})}):e.jsxs("div",{className:A,children:[e.jsxs("header",{className:F,children:[e.jsxs("div",{className:E,children:[e.jsx(s,{className:U}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestão de Aplicativos"}),e.jsxs("p",{children:[Aa.length," apps cadastrados"]})]})]}),e.jsxs("button",{onClick:Qa,className:B,children:[e.jsx(l,{})," Atualizar"]})]}),Wa&&e.jsxs("div",{className:R,children:[e.jsx(t,{})," ",Wa]}),Ba&&e.jsxs("div",{className:L,children:[e.jsx(r,{})," ",Ba]}),(()=>{const a=Math.ceil(Aa.length/6),l=Aa.slice(6*(Ja-1),6*Ja);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:T,children:0===Aa.length?e.jsx(S,{variant:"outlined",className:$,children:e.jsxs("div",{className:z,children:[e.jsx(s,{className:P}),e.jsx("p",{children:"Nenhum aplicativo cadastrado"})]})}):l.map(a=>e.jsxs(S,{variant:"elevated",className:I,children:[e.jsx("div",{className:M,children:e.jsx("img",{src:C(Ca(a)),alt:a.name,onError:a=>{a.currentTarget.src="/logo-principal.png"}})}),e.jsxs("div",{className:G,children:[e.jsx("h3",{children:a.name}),e.jsx("p",{className:O,children:String(a.mainFeature||"").slice(0,80)}),e.jsxs("div",{className:D,children:[e.jsx("span",{className:W,children:Sa(wa(a))}),e.jsx(k,{variant:"available"===a.status?"success":"warning",children:a.status||"draft"})]}),a.platforms&&a.platforms.length>0&&e.jsxs("div",{className:Y,children:[a.platforms.includes("windows")&&e.jsxs("span",{className:H,children:[e.jsx(i,{})," Win"]}),a.platforms.includes("macos")&&e.jsxs("span",{className:H,children:[e.jsx(n,{})," Mac"]}),a.platforms.includes("linux")&&e.jsxs("span",{className:H,children:[e.jsx(c,{})," Linux"]})]})]}),e.jsxs("div",{className:q,children:[e.jsx("button",{onClick:()=>(a=>{let e=a.platforms||["windows"];if("string"==typeof e)try{e=JSON.parse(e)}catch{e=[e]}Array.isArray(e)||(e=["windows"]),Ta({id:a.id,name:a.name||"",mainFeature:a.mainFeature||"",description:a.description||"",status:a.status||"draft",price:a.price||0,thumbnail:a.thumbnail||"",exec_url:a.executableUrl||"",version:a.version||"1.0.0",platforms:e}),document.getElementById("app-form")?.scrollIntoView({behavior:"smooth"})})(a),className:J,title:"Editar",children:e.jsx(o,{})}),e.jsx("button",{onClick:()=>(async a=>{const e="available"===String(a.status||"").toLowerCase()?"draft":"available";try{await f(a.id,{status:e}),Za("Status atualizado!"),Qa()}catch(s){Ra(s.message||"Falha ao alternar")}})(a),className:V,title:"available"===a.status?"Ocultar":"Publicar",children:"available"===a.status?e.jsx(d,{}):e.jsx(m,{})}),e.jsx("button",{onClick:()=>window.open(`/apps/${a.id}/compra`,"_blank"),className:Z,title:"Ver compra",children:e.jsx(u,{})}),e.jsx("button",{onClick:()=>(async a=>{if(confirm("Excluir este aplicativo?"))try{await y(a.id),Za("App excluído!"),Qa()}catch(e){Ra(e.message||"Falha ao excluir")}})(a),className:Q,title:"Excluir",children:e.jsx(p,{})})]})]},a.id))}),a>1&&e.jsxs("div",{className:va,children:[e.jsx("button",{onClick:()=>Va(a=>Math.max(1,a-1)),disabled:1===Ja,className:ba,children:e.jsx(h,{})}),Array.from({length:a},(a,e)=>e+1).map(a=>e.jsx("button",{onClick:()=>Va(a),className:`${ba} ${Ja===a?Na:""}`,children:a},a)),e.jsx("button",{onClick:()=>Va(e=>Math.min(a,e+1)),disabled:Ja===a,className:ba,children:e.jsx(_,{})}),e.jsxs("span",{className:fa,children:[6*(Ja-1)+1,"-",Math.min(6*Ja,Aa.length)," de ",Aa.length]})]})]})})(),e.jsxs(S,{variant:"elevated",className:aa,id:"app-form",children:[e.jsx("h2",{className:ea,children:La.id?e.jsxs(e.Fragment,{children:[e.jsx(o,{})," Editar App"]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{})," Criar Novo App"]})}),e.jsxs("div",{className:sa,children:[e.jsxs("div",{className:la,children:[e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Nome *"}),e.jsx("input",{type:"text",placeholder:"Nome do app",value:La.name,onChange:a=>Ta({...La,name:a.target.value}),className:ra})]}),e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Feature Principal"}),e.jsx("input",{type:"text",placeholder:"Recurso principal",value:La.mainFeature,onChange:a=>Ta({...La,mainFeature:a.target.value}),className:ra})]}),e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Preço (R$)"}),e.jsx("input",{type:"text",value:$a,onChange:a=>{const e=String(a.target.value||"").replace(/[^0-9]/g,""),s=Number(e||0)/100;Ta(a=>({...a,price:s}))},className:ra})]})]}),e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{placeholder:"Descrição completa do app...",value:La.description,onChange:a=>Ta({...La,description:a.target.value}),className:na,rows:"4"})]}),e.jsxs("div",{className:la,children:[e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Thumbnail URL"}),e.jsx("input",{type:"url",placeholder:"https://...",value:La.thumbnail,onChange:a=>Ta({...La,thumbnail:a.target.value}),className:ra})]}),e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"URL do Executável"}),e.jsx("input",{type:"url",placeholder:"https://...",value:La.exec_url,onChange:a=>Ta({...La,exec_url:a.target.value}),className:ra})]})]}),La.id&&e.jsx("div",{className:ca,children:e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Enviar Executável (.exe)"}),e.jsxs("div",{className:oa,children:[e.jsxs("label",{className:da,children:[e.jsx(j,{})," ",Pa?Pa.name:"Selecionar arquivo",e.jsx("input",{type:"file",accept:".exe",onChange:a=>{const e=a.target.files?.[0]||null;if(Ia(e),Da(""),e){const a=e.name.replace(/[^a-zA-Z0-9._-]/g,"_");Ta(e=>({...e,exec_url:`/downloads/${a}`}))}}})]}),e.jsx("button",{onClick:async()=>{if(Pa&&La.id)try{Ga(!0),Da("");const a=await w(La.id,Pa),e=a?.data?.executable_url||a?.executable_url||a?.download_url||a?.url;e?(Ta(a=>({...a,exec_url:e})),Za("Upload concluído!"),Qa()):Da("Upload ok mas URL não retornada."),Ia(null)}catch(a){Da(a.message||"Falha no upload")}finally{Ga(!1)}},disabled:Ma||!Pa,className:ma,children:Ma?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(v,{})," Enviar"]})})]}),Oa&&e.jsx("span",{className:ua,children:Oa})]})}),La.thumbnail&&e.jsx("div",{className:pa,children:e.jsx("img",{src:C(La.thumbnail),alt:"Preview",onError:a=>{a.currentTarget.src="/logo-principal.png"}})}),e.jsxs("div",{className:la,children:[e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:La.status,onChange:a=>Ta({...La,status:a.target.value}),className:ia,children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"available",children:"Disponível"})]})]}),e.jsxs("div",{className:ta,children:[e.jsx("label",{children:"Plataformas"}),e.jsxs("div",{className:K,children:[e.jsxs("label",{className:X,children:[e.jsx("input",{type:"checkbox",checked:La.platforms?.includes("windows"),onChange:()=>Ha("windows")}),e.jsx(i,{})," Windows"]}),e.jsxs("label",{className:X,children:[e.jsx("input",{type:"checkbox",checked:La.platforms?.includes("macos"),onChange:()=>Ha("macos")}),e.jsx(n,{})," macOS"]}),e.jsxs("label",{className:X,children:[e.jsx("input",{type:"checkbox",checked:La.platforms?.includes("linux"),onChange:()=>Ha("linux")}),e.jsx(c,{})," Linux"]})]})]})]})]}),e.jsxs("div",{className:ha,children:[e.jsxs("button",{onClick:async()=>{try{const a={name:La.name,short_description:La.mainFeature,description:La.description,status:La.status,price:Number(La.price||0),thumb_url:La.thumbnail,executable_url:La.exec_url,platforms:La.platforms};if(Ya(La.thumbnail))return void Ra("Thumbnail URL inválida. Use http(s).");if(Ya(La.exec_url))return void Ra("Exec URL inválida. Use http(s).");await f(La.id,a),Ta({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]}),Za("App atualizado!"),Qa()}catch(a){Ra("Erro ao atualizar: "+a.message)}},disabled:!La.id||!La.name,className:_a,children:[e.jsx(t,{})," Salvar"]}),e.jsxs("button",{onClick:async()=>{try{const a={name:La.name,short_description:La.mainFeature,description:La.description,status:La.status,price:Number(La.price||0),thumb_url:La.thumbnail,executable_url:La.exec_url,platforms:La.platforms};if(!a.name)return void Ra("Nome é obrigatório");if(Ya(La.thumbnail))return void Ra("Thumbnail URL inválida. Use http(s).");if(Ya(La.exec_url))return void Ra("Exec URL inválida. Use http(s).");await g(a),Ta({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]}),Za("App criado!"),Qa()}catch(a){Ra("Erro ao criar: "+a.message)}},disabled:!!La.id||!La.name||La.price<=0,className:xa,children:[e.jsx(x,{})," Criar"]}),e.jsxs("button",{onClick:()=>{Ta({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]})},className:ja,children:[e.jsx(r,{})," Limpar"]})]})]})]})}export{ka as default};

import{j as e,ab as s,$ as a,af as i,a7 as l,ak as o,al as t,am as r,an as n,ao as c,q as d,a9 as m,ap as u,aa as h,ae as _,aq as x,ah as j,ar as p}from"./index-B9S7B1ct.js";import{r as v}from"./router-5U3rcizL.js";import{d as N,M as g}from"./useAdminRepo-BL5r1Vp_.js";import{a as b}from"./urlSanitize-MTL8k_kh.js";import{A as y,S as f}from"./StatusBadge-BCSqGBK2.js";import"./realtime-BxkdmVbQ.js";import"./projectsAPI-ncNOvpHO.js";import"./dataCache-D0LcSMWP.js";import"./rankingAPI-D7vwloWX.js";import"./userAPI-DCS3M3Ri.js";const C="_page_1ouoi_7",S="_header_1ouoi_17",k="_headerTitle_1ouoi_35",w="_headerIcon_1ouoi_47",E="_toast_1ouoi_91",B="_success_1ouoi_115",I="_error_1ouoi_127",$="_filtersCard_1ouoi_163",A="_filters_1ouoi_163",P="_searchBox_1ouoi_189",R="_searchIcon_1ouoi_201",M="_searchInput_1ouoi_219",z="_input_1ouoi_251",D="_select_1ouoi_253",L="_inputError_1ouoi_287",O="_bulkActions_1ouoi_297",F="_checkboxLabel_1ouoi_315",T="_bulkButtons_1ouoi_347",G="_selectedCount_1ouoi_361",q="_bulkBtn_1ouoi_379",U="_bulkBtnOutline_1ouoi_381",V="_gridNav_1ouoi_449",H="_navBtn_1ouoi_465",W="_pageInfo_1ouoi_505",J="_mentorsGrid_1ouoi_517",K="_emptyCard_1ouoi_535",Q="_emptyState_1ouoi_543",X="_emptyIcon_1ouoi_555",Y="_mentorCard_1ouoi_571",Z="_cardHeader_1ouoi_593",ee="_mentorAvatar_1ouoi_611",se="_avatarPlaceholder_1ouoi_637",ae="_cardBody_1ouoi_663",ie="_mentorName_1ouoi_671",le="_mentorSpecialty_1ouoi_685",oe="_contactInfo_1ouoi_697",te="_metaInfo_1ouoi_735",re="_cardFooter_1ouoi_761",ne="_editBtn_1ouoi_775",ce="_visibilityBtn_1ouoi_777",de="_historyBtn_1ouoi_779",me="_deleteBtn_1ouoi_781",ue="_historySection_1ouoi_879",he="_historyList_1ouoi_891",_e="_historyItem_1ouoi_909",xe="_historyType_1ouoi_929",je="_historyDate_1ouoi_945",pe="_muted_1ouoi_971",ve="_pagination_1ouoi_985",Ne="_pageNumbers_1ouoi_1003",ge="_pageBtn_1ouoi_1013",be="_active_1ouoi_1063",ye="_formCard_1ouoi_1079",fe="_formTitle_1ouoi_1089",Ce="_formContainer_1ouoi_1109",Se="_formFields_1ouoi_1121",ke="_formRow_1ouoi_1133",we="_formGroup_1ouoi_1145",Ee="_textarea_1ouoi_1169",Be="_fieldError_1ouoi_1205",Ie="_fileUpload_1ouoi_1215",$e="_formPreview_1ouoi_1267",Ae="_previewCard_1ouoi_1295",Pe="_previewAvatar_1ouoi_1309",Re="_previewInfo_1ouoi_1347",Me="_previewContact_1ouoi_1399",ze="_formActions_1ouoi_1433",De="_saveBtn_1ouoi_1449",Le="_cancelBtn_1ouoi_1451",Oe="_errorsList_1ouoi_1531",Fe="_errorItem_1ouoi_1553",Te="_loadingState_1ouoi_1571",Ge="_spinner_1ouoi_1591",qe="_errorState_1ouoi_1617",Ue="_retryBtn_1ouoi_1647";function Ve(){const{data:Ve,loading:He,error:We,refresh:Je}=N(),[Ke,Qe]=v.useState({name:"",specialty:"",bio:"",email:"",phone:"",photo:"",avatar_url:"",status:"published",visible:!0}),[Xe,Ye]=v.useState(null),[Ze,es]=v.useState({}),[ss,as]=v.useState(!1),[is,ls]=v.useState(""),os=["image/jpeg","image/png","image/webp","image/jpg","image/pjpeg","image/gif","image/svg+xml"],[ts,rs]=v.useState(""),[ns,cs]=v.useState(""),[ds,ms]=v.useState(""),[us,hs]=v.useState(1),[_s,xs]=v.useState(new Set),[js,ps]=v.useState(null),vs=v.useRef(null),Ns="/logo-principal.png",gs=v.useMemo(()=>(Ve||[]).filter(e=>(e.name||"").toLowerCase().includes(ts.toLowerCase())&&(!ns||(e.specialty||"").toLowerCase().includes(ns.toLowerCase()))&&(!ds||(e.status||"")===ds)),[Ve,ts,ns,ds]),bs=Math.max(1,Math.ceil(gs.length/6)),ys=gs.slice(6*(us-1),6*us),fs=e=>{const s={};return(!e.name||String(e.name).trim().length<2)&&(s.name="Informe um nome válido"),(!e.specialty||String(e.specialty).trim().length<2)&&(s.specialty="Informe a especialidade"),(!e.bio||String(e.bio).trim().length<5)&&(s.bio="Descrição muito curta"),e.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e.email))&&(s.email="E-mail inválido"),e.phone&&String(e.phone).trim().length<8&&(s.phone="Telefone incompleto"),s};v.useEffect(()=>{es(fs(Ke))},[Ke]);const Cs=async e=>{0!==_s.size&&window.confirm(`Aplicar status "${e}" a ${_s.size} mentor(es)?`)&&(await g.bulkSetStatus(Array.from(_s),e),xs(new Set),Je())},Ss=async e=>{0!==_s.size&&window.confirm(`${e?"Exibir":"Ocultar"} ${_s.size} mentor(es)?`)&&(await g.bulkSetVisibility(Array.from(_s),e),xs(new Set),Je())},ks=e=>{const s=vs.current;s&&s.scrollBy({left:360*e,behavior:"smooth"})},ws=({mentorId:s})=>{const[a,i]=v.useState([]);v.useEffect(()=>{i(g.getHistory(s))},[s]);return e.jsx("div",{className:he,children:0===a.length?e.jsx("p",{className:pe,children:"Sem histórico"}):e.jsx("ul",{children:a.map(s=>e.jsxs("li",{className:_e,children:[e.jsx("span",{className:xe,children:s.type}),e.jsx("span",{className:je,children:new Date(s.at).toLocaleString("pt-BR")}),e.jsxs("button",{onClick:()=>(async e=>{if(!window.confirm(`Reverter evento ${e}?`))return;const s=await g.revertHistory(e);s.ok||alert(s.error),Je()})(s.id),className:de,children:[e.jsx(p,{})," Reverter"]})]},s.id))})})};return He?e.jsx("div",{className:C,children:e.jsxs("div",{className:Te,children:[e.jsx("div",{className:Ge}),e.jsx("p",{children:"Carregando mentores..."})]})}):We?e.jsx("div",{className:C,children:e.jsx(y,{variant:"outlined",children:e.jsxs("div",{className:qe,children:[e.jsx("h3",{children:"Erro ao carregar mentores"}),e.jsx("p",{children:We}),e.jsx("button",{onClick:Je,className:Ue,children:"Tentar novamente"})]})})}):e.jsxs("div",{className:C,children:[e.jsx("header",{className:S,children:e.jsxs("div",{className:k,children:[e.jsx(s,{className:w}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestão de Mentores"}),e.jsxs("p",{children:[(Ve||[]).length," mentores cadastrados"]})]})]})}),is&&e.jsxs("div",{className:`${E} ${is.includes("Erro")?I:B}`,children:[is.includes("Erro")?e.jsx(a,{}):e.jsx(i,{}),is]}),e.jsxs(y,{variant:"elevated",className:$,children:[e.jsxs("div",{className:A,children:[e.jsxs("div",{className:P,children:[e.jsx(l,{className:R}),e.jsx("input",{type:"text",placeholder:"Buscar por nome...",value:ts,onChange:e=>{rs(e.target.value),hs(1)},className:M})]}),e.jsx("input",{type:"text",placeholder:"Filtrar especialidade...",value:ns,onChange:e=>{cs(e.target.value),hs(1)},className:z}),e.jsxs("select",{value:ds,onChange:e=>{ms(e.target.value),hs(1)},className:D,children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"published",children:"Publicado"})]})]}),e.jsxs("div",{className:O,children:[e.jsxs("label",{className:F,children:[e.jsx("input",{type:"checkbox",onChange:e=>{return s=e.target.checked,void xs(e=>{const a=new Set(e);for(const i of ys)s?a.add(i.id):a.delete(i.id);return a});var s},checked:ys.length>0&&ys.every(e=>_s.has(e.id))}),"Selecionar página"]}),_s.size>0&&e.jsxs("div",{className:T,children:[e.jsxs("span",{className:G,children:[_s.size," selecionado(s)"]}),e.jsxs("button",{onClick:()=>Cs("published"),className:q,children:[e.jsx(i,{})," Publicar"]}),e.jsx("button",{onClick:()=>Cs("draft"),className:U,children:"Rascunho"}),e.jsxs("button",{onClick:()=>Ss(!0),className:q,children:[e.jsx(o,{})," Exibir"]}),e.jsxs("button",{onClick:()=>Ss(!1),className:U,children:[e.jsx(t,{})," Ocultar"]})]})]})]}),e.jsxs("div",{className:V,children:[e.jsx("button",{onClick:()=>ks(-1),className:H,children:e.jsx(r,{})}),e.jsxs("span",{className:W,children:["Página ",us," de ",bs," (",gs.length," mentores)"]}),e.jsx("button",{onClick:()=>ks(1),className:H,children:e.jsx(n,{})})]}),e.jsx("div",{className:J,ref:vs,children:0===ys.length?e.jsx(y,{variant:"outlined",className:K,children:e.jsxs("div",{className:Q,children:[e.jsx(s,{className:X}),e.jsx("p",{children:"Nenhum mentor encontrado"})]})}):ys.map(s=>e.jsxs(y,{variant:"elevated",className:Y,children:[e.jsxs("div",{className:Z,children:[e.jsx("label",{className:F,children:e.jsx("input",{type:"checkbox",checked:_s.has(s.id),onChange:e=>{return a=s.id,i=e.target.checked,void xs(e=>{const s=new Set(e);return i?s.add(a):s.delete(a),s});var a,i}})}),e.jsx("div",{className:ee,children:s.photo||s.avatar_url?e.jsx("img",{src:b(s.photo||s.avatar_url),alt:s.name,onError:e=>{e.currentTarget.src=Ns}}):e.jsx("div",{className:se,children:s.name?.charAt(0).toUpperCase()})}),e.jsx(f,{variant:s.visible?"success":"neutral",size:"sm",children:s.visible?"Visível":"Oculto"})]}),e.jsxs("div",{className:ae,children:[e.jsx("h3",{className:ie,children:s.name}),e.jsx("p",{className:le,children:s.specialty}),e.jsxs("div",{className:oe,children:[e.jsxs("span",{children:[e.jsx(c,{})," ",s.phone||"(00) 00000-0000"]}),e.jsxs("span",{children:[e.jsx(d,{})," ",s.email||"email@exemplo.com"]})]}),e.jsxs("div",{className:te,children:[e.jsx(f,{variant:"published"===s.status?"info":"warning",size:"sm",children:"published"===s.status?"Publicado":"Rascunho"}),s.created_at&&e.jsxs("small",{children:["Desde ",new Date(s.created_at).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"})]})]})]}),e.jsxs("div",{className:re,children:[e.jsxs("button",{onClick:()=>{return Ye((e=s).id),Qe({name:e.name,specialty:e.specialty,bio:e.bio,email:e.email,phone:e.phone,photo:e.photo||e.avatar_url||"",avatar_url:e.avatar_url||"",status:e.status||"draft",visible:!!e.visible}),void document.getElementById("mentor-form")?.scrollIntoView({behavior:"smooth"});var e},className:ne,title:"Editar",children:[e.jsx(m,{})," Editar"]}),e.jsx("button",{onClick:()=>(async e=>{await g.toggleVisible(e),Je()})(s),className:ce,title:s.visible?"Ocultar":"Exibir",children:s.visible?e.jsx(t,{}):e.jsx(o,{})}),e.jsx("button",{onClick:()=>ps(js===s.id?null:s.id),className:de,title:"Histórico",children:e.jsx(u,{})}),e.jsx("button",{onClick:()=>(async e=>{window.confirm("Confirma remover este mentor?")&&(await g.delete(e),Je())})(s.id),className:me,title:"Remover",children:e.jsx(h,{})})]}),js===s.id&&e.jsx("div",{className:ue,children:e.jsx(ws,{mentorId:s.id})})]},s.id))}),e.jsxs("div",{className:ve,children:[e.jsxs("button",{onClick:()=>hs(Math.max(1,us-1)),disabled:1===us,className:ge,children:[e.jsx(r,{})," Anterior"]}),e.jsx("div",{className:Ne,children:Array.from({length:bs},(e,s)=>s+1).map(s=>e.jsx("button",{onClick:()=>hs(s),className:`${ge} ${us===s?be:""}`,children:s},s))}),e.jsxs("button",{onClick:()=>hs(Math.min(bs,us+1)),disabled:us===bs,className:ge,children:["Próximo ",e.jsx(n,{})]})]}),e.jsxs(y,{variant:"elevated",className:ye,id:"mentor-form",children:[e.jsx("h2",{className:fe,children:Xe?e.jsxs(e.Fragment,{children:[e.jsx(m,{})," Editar Mentor"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{})," Novo Mentor"]})}),e.jsxs("div",{className:Ce,children:[e.jsxs("div",{className:Se,children:[e.jsxs("div",{className:ke,children:[e.jsxs("div",{className:we,children:[e.jsx("label",{children:"Nome *"}),e.jsx("input",{type:"text",placeholder:"Nome completo",value:Ke.name,onChange:e=>Qe({...Ke,name:e.target.value}),className:`${z} ${Ze.name?L:""}`,required:!0}),Ze.name&&e.jsx("span",{className:Be,children:Ze.name})]}),e.jsxs("div",{className:we,children:[e.jsx("label",{children:"Especialidade *"}),e.jsx("input",{type:"text",placeholder:"Ex: Desenvolvimento Web",value:Ke.specialty,onChange:e=>Qe({...Ke,specialty:e.target.value}),className:`${z} ${Ze.specialty?L:""}`,required:!0}),Ze.specialty&&e.jsx("span",{className:Be,children:Ze.specialty})]})]}),e.jsxs("div",{className:we,children:[e.jsx("label",{children:"Bio / Descrição *"}),e.jsx("textarea",{placeholder:"Descreva a experiência e atuação do mentor...",value:Ke.bio,onChange:e=>Qe({...Ke,bio:e.target.value}),className:`${Ee} ${Ze.bio?L:""}`,rows:"3",required:!0}),Ze.bio&&e.jsx("span",{className:Be,children:Ze.bio})]}),e.jsxs("div",{className:ke,children:[e.jsxs("div",{className:we,children:[e.jsx("label",{children:"E-mail"}),e.jsx("input",{type:"email",placeholder:"email@exemplo.com",value:Ke.email,onChange:e=>Qe({...Ke,email:e.target.value}),className:`${z} ${Ze.email?L:""}`}),Ze.email&&e.jsx("span",{className:Be,children:Ze.email})]}),e.jsxs("div",{className:we,children:[e.jsx("label",{children:"Telefone"}),e.jsx("input",{type:"tel",placeholder:"(00) 00000-0000",value:Ke.phone,onChange:e=>Qe({...Ke,phone:e.target.value}),className:`${z} ${Ze.phone?L:""}`}),Ze.phone&&e.jsx("span",{className:Be,children:Ze.phone})]})]}),e.jsxs("div",{className:ke,children:[e.jsxs("div",{className:we,children:[e.jsx("label",{children:"Foto (URL)"}),e.jsx("input",{type:"url",placeholder:"https://...",value:Ke.photo,onChange:e=>Qe({...Ke,photo:e.target.value}),className:z})]}),e.jsxs("div",{className:we,children:[e.jsx("label",{children:"Ou envie um arquivo"}),e.jsxs("label",{className:Ie,children:[e.jsx(x,{})," Escolher imagem",e.jsx("input",{type:"file",accept:os.join(","),onChange:e=>(async e=>{if(!e)return;if(!(e.type&&e.type.startsWith("image/")||os.includes(e.type)))return void alert("Formato inválido. Use imagens (JPEG, PNG, WEBP, GIF, SVG).");if(e.size>5242880)return void alert("Imagem muito grande. Máximo de 5MB.");const s=new FileReader;s.onload=()=>{const e=s.result;Qe(s=>({...s,photo:String(e),avatar_url:String(e)}))},s.readAsDataURL(e)})(e.target.files?.[0])})]})]})]}),e.jsxs("div",{className:ke,children:[e.jsxs("div",{className:we,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:Ke.status,onChange:e=>Qe({...Ke,status:e.target.value}),className:D,children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"published",children:"Publicado"})]})]}),e.jsx("div",{className:we,children:e.jsxs("label",{className:F,children:[e.jsx("input",{type:"checkbox",checked:Ke.visible,onChange:e=>Qe({...Ke,visible:e.target.checked})}),"Visível no site"]})})]})]}),e.jsxs("div",{className:$e,children:[e.jsx("h4",{children:"Pré-visualização"}),e.jsxs("div",{className:Ae,children:[e.jsx("div",{className:Pe,children:Ke.photo||Ke.avatar_url?e.jsx("img",{src:b(Ke.photo||Ke.avatar_url),alt:"Preview",onError:e=>{e.currentTarget.src=Ns}}):e.jsx("div",{className:se,children:Ke.name?.charAt(0).toUpperCase()||"?"})}),e.jsxs("div",{className:Re,children:[e.jsx("strong",{children:Ke.name||"Nome do mentor"}),e.jsx("span",{children:Ke.specialty||"Especialidade"}),e.jsx("p",{children:Ke.bio||"Descrição curta..."})]}),e.jsxs("div",{className:Me,children:[e.jsxs("span",{children:[e.jsx(c,{})," ",Ke.phone||"(00) 00000-0000"]}),e.jsxs("span",{children:[e.jsx(d,{})," ",Ke.email||"email@exemplo.com"]})]})]})]})]}),e.jsxs("div",{className:ze,children:[e.jsx("button",{onClick:async()=>{const e=fs(Ke);if(Object.keys(e).length>0)es(e);else{as(!0);try{Xe?await g.upsert({...Ke,id:Xe}):await g.upsert(Ke),Qe({name:"",specialty:"",bio:"",email:"",phone:"",photo:"",avatar_url:"",status:"published",visible:!0}),Ye(null),ls("Mentor salvo com sucesso!"),setTimeout(()=>ls(""),2500),Je()}catch(s){ls("Erro ao salvar mentor")}finally{as(!1)}}},disabled:ss||Object.keys(Ze).length>0,className:De,children:ss?"Salvando...":e.jsxs(e.Fragment,{children:[e.jsx(j,{})," ",Xe?"Atualizar":"Salvar"]})}),Xe&&e.jsxs("button",{onClick:()=>{Ye(null),Qe({name:"",specialty:"",bio:"",email:"",phone:"",photo:"",avatar_url:"",status:"published",visible:!0})},className:Le,children:[e.jsx(a,{})," Cancelar"]})]}),Object.keys(Ze).length>0&&e.jsx("div",{className:Oe,children:Object.values(Ze).map((s,i)=>e.jsxs("span",{className:Fe,children:[e.jsx(a,{})," ",s]},i))})]})]})}export{Ve as default};

import{j as e}from"./index-BHfn_mjD.js";import{f as t,R as a}from"./router-5U3rcizL.js";import{o as n,p as s,q as i,t as r}from"./appsAPI-C9-th34J.js";function l(){const[l,d]=t(),[o,c]=a.useState(()=>{const e=new Date,t=e=>e.toISOString().slice(0,19)+".000-00:00";return{sort:"date_created",criteria:"desc",range:"date_created",begin_date:t(new Date(e.getTime()-2592e6)),end_date:t(e),external_reference:"",status:"",payment_method_id:"",collectorId:"",payerId:""}}),[u,m]=a.useState(!1),[p,h]=a.useState(""),[x,j]=a.useState(null),[y,g]=a.useState([]),[_,v]=a.useState({total:0,limit:0,offset:0}),[f,b]=a.useState(""),[N,S]=a.useState(""),[C,w]=a.useState(30),[I,O]=a.useState(1),[k,B]=a.useState(null),[D,T]=a.useState(""),[R,M]=a.useState(null),[L,A]=a.useState(""),[P,E]=a.useState("gui"),[F,z]=a.useState([]),[J,H]=a.useState({capture:"",status:"",transaction_amount:"",date_of_expiration:""}),U=a.useMemo(()=>["approved","pending","authorized","in_process","rejected","cancelled","refunded","charged_back"],[]),V=a.useMemo(()=>/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}[+-]\d{2}:\d{2}$/,[]),q=a.useMemo(()=>{const e={};if(J.capture&&"true"!==J.capture&&"false"!==J.capture&&(e.capture="Capture deve ser true ou false"),J.status&&!U.includes(J.status)&&(e.status="Status inv√°lido"),""!==J.transaction_amount){const t=Number(J.transaction_amount);(Number.isNaN(t)||t<=0)&&(e.transaction_amount="Valor deve ser n√∫mero maior que 0")}return J.date_of_expiration&&(V.test(J.date_of_expiration)||(e.date_of_expiration="Formato ISO inv√°lido. Use yyyy-MM-dd'T'HH:mm:ss.SSS¬±HH:mm")),e},[J,U,V]),$=a.useMemo(()=>Object.values(q).some(Boolean),[q]),[W,G]=a.useState(null),[K,Q]=a.useState(!1),[Y,Z]=a.useState(""),[X,ee]=a.useState({id:!0,status:!0,method:!0,amount:!0,installments:!0,payer:!0,external_reference:!0,description:!0,created:!0,updated:!0,actions:!0}),[te,ae]=a.useState(!0);a.useEffect(()=>{try{const e=localStorage.getItem("adminPaymentsColumns");if(e&&!l.get("columns")){const t=JSON.parse(e);Array.isArray(t)&&t.length&&ee(e=>Object.fromEntries(Object.keys(e).map(e=>[e,t.includes(e)])))}}catch(e){}},[l]),a.useEffect(()=>{try{const e=Object.entries(X).filter(([,e])=>e).map(([e])=>e);localStorage.setItem("adminPaymentsColumns",JSON.stringify(e))}catch(e){}},[X]);const ne=a.useCallback(async()=>{m(!0),h(""),j(null);try{const e={};o.status&&(e.status=o.status),o.begin_date&&(e.from_date=o.begin_date.split("T")[0]),o.end_date&&(e.to_date=o.end_date.split("T")[0]),N&&(e.email=N),e.limit=String(C),e.page=String(I);const t=await n(e),a=t?.data||t;let s=[];Array.isArray(a?.items)?s=a.items:Array.isArray(a?.results)?s=a.results:Array.isArray(a)&&(s=a);const i=s.map(e=>({id:e.id||e.payment_id,status:e.status,status_detail:e.statusDetail||e.status_detail,payment_method_id:e.paymentMethodId||e.payment_method_id||e.paymentTypeId||e.payment_type_id,transaction_amount:e.amount||e.transaction_amount,installments:e.installments||1,payer:{email:e.payerEmail||e.payer_email||e.payer?.email},external_reference:e.externalReference||e.external_reference||e.preferenceId||e.preference_id,description:e.description||(e.app?.name?`App: ${e.app.name}`:""),date_created:e.createdAt||e.created_at||e.date_created,last_modified:e.updatedAt||e.updated_at||e.last_modified,app:e.app,user:e.user})).filter(e=>{const t=!f||String(e?.id||"").includes(f)||String(e?.external_reference||"").toLowerCase().includes(f.toLowerCase())||String(e?.description||"").toLowerCase().includes(f.toLowerCase())||String(e?.payer?.email||"").toLowerCase().includes(f.toLowerCase()),a=!o.payment_method_id||String(e?.payment_method_id||"")===String(o.payment_method_id);return t&&a});g(i);const r=a?.total||t?.total||i.length,l=(Math.max(1,I)-1)*Number(C||30);v({total:r,limit:Number(C||30),offset:l})}catch(e){const t=String(e?.message||"").toLowerCase();503===e?.status||t.includes("no_access_token")||t.includes("sem access token")?h("Credenciais do Mercado Pago ausentes. Configure MERCADO_PAGO_ACCESS_TOKEN ou OAuth e tente novamente."):h(401===e?.status?"N√£o autenticado. Fa√ßa login para acessar pagamentos.":403===e?.status?"Acesso restrito. Seu perfil n√£o possui permiss√£o de administrador.":e?.message||"Erro ao buscar pagamentos"),j(null)}finally{m(!1)}},[o,C,I,f,N]);a.useEffect(()=>{if("json"!==P)return void z([]);const e=[];if(L){try{const t=JSON.parse(L);if(t&&"object"==typeof t){if(t.status&&!U.includes(t.status)&&e.push("status inv√°lido no JSON avan√ßado"),Object.prototype.hasOwnProperty.call(t,"transaction_amount")){const a=Number(t.transaction_amount);(Number.isNaN(a)||a<=0)&&e.push("transaction_amount deve ser n√∫mero > 0")}t.date_of_expiration&&!V.test(t.date_of_expiration)&&e.push("date_of_expiration em formato ISO inv√°lido (yyyy-MM-dd'T'HH:mm:ss.SSS¬±HH:mm)")}}catch(t){e.push("JSON inv√°lido: "+String(t?.message||t))}z(e)}else z([])},[P,L,U,V]),a.useEffect(()=>{const e=String(R?.id||"").trim();if(!e)return G(null),void Z("");let t=!1;return(async()=>{try{Q(!0),Z("");const a=await s(e);t||G(a?.data?.data||a?.data||a)}catch(a){t||Z(a?.message||"Erro ao buscar resumo do DB")}finally{t||Q(!1)}})(),()=>{t=!0}},[R]),a.useEffect(()=>{try{const e=Object.fromEntries([...l.entries()]);if(c(t=>{const a={...t};let n=!1;for(const r of["sort","criteria","range","begin_date","end_date","external_reference","status"])e[r]&&e[r]!==t[r]&&(a[r]=e[r],n=!0);const s=e["collector.id"],i=e["payer.id"];return s&&s!==t.collectorId&&(a.collectorId=s,n=!0),i&&i!==t.payerId&&(a.payerId=i,n=!0),n?a:t}),b(t=>e.query&&e.query!==t?e.query:t),S(t=>e.email&&e.email!==t?e.email:t),w(t=>e.limit&&Number(e.limit)!==Number(t)?Number(e.limit):t),O(t=>{const a=e.page?Math.max(1,Number(e.page)):null,n=Math.max(1,Number(t));return a&&a!==n?a:t}),e.columns){const t=String(e.columns).split(",").map(e=>e.trim()).filter(Boolean),a=e=>Object.fromEntries(Object.keys(e).map(e=>[e,t.includes(e)]));ee(e=>{const t=a(e);return Object.keys(e).every(a=>e[a]===t[a])?e:t})}}catch(e){}},[l]),a.useEffect(()=>{ne()},[ne]);const se=a.useCallback(()=>{const e=new URLSearchParams;e.set("sort",o.sort),e.set("criteria",o.criteria),e.set("range",o.range),o.begin_date&&e.set("begin_date",o.begin_date),o.end_date&&e.set("end_date",o.end_date),o.external_reference&&e.set("external_reference",o.external_reference),o.status&&e.set("status",o.status),o.collectorId&&e.set("collector.id",o.collectorId),o.payerId&&e.set("payer.id",o.payerId),f&&e.set("query",f),N&&e.set("email",N),e.set("limit",String(C)),e.set("page",String(I));const t=Object.entries(X).filter(([,e])=>e).map(([e])=>e).join(",");t&&e.set("columns",t),d(e)},[o,f,N,C,I,X,d]),ie=({s:t})=>e.jsx("span",{style:{background:"approved"===t?"#00E4F2":"pending"===t?"#FFA500":"rejected"===t?"#FF6B6B":"#666",color:"#fff",padding:"4px 8px",borderRadius:12,fontSize:"0.8em",fontWeight:"bold"},children:t||"‚Äî"}),re=async e=>{if(e)try{m(!0),h(""),j(null);const t=await i(e),a=t?.data?.data||t?.data||t;M(a),B(String(a?.id||e));const n=new URLSearchParams(l);n.set("paymentId",String(e)),d(n)}catch(t){h(t?.message||"Erro ao obter pagamento por ID"),j(t?.data?.details||null)}finally{m(!1)}};return e.jsxs("div",{className:"admin-content",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"title",children:"üí≥ Pagamentos ‚Äì Mercado Pago"}),e.jsx("p",{className:"muted",children:"Liste e filtre pagamentos via proxy seguro (admin)"})]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=y.map(e=>[e.id,e.status,e.status_detail,e.payment_method_id,e.transaction_amount,e.installments,e?.payer?.email||"",e.external_reference||"",e.description||"",e.date_created||"",e.last_modified||e.last_updated||""]),t=[["id","status","status_detail","payment_method_id","transaction_amount","installments","payer_email","external_reference","description","date_created","last_modified"].join(","),...e.map(e=>e.join(","))].join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download="pagamentos_mercadopago.csv",s.click(),URL.revokeObjectURL(n)},children:"üì§ Exportar CSV"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{se(),ne()},disabled:u,children:u?"üîÑ Carregando‚Ä¶":"üîÅ Buscar"})]})]}),e.jsxs("section",{className:"filters-section",style:{marginBottom:12},children:[e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"2fr 1fr auto"},children:[e.jsx("input",{placeholder:"üî¢ ID do pagamento",value:D,onChange:e=>T(e.target.value)}),e.jsx("button",{className:"btn btn-secondary",onClick:async()=>{if(D)try{m(!0),h(""),M(null);const e=await i(D),t=e?.data?.data||e?.data||e;M(t),B(String(t?.id||D));const a=new URLSearchParams(l);a.set("paymentId",String(D)),d(a)}catch(e){h(e?.message||"Erro ao obter pagamento por ID")}finally{m(!1)}},children:"üîç Buscar por ID"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{T(""),M(null),B(null);const e=new URLSearchParams(l);e.delete("paymentId"),d(e)},children:"Limpar ID"})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{placeholder:"üîç Busca livre (ID, refer√™ncia, descri√ß√£o, e-mail)",value:f,onChange:e=>b(e.target.value)}),e.jsxs("select",{value:o.sort,onChange:e=>c(t=>({...t,sort:e.target.value})),children:[e.jsx("option",{value:"date_created",children:"Ordenar por cria√ß√£o"}),e.jsx("option",{value:"last_modified",children:"Ordenar por √∫ltima modifica√ß√£o"}),e.jsx("option",{value:"date_approved",children:"Ordenar por aprova√ß√£o"})]}),e.jsxs("select",{value:o.criteria,onChange:e=>c(t=>({...t,criteria:e.target.value})),children:[e.jsx("option",{value:"desc",children:"Desc"}),e.jsx("option",{value:"asc",children:"Asc"})]}),e.jsxs("select",{value:o.range,onChange:e=>c(t=>({...t,range:e.target.value})),children:[e.jsx("option",{value:"date_created",children:"Intervalo: cria√ß√£o"}),e.jsx("option",{value:"last_modified",children:"Intervalo: √∫ltima modifica√ß√£o"}),e.jsx("option",{value:"date_approved",children:"Intervalo: aprova√ß√£o"})]})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{type:"text",placeholder:"external_reference",value:o.external_reference,onChange:e=>c(t=>({...t,external_reference:e.target.value}))}),e.jsxs("select",{value:o.status,onChange:e=>c(t=>({...t,status:e.target.value})),children:[e.jsx("option",{value:"",children:"Status: todos"}),e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"authorized",children:"authorized"}),e.jsx("option",{value:"in_process",children:"in_process"}),e.jsx("option",{value:"rejected",children:"rejected"}),e.jsx("option",{value:"cancelled",children:"cancelled"}),e.jsx("option",{value:"refunded",children:"refunded"}),e.jsx("option",{value:"charged_back",children:"charged_back"})]}),e.jsx("input",{type:"text",placeholder:"payment_method_id (client-side)",value:o.payment_method_id,onChange:e=>c(t=>({...t,payment_method_id:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"collector.id",value:o.collectorId,onChange:e=>c(t=>({...t,collectorId:e.target.value}))})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{type:"text",placeholder:"payer.id",value:o.payerId,onChange:e=>c(t=>({...t,payerId:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"begin_date (ISO)",value:o.begin_date,onChange:e=>c(t=>({...t,begin_date:e.target.value}))}),e.jsx("input",{type:"text",placeholder:"end_date (ISO)",value:o.end_date,onChange:e=>c(t=>({...t,end_date:e.target.value}))}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs("select",{onChange:e=>{const t=new Date,a=e.target.value;let n=null,s=null;"today"===a&&(n=new Date(t),n.setHours(0,0,0,0),s=new Date(t),s.setHours(23,59,59,999)),"7d"===a&&(s=new Date(t),n=new Date(t.getTime()-6048e5)),"30d"===a&&(s=new Date(t),n=new Date(t.getTime()-2592e6)),"month"===a&&(s=new Date(t),n=new Date(t.getFullYear(),t.getMonth(),1,0,0,0,0));const i=e=>e.toISOString().slice(0,19)+".000-00:00";c(e=>({...e,begin_date:n?i(n):e.begin_date,end_date:s?i(s):e.end_date})),O(1),se(),ne()},defaultValue:"",children:[e.jsx("option",{value:"",children:"Presets de datas‚Ä¶"}),e.jsx("option",{value:"today",children:"Hoje"}),e.jsx("option",{value:"7d",children:"√öltimos 7 dias"}),e.jsx("option",{value:"30d",children:"√öltimos 30 dias"}),e.jsx("option",{value:"month",children:"M√™s atual"})]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>c(e=>({...e,begin_date:"",end_date:""})),children:"Limpar datas"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>c(e=>({...e,external_reference:"",status:"",payment_method_id:"",collectorId:"",payerId:""})),children:"Limpar filtros"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{O(1),se(),ne()},disabled:u,children:u?"Buscando‚Ä¶":"Aplicar filtros"})]})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(4, 1fr)"},children:[e.jsx("input",{placeholder:"üìß Filtro por e-mail (client-side)",value:N,onChange:e=>S(e.target.value)}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("label",{children:"Page size:"}),e.jsxs("select",{value:C,onChange:e=>{w(Number(e.target.value)),O(1),se(),ne()},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=Math.max(1,I-1);O(e),se(),ne()},children:"‚óÄ"}),e.jsxs("span",{children:["Pag ",I," / ",Math.max(1,Math.ceil(Number(_?.total||0)/Number(C||30)))]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=Math.max(1,Math.ceil(Number(_?.total||0)/Number(C||30))),t=Math.min(e,I+1);O(t),se(),ne()},children:"‚ñ∂"})]}),e.jsx("div",{style:{display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:Object.keys(X).map(t=>e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:X[t],onChange:e=>{const a={...X,[t]:e.target.checked};ee(a),se()}})," ",t]},t))})]})]}),u&&e.jsx("p",{children:"üîÑ Carregando‚Ä¶"}),p&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["‚ùå ",p]}),e.jsx("div",{className:"table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[X.id&&e.jsx("th",{children:"ID"}),X.status&&e.jsx("th",{children:"Status"}),X.method&&e.jsx("th",{children:"M√©todo"}),X.amount&&e.jsx("th",{children:"Valor"}),X.installments&&e.jsx("th",{children:"Parcelas"}),X.payer&&e.jsx("th",{children:"Payer"}),X.external_reference&&e.jsx("th",{children:"Ref. Externa"}),X.description&&e.jsx("th",{children:"Descri√ß√£o"}),X.created&&e.jsx("th",{children:"Criado"}),X.updated&&e.jsx("th",{children:"Atualizado"}),X.actions&&e.jsx("th",{children:"A√ß√µes"})]})}),e.jsx("tbody",{children:0===y.length?e.jsx("tr",{children:e.jsx("td",{colSpan:Object.values(X).filter(Boolean).length||1,children:"üì≠ Nenhum pagamento encontrado"})}):(te?y.slice(0,10):y).map(t=>e.jsxs("tr",{children:[X.id&&e.jsx("td",{"data-label":"ID",children:e.jsx("button",{className:"btn btn-link",onClick:()=>re(t.id),title:"Ver completo",children:t.id})}),X.status&&e.jsx("td",{"data-label":"Status",children:e.jsx(ie,{s:t.status})}),X.method&&e.jsx("td",{"data-label":"M√©todo",children:t.payment_method_id||"‚Äî"}),X.amount&&e.jsxs("td",{"data-label":"Valor",children:["R$ ",Number(t.transaction_amount||0).toLocaleString("pt-BR")]}),X.installments&&e.jsx("td",{"data-label":"Parcelas",children:t.installments||1}),X.payer&&e.jsx("td",{"data-label":"Payer",children:t?.payer?.email||"‚Äî"}),X.external_reference&&e.jsx("td",{"data-label":"Ref. Externa",children:t.external_reference||"‚Äî"}),X.description&&e.jsx("td",{"data-label":"Descri√ß√£o",children:t.description||"‚Äî"}),X.created&&e.jsx("td",{"data-label":"Criado",children:t.date_created?new Date(t.date_created).toLocaleString("pt-BR"):"‚Äî"}),X.updated&&e.jsx("td",{"data-label":"Atualizado",children:t.last_modified||t.last_updated?new Date(t.last_modified||t.last_updated).toLocaleString("pt-BR"):"‚Äî"}),X.actions&&e.jsx("td",{"data-label":"A√ß√µes",children:e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>navigator.clipboard?.writeText(String(t.id)),children:"Copiar ID"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>B(k===t.id?null:t.id),children:k===t.id?"Ocultar":"Ver"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>re(t.id),children:"Ver completo"})]})})]},t.id))})]})}),y.length>10&&e.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"btn btn-outline",onClick:()=>ae(e=>!e),children:te?`Mostrar todos (${y.length})`:"Mostrar menos"})}),R&&e.jsxs("section",{className:"card",style:{marginTop:12},children:[e.jsxs("h3",{children:["Pagamento (por ID) #",R?.id]}),e.jsxs("div",{className:"btn-group",style:{marginBottom:8},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{try{navigator.clipboard?.writeText(window.location.href)}catch(e){}},children:"Copiar link"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{M(null),B(null);const e=new URLSearchParams(l);e.delete("paymentId"),d(e)},children:"Fechar painel"})]}),e.jsxs("details",{style:{marginBottom:12},children:[e.jsx("summary",{children:"Atualizar pagamento (PUT)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:8,marginTop:8},children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("input",{type:"radio",name:"updateMode",checked:"gui"===P,onChange:()=>E("gui")})," Campos guiados"]}),e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("input",{type:"radio",name:"updateMode",checked:"json"===P,onChange:()=>E("json")})," JSON avan√ßado"]})]}),"gui"===P?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"capture"}),e.jsxs("select",{value:J.capture,onChange:e=>H(t=>({...t,capture:e.target.value})),children:[e.jsx("option",{value:"",children:"(n√£o enviar)"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]}),q.capture&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:q.capture})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"status"}),e.jsxs("select",{value:J.status,onChange:e=>H(t=>({...t,status:e.target.value})),children:[e.jsx("option",{value:"",children:"(n√£o enviar)"}),e.jsx("option",{value:"approved",children:"approved"}),e.jsx("option",{value:"pending",children:"pending"}),e.jsx("option",{value:"authorized",children:"authorized"}),e.jsx("option",{value:"in_process",children:"in_process"}),e.jsx("option",{value:"rejected",children:"rejected"}),e.jsx("option",{value:"cancelled",children:"cancelled"}),e.jsx("option",{value:"refunded",children:"refunded"}),e.jsx("option",{value:"charged_back",children:"charged_back"})]}),q.status&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:q.status})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"transaction_amount"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"ex.: 58.8",value:J.transaction_amount,onChange:e=>H(t=>({...t,transaction_amount:e.target.value}))}),q.transaction_amount&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:q.transaction_amount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"date_of_expiration"}),e.jsx("input",{type:"text",placeholder:"yyyy-MM-dd'T'HH:mm:ss.SSS-04:00",value:J.date_of_expiration,onChange:e=>H(t=>({...t,date_of_expiration:e.target.value}))}),q.date_of_expiration&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:q.date_of_expiration})]})]}):e.jsx("textarea",{placeholder:'Ex.: {"capture": false, "status": "cancelled", "transaction_amount": 58.8}',value:L,onChange:e=>A(e.target.value),style:{minHeight:120}}),"json"===P&&F.length>0&&e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:F.map((t,a)=>e.jsxs("div",{children:["‚Ä¢ ",t]},a))}),e.jsx("div",{className:"muted",children:"Campos comuns: `capture` (boolean), `status` (approved|pending|authorized|in_process|rejected|cancelled|refunded|charged_back), `transaction_amount` (number), `date_of_expiration` (ISO yyyy-MM-dd'T'HH:mm:ss.SSSZ)"}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=Number(R?.transaction_amount||58.8);"gui"===P?H(t=>({...t,capture:"false",status:"cancelled",transaction_amount:String(e)})):A(JSON.stringify({capture:!1,status:"cancelled",transaction_amount:e},null,2))},children:"Preencher exemplo"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=new Date((new Date).getTime()+1728e5).toISOString().slice(0,23)+"-04:00";H(t=>({...t,date_of_expiration:e}))},children:"Expira em 48h"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{H({capture:"",status:"",transaction_amount:"",date_of_expiration:""}),A("")},children:"Limpar"}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(!D&&!R?.id)return void h("Informe o ID do pagamento");const e=D||String(R?.id||"");if("gui"===P&&$)return void h("Corrija os campos antes de atualizar");let t=null;if("gui"===P){const e={};"true"!==J.capture&&"false"!==J.capture||(e.capture="true"===J.capture),J.status&&(e.status=J.status),""===J.transaction_amount||Number.isNaN(Number(J.transaction_amount))||(e.transaction_amount=Number(J.transaction_amount)),J.date_of_expiration&&(e.date_of_expiration=J.date_of_expiration),t=e}else try{t=L?JSON.parse(L):null}catch(a){return h("Payload JSON inv√°lido"),void j(String(a?.message||a))}if(t&&"object"==typeof t&&0!==Object.keys(t).length)try{m(!0),h(""),j(null);const a=await r(e,t);M(a?.data?.data||a?.data||a)}catch(a){h(a?.message||"Erro ao atualizar pagamento"),j(a?.data?.details||null)}finally{m(!1)}else h("Payload √© obrigat√≥rio para atualizar")},disabled:u||"gui"===P&&$,children:u?"Atualizando‚Ä¶":"Atualizar pagamento"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Status"}),e.jsx("div",{children:e.jsx(ie,{s:R?.status})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"M√©todo"}),e.jsx("div",{children:R?.payment_method_id||R?.payment_method?.id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Valor"}),e.jsxs("div",{children:["R$ ",Number(R?.transaction_amount||0).toLocaleString("pt-BR")]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Aprovado em"}),e.jsx("div",{children:R?.date_approved?new Date(R.date_approved).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Criado em"}),e.jsx("div",{children:R?.date_created?new Date(R.date_created).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"Atualizado"}),e.jsx("div",{children:R?.date_last_updated?new Date(R.date_last_updated).toLocaleString("pt-BR"):R?.last_modified?new Date(R.last_modified).toLocaleString("pt-BR"):"‚Äî"})]})]}),e.jsxs("details",{style:{marginTop:12},children:[e.jsx("summary",{children:"Ver detalhes brutos"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:JSON.stringify(R,null,2)})]}),e.jsxs("details",{style:{marginTop:12},children:[e.jsx("summary",{children:"Resumo DB (app_payments)"}),K?e.jsx("div",{className:"muted",children:"Carregando resumo do banco‚Ä¶"}):Y?e.jsx("div",{className:"muted",style:{color:"#FF6B6B"},children:Y}):W?.payment?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payment_id"}),e.jsx("div",{children:W.payment.payment_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"app_id"}),e.jsx("div",{children:W.payment.app_id??"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"preference_id"}),e.jsx("div",{children:W.payment.preference_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"status"}),e.jsx("div",{children:W.payment.status||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"amount"}),e.jsx("div",{children:null!=W.payment.amount?Number(W.payment.amount).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"currency"}),e.jsx("div",{children:W.payment.currency||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payer_email"}),e.jsx("div",{children:W.payment.payer_email||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"status_detail"}),e.jsx("div",{children:W.payment.status_detail||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payment_type_id"}),e.jsx("div",{children:W.payment.payment_type_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"issuer_id"}),e.jsx("div",{children:W.payment.issuer_id||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"net_received_amount"}),e.jsx("div",{children:null!=W.payment.net_received_amount?Number(W.payment.net_received_amount).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"installment_amount"}),e.jsx("div",{children:null!=W.payment.installment_amount?Number(W.payment.installment_amount).toLocaleString("pt-BR"):"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payer_document_type"}),e.jsx("div",{children:W.payment.payer_document_type||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"payer_document_number"}),e.jsx("div",{children:W.payment.payer_document_number||"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"muted",children:"updated_at"}),e.jsx("div",{children:W.payment.updated_at?new Date(W.payment.updated_at).toLocaleString("pt-BR"):"‚Äî"})]})]}):e.jsx("div",{className:"muted",children:"Nenhum registro no banco para este payment_id"}),Array.isArray(W?.audit)&&W.audit.length>0&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"muted",children:"Auditoria (√∫ltimos eventos)"}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Evento"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Quando"}),e.jsx("th",{children:"Notas"})]})}),e.jsx("tbody",{children:W.audit.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.event||t.action||"‚Äî"}),e.jsx("td",{children:t.status||t.to_status||"‚Äî"}),e.jsx("td",{children:t.created_at?new Date(t.created_at).toLocaleString("pt-BR"):"‚Äî"}),e.jsx("td",{children:t.notes||""})]},a))})]})]}),W?.payment?.mp_response_json&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"muted",children:"Resposta MP (persistida)"}),e.jsx("div",{className:"btn-group",style:{marginBottom:8},children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{try{navigator.clipboard?.writeText(String(W.payment.mp_response_json||""))}catch(e){}},children:"Copiar JSON"})}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:(()=>{try{return JSON.stringify(JSON.parse(W.payment.mp_response_json),null,2)}catch{return String(W.payment.mp_response_json)}})()})]}),!W?.payment?.mp_response_json&&W?.payment?.response_json&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"muted",children:"Resposta MP (persistida)"}),e.jsx("div",{className:"btn-group",style:{marginBottom:8},children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{try{navigator.clipboard?.writeText(String(W.payment.response_json||""))}catch(e){}},children:"Copiar JSON"})}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:(()=>{try{return JSON.stringify(JSON.parse(W.payment.response_json),null,2)}catch{return String(W.payment.response_json)}})()})]})]})]}),k&&!R&&e.jsxs("section",{className:"card",style:{marginTop:12},children:[e.jsx("h3",{children:"Detalhes brutos"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:JSON.stringify(y.find(e=>e.id===k)||{},null,2)})]}),e.jsxs("section",{style:{marginTop:12},children:[e.jsxs("div",{className:"muted",children:["Total retornado: ",_.total," | Limit: ",_.limit," | Offset: ",_.offset]}),p&&e.jsxs("div",{className:"muted",style:{color:"#FF6B6B",marginTop:8},children:[e.jsx("div",{children:"Detalhes do erro:"}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:"object"==typeof x?JSON.stringify(x,null,2):String(x||"")})]})]})]})}export{l as default};

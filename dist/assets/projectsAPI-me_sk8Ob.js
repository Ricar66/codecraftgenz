import{a as t}from"./index-DQkRuPgL.js";import{p as a}from"./dataCache-D0LcSMWP.js";class e extends Error{constructor(t,a,e=null){super(t),this.name="APIError",this.status=a,this.data=e}}const r=async(a={all:"1"})=>{const e=new URLSearchParams;Object.entries(a||{}).forEach(([t,a])=>{null!=a&&""!==a&&e.append(t,a)});const r="/api/projetos"+(e.toString()?`?${e.toString()}`:"");return(await t(r,{method:"GET"})).data};async function o(a){const e=await t("/api/projetos",{method:"POST",body:JSON.stringify(a)});return e.project||e.data||e}async function s(a,e){const r=await t(`/api/projetos/${a}`,{method:"PUT",body:JSON.stringify(e)});return r.project||r.data||r}async function n(a){const e=await t(`/api/projetos/${a}`,{method:"DELETE"});return e.project||e.data||{ok:!0}}const i=async(r={})=>{const{page:o=1,limit:s=10,search:n="",status:i="",tags:c=[],sortBy:p="createdAt",sortOrder:d="desc",useCache:m=!0}=r,u=a.generateKey("projects",{page:o,limit:s,search:n,status:i,tags:c,sortBy:p,sortOrder:d});if(m){const t=a.get(u);if(t)return t}try{const e=new URLSearchParams({page:o.toString(),limit:s.toString(),sortBy:p,sortOrder:d});n&&e.append("search",n),i&&e.append("status",i),c.length>0&&e.append("tags",c.join(",")),r.publicOnly&&e.append("visivel","true");const l=`/api/projetos?${e.toString()}`,h=await t(l,{method:"GET",headers:{Accept:"application/json"}});let g=(Array.isArray(h?.data)?h.data:Array.isArray(h?.projects)?h.projects:[]).map(t=>({...t,title:t.titulo||t.title||t.nome,description:t.descricao||t.description,createdAt:t.created_at||t.createdAt,updatedAt:t.updated_at||t.updatedAt,startDate:t.data_inicio||t.startDate,thumbUrl:t.thumb_url||t.thumbUrl,mentorId:t.mentor_id||t.mentorId,mentorName:t.mentor_nome||t.mentorName,mentorEmail:t.mentor_email||t.mentorEmail,price:t.preco||t.price,progress:t.progresso||t.progress}));r.publicOnly&&(g=g.filter(t=>{const a=String(t.status||"").toLowerCase();return"rascunho"!==a&&"draft"!==a}));const y={data:g,pagination:h.pagination||{page:o,limit:s,total:g.length,totalPages:1},meta:{source:"api",timestamp:(new Date).toISOString(),cached:!1}};if(!Array.isArray(y.data))throw new Error("Resposta da API não é um array de projetos.");return m&&y.data.length>0&&(a.set(u,y),y.meta.cached=!0),y}catch(l){if("TypeError"===l.name||"network"===l.type)throw new e("Erro de conexão: Verifique sua internet e tente novamente",0);throw l}};export{r as a,o as c,n as d,i as g,s as u};

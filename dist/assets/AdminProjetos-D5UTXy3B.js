import{j as e,b as s,l as a,$ as t,ah as r,a7 as l,am as i,an as o,a9 as n,ak as c,al as d,aa as x,ae as u,aq as h,au as m}from"./index-B9S7B1ct.js";import{r as _}from"./router-5U3rcizL.js";import{c as j,P as p}from"./useAdminRepo-BL5r1Vp_.js";import{d as g}from"./projectsAPI-ncNOvpHO.js";import{u as v}from"./uploadsAPI-BQgzJDm-.js";import{A as N,S as b}from"./StatusBadge-BCSqGBK2.js";import"./realtime-BxkdmVbQ.js";import"./rankingAPI-D7vwloWX.js";import"./userAPI-DCS3M3Ri.js";import"./dataCache-D0LcSMWP.js";const w="_page_4x0x7_7",f="_header_4x0x7_13",C="_headerTitle_4x0x7_31",y="_headerIcon_4x0x7_43",R="_exportBtn_4x0x7_85",S="_notice_4x0x7_121",P="_success_4x0x7_143",k="_error_4x0x7_155",B="_filtersCard_4x0x7_179",L="_filters_4x0x7_179",A="_searchBox_4x0x7_207",E="_searchIcon_4x0x7_219",$="_searchInput_4x0x7_235",T="_pagination_4x0x7_267",U="_pageBtn_4x0x7_289",I="_tableCard_4x0x7_339",D="_tableWrapper_4x0x7_351",F="_table_4x0x7_339",z="_emptyRow_4x0x7_423",O="_price_4x0x7_435",M="_progressBar_4x0x7_445",V="_progressFill_4x0x7_473",G="_actionBtns_4x0x7_497",q="_editBtn_4x0x7_507",K="_visibilityBtn_4x0x7_507",W="_deleteBtn_4x0x7_507",X="_formCard_4x0x7_585",Y="_formTitle_4x0x7_595",Z="_formGrid_4x0x7_615",H="_formRow_4x0x7_627",J="_formGroup_4x0x7_639",Q="_input_4x0x7_663",ee="_select_4x0x7_663",se="_textarea_4x0x7_693",ae="_rangeInput_4x0x7_729",te="_financeNote_4x0x7_739",re="_formActions_4x0x7_765",le="_saveBtn_4x0x7_781",ie="_cancelBtn_4x0x7_781",oe="_loadingState_4x0x7_841",ne="_spinner_4x0x7_861",ce="_errorState_4x0x7_883",de="_retryBtn_4x0x7_913",xe="_tagsContainer_4x0x7_935",ue="_tag_4x0x7_935",he="_tagRemove_4x0x7_981",me="_tagInput_4x0x7_1021",_e="_addTagBtn_4x0x7_1039",je="_hint_4x0x7_1079",pe="_uploadRow_4x0x7_1155",ge="_fileUpload_4x0x7_1167",ve="_uploadBtn_4x0x7_1201",Ne="_uploadError_4x0x7_1233",be=e=>Number(e.price??e.preco??0);function we(){const{data:we,loading:fe,error:Ce,refresh:ye}=j(),[Re,Se]=_.useState({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,visivel:!1,thumb_url:"",tags:[]}),[Pe,ke]=_.useState({type:"",msg:""}),[Be,Le]=_.useState(null),[Ae,Ee]=_.useState(!1),[$e,Te]=_.useState(""),[Ue,Ie]=_.useState(""),[De,Fe]=_.useState(1),[ze,Oe]=_.useState(""),Me=()=>{const e=ze.trim().toUpperCase();e&&!Re.tags.includes(e)&&Se({...Re,tags:[...Re.tags,e]}),Oe("")},Ve=_.useMemo(()=>(we||[]).filter(e=>(e.title||e.titulo||e.nome||"").toLowerCase().includes(Ue.toLowerCase())||(e.owner||e.responsavel||"").toLowerCase().includes(Ue.toLowerCase())||(e.status||"").toLowerCase().includes(Ue.toLowerCase())),[we,Ue]),Ge=Math.max(1,Math.ceil(Ve.length/6)),qe=Ve.slice(6*(De-1),6*De),Ke=(e,s)=>{ke({type:e,msg:s}),setTimeout(()=>ke({type:"",msg:""}),3e3)},We=e=>{switch(e?.toLowerCase()){case"finalizado":return"success";case"ongoing":return"warning";default:return"neutral"}};return fe?e.jsx("div",{className:w,children:e.jsxs("div",{className:oe,children:[e.jsx("div",{className:ne}),e.jsx("p",{children:"Carregando projetos..."})]})}):Ce?e.jsx("div",{className:w,children:e.jsx(N,{variant:"outlined",children:e.jsxs("div",{className:ce,children:[e.jsx("h3",{children:"Erro ao carregar projetos"}),e.jsx("p",{children:Ce}),e.jsx("button",{onClick:ye,className:de,children:"Tentar novamente"})]})})}):e.jsxs("div",{className:w,children:[e.jsxs("header",{className:f,children:[e.jsxs("div",{className:C,children:[e.jsx(s,{className:y}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestão de Projetos"}),e.jsxs("p",{children:[(we||[]).length," projetos cadastrados"]})]})]}),e.jsxs("button",{onClick:()=>{const e=Ve.map(e=>`${e.id},"${e.title||e.titulo||e.nome||""}","${e.owner||e.responsavel||""}",${e.status},${e.price??e.preco??0},${e.startDate||e.data_inicio||""},${e.progress??e.progresso??0}`).join("\n"),s=new Blob(["id,title,owner,status,price,startDate,progress\n"+e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download="projetos.csv",t.click(),URL.revokeObjectURL(a)},className:R,children:[e.jsx(a,{})," Exportar CSV"]})]}),Pe.msg&&e.jsxs("div",{className:`${S} ${"error"===Pe.type?k:P}`,children:["error"===Pe.type?e.jsx(t,{}):e.jsx(r,{}),Pe.msg]}),e.jsx(N,{variant:"elevated",className:B,children:e.jsxs("div",{className:L,children:[e.jsxs("div",{className:A,children:[e.jsx(l,{className:E}),e.jsx("input",{type:"text",placeholder:"Buscar (título/owner/status)...",value:Ue,onChange:e=>{Ie(e.target.value),Fe(1)},className:$})]}),e.jsxs("div",{className:T,children:[e.jsx("button",{onClick:()=>Fe(Math.max(1,De-1)),disabled:1===De,className:U,children:e.jsx(i,{})}),e.jsxs("span",{children:["Página ",De," de ",Ge]}),e.jsx("button",{onClick:()=>Fe(Math.min(Ge,De+1)),disabled:De===Ge,className:U,children:e.jsx(o,{})})]})]})}),e.jsx(N,{variant:"elevated",className:I,children:e.jsx("div",{className:D,children:e.jsxs("table",{className:F,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Título"}),e.jsx("th",{children:"Owner"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Preço"}),e.jsx("th",{children:"Progresso"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===qe.length?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:z,children:[e.jsx(s,{})," Nenhum projeto encontrado"]})}):qe.map(s=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Título",children:e.jsx("strong",{children:s.title||s.titulo||s.nome||"—"})}),e.jsx("td",{"data-label":"Owner",children:s.owner||s.responsavel||"—"}),e.jsx("td",{"data-label":"Status",children:e.jsx(b,{variant:We(s.status),children:s.status})}),e.jsx("td",{"data-label":"Preço",children:e.jsxs("span",{className:O,children:["R$ ",be(s).toLocaleString("pt-BR")]})}),e.jsx("td",{"data-label":"Progresso",children:e.jsxs("div",{className:M,children:[e.jsx("div",{className:V,style:{width:`${s.progress??s.progresso??0}%`}}),e.jsxs("span",{children:[s.progress??s.progresso??0,"%"]})]})}),e.jsx("td",{"data-label":"Ações",children:e.jsxs("div",{className:G,children:[e.jsx("button",{onClick:()=>(e=>{Se({id:e.id,titulo:e.title||e.titulo||e.nome||"",owner:e.owner||e.responsavel||"",descricao:e.description||e.descricao||"",data_inicio:e.startDate||e.data_inicio||"",status:e.status||"rascunho",preco:e.price??e.preco??0,progresso:e.progress??e.progresso??0,visivel:e.visivel??e.visible??!1,thumb_url:e.thumb_url||e.thumbUrl||"",tags:e.tags||e.tecnologias||[]}),document.getElementById("project-form")?.scrollIntoView({behavior:"smooth"})})(s),className:q,title:"Editar",children:e.jsx(n,{})}),e.jsx("button",{onClick:()=>(async e=>{const s=await p.toggleVisible(e);s.ok?(Ke("success","Visibilidade atualizada"),ye()):Ke("error",s.error||"Falha ao alternar visibilidade")})(s),className:K,title:"rascunho"===s.status?"Publicar":"Ocultar",children:"rascunho"===s.status?e.jsx(c,{}):e.jsx(d,{})}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Deletar este projeto?"))try{await g(e.id),Ke("success","Projeto deletado!"),ye()}catch(s){Ke("error",s.message||"Falha ao deletar")}})(s),className:W,title:"Deletar",children:e.jsx(x,{})})]})})]},s.id))})]})})}),e.jsxs(N,{variant:"elevated",className:X,id:"project-form",children:[e.jsx("h2",{className:Y,children:Re.id?e.jsxs(e.Fragment,{children:[e.jsx(n,{})," Editar Projeto"]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{})," Novo Projeto"]})}),e.jsxs("div",{className:Z,children:[e.jsxs("div",{className:H,children:[e.jsxs("div",{className:J,children:[e.jsx("label",{children:"Título *"}),e.jsx("input",{type:"text",placeholder:"Título do projeto",value:Re.titulo,onChange:e=>Se({...Re,titulo:e.target.value}),className:Q})]}),e.jsxs("div",{className:J,children:[e.jsx("label",{children:"Owner *"}),e.jsx("input",{type:"text",placeholder:"Responsável",value:Re.owner,onChange:e=>Se({...Re,owner:e.target.value}),className:Q})]}),e.jsxs("div",{className:J,children:[e.jsx("label",{children:"Thumbnail (URL ou Upload)"}),e.jsx("input",{type:"url",placeholder:"https://... (ou envie abaixo)",value:Re.thumb_url,onChange:e=>Se({...Re,thumb_url:e.target.value}),className:Q}),e.jsxs("div",{className:pe,style:{marginTop:8},children:[e.jsxs("label",{className:ge,children:[e.jsx(h,{})," ",Be?Be.name:"Enviar imagem",e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,image/gif,image/svg+xml",onChange:e=>{Le(e.target.files?.[0]||null),Te("")}})]}),e.jsx("button",{onClick:async()=>{if(Be)try{Ee(!0),Te("");const e=await v(Be,Re.thumb_url||void 0,"projetos"),s=e?.data?.url||e?.url;s?(Se(e=>({...e,thumb_url:s})),Ke("success","Thumbnail enviada!")):Te("Upload ok mas URL não retornada."),Le(null)}catch(e){Te(e.message||"Falha no upload da imagem")}finally{Ee(!1)}},disabled:Ae||!Be,className:ve,children:Ae?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(h,{})," Enviar"]})})]}),$e&&e.jsx("span",{className:Ne,children:$e})]})]}),e.jsxs("div",{className:H,children:[e.jsxs("div",{className:J,children:[e.jsx("label",{children:"Data de Início"}),e.jsx("input",{type:"date",value:Re.data_inicio,onChange:e=>Se({...Re,data_inicio:e.target.value}),className:Q})]}),e.jsxs("div",{className:J,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:Re.status,onChange:e=>Se({...Re,status:e.target.value}),className:ee,children:[e.jsx("option",{value:"rascunho",children:"Rascunho"}),e.jsx("option",{value:"ongoing",children:"Em Andamento"}),e.jsx("option",{value:"finalizado",children:"Finalizado"})]})]}),e.jsxs("div",{className:J,children:[e.jsx("label",{children:"Preço (R$)"}),e.jsx("input",{type:"number",placeholder:"0",value:Re.preco,onChange:e=>Se({...Re,preco:Number(e.target.value)}),className:Q})]}),e.jsxs("div",{className:J,children:[e.jsxs("label",{children:["Progresso: ",Re.progresso,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:Re.progresso,onChange:e=>Se({...Re,progresso:Number(e.target.value)}),className:ae})]})]}),e.jsxs("div",{className:J,children:[e.jsx("label",{children:"Descrição *"}),e.jsx("textarea",{placeholder:"Descreva o objetivo e escopo do projeto...",value:Re.descricao,onChange:e=>Se({...Re,descricao:e.target.value}),className:se,rows:"3"})]}),e.jsxs("div",{className:J,children:[e.jsxs("label",{children:[e.jsx(m,{style:{marginRight:6}}),"Tecnologias"]}),e.jsx("div",{className:xe,children:Re.tags.map((s,a)=>e.jsxs("span",{className:ue,children:[s,e.jsx("button",{type:"button",onClick:()=>{return e=s,void Se({...Re,tags:Re.tags.filter(s=>s!==e)});var e},className:he,title:"Remover",children:e.jsx(t,{})})]},a))}),e.jsxs("div",{className:me,children:[e.jsx("input",{type:"text",placeholder:"Ex: React, Node.js, Python...",value:ze,onChange:e=>Oe(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),Me())},className:Q}),e.jsxs("button",{type:"button",onClick:Me,className:_e,children:[e.jsx(u,{})," Adicionar"]})]}),e.jsx("small",{className:je,children:"Pressione Enter ou clique em Adicionar para incluir uma tecnologia"})]})]}),Re.preco>0&&e.jsxs("div",{className:te,children:[e.jsx(r,{})," Registro financeiro será criado: R$ ",Re.preco.toLocaleString("pt-BR")]}),e.jsxs("div",{className:re,children:[e.jsxs("button",{onClick:async()=>{try{if(!String(Re.titulo||"").trim()||!String(Re.owner||"").trim()||!String(Re.status||"").trim())return void Ke("error","Preencha título, owner e status.");if(String(Re.descricao||"").length<10)return void Ke("error","Descrição muito curta. Adicione mais detalhes.");if((e=>{const s=String(e||""),a=/^[a-zA-Z]:\\/.test(s),t=s.startsWith("file:");return a||t})(Re.thumb_url))return void Ke("error","URL de imagem inválida. Use http(s) ou carregue um link público.");await p.upsert(Re),Se({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,visivel:!1,thumb_url:"",tags:[]}),Ke("success",Re.id?"Projeto atualizado com sucesso.":"Projeto criado com sucesso."),ye()}catch(e){Ke("error","Erro ao salvar projeto: "+(e.message||"Falha desconhecida"))}},className:le,children:[e.jsx(r,{})," ",Re.id?"Atualizar":"Criar"," Projeto"]}),Re.id&&e.jsxs("button",{onClick:()=>{Se({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,visivel:!1,thumb_url:"",tags:[]})},className:ie,children:[e.jsx(t,{})," Cancelar"]})]})]})]})}export{we as default};

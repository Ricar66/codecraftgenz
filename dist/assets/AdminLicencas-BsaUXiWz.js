import{j as e,K as a,ae as s,a2 as c,ah as i,$ as r,a7 as l,aa as n,a as t}from"./index-BNwvcLYh.js";import{r as d}from"./router-Bh7m2j_b.js";import{j as o}from"./appsAPI-Coih7GPG.js";import{A as m,S as _}from"./StatusBadge-Doi_MAPz.js";const h="_page_u4crf_7",u="_header_u4crf_13",x="_headerTitle_u4crf_31",j="_headerIcon_u4crf_43",p="_headerActions_u4crf_85",f="_newBtn_u4crf_95",v="_refreshBtn_u4crf_127",N="_toast_u4crf_161",g="_error_u4crf_161",y="_formCard_u4crf_219",b="_formTitle_u4crf_231",S="_formGrid_u4crf_251",C="_formRow_u4crf_263",A="_formGroup_u4crf_275",k="_input_u4crf_299",w="_select_u4crf_299",E="_formActions_u4crf_329",B="_saveBtn_u4crf_341",L="_cancelBtn_u4crf_373",D="_filterCard_u4crf_405",I="_filterRow_u4crf_413",P="_searchBtn_u4crf_427",T="_tableWrapper_u4crf_461",$="_table_u4crf_461",R="_emailCell_u4crf_533",G="_keyCell_u4crf_547",z="_hwCell_u4crf_563",F="_muted_u4crf_573",q="_dateCell_u4crf_585",O="_deleteBtn_u4crf_593",H="_emptyState_u4crf_627",J="_emptyIcon_u4crf_639",K="_loadingState_u4crf_655",U="_spinner_u4crf_675",V="_pagination_u4crf_699",W="_pageBtn_u4crf_715",Z="_pageInfo_u4crf_741",M="codecraftgenz";function Q(){const[Q,X]=d.useState([]),[Y,ee]=d.useState([]),[ae,se]=d.useState(!0),[ce,ie]=d.useState(""),[re,le]=d.useState(""),[ne,te]=d.useState(0),[de,oe]=d.useState(1),[me,_e]=d.useState(1),[he,ue]=d.useState(""),[xe,je]=d.useState(""),[pe,fe]=d.useState(!1),[ve,Ne]=d.useState({app_id:"",email:"",name:""}),[ge,ye]=d.useState(!1),be=e=>{le(e),setTimeout(()=>le(""),3e3)},Se=d.useCallback(async()=>{try{const e=await o({page:1,pageSize:100}),a=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[];ee(a)}catch{}},[]),Ce=d.useCallback(async(e=de)=>{try{se(!0),ie("");const a=await async function({app_id:e,email:a,page:s=1,limit:c=50}={}){const i=new URLSearchParams;return e&&i.set("app_id",e),a&&i.set("email",a),i.set("page",String(s)),i.set("limit",String(c)),t(`/health/admin/licenses?${i.toString()}`,{method:"GET",headers:{"x-admin-token":M}})}({app_id:he||void 0,email:xe||void 0,page:e}),s=a?.data||a;X(s?.licenses||[]),te(s?.total||0),oe(s?.page||e),_e(s?.pages||1)}catch(a){ie(a.message||"Erro ao carregar licencas")}finally{se(!1)}},[he,xe,de]);d.useEffect(()=>{Se()},[Se]),d.useEffect(()=>{Ce(1)},[he,xe]);const Ae=async e=>{if(confirm(`Remover licenca #${e.id} (${e.email})?`))try{await async function(e){return t(`/health/admin/licenses/${e}`,{method:"DELETE",headers:{"x-admin-token":M}})}(e.id),be("Licenca removida"),Ce(de)}catch(a){ie(a.message||"Erro ao remover licenca")}},ke=e=>{const a=Y.find(a=>a.id===e);return a?.name||`App #${e}`};return e.jsxs("div",{className:h,children:[e.jsxs("header",{className:u,children:[e.jsxs("div",{className:x,children:[e.jsx(a,{className:j}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestao de Licencas"}),e.jsxs("p",{children:[ne," licencas encontradas"]})]})]}),e.jsxs("div",{className:p,children:[e.jsxs("button",{onClick:()=>fe(!pe),className:f,children:[e.jsx(s,{})," Nova Licenca"]}),e.jsxs("button",{onClick:()=>Ce(de),className:v,children:[e.jsx(c,{})," Atualizar"]})]})]}),re&&e.jsxs("div",{className:N,children:[e.jsx(i,{})," ",re]}),ce&&e.jsxs("div",{className:g,children:[e.jsx(r,{})," ",ce]}),pe&&e.jsxs(m,{variant:"elevated",className:y,children:[e.jsxs("h2",{className:b,children:[e.jsx(s,{})," Provisionar Nova Licenca"]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),ve.app_id&&ve.email)try{ye(!0),ie("");const e=await async function({app_id:e,email:a,name:s}){return t("/health/admin/provision-license",{method:"POST",headers:{"x-admin-token":M},body:JSON.stringify({app_id:e,email:a,name:s})})}(ve),a=e?.data||e;be(`Licenca criada! Chave: ${a?.license_key||"N/A"}`),Ne({app_id:"",email:"",name:""}),fe(!1),Ce(1)}catch(a){ie(a.message||"Erro ao criar licenca")}finally{ye(!1)}else ie("App e email sao obrigatorios")},className:S,children:[e.jsxs("div",{className:C,children:[e.jsxs("div",{className:A,children:[e.jsx("label",{children:"Aplicativo *"}),e.jsxs("select",{value:ve.app_id,onChange:e=>Ne({...ve,app_id:e.target.value}),className:w,required:!0,children:[e.jsx("option",{value:"",children:"Selecione o app..."}),Y.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (ID: ",a.id,")"]},a.id))]})]}),e.jsxs("div",{className:A,children:[e.jsx("label",{children:"Email do Cliente *"}),e.jsx("input",{type:"email",placeholder:"email@exemplo.com",value:ve.email,onChange:e=>Ne({...ve,email:e.target.value}),className:k,required:!0})]}),e.jsxs("div",{className:A,children:[e.jsx("label",{children:"Nome (opcional)"}),e.jsx("input",{type:"text",placeholder:"Nome do cliente",value:ve.name,onChange:e=>Ne({...ve,name:e.target.value}),className:k})]})]}),e.jsxs("div",{className:E,children:[e.jsx("button",{type:"submit",disabled:ge,className:B,children:ge?"Criando...":e.jsxs(e.Fragment,{children:[e.jsx(a,{})," Gerar Licenca"]})}),e.jsxs("button",{type:"button",onClick:()=>fe(!1),className:L,children:[e.jsx(r,{})," Cancelar"]})]})]})]}),e.jsx(m,{variant:"outlined",className:D,children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),Ce(1)},className:I,children:[e.jsxs("div",{className:A,children:[e.jsx("label",{children:"Filtrar por App"}),e.jsxs("select",{value:he,onChange:e=>ue(e.target.value),className:w,children:[e.jsx("option",{value:"",children:"Todos os apps"}),Y.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:A,children:[e.jsx("label",{children:"Filtrar por Email"}),e.jsx("input",{type:"text",placeholder:"Buscar por email...",value:xe,onChange:e=>je(e.target.value),className:k})]}),e.jsxs("button",{type:"submit",className:P,children:[e.jsx(l,{})," Buscar"]})]})}),ae?e.jsxs("div",{className:K,children:[e.jsx("div",{className:U}),e.jsx("p",{children:"Carregando licencas..."})]}):0===Q.length?e.jsx(m,{variant:"outlined",children:e.jsxs("div",{className:H,children:[e.jsx(a,{className:J}),e.jsx("p",{children:"Nenhuma licenca encontrada"})]})}):e.jsx("div",{className:T,children:e.jsxs("table",{className:$,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"App"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Chave"}),e.jsx("th",{children:"Hardware ID"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Criada em"}),e.jsx("th",{children:"Acoes"})]})}),e.jsx("tbody",{children:Q.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{children:["#",a.id]}),e.jsx("td",{children:a.app_name||ke(a.app_id)}),e.jsx("td",{className:R,children:a.email}),e.jsx("td",{className:G,children:e.jsx("code",{children:a.license_key||"â€”"})}),e.jsx("td",{className:z,children:a.hardware_id?e.jsxs("code",{children:[a.hardware_id.slice(0,12),"..."]}):e.jsx("span",{className:F,children:"Nao ativada"})}),e.jsx("td",{children:e.jsx(_,{variant:a.activated_at?"success":"warning",children:a.activated_at?"Ativada":"Pendente"})}),e.jsx("td",{className:q,children:new Date(a.created_at).toLocaleDateString("pt-BR")}),e.jsx("td",{children:e.jsx("button",{onClick:()=>Ae(a),className:O,title:"Remover licenca",children:e.jsx(n,{})})})]},a.id))})]})}),me>1&&e.jsxs("div",{className:V,children:[e.jsx("button",{onClick:()=>Ce(de-1),disabled:de<=1,className:W,children:"Anterior"}),e.jsxs("span",{className:Z,children:["Pagina ",de," de ",me]}),e.jsx("button",{onClick:()=>Ce(de+1),disabled:de>=me,className:W,children:"Proxima"})]})]})}export{Q as default};

import{u as a,j as e,av as s,a2 as l,ah as t,$ as i,k as r,i as n,h as c,a9 as o,al as d,ak as m,g as u,aa as p,am as h,an as _,ae as x,aq as j,l as v}from"./index-iOmXG8wF.js";import{r as b}from"./router-5U3rcizL.js";import{j as g,k as N,n as f,l as y,m as w}from"./appsAPI-D5FPFj-s.js";import{u as C}from"./uploadsAPI-CkeZmCm7.js";import{a as S}from"./urlSanitize-buIpTRTv.js";import{A as k,S as A}from"./StatusBadge-p-exY-w4.js";const F="_page_163o9_7",E="_header_163o9_13",U="_headerTitle_163o9_31",B="_headerIcon_163o9_43",R="_refreshBtn_163o9_85",L="_toast_163o9_119",T="_error_163o9_119",$="_appsGrid_163o9_177",z="_emptyCard_163o9_191",P="_emptyState_163o9_195",I="_emptyIcon_163o9_207",M="_appCard_163o9_223",G="_cardThumb_163o9_247",O="_cardBody_163o9_277",D="_feature_163o9_291",W="_cardMeta_163o9_305",q="_price_163o9_323",J="_cardActions_163o9_335",V="_editBtn_163o9_345",Z="_visibilityBtn_163o9_345",Q="_buyBtn_163o9_345",Y="_deleteBtn_163o9_345",H="_platformBadges_163o9_439",K="_platformBadge_163o9_439",X="_platformChecks_163o9_477",aa="_platformCheck_163o9_477",ea="_formCard_163o9_525",sa="_formTitle_163o9_535",la="_formGrid_163o9_555",ta="_formRow_163o9_567",ia="_formGroup_163o9_579",ra="_input_163o9_603",na="_select_163o9_603",ca="_textarea_163o9_633",oa="_uploadSection_163o9_671",da="_uploadRow_163o9_685",ma="_fileUpload_163o9_697",ua="_uploadBtn_163o9_733",pa="_uploadError_163o9_765",ha="_thumbPreview_163o9_779",_a="_formActions_163o9_805",xa="_saveBtn_163o9_821",ja="_createBtn_163o9_821",va="_cancelBtn_163o9_821",ba="_pagination_163o9_901",ga="_pageBtn_163o9_917",Na="_pageBtnActive_163o9_973",fa="_pageInfo_163o9_985",ya="_loadingState_163o9_999",wa="_spinner_163o9_1019",Ca=a=>Number(a.price??a.preco??0),Sa=a=>a.thumbnail||a.thumb_url||a.thumbUrl||"",ka=a=>{try{return Number(a||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}catch{return`R$ ${String(a||0)}`}};function Aa(){const{hasRole:Aa}=a(),[Fa,Ea]=b.useState([]),[Ua,Ba]=b.useState(!0),[Ra,La]=b.useState(""),[Ta,$a]=b.useState({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]}),[za,Pa]=b.useState("R$ 0,00"),[Ia,Ma]=b.useState(null),[Ga,Oa]=b.useState(!1),[Da,Wa]=b.useState(""),[qa,Ja]=b.useState(null),[Va,Za]=b.useState(!1),[Qa,Ya]=b.useState(""),[Ha,Ka]=b.useState(""),[Xa,ae]=b.useState(1);b.useEffect(()=>{Pa(ka(Ta.price||0))},[Ta.price]);const ee=a=>{Ka(a),setTimeout(()=>Ka(""),2500)},se=b.useCallback(async()=>{try{Ba(!0),La("");const a=Aa(["admin"]),e=await g({page:1,pageSize:100,publicFallback:!a}),s=(Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[]).map(a=>({...a,thumbnail:a.thumbnail||a.thumb_url||a.thumbUrl||"",executableUrl:a.executableUrl||a.executable_url||"",mainFeature:a.mainFeature||a.main_feature||a.short_description||"",platforms:(()=>{let e=a.platforms||["windows"];if("string"==typeof e)try{e=JSON.parse(e)}catch{e=[e]}return Array.isArray(e)?e:["windows"]})()}));Ea(s),ae(1)}catch(a){La(a.message||"Erro ao carregar apps")}finally{Ba(!1)}},[Aa]);b.useEffect(()=>{se()},[se]);const le=a=>{const e=String(a||"");return/^[a-zA-Z]:\\/.test(e)||e.startsWith("file:")},te=a=>{$a(e=>{const s=e.platforms||[],l=s.includes(a)?s.filter(e=>e!==a):[...s,a];return{...e,platforms:l.length>0?l:s}})};return Ua?e.jsx("div",{className:F,children:e.jsxs("div",{className:ya,children:[e.jsx("div",{className:wa}),e.jsx("p",{children:"Carregando aplicativos..."})]})}):e.jsxs("div",{className:F,children:[e.jsxs("header",{className:E,children:[e.jsxs("div",{className:U,children:[e.jsx(s,{className:B}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestão de Aplicativos"}),e.jsxs("p",{children:[Fa.length," apps cadastrados"]})]})]}),e.jsxs("button",{onClick:se,className:R,children:[e.jsx(l,{})," Atualizar"]})]}),Ha&&e.jsxs("div",{className:L,children:[e.jsx(t,{})," ",Ha]}),Ra&&e.jsxs("div",{className:T,children:[e.jsx(i,{})," ",Ra]}),(()=>{const a=Math.ceil(Fa.length/6),l=Fa.slice(6*(Xa-1),6*Xa);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:$,children:0===Fa.length?e.jsx(k,{variant:"outlined",className:z,children:e.jsxs("div",{className:P,children:[e.jsx(s,{className:I}),e.jsx("p",{children:"Nenhum aplicativo cadastrado"})]})}):l.map(a=>e.jsxs(k,{variant:"elevated",className:M,children:[e.jsx("div",{className:G,children:e.jsx("img",{src:S(Sa(a)),alt:a.name,onError:a=>{a.currentTarget.src="/logo-principal.png"}})}),e.jsxs("div",{className:O,children:[e.jsx("h3",{children:a.name}),e.jsx("p",{className:D,children:String(a.mainFeature||"").slice(0,80)}),e.jsxs("div",{className:W,children:[e.jsx("span",{className:q,children:ka(Ca(a))}),e.jsx(A,{variant:"available"===a.status?"success":"warning",children:a.status||"draft"})]}),a.platforms&&a.platforms.length>0&&e.jsxs("div",{className:H,children:[a.platforms.includes("windows")&&e.jsxs("span",{className:K,children:[e.jsx(r,{})," Win"]}),a.platforms.includes("macos")&&e.jsxs("span",{className:K,children:[e.jsx(n,{})," Mac"]}),a.platforms.includes("linux")&&e.jsxs("span",{className:K,children:[e.jsx(c,{})," Linux"]})]})]}),e.jsxs("div",{className:J,children:[e.jsx("button",{onClick:()=>(a=>{let e=a.platforms||["windows"];if("string"==typeof e)try{e=JSON.parse(e)}catch{e=[e]}Array.isArray(e)||(e=["windows"]),$a({id:a.id,name:a.name||"",mainFeature:a.short_description||a.mainFeature||"",description:a.description||"",status:a.status||"draft",price:a.price||0,thumbnail:a.thumb_url||a.thumbnail||"",exec_url:a.executable_url||a.executableUrl||"",version:a.version||"1.0.0",platforms:e}),document.getElementById("app-form")?.scrollIntoView({behavior:"smooth"})})(a),className:V,title:"Editar",children:e.jsx(o,{})}),e.jsx("button",{onClick:()=>(async a=>{const e="available"===String(a.status||"").toLowerCase()?"draft":"available";try{await N(a.id,{status:e}),ee("Status atualizado!"),se()}catch(s){La(s.message||"Falha ao alternar")}})(a),className:Z,title:"available"===a.status?"Ocultar":"Publicar",children:"available"===a.status?e.jsx(d,{}):e.jsx(m,{})}),e.jsx("button",{onClick:()=>window.open(`/apps/${a.id}/compra`,"_blank"),className:Q,title:"Ver compra",children:e.jsx(u,{})}),e.jsx("button",{onClick:()=>(async a=>{if(confirm("Excluir este aplicativo?"))try{await y(a.id),ee("App excluído!"),se()}catch(e){La(e.message||"Falha ao excluir")}})(a),className:Y,title:"Excluir",children:e.jsx(p,{})})]})]},a.id))}),a>1&&e.jsxs("div",{className:ba,children:[e.jsx("button",{onClick:()=>ae(a=>Math.max(1,a-1)),disabled:1===Xa,className:ga,children:e.jsx(h,{})}),Array.from({length:a},(a,e)=>e+1).map(a=>e.jsx("button",{onClick:()=>ae(a),className:`${ga} ${Xa===a?Na:""}`,children:a},a)),e.jsx("button",{onClick:()=>ae(e=>Math.min(a,e+1)),disabled:Xa===a,className:ga,children:e.jsx(_,{})}),e.jsxs("span",{className:fa,children:[6*(Xa-1)+1,"-",Math.min(6*Xa,Fa.length)," de ",Fa.length]})]})]})})(),e.jsxs(k,{variant:"elevated",className:ea,id:"app-form",children:[e.jsx("h2",{className:sa,children:Ta.id?e.jsxs(e.Fragment,{children:[e.jsx(o,{})," Editar App"]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{})," Criar Novo App"]})}),e.jsxs("div",{className:la,children:[e.jsxs("div",{className:ta,children:[e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Nome *"}),e.jsx("input",{type:"text",placeholder:"Nome do app",value:Ta.name,onChange:a=>$a({...Ta,name:a.target.value}),className:ra})]}),e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Feature Principal"}),e.jsx("input",{type:"text",placeholder:"Recurso principal",value:Ta.mainFeature,onChange:a=>$a({...Ta,mainFeature:a.target.value}),className:ra})]}),e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Preço (R$)"}),e.jsx("input",{type:"text",value:za,onChange:a=>{const e=String(a.target.value||"").replace(/[^0-9]/g,""),s=Number(e||0)/100;$a(a=>({...a,price:s}))},className:ra})]})]}),e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{placeholder:"Descrição completa do app...",value:Ta.description,onChange:a=>$a({...Ta,description:a.target.value}),className:ca,rows:"4"})]}),e.jsxs("div",{className:ta,children:[e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Thumbnail (URL ou Upload)"}),e.jsx("input",{type:"url",placeholder:"https://... (ou envie abaixo)",value:Ta.thumbnail,onChange:a=>$a({...Ta,thumbnail:a.target.value}),className:ra}),e.jsxs("div",{className:da,style:{marginTop:8},children:[e.jsxs("label",{className:ma,children:[e.jsx(j,{})," ",qa?qa.name:"Enviar imagem",e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,image/gif,image/svg+xml",onChange:a=>{Ja(a.target.files?.[0]||null),Ya("")}})]}),e.jsx("button",{onClick:async()=>{if(qa)try{Za(!0),Ya("");const a=await C(qa,Ta.thumbnail||void 0,"apps"),e=a?.data?.url||a?.url;e?($a(a=>({...a,thumbnail:e})),ee("Thumbnail enviada!")):Ya("Upload ok mas URL não retornada."),Ja(null)}catch(a){Ya(a.message||"Falha no upload da imagem")}finally{Za(!1)}},disabled:Va||!qa,className:ua,children:Va?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(j,{})," Enviar"]})})]}),Qa&&e.jsx("span",{className:pa,children:Qa})]}),e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"URL do Executável"}),e.jsx("input",{type:"url",placeholder:"https://...",value:Ta.exec_url,onChange:a=>$a({...Ta,exec_url:a.target.value}),className:ra})]})]}),Ta.id&&e.jsx("div",{className:oa,children:e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Enviar Executável (.exe)"}),e.jsxs("div",{className:da,children:[e.jsxs("label",{className:ma,children:[e.jsx(j,{})," ",Ia?Ia.name:"Selecionar arquivo",e.jsx("input",{type:"file",accept:".exe",onChange:a=>{const e=a.target.files?.[0]||null;if(Ma(e),Wa(""),e){const a=e.name.replace(/[^a-zA-Z0-9._-]/g,"_");$a(e=>({...e,exec_url:`/downloads/${a}`}))}}})]}),e.jsx("button",{onClick:async()=>{if(Ia&&Ta.id)try{Oa(!0),Wa("");const a=await w(Ta.id,Ia),e=a?.data?.executable_url||a?.executable_url||a?.download_url||a?.url;e?($a(a=>({...a,exec_url:e})),ee("Upload concluído!"),se()):Wa("Upload ok mas URL não retornada."),Ma(null)}catch(a){Wa(a.message||"Falha no upload")}finally{Oa(!1)}},disabled:Ga||!Ia,className:ua,children:Ga?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(v,{})," Enviar"]})})]}),Da&&e.jsx("span",{className:pa,children:Da})]})}),Ta.thumbnail&&e.jsx("div",{className:ha,children:e.jsx("img",{src:S(Ta.thumbnail),alt:"Preview",onError:a=>{a.currentTarget.src="/logo-principal.png"}})}),e.jsxs("div",{className:ta,children:[e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:Ta.status,onChange:a=>$a({...Ta,status:a.target.value}),className:na,children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"available",children:"Disponível"})]})]}),e.jsxs("div",{className:ia,children:[e.jsx("label",{children:"Plataformas"}),e.jsxs("div",{className:X,children:[e.jsxs("label",{className:aa,children:[e.jsx("input",{type:"checkbox",checked:Ta.platforms?.includes("windows"),onChange:()=>te("windows")}),e.jsx(r,{})," Windows"]}),e.jsxs("label",{className:aa,children:[e.jsx("input",{type:"checkbox",checked:Ta.platforms?.includes("macos"),onChange:()=>te("macos")}),e.jsx(n,{})," macOS"]}),e.jsxs("label",{className:aa,children:[e.jsx("input",{type:"checkbox",checked:Ta.platforms?.includes("linux"),onChange:()=>te("linux")}),e.jsx(c,{})," Linux"]})]})]})]})]}),e.jsxs("div",{className:_a,children:[e.jsxs("button",{onClick:async()=>{try{const a={name:Ta.name,short_description:Ta.mainFeature,description:Ta.description,status:Ta.status,price:Number(Ta.price||0),thumb_url:Ta.thumbnail,executable_url:Ta.exec_url,platforms:Ta.platforms};if(le(Ta.thumbnail))return void La("Thumbnail URL inválida. Use http(s).");if(le(Ta.exec_url))return void La("Exec URL inválida. Use http(s).");await N(Ta.id,a),$a({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]}),ee("App atualizado!"),se()}catch(a){La("Erro ao atualizar: "+a.message)}},disabled:!Ta.id||!Ta.name,className:xa,children:[e.jsx(t,{})," Salvar"]}),e.jsxs("button",{onClick:async()=>{try{const a={name:Ta.name,short_description:Ta.mainFeature,description:Ta.description,status:Ta.status,price:Number(Ta.price||0),thumb_url:Ta.thumbnail,executable_url:Ta.exec_url,platforms:Ta.platforms};if(!a.name)return void La("Nome é obrigatório");if(le(Ta.thumbnail))return void La("Thumbnail URL inválida. Use http(s).");if(le(Ta.exec_url))return void La("Exec URL inválida. Use http(s).");await f(a),$a({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]}),ee("App criado!"),se()}catch(a){La("Erro ao criar: "+a.message)}},disabled:!!Ta.id||!Ta.name||Ta.price<=0,className:ja,children:[e.jsx(x,{})," Criar"]}),e.jsxs("button",{onClick:()=>{$a({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0",platforms:["windows"]})},className:va,children:[e.jsx(i,{})," Limpar"]})]})]})]})}export{Aa as default};

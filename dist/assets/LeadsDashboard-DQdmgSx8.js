import{a as e,j as a,a1 as s,a2 as t,c as i,a6 as r,a5 as n,o as l,aE as c}from"./index-BNwvcLYh.js";import{r as o}from"./router-Bh7m2j_b.js";import{A as d,S as j}from"./StatusBadge-Doi_MAPz.js";import{a1 as _,a2 as h,a3 as p,a4 as x,a5 as m,a6 as u,a7 as g,a8 as v,a9 as b,aa as N,ab as k,ac as f}from"./AreaChart-zknvknMQ.js";async function y(a="30d"){const s=await e(`/api/leads/dashboard?periodo=${a}`,{method:"GET"});return s?.data??s}async function C({origin:a,status:s,search:t,page:i=1,limit:r=25}={}){const n=new URLSearchParams;n.set("page",String(i)),n.set("limit",String(r)),a&&n.set("origin",a),s&&n.set("status",s),t&&n.set("search",t);return await e(`/api/leads?${n.toString()}`,{method:"GET"})}const S={dashboard:"_dashboard_3sjc9_4",header:"_header_3sjc9_9",title:"_title_3sjc9_18",subtitle:"_subtitle_3sjc9_25",headerActions:"_headerActions_3sjc9_31",periodoSelect:"_periodoSelect_3sjc9_36",kpiGrid:"_kpiGrid_3sjc9_53",kpiCard:"_kpiCard_3sjc9_60",kpiContent:"_kpiContent_3sjc9_72",kpiIcon:"_kpiIcon_3sjc9_79",kpiInfo:"_kpiInfo_3sjc9_90",kpiLabel:"_kpiLabel_3sjc9_97",kpiValue:"_kpiValue_3sjc9_103",kpiTrend:"_kpiTrend_3sjc9_110",trendUp:"_trendUp_3sjc9_118",kpiMuted:"_kpiMuted_3sjc9_122",chartsGrid:"_chartsGrid_3sjc9_128",chartCard:"_chartCard_3sjc9_135",chartContainer:"_chartContainer_3sjc9_141",customTooltip:"_customTooltip_3sjc9_147",tooltipLabel:"_tooltipLabel_3sjc9_155",filterBar:"_filterBar_3sjc9_162",filterSelect:"_filterSelect_3sjc9_170",searchInput:"_searchInput_3sjc9_187",tableCard:"_tableCard_3sjc9_210",leadsTable:"_leadsTable_3sjc9_216",leadName:"_leadName_3sjc9_247",leadEmail:"_leadEmail_3sjc9_252",originBadge:"_originBadge_3sjc9_257",origin_crafter_signup:"_origin_crafter_signup_3sjc9_269",origin_feedback:"_origin_feedback_3sjc9_274",origin_proposal:"_origin_proposal_3sjc9_279",origin_challenge_subscribe:"_origin_challenge_subscribe_3sjc9_284",origin_registration:"_origin_registration_3sjc9_289",origin_app_purchase:"_origin_app_purchase_3sjc9_294",origin_contact:"_origin_contact_3sjc9_299",origin_app_download:"_origin_app_download_3sjc9_304",statusSelect:"_statusSelect_3sjc9_309",dateCell:"_dateCell_3sjc9_325",pagination:"_pagination_3sjc9_332",pageBtn:"_pageBtn_3sjc9_340",pageInfo:"_pageInfo_3sjc9_362",liveBadge:"_liveBadge_3sjc9_369",liveDot:"_liveDot_3sjc9_380",pulse:"_pulse_3sjc9_1",loadingState:"_loadingState_3sjc9_394",errorState:"_errorState_3sjc9_394",spinner:"_spinner_3sjc9_404",spin:"_spin_3sjc9_404",retryBtn:"_retryBtn_3sjc9_428",refreshBtn:"_refreshBtn_3sjc9_447",spinning:"_spinning_3sjc9_472",noData:"_noData_3sjc9_477",tableWrap:"_tableWrap_3sjc9_487"},B="#D12BF2",L="#00E4F2",w="#7A3EF5",D="#10B981",T="#F59E0B",I="#ef4444",E="#a0a0a0",A={crafter_signup:"Crafter",app_download:"Download",app_purchase:"Compra",challenge_subscribe:"Desafio",feedback:"Feedback",proposal:"Proposta B2B",registration:"Registro",contact:"Contato"},$=[L,B,w,T,D,"#EC4899","#3B82F6","#9CA3AF"],M={new:"Novo",contacted:"Contatado",converted:"Convertido",lost:"Perdido"},P={new:"info",contacted:"warning",converted:"success",lost:"error"},R=({active:e,payload:s,label:t})=>e&&s&&s.length?a.jsxs("div",{className:S.customTooltip,children:[a.jsx("p",{className:S.tooltipLabel,children:t}),s.map((e,s)=>a.jsxs("p",{style:{color:e.color},children:[e.name,": ",e.value]},s))]}):null,F=()=>{const[F,G]=o.useState("30d"),[O,V]=o.useState(!0),[z,K]=o.useState(null),[U,H]=o.useState(null),[W,J]=o.useState([]),[Z,q]=o.useState(0),[Q,X]=o.useState(1),[Y,ee]=o.useState(""),[ae,se]=o.useState(""),[te,ie]=o.useState(""),re=o.useCallback(async()=>{V(!0),K(null);try{const[e,a]=await Promise.all([y(F),C({origin:Y,status:ae,search:te,page:Q,limit:25})]);H(e),J(a?.data||a?.leads||[]),q(a?.meta?.total||a?.total||0)}catch(e){K(e.message||"Erro ao carregar dados")}finally{V(!1)}},[F,Y,ae,te,Q]);o.useEffect(()=>{re()},[re]);const[ne,le]=o.useState("");o.useEffect(()=>{const e=setTimeout(()=>ie(ne),400);return()=>clearTimeout(e)},[ne]);const ce=o.useMemo(()=>U?.kpis?U.kpis:null,[U]),oe=o.useMemo(()=>U?.daily_chart?U.daily_chart.map(e=>({date:new Date(e.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),leads:e.count})):[],[U]),de=o.useMemo(()=>U?.by_origin?U.by_origin.map((e,a)=>({name:A[e.origin]||e.origin,value:e.count,color:$[a%$.length]})).filter(e=>e.value>0):[],[U]),je=o.useMemo(()=>{if(!U?.by_status)return[];const e=[L,T,D,I];return["new","contacted","converted","lost"].map((a,s)=>{const t=U.by_status.find(e=>e.status===a);return{status:M[a]||a,count:t?.count||0,color:e[s]}})},[U]),_e=async(a,s)=>{try{await async function(a,s){const t=await e(`/api/leads/${a}/status`,{method:"PUT",body:JSON.stringify({status:s})});return t?.data??t}(a,s),re()}catch(t){}},he=Math.ceil(Z/25);return O&&!U?a.jsxs("div",{className:S.loadingState,children:[a.jsx("div",{className:S.spinner}),a.jsx("span",{children:"Carregando leads..."})]}):z&&!U?a.jsxs("div",{className:S.errorState,children:[a.jsx(s,{size:48,color:I}),a.jsx("h2",{children:"Erro ao carregar leads"}),a.jsx("p",{children:z}),a.jsxs("button",{onClick:re,className:S.retryBtn,children:[a.jsx(t,{})," Tentar novamente"]})]}):a.jsxs("div",{className:S.dashboard,children:[a.jsxs("header",{className:S.header,children:[a.jsxs("div",{children:[a.jsx("h1",{className:S.title,children:"Leads Engine"}),a.jsx("p",{className:S.subtitle,children:"Central de captação omnichannel"})]}),a.jsxs("div",{className:S.headerActions,children:[a.jsx("button",{onClick:re,className:S.refreshBtn,disabled:O,title:"Atualizar",children:a.jsx(t,{className:O?S.spinning:""})}),a.jsxs("select",{value:F,onChange:e=>G(e.target.value),className:S.periodoSelect,children:[a.jsx("option",{value:"7d",children:"7 dias"}),a.jsx("option",{value:"30d",children:"30 dias"}),a.jsx("option",{value:"90d",children:"90 dias"}),a.jsx("option",{value:"365d",children:"Este ano"})]})]})]}),a.jsxs("section",{className:S.kpiGrid,children:[a.jsx(d,{variant:"elevated",className:S.kpiCard,children:a.jsxs("div",{className:S.kpiContent,children:[a.jsx("div",{className:S.kpiIcon,style:{background:"rgba(0, 228, 242, 0.15)"},children:a.jsx(i,{style:{color:L}})}),a.jsxs("div",{className:S.kpiInfo,children:[a.jsx("span",{className:S.kpiLabel,children:"Total de Leads"}),a.jsx("span",{className:S.kpiValue,children:ce?.total||0}),a.jsx("span",{className:S.kpiMuted,children:"Todos os canais"})]})]})}),a.jsx(d,{variant:"elevated",className:S.kpiCard,children:a.jsxs("div",{className:S.kpiContent,children:[a.jsx("div",{className:S.kpiIcon,style:{background:"rgba(209, 43, 242, 0.15)"},children:a.jsx(r,{style:{color:B}})}),a.jsxs("div",{className:S.kpiInfo,children:[a.jsxs("span",{className:S.kpiLabel,children:["Novos (",F,")"]}),a.jsx("span",{className:S.kpiValue,children:ce?.new_period||0}),ce?.new_period>0&&a.jsxs("span",{className:S.kpiTrend,children:[a.jsx(n,{className:S.trendUp}),"+",ce.new_period," captados"]})]})]})}),a.jsx(d,{variant:"elevated",className:S.kpiCard,children:a.jsxs("div",{className:S.kpiContent,children:[a.jsx("div",{className:S.kpiIcon,style:{background:"rgba(16, 185, 129, 0.15)"},children:a.jsx(l,{style:{color:D}})}),a.jsxs("div",{className:S.kpiInfo,children:[a.jsx("span",{className:S.kpiLabel,children:"Convertidos"}),a.jsx("span",{className:S.kpiValue,children:ce?.converted||0}),a.jsx("span",{className:S.kpiMuted,children:"Total convertidos"})]})]})}),a.jsx(d,{variant:"elevated",className:S.kpiCard,children:a.jsxs("div",{className:S.kpiContent,children:[a.jsx("div",{className:S.kpiIcon,style:{background:"rgba(122, 62, 245, 0.15)"},children:a.jsx(c,{style:{color:w}})}),a.jsxs("div",{className:S.kpiInfo,children:[a.jsx("span",{className:S.kpiLabel,children:"Taxa de Conversão"}),a.jsxs("span",{className:S.kpiValue,children:[ce?.conversion_rate||0,"%"]}),a.jsx("span",{className:S.kpiMuted,children:"Lead → Conversão"})]})]})})]}),a.jsxs("section",{className:S.chartsGrid,children:[a.jsxs(d,{variant:"elevated",className:S.chartCard,children:[a.jsx(d.Header,{title:"Volume de Leads",subtitle:`Últimos ${F}`,noBorder:!0}),a.jsx(d.Body,{noPadding:!0,children:a.jsx("div",{className:S.chartContainer,children:oe.length>0?a.jsx(_,{width:"100%",height:280,children:a.jsxs(h,{data:oe,margin:{top:10,right:30,left:0,bottom:0},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"colorLeads",x1:"0",y1:"0",x2:"0",y2:"1",children:[a.jsx("stop",{offset:"5%",stopColor:L,stopOpacity:.3}),a.jsx("stop",{offset:"95%",stopColor:L,stopOpacity:0})]})}),a.jsx(p,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),a.jsx(x,{dataKey:"date",stroke:E,fontSize:12}),a.jsx(m,{stroke:E,fontSize:12,allowDecimals:!1}),a.jsx(u,{content:a.jsx(R,{})}),a.jsx(g,{type:"monotone",dataKey:"leads",name:"Leads",stroke:L,fillOpacity:1,fill:"url(#colorLeads)",strokeWidth:2})]})}):a.jsx("div",{className:S.noData,children:"Sem dados no período"})})})]}),a.jsxs(d,{variant:"elevated",className:S.chartCard,children:[a.jsx(d.Header,{title:"Leads por Origem",subtitle:"Distribuição omnichannel",actions:a.jsxs("span",{className:S.liveBadge,children:[a.jsx("span",{className:S.liveDot})," LIVE"]}),noBorder:!0}),a.jsx(d.Body,{noPadding:!0,children:a.jsx("div",{className:S.chartContainer,children:de.length>0?a.jsx(_,{width:"100%",height:280,children:a.jsxs(v,{children:[a.jsx(b,{data:de,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",label:({name:e,percent:a})=>`${e} ${(100*a).toFixed(0)}%`,labelLine:{stroke:E},children:de.map((e,s)=>a.jsx(N,{fill:e.color},`cell-${s}`))}),a.jsx(u,{formatter:e=>[e,"Leads"],contentStyle:{background:"rgba(10, 10, 15, 0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"}})]})}):a.jsx("div",{className:S.noData,children:"Sem dados de origem"})})})]}),a.jsxs(d,{variant:"elevated",className:S.chartCard,children:[a.jsx(d.Header,{title:"Funil de Leads",subtitle:"Por status",noBorder:!0}),a.jsx(d.Body,{noPadding:!0,children:a.jsx("div",{className:S.chartContainer,children:je.some(e=>e.count>0)?a.jsx(_,{width:"100%",height:280,children:a.jsxs(k,{data:je,layout:"vertical",margin:{top:10,right:30,left:80,bottom:10},children:[a.jsx(p,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),a.jsx(x,{type:"number",stroke:E,fontSize:12,allowDecimals:!1}),a.jsx(m,{type:"category",dataKey:"status",stroke:E,fontSize:12}),a.jsx(u,{formatter:e=>[e,"Leads"],contentStyle:{background:"rgba(10, 10, 15, 0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"}}),a.jsx(f,{dataKey:"count",radius:[0,4,4,0],children:je.map((e,s)=>a.jsx(N,{fill:e.color},`cell-${s}`))})]})}):a.jsx("div",{className:S.noData,children:"Sem dados de funil"})})})]})]}),a.jsx("section",{children:a.jsxs(d,{variant:"elevated",className:S.tableCard,children:[a.jsx(d.Header,{title:"Leads Recentes",subtitle:`${Z} leads no total`,noBorder:!0}),a.jsxs(d.Body,{noPadding:!0,children:[a.jsxs("div",{className:S.filterBar,style:{padding:"0 16px"},children:[a.jsxs("select",{value:Y,onChange:e=>{ee(e.target.value),X(1)},className:S.filterSelect,children:[a.jsx("option",{value:"",children:"Todas as origens"}),Object.entries(A).map(([e,s])=>a.jsx("option",{value:e,children:s},e))]}),a.jsxs("select",{value:ae,onChange:e=>{se(e.target.value),X(1)},className:S.filterSelect,children:[a.jsx("option",{value:"",children:"Todos os status"}),Object.entries(M).map(([e,s])=>a.jsx("option",{value:e,children:s},e))]}),a.jsx("input",{type:"text",placeholder:"Buscar por nome ou email...",value:ne,onChange:e=>{le(e.target.value),X(1)},className:S.searchInput})]}),a.jsx("div",{className:S.tableWrap,children:a.jsxs("table",{className:S.leadsTable,children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nome / Email"}),a.jsx("th",{children:"Origem"}),a.jsx("th",{children:"Referência"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Data"}),a.jsx("th",{children:"Ação"})]})}),a.jsx("tbody",{children:W.length>0?W.map(e=>a.jsxs("tr",{children:[a.jsxs("td",{children:[a.jsx("div",{className:S.leadName,children:e.nome||"—"}),a.jsx("div",{className:S.leadEmail,children:e.email})]}),a.jsx("td",{children:a.jsx("span",{className:`${S.originBadge} ${S[`origin_${e.origin}`]||""}`,children:A[e.origin]||e.origin})}),a.jsx("td",{style:{fontSize:"0.85rem",color:E},children:e.origin_ref||"—"}),a.jsx("td",{children:a.jsx(j,{variant:P[e.status]||"neutral",children:M[e.status]||e.status})}),a.jsx("td",{className:S.dateCell,children:new Date(e.created_at).toLocaleDateString("pt-BR")}),a.jsx("td",{children:a.jsx("select",{value:e.status,onChange:a=>_e(e.id,a.target.value),className:S.statusSelect,children:Object.entries(M).map(([e,s])=>a.jsx("option",{value:e,children:s},e))})})]},e.id)):a.jsx("tr",{children:a.jsx("td",{colSpan:6,children:a.jsx("div",{className:S.noData,children:"Nenhum lead encontrado"})})})})]})}),he>1&&a.jsxs("div",{className:S.pagination,children:[a.jsx("button",{className:S.pageBtn,disabled:Q<=1,onClick:()=>X(e=>Math.max(1,e-1)),children:"Anterior"}),a.jsxs("span",{className:S.pageInfo,children:[Q," / ",he]}),a.jsx("button",{className:S.pageBtn,disabled:Q>=he,onClick:()=>X(e=>e+1),children:"Próximo"})]})]})]})})]})};export{F as default};

import{j as s,b as e,l as a,$ as t,ah as r,a7 as i,am as l,an as o,a9 as n,ak as c,al as d,aa as p,ae as h,au as u}from"./index-sK2loqLz.js";import{r as _}from"./router-5U3rcizL.js";import{c as j,P as m}from"./useAdminRepo-DSJMOvov.js";import{d as x}from"./projectsAPI-Dk1YwCPU.js";import{A as g,S as v}from"./StatusBadge-Du63B6PO.js";import"./realtime-BxkdmVbQ.js";import"./rankingAPI-5toaWGiO.js";import"./userAPI-JeWysunA.js";import"./dataCache-D0LcSMWP.js";const y="_page_spyz5_7",N="_header_spyz5_13",b="_headerTitle_spyz5_31",z="_headerIcon_spyz5_43",w="_exportBtn_spyz5_85",C="_notice_spyz5_121",f="_success_spyz5_143",P="_error_spyz5_155",R="_filtersCard_spyz5_179",S="_filters_spyz5_179",k="_searchBox_spyz5_207",B="_searchIcon_spyz5_219",L="_searchInput_spyz5_235",A="_pagination_spyz5_267",$="_pageBtn_spyz5_289",D="_tableCard_spyz5_339",E="_tableWrapper_spyz5_351",I="_table_spyz5_339",T="_emptyRow_spyz5_423",U="_price_spyz5_435",F="_progressBar_spyz5_445",O="_progressFill_spyz5_473",M="_actionBtns_spyz5_497",V="_editBtn_spyz5_507",G="_visibilityBtn_spyz5_507",K="_deleteBtn_spyz5_507",W="_formCard_spyz5_585",q="_formTitle_spyz5_595",X="_formGrid_spyz5_615",Y="_formRow_spyz5_627",Z="_formGroup_spyz5_639",H="_input_spyz5_663",J="_select_spyz5_663",Q="_textarea_spyz5_693",ss="_rangeInput_spyz5_729",es="_financeNote_spyz5_739",as="_formActions_spyz5_765",ts="_saveBtn_spyz5_781",rs="_cancelBtn_spyz5_781",is="_loadingState_spyz5_841",ls="_spinner_spyz5_861",os="_errorState_spyz5_883",ns="_retryBtn_spyz5_913",cs="_tagsContainer_spyz5_935",ds="_tag_spyz5_935",ps="_tagRemove_spyz5_981",hs="_tagInput_spyz5_1021",us="_addTagBtn_spyz5_1039",_s="_hint_spyz5_1079",js=s=>Number(s.price??s.preco??0);function ms(){const{data:ms,loading:xs,error:gs,refresh:vs}=j(),[ys,Ns]=_.useState({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,visivel:!1,thumb_url:"",tags:[]}),[bs,zs]=_.useState({type:"",msg:""}),[ws,Cs]=_.useState(""),[fs,Ps]=_.useState(1),[Rs,Ss]=_.useState(""),ks=()=>{const s=Rs.trim().toUpperCase();s&&!ys.tags.includes(s)&&Ns({...ys,tags:[...ys.tags,s]}),Ss("")},Bs=_.useMemo(()=>(ms||[]).filter(s=>(s.title||s.titulo||s.nome||"").toLowerCase().includes(ws.toLowerCase())||(s.owner||s.responsavel||"").toLowerCase().includes(ws.toLowerCase())||(s.status||"").toLowerCase().includes(ws.toLowerCase())),[ms,ws]),Ls=Math.max(1,Math.ceil(Bs.length/6)),As=Bs.slice(6*(fs-1),6*fs),$s=(s,e)=>{zs({type:s,msg:e}),setTimeout(()=>zs({type:"",msg:""}),3e3)},Ds=s=>{switch(s?.toLowerCase()){case"finalizado":return"success";case"ongoing":return"warning";default:return"neutral"}};return xs?s.jsx("div",{className:y,children:s.jsxs("div",{className:is,children:[s.jsx("div",{className:ls}),s.jsx("p",{children:"Carregando projetos..."})]})}):gs?s.jsx("div",{className:y,children:s.jsx(g,{variant:"outlined",children:s.jsxs("div",{className:os,children:[s.jsx("h3",{children:"Erro ao carregar projetos"}),s.jsx("p",{children:gs}),s.jsx("button",{onClick:vs,className:ns,children:"Tentar novamente"})]})})}):s.jsxs("div",{className:y,children:[s.jsxs("header",{className:N,children:[s.jsxs("div",{className:b,children:[s.jsx(e,{className:z}),s.jsxs("div",{children:[s.jsx("h1",{children:"Gestão de Projetos"}),s.jsxs("p",{children:[(ms||[]).length," projetos cadastrados"]})]})]}),s.jsxs("button",{onClick:()=>{const s=Bs.map(s=>`${s.id},"${s.title||s.titulo||s.nome||""}","${s.owner||s.responsavel||""}",${s.status},${s.price??s.preco??0},${s.startDate||s.data_inicio||""},${s.progress??s.progresso??0}`).join("\n"),e=new Blob(["id,title,owner,status,price,startDate,progress\n"+s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download="projetos.csv",t.click(),URL.revokeObjectURL(a)},className:w,children:[s.jsx(a,{})," Exportar CSV"]})]}),bs.msg&&s.jsxs("div",{className:`${C} ${"error"===bs.type?P:f}`,children:["error"===bs.type?s.jsx(t,{}):s.jsx(r,{}),bs.msg]}),s.jsx(g,{variant:"elevated",className:R,children:s.jsxs("div",{className:S,children:[s.jsxs("div",{className:k,children:[s.jsx(i,{className:B}),s.jsx("input",{type:"text",placeholder:"Buscar (título/owner/status)...",value:ws,onChange:s=>{Cs(s.target.value),Ps(1)},className:L})]}),s.jsxs("div",{className:A,children:[s.jsx("button",{onClick:()=>Ps(Math.max(1,fs-1)),disabled:1===fs,className:$,children:s.jsx(l,{})}),s.jsxs("span",{children:["Página ",fs," de ",Ls]}),s.jsx("button",{onClick:()=>Ps(Math.min(Ls,fs+1)),disabled:fs===Ls,className:$,children:s.jsx(o,{})})]})]})}),s.jsx(g,{variant:"elevated",className:D,children:s.jsx("div",{className:E,children:s.jsxs("table",{className:I,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Título"}),s.jsx("th",{children:"Owner"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Preço"}),s.jsx("th",{children:"Progresso"}),s.jsx("th",{children:"Ações"})]})}),s.jsx("tbody",{children:0===As.length?s.jsx("tr",{children:s.jsxs("td",{colSpan:"6",className:T,children:[s.jsx(e,{})," Nenhum projeto encontrado"]})}):As.map(e=>s.jsxs("tr",{children:[s.jsx("td",{"data-label":"Título",children:s.jsx("strong",{children:e.title||e.titulo||e.nome||"—"})}),s.jsx("td",{"data-label":"Owner",children:e.owner||e.responsavel||"—"}),s.jsx("td",{"data-label":"Status",children:s.jsx(v,{variant:Ds(e.status),children:e.status})}),s.jsx("td",{"data-label":"Preço",children:s.jsxs("span",{className:U,children:["R$ ",js(e).toLocaleString("pt-BR")]})}),s.jsx("td",{"data-label":"Progresso",children:s.jsxs("div",{className:F,children:[s.jsx("div",{className:O,style:{width:`${e.progress??e.progresso??0}%`}}),s.jsxs("span",{children:[e.progress??e.progresso??0,"%"]})]})}),s.jsx("td",{"data-label":"Ações",children:s.jsxs("div",{className:M,children:[s.jsx("button",{onClick:()=>(s=>{Ns({id:s.id,titulo:s.title||s.titulo||s.nome||"",owner:s.owner||s.responsavel||"",descricao:s.description||s.descricao||"",data_inicio:s.startDate||s.data_inicio||"",status:s.status||"rascunho",preco:s.price??s.preco??0,progresso:s.progress??s.progresso??0,visivel:s.visivel??s.visible??!1,thumb_url:s.thumb_url||s.thumbUrl||"",tags:s.tags||s.tecnologias||[]}),document.getElementById("project-form")?.scrollIntoView({behavior:"smooth"})})(e),className:V,title:"Editar",children:s.jsx(n,{})}),s.jsx("button",{onClick:()=>(async s=>{const e=await m.toggleVisible(s);e.ok?($s("success","Visibilidade atualizada"),vs()):$s("error",e.error||"Falha ao alternar visibilidade")})(e),className:G,title:"rascunho"===e.status?"Publicar":"Ocultar",children:"rascunho"===e.status?s.jsx(c,{}):s.jsx(d,{})}),s.jsx("button",{onClick:()=>(async s=>{if(window.confirm("Deletar este projeto?"))try{await x(s.id),$s("success","Projeto deletado!"),vs()}catch(e){$s("error",e.message||"Falha ao deletar")}})(e),className:K,title:"Deletar",children:s.jsx(p,{})})]})})]},e.id))})]})})}),s.jsxs(g,{variant:"elevated",className:W,id:"project-form",children:[s.jsx("h2",{className:q,children:ys.id?s.jsxs(s.Fragment,{children:[s.jsx(n,{})," Editar Projeto"]}):s.jsxs(s.Fragment,{children:[s.jsx(h,{})," Novo Projeto"]})}),s.jsxs("div",{className:X,children:[s.jsxs("div",{className:Y,children:[s.jsxs("div",{className:Z,children:[s.jsx("label",{children:"Título *"}),s.jsx("input",{type:"text",placeholder:"Título do projeto",value:ys.titulo,onChange:s=>Ns({...ys,titulo:s.target.value}),className:H})]}),s.jsxs("div",{className:Z,children:[s.jsx("label",{children:"Owner *"}),s.jsx("input",{type:"text",placeholder:"Responsável",value:ys.owner,onChange:s=>Ns({...ys,owner:s.target.value}),className:H})]}),s.jsxs("div",{className:Z,children:[s.jsx("label",{children:"Thumbnail URL"}),s.jsx("input",{type:"url",placeholder:"https://...",value:ys.thumb_url,onChange:s=>Ns({...ys,thumb_url:s.target.value}),className:H})]})]}),s.jsxs("div",{className:Y,children:[s.jsxs("div",{className:Z,children:[s.jsx("label",{children:"Data de Início"}),s.jsx("input",{type:"date",value:ys.data_inicio,onChange:s=>Ns({...ys,data_inicio:s.target.value}),className:H})]}),s.jsxs("div",{className:Z,children:[s.jsx("label",{children:"Status"}),s.jsxs("select",{value:ys.status,onChange:s=>Ns({...ys,status:s.target.value}),className:J,children:[s.jsx("option",{value:"rascunho",children:"Rascunho"}),s.jsx("option",{value:"ongoing",children:"Em Andamento"}),s.jsx("option",{value:"finalizado",children:"Finalizado"})]})]}),s.jsxs("div",{className:Z,children:[s.jsx("label",{children:"Preço (R$)"}),s.jsx("input",{type:"number",placeholder:"0",value:ys.preco,onChange:s=>Ns({...ys,preco:Number(s.target.value)}),className:H})]}),s.jsxs("div",{className:Z,children:[s.jsxs("label",{children:["Progresso: ",ys.progresso,"%"]}),s.jsx("input",{type:"range",min:"0",max:"100",value:ys.progresso,onChange:s=>Ns({...ys,progresso:Number(s.target.value)}),className:ss})]})]}),s.jsxs("div",{className:Z,children:[s.jsx("label",{children:"Descrição *"}),s.jsx("textarea",{placeholder:"Descreva o objetivo e escopo do projeto...",value:ys.descricao,onChange:s=>Ns({...ys,descricao:s.target.value}),className:Q,rows:"3"})]}),s.jsxs("div",{className:Z,children:[s.jsxs("label",{children:[s.jsx(u,{style:{marginRight:6}}),"Tecnologias"]}),s.jsx("div",{className:cs,children:ys.tags.map((e,a)=>s.jsxs("span",{className:ds,children:[e,s.jsx("button",{type:"button",onClick:()=>{return s=e,void Ns({...ys,tags:ys.tags.filter(e=>e!==s)});var s},className:ps,title:"Remover",children:s.jsx(t,{})})]},a))}),s.jsxs("div",{className:hs,children:[s.jsx("input",{type:"text",placeholder:"Ex: React, Node.js, Python...",value:Rs,onChange:s=>Ss(s.target.value),onKeyDown:s=>{"Enter"===s.key&&(s.preventDefault(),ks())},className:H}),s.jsxs("button",{type:"button",onClick:ks,className:us,children:[s.jsx(h,{})," Adicionar"]})]}),s.jsx("small",{className:_s,children:"Pressione Enter ou clique em Adicionar para incluir uma tecnologia"})]})]}),ys.preco>0&&s.jsxs("div",{className:es,children:[s.jsx(r,{})," Registro financeiro será criado: R$ ",ys.preco.toLocaleString("pt-BR")]}),s.jsxs("div",{className:as,children:[s.jsxs("button",{onClick:async()=>{try{if(!String(ys.titulo||"").trim()||!String(ys.owner||"").trim()||!String(ys.status||"").trim())return void $s("error","Preencha título, owner e status.");if(String(ys.descricao||"").length<10)return void $s("error","Descrição muito curta. Adicione mais detalhes.");if((s=>{const e=String(s||""),a=/^[a-zA-Z]:\\/.test(e),t=e.startsWith("file:");return a||t})(ys.thumb_url))return void $s("error","URL de imagem inválida. Use http(s) ou carregue um link público.");await m.upsert(ys),Ns({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,visivel:!1,thumb_url:"",tags:[]}),$s("success",ys.id?"Projeto atualizado com sucesso.":"Projeto criado com sucesso."),vs()}catch(s){$s("error","Erro ao salvar projeto: "+(s.message||"Falha desconhecida"))}},className:ts,children:[s.jsx(r,{})," ",ys.id?"Atualizar":"Criar"," Projeto"]}),ys.id&&s.jsxs("button",{onClick:()=>{Ns({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,visivel:!1,thumb_url:"",tags:[]})},className:rs,children:[s.jsx(t,{})," Cancelar"]})]})]})]})}export{ms as default};

import{j as e,a1 as a,a2 as s,af as t,a4 as l,ae as o,a7 as n,at as i,$ as r,aa as d,ay as c,ak as m}from"./index-sK2loqLz.js";import{r as j}from"./router-5U3rcizL.js";import{A as p,S as u}from"./StatusBadge-Du63B6PO.js";import{A as _}from"./AdminTable-C_HoPOCQ.js";import{l as h,g as x,u as v,c as N,d as g}from"./proposalAPI-pmyRHXpI.js";const b={page:"_page_1l9jd_7",header:"_header_1l9jd_17",headerTitle:"_headerTitle_1l9jd_31",headerIcon:"_headerIcon_1l9jd_43",statsGrid:"_statsGrid_1l9jd_87",statCard:"_statCard_1l9jd_101",statContent:"_statContent_1l9jd_111",statValue:"_statValue_1l9jd_125",statLabel:"_statLabel_1l9jd_137",statNovo:"_statNovo_1l9jd_149",statAnalise:"_statAnalise_1l9jd_151",statPipeline:"_statPipeline_1l9jd_153",filters:"_filters_1l9jd_159",searchBox:"_searchBox_1l9jd_173",searchIcon:"_searchIcon_1l9jd_185",searchInput:"_searchInput_1l9jd_203",filterGroup:"_filterGroup_1l9jd_235",filterIcon:"_filterIcon_1l9jd_247",filterSelect:"_filterSelect_1l9jd_255",empresaCell:"_empresaCell_1l9jd_289",contatoInfo:"_contatoInfo_1l9jd_309",emailLink:"_emailLink_1l9jd_319",orcamento:"_orcamento_1l9jd_337",actions:"_actions_1l9jd_349",actionBtn:"_actionBtn_1l9jd_361",modalOverlay:"_modalOverlay_1l9jd_401",modal:"_modal_1l9jd_401",modalHeader:"_modalHeader_1l9jd_443",modalClose:"_modalClose_1l9jd_473",modalBody:"_modalBody_1l9jd_513",modalGrid:"_modalGrid_1l9jd_521",modalField:"_modalField_1l9jd_535",orcamentoDestaque:"_orcamentoDestaque_1l9jd_593",descricaoSection:"_descricaoSection_1l9jd_603",descricaoTexto:"_descricaoTexto_1l9jd_637",modalFooter:"_modalFooter_1l9jd_653",footerLabel:"_footerLabel_1l9jd_671",statusButtons:"_statusButtons_1l9jd_683",statusBtn:"_statusBtn_1l9jd_695",statusNovo:"_statusNovo_1l9jd_731",statusAnalise:"_statusAnalise_1l9jd_743",statusRespondido:"_statusRespondido_1l9jd_755",statusArquivado:"_statusArquivado_1l9jd_767",loadingState:"_loadingState_1l9jd_881",errorState:"_errorState_1l9jd_881",spinner:"_spinner_1l9jd_901",spin:"_spin_1l9jd_901",retryBtn:"_retryBtn_1l9jd_945",toast:"_toast_1l9jd_983",slideIn:"_slideIn_1l9jd_1",toastSuccess:"_toastSuccess_1l9jd_1011",toastError:"_toastError_1l9jd_1023",headerActions:"_headerActions_1l9jd_1047",refreshBtn:"_refreshBtn_1l9jd_1057",spinning:"_spinning_1l9jd_1107",createBtn:"_createBtn_1l9jd_1115",statusContacted:"_statusContacted_1l9jd_1153",statusNegotiating:"_statusNegotiating_1l9jd_1165",statusApproved:"_statusApproved_1l9jd_1177",statusRejected:"_statusRejected_1l9jd_1189",footerLeft:"_footerLeft_1l9jd_1203",deleteBtn:"_deleteBtn_1l9jd_1211",pagination:"_pagination_1l9jd_1251",pageBtn:"_pageBtn_1l9jd_1271",formGroup:"_formGroup_1l9jd_1315",formGroupFull:"_formGroupFull_1l9jd_1339",input:"_input_1l9jd_1365",select:"_select_1l9jd_1365",textarea:"_textarea_1l9jd_1365",formActions:"_formActions_1l9jd_1405",cancelBtn:"_cancelBtn_1l9jd_1423",submitBtn:"_submitBtn_1l9jd_1453"},C={new:{label:"Novo",variant:"info"},contacted:{label:"Contatado",variant:"warning"},negotiating:{label:"Negociando",variant:"purple"},approved:{label:"Aprovado",variant:"success"},rejected:{label:"Rejeitado",variant:"danger"}},f={under5k:"Até R$ 5.000","5k-15k":"R$ 5.000 - R$ 15.000","15k-50k":"R$ 15.000 - R$ 50.000","50k-100k":"R$ 50.000 - R$ 100.000",above100k:"Acima de R$ 100.000",undefined:"A definir"},y={web:{label:"Aplicação Web"},mobile:{label:"App Mobile"},desktop:{label:"Software Desktop"},api:{label:"API/Backend"},fullstack:{label:"Solução Completa"},custom:{label:"Customizado"}},k=()=>{const[k,B]=j.useState([]),[S,A]=j.useState(!0),[P,$]=j.useState(null),[R,T]=j.useState(null),[w,G]=j.useState(!1),[I,E]=j.useState(!1),[D,F]=j.useState(""),[L,q]=j.useState(""),[z,O]=j.useState(""),[V,M]=j.useState({total:0,new:0,contacted:0,negotiating:0,pipelineTotal:0}),[H,W]=j.useState({page:1,limit:20,total:0,totalPages:0}),[Y,J]=j.useState(null),[K,Q]=j.useState({companyName:"",contactName:"",email:"",phone:"",projectType:"custom",budgetRange:"",description:""}),U=j.useCallback(async()=>{A(!0),$(null);try{const e=await h({status:D||void 0,search:z||void 0,page:H.page,limit:H.limit});B(e.proposals||[]),W(a=>({...a,total:e.pagination?.total||0,totalPages:e.pagination?.totalPages||0}))}catch(e){$(e.message||"Erro ao carregar propostas")}finally{A(!1)}},[D,z,H.page,H.limit]),X=j.useCallback(async()=>{try{const e=await x();M({total:e.total||0,new:e.byStatus?.new||0,contacted:e.byStatus?.contacted||0,negotiating:e.byStatus?.negotiating||0,approved:e.byStatus?.approved||0,conversionRate:e.conversionRate||"0"})}catch(e){}},[]);j.useEffect(()=>{U(),X()},[U,X]);const Z=j.useMemo(()=>L?k.filter(e=>e.projectType===L):k,[k,L]),ee=(e,a="success")=>{J({message:e,type:a}),setTimeout(()=>J(null),3e3)},ae=j.useCallback(e=>{T(e),G(!0)},[]),se=j.useCallback(()=>{G(!1),T(null)},[]),te=j.useCallback(()=>{E(!1),Q({companyName:"",contactName:"",email:"",phone:"",projectType:"custom",budgetRange:"",description:""})},[]),le=j.useCallback(async(e,a)=>{try{await v(e,a),B(s=>s.map(s=>s.id===e?{...s,status:a,updatedAt:(new Date).toISOString()}:s)),R?.id===e&&T(e=>e?{...e,status:a}:null),ee("Status atualizado com sucesso"),X()}catch(s){ee(s.message||"Erro ao atualizar status","error")}},[R,X]),oe=j.useCallback(async e=>{if(e.preventDefault(),K.companyName.trim()&&K.contactName.trim()&&K.email.trim())try{await N(K),ee("Proposta criada com sucesso"),te(),U(),X()}catch(a){ee(a.message||"Erro ao criar proposta","error")}else ee("Preencha os campos obrigatórios","error")},[K,U,X,te]),ne=j.useCallback(async e=>{if(window.confirm("Tem certeza que deseja excluir esta proposta?"))try{await g(e),ee("Proposta excluída com sucesso"),se(),U(),X()}catch(a){ee(a.message||"Erro ao excluir proposta","error")}},[U,X,se]),ie=e=>{if(!e)return"—";return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})},re=[{key:"companyName",label:"Empresa",render:(a,s)=>e.jsxs("div",{className:b.empresaCell,children:[e.jsx("strong",{children:a||"—"}),e.jsx("span",{className:b.contatoInfo,children:s.contactName||""})]})},{key:"email",label:"Email",render:a=>e.jsx("a",{href:`mailto:${a}`,className:b.emailLink,children:a||"—"})},{key:"projectType",label:"Tipo",render:e=>y[e]?.label||e||"—"},{key:"budgetRange",label:"Orçamento",render:a=>e.jsx("span",{className:b.orcamento,children:f[a]||a||"—"})},{key:"createdAt",label:"Data",render:e=>ie(e)},{key:"status",label:"Status",render:a=>{const s=C[a];return e.jsx(u,{variant:s?.variant||"neutral",dot:!0,pulse:"new"===a,children:s?.label||a})}},{key:"actions",label:"Ações",align:"center",render:(a,s)=>e.jsx("div",{className:b.actions,children:e.jsx("button",{className:b.actionBtn,onClick:e=>{e.stopPropagation(),ae(s)},title:"Ver detalhes",children:e.jsx(m,{})})})}];return S&&0===k.length?e.jsxs("div",{className:b.loadingState,children:[e.jsx("div",{className:b.spinner}),e.jsx("span",{children:"Carregando propostas..."})]}):P&&0===k.length?e.jsxs("div",{className:b.errorState,children:[e.jsx(a,{size:48}),e.jsx("h2",{children:"Erro ao carregar propostas"}),e.jsx("p",{children:P}),e.jsxs("button",{onClick:U,className:b.retryBtn,children:[e.jsx(s,{})," Tentar novamente"]})]}):e.jsxs("div",{className:b.page,children:[Y&&e.jsxs("div",{className:`${b.toast} ${b["toast"+("error"===Y.type?"Error":"Success")]}`,children:["error"===Y.type?e.jsx(a,{}):e.jsx(t,{}),Y.message]}),e.jsxs("header",{className:b.header,children:[e.jsxs("div",{className:b.headerTitle,children:[e.jsx(l,{className:b.headerIcon}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestão de Propostas B2B"}),e.jsx("p",{children:"Gerencie as solicitações de orçamento recebidas"})]})]}),e.jsxs("div",{className:b.headerActions,children:[e.jsx("button",{onClick:U,className:b.refreshBtn,disabled:S,title:"Atualizar",children:e.jsx(s,{className:S?b.spinning:""})}),e.jsxs("button",{onClick:()=>E(!0),className:b.createBtn,children:[e.jsx(o,{})," Nova Proposta"]})]})]}),e.jsxs("section",{className:b.statsGrid,children:[e.jsx(p,{variant:"elevated",className:b.statCard,children:e.jsxs("div",{className:b.statContent,children:[e.jsx("span",{className:b.statValue,children:V.total}),e.jsx("span",{className:b.statLabel,children:"Total de Propostas"})]})}),e.jsx(p,{variant:"elevated",className:`${b.statCard} ${b.statNovo}`,children:e.jsxs("div",{className:b.statContent,children:[e.jsx("span",{className:b.statValue,children:V.new}),e.jsx("span",{className:b.statLabel,children:"Novas"})]})}),e.jsx(p,{variant:"elevated",className:`${b.statCard} ${b.statAnalise}`,children:e.jsxs("div",{className:b.statContent,children:[e.jsx("span",{className:b.statValue,children:V.negotiating}),e.jsx("span",{className:b.statLabel,children:"Negociando"})]})}),e.jsx(p,{variant:"elevated",className:`${b.statCard} ${b.statPipeline}`,children:e.jsxs("div",{className:b.statContent,children:[e.jsxs("span",{className:b.statValue,children:[V.conversionRate,"%"]}),e.jsx("span",{className:b.statLabel,children:"Taxa de Conversão"})]})})]}),e.jsxs("section",{className:b.filters,children:[e.jsxs("div",{className:b.searchBox,children:[e.jsx(n,{className:b.searchIcon}),e.jsx("input",{type:"text",placeholder:"Buscar empresa, contato ou email...",value:z,onChange:e=>O(e.target.value),className:b.searchInput})]}),e.jsxs("div",{className:b.filterGroup,children:[e.jsx(i,{className:b.filterIcon}),e.jsxs("select",{value:D,onChange:e=>F(e.target.value),className:b.filterSelect,children:[e.jsx("option",{value:"",children:"Todos os Status"}),e.jsx("option",{value:"new",children:"Novo"}),e.jsx("option",{value:"contacted",children:"Contatado"}),e.jsx("option",{value:"negotiating",children:"Negociando"}),e.jsx("option",{value:"approved",children:"Aprovado"}),e.jsx("option",{value:"rejected",children:"Rejeitado"})]}),e.jsxs("select",{value:L,onChange:e=>q(e.target.value),className:b.filterSelect,children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"web",children:"Aplicação Web"}),e.jsx("option",{value:"mobile",children:"App Mobile"}),e.jsx("option",{value:"desktop",children:"Software Desktop"}),e.jsx("option",{value:"api",children:"API/Backend"}),e.jsx("option",{value:"fullstack",children:"Solução Completa"}),e.jsx("option",{value:"custom",children:"Customizado"})]})]})]}),e.jsx(p,{variant:"outlined",padding:"sm",children:e.jsx(_,{columns:re,data:Z,onRowClick:ae,emptyMessage:"Nenhuma proposta encontrada",hoverable:!0})}),H.totalPages>1&&e.jsxs("div",{className:b.pagination,children:[e.jsx("button",{onClick:()=>W(e=>({...e,page:e.page-1})),disabled:H.page<=1,className:b.pageBtn,children:"Anterior"}),e.jsxs("span",{children:["Página ",H.page," de ",H.totalPages]}),e.jsx("button",{onClick:()=>W(e=>({...e,page:e.page+1})),disabled:H.page>=H.totalPages,className:b.pageBtn,children:"Próxima"})]}),w&&R&&e.jsx("div",{className:b.modalOverlay,onClick:se,children:e.jsxs("div",{className:b.modal,onClick:e=>e.stopPropagation(),children:[e.jsxs("header",{className:b.modalHeader,children:[e.jsx("h2",{children:"Detalhes da Proposta"}),e.jsx("button",{className:b.modalClose,onClick:se,children:e.jsx(r,{})})]}),e.jsxs("div",{className:b.modalBody,children:[e.jsxs("div",{className:b.modalGrid,children:[e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Empresa"}),e.jsx("span",{children:R.companyName})]}),e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Contato"}),e.jsx("span",{children:R.contactName})]}),e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Email"}),e.jsx("a",{href:`mailto:${R.email}`,children:R.email})]}),e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Telefone"}),e.jsx("span",{children:R.phone||"—"})]}),e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Tipo de Projeto"}),e.jsx("span",{children:y[R.projectType]?.label||R.projectType})]}),e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Orçamento Estimado"}),e.jsx("span",{className:b.orcamentoDestaque,children:f[R.budgetRange]||R.budgetRange||"—"})]}),e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Status Atual"}),e.jsx(u,{variant:C[R.status]?.variant,dot:!0,children:C[R.status]?.label})]}),e.jsxs("div",{className:b.modalField,children:[e.jsx("label",{children:"Data de Criação"}),e.jsx("span",{children:ie(R.createdAt)})]})]}),e.jsxs("div",{className:b.descricaoSection,children:[e.jsx("label",{children:"Descrição do Projeto"}),e.jsx("p",{className:b.descricaoTexto,children:R.description||"Sem descrição"})]}),R.notes&&e.jsxs("div",{className:b.descricaoSection,children:[e.jsx("label",{children:"Notas Internas"}),e.jsx("p",{className:b.descricaoTexto,children:R.notes})]})]}),e.jsxs("footer",{className:b.modalFooter,children:[e.jsx("div",{className:b.footerLeft,children:e.jsxs("button",{className:b.deleteBtn,onClick:()=>ne(R.id),children:[e.jsx(d,{})," Excluir"]})}),e.jsxs("div",{className:b.statusButtons,children:[e.jsx("span",{className:b.footerLabel,children:"Alterar Status:"}),e.jsx("button",{className:`${b.statusBtn} ${b.statusNovo}`,onClick:()=>le(R.id,"new"),disabled:"new"===R.status,children:"Novo"}),e.jsx("button",{className:`${b.statusBtn} ${b.statusContacted}`,onClick:()=>le(R.id,"contacted"),disabled:"contacted"===R.status,children:"Contatado"}),e.jsx("button",{className:`${b.statusBtn} ${b.statusNegotiating}`,onClick:()=>le(R.id,"negotiating"),disabled:"negotiating"===R.status,children:"Negociando"}),e.jsxs("button",{className:`${b.statusBtn} ${b.statusApproved}`,onClick:()=>le(R.id,"approved"),disabled:"approved"===R.status,children:[e.jsx(t,{})," Aprovado"]}),e.jsxs("button",{className:`${b.statusBtn} ${b.statusRejected}`,onClick:()=>le(R.id,"rejected"),disabled:"rejected"===R.status,children:[e.jsx(c,{})," Rejeitado"]})]})]})]})}),I&&e.jsx("div",{className:b.modalOverlay,onClick:te,children:e.jsxs("div",{className:b.modal,onClick:e=>e.stopPropagation(),children:[e.jsxs("header",{className:b.modalHeader,children:[e.jsx("h2",{children:"Nova Proposta B2B"}),e.jsx("button",{className:b.modalClose,onClick:te,children:e.jsx(r,{})})]}),e.jsxs("form",{onSubmit:oe,className:b.modalBody,children:[e.jsxs("div",{className:b.modalGrid,children:[e.jsxs("div",{className:b.formGroup,children:[e.jsx("label",{children:"Empresa *"}),e.jsx("input",{type:"text",value:K.companyName,onChange:e=>Q(a=>({...a,companyName:e.target.value})),className:b.input,required:!0})]}),e.jsxs("div",{className:b.formGroup,children:[e.jsx("label",{children:"Contato *"}),e.jsx("input",{type:"text",value:K.contactName,onChange:e=>Q(a=>({...a,contactName:e.target.value})),className:b.input,required:!0})]}),e.jsxs("div",{className:b.formGroup,children:[e.jsx("label",{children:"Email *"}),e.jsx("input",{type:"email",value:K.email,onChange:e=>Q(a=>({...a,email:e.target.value})),className:b.input,required:!0})]}),e.jsxs("div",{className:b.formGroup,children:[e.jsx("label",{children:"Telefone"}),e.jsx("input",{type:"tel",value:K.phone,onChange:e=>Q(a=>({...a,phone:e.target.value})),className:b.input})]}),e.jsxs("div",{className:b.formGroup,children:[e.jsx("label",{children:"Tipo de Projeto"}),e.jsxs("select",{value:K.projectType,onChange:e=>Q(a=>({...a,projectType:e.target.value})),className:b.select,children:[e.jsx("option",{value:"web",children:"Aplicação Web"}),e.jsx("option",{value:"mobile",children:"App Mobile"}),e.jsx("option",{value:"desktop",children:"Software Desktop"}),e.jsx("option",{value:"api",children:"API/Backend"}),e.jsx("option",{value:"fullstack",children:"Solução Completa"}),e.jsx("option",{value:"custom",children:"Customizado"})]})]}),e.jsxs("div",{className:b.formGroup,children:[e.jsx("label",{children:"Orçamento Estimado"}),e.jsx("input",{type:"text",value:K.budgetRange,onChange:e=>Q(a=>({...a,budgetRange:e.target.value})),className:b.input,placeholder:"Ex: R$ 5.000 - R$ 10.000"})]})]}),e.jsxs("div",{className:b.formGroupFull,children:[e.jsx("label",{children:"Descrição do Projeto"}),e.jsx("textarea",{value:K.description,onChange:e=>Q(a=>({...a,description:e.target.value})),className:b.textarea,rows:4,placeholder:"Descreva os detalhes do projeto..."})]}),e.jsxs("div",{className:b.formActions,children:[e.jsx("button",{type:"button",onClick:te,className:b.cancelBtn,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:b.submitBtn,children:[e.jsx(o,{})," Criar Proposta"]})]})]})]})})]})};export{k as default};

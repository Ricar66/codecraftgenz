import{j as e,u as a,a as s}from"./index-DQkRuPgL.js";import{r}from"./router-Bh7m2j_b.js";import{s as t}from"./urlSanitize-kq56XB4o.js";import{N as i}from"./Navbar-CSWGQ87u.js";import{r as n}from"./realtime-BxkdmVbQ.js";const c="_card_xrfmp_7",l="_header_xrfmp_31",o="_thumb_xrfmp_37",d="_name_xrfmp_47",_="_pill_xrfmp_60",m="_tags_xrfmp_74",h="_objective_xrfmp_83",p="_meta_xrfmp_97",u="_countdown_xrfmp_105",f="_reward_xrfmp_113";function x(e){try{return new Date(e).toLocaleString("pt-BR")}catch{return"â€”"}}function b(e){try{const a=new Date(e).getTime(),s=Math.max(0,a-Date.now()),r=Math.floor(s/864e5),t=Math.floor(s%864e5/36e5),i=Math.floor(s%36e5/6e4);return`${r}d ${String(t).padStart(2,"0")}:${String(i).padStart(2,"0")}h`}catch{return"â€”"}}function v({challenge:a}){const s=a||{};return e.jsxs("article",{className:c,children:[e.jsxs("div",{className:l,children:[s.thumb_url?e.jsx("img",{className:o,src:t(s.thumb_url),alt:"Thumb"}):null,e.jsx("h3",{className:d,children:s.name}),e.jsx("span",{className:_,children:(e=>{const a=String(e||"").toLowerCase();return"starter"===a?"Starter":"intermediate"===a?"IntermediÃ¡rio":"pro"===a?"Pro":"â€”"})(s.difficulty)})]}),e.jsx("div",{className:m,children:(Array.isArray(s.tags)?s.tags:[]).map((a,s)=>e.jsx("span",{className:_,children:a},s))}),e.jsx("p",{className:h,children:s.objective||s.description||""}),e.jsxs("div",{className:p,children:[e.jsxs("span",{className:u,children:["â³ ",b(s.deadline)]}),s.reward?e.jsxs("span",{className:f,children:["ðŸŽ ",s.reward]}):null,"number"==typeof s.base_points&&s.base_points>0?e.jsxs("span",{className:_,children:["+",s.base_points," pts"]}):null,e.jsx("span",{className:_,children:(e=>{const a=String(e||"").toLowerCase();return"active"===a?"Ativo":"closed"===a?"Encerrado":"archived"===a?"Arquivado":"draft"===a?"Rascunho":"â€”"})(s.status)})]}),e.jsx("div",{className:p,children:e.jsxs("span",{children:["Deadline: ",x(s.deadline)]})})]})}const j="_page_4w11b_9",N="_hero_4w11b_77",g="_heroTitle_4w11b_95",w="_heroSubtitle_4w11b_137",y="_heroLead_4w11b_151",S="_challengesSection_4w11b_301",C="_carouselContainer_4w11b_319",T="_carouselTrack_4w11b_329",E="_navBtn_4w11b_381",L="_navBtnLeft_4w11b_431",R="_navBtnRight_4w11b_439",$="_challengeSnap_4w11b_449",A="_challengeActions_4w11b_465",k="_participateBtn_4w11b_479",B="_deliveryForm_4w11b_533",D="_deliveryInput_4w11b_543",I="_deliveryBtn_4w11b_581",M="_emptyState_4w11b_627",F="_emptyIcon_4w11b_643",O="_emptyTitle_4w11b_655",P="_emptyText_4w11b_667",U="_errorState_4w11b_677",q="_loadingState_4w11b_697",V="_spinner_4w11b_709",z="_footerSection_4w11b_739",J="_footerCard_4w11b_755",G="_footerText_4w11b_771";function Q(){const[t,c]=r.useState([]),[l,o]=r.useState(!0),[d,_]=r.useState(""),[m,h]=r.useState({}),{user:p}=a(),u=async()=>{try{o(!0),_("");const e=await s("/api/desafios",{method:"GET"}),a=Array.isArray(e?.data)?e.data:[];c(a)}catch(e){_(e?.message||"Falha ao carregar desafios"),c([])}finally{o(!1)}};r.useEffect(()=>{u();const e=n.subscribe("desafios_changed",()=>u());return()=>e()},[]);const f=r.useRef(null),x=e=>{const a=f.current;if(!a)return;const s=Math.round(.9*a.clientWidth);a.scrollBy({left:e*s,behavior:"smooth"})};return e.jsxs("div",{className:j,children:[e.jsx(i,{}),e.jsxs("header",{className:N,children:[e.jsx("h1",{className:g,children:"Desafios Epicos"}),e.jsx("h2",{className:w,children:"Desafios que moldam gigantes"}),e.jsx("p",{className:y,children:"Cada missao CodeCraft e uma oportunidade de testar suas habilidades e crescer como desenvolvedor. Aceite o desafio!"})]}),e.jsxs("section",{className:S,children:[l&&e.jsxs("div",{className:q,children:[e.jsx("div",{className:V}),e.jsx("p",{children:"Carregando desafios..."})]}),!l&&d&&e.jsx("div",{className:U,role:"alert",children:d}),!l&&!d&&t.length>0&&e.jsxs("div",{className:C,children:[e.jsx("button",{className:`${E} ${L}`,onClick:()=>x(-1),"aria-label":"Ver anteriores",children:"â—€"}),e.jsx("div",{className:T,ref:f,"aria-live":"polite",children:t.map(a=>e.jsxs("div",{className:$,children:[e.jsx(v,{challenge:a}),e.jsxs("div",{className:A,children:[e.jsx("button",{className:k,onClick:()=>(async e=>{const a=p?.id;if(!a)return void alert("E necessario estar autenticado para participar.");const r={crafter_id:a};try{await s(`/api/desafios/${e}/inscrever`,{method:"POST",body:JSON.stringify(r)}),alert("Inscricao realizada!"),n.publish("desafios_changed",{})}catch(t){alert(t.message||"Falha ao inscrever")}})(a.id),disabled:"active"!==a.status,children:"active"===a.status?"Quero participar!":"Encerrado"}),("link"===a.delivery_type||"github"===a.delivery_type)&&e.jsxs("div",{className:B,children:[e.jsx("input",{type:"text",placeholder:"github"===a.delivery_type?"URL do repositorio":"URL da entrega",value:m[a.id]||"",onChange:e=>h(s=>({...s,[a.id]:e.target.value})),className:D,"aria-label":"URL da entrega"}),e.jsx("button",{className:I,onClick:()=>(async e=>{const a=String(m[e.id]||"").trim();if(("link"===e.delivery_type||"github"===e.delivery_type)&&!/^https?:\/\//i.test(a))return void alert("URL invalida.");const r=p?.id;if(!r)return void alert("E necessario estar autenticado para enviar a entrega.");const t={crafter_id:r,delivery:{url:a,notes:""}};try{await s(`/api/desafios/${e.id}/entregar`,{method:"POST",body:JSON.stringify(t)}),alert("Entrega enviada!"),n.publish("desafios_changed",{}),h(a=>({...a,[e.id]:""}))}catch(i){alert(i.message||"Falha ao enviar")}})(a),disabled:"active"!==a.status,children:"Enviar"})]})]})]},a.id))}),e.jsx("button",{className:`${E} ${R}`,onClick:()=>x(1),"aria-label":"Ver proximos",children:"â–¶"})]}),!l&&!d&&0===t.length&&e.jsxs("div",{className:M,children:[e.jsx("div",{className:F,children:"ðŸŽ¯"}),e.jsx("h3",{className:O,children:"Nenhum desafio ativo"}),e.jsx("p",{className:P,children:"Volte em breve para conferir novos desafios e testar suas habilidades!"})]})]}),e.jsx("section",{className:z,children:e.jsx("div",{className:J,children:e.jsx("p",{className:G,children:"Nossos desafios nao sao apenas testes. Sao experiencias que transformam Crafters em verdadeiros criadores do amanha."})})})]})}export{Q as default};

import{a as e,j as a}from"./index-w4WX6YNc.js";import{r as s,d as r}from"./router-5U3rcizL.js";/* empty css                    */const t=()=>{const[t,i]=s.useState([]),[n,c]=s.useState(!0),[l,o]=s.useState(null),[d,m]=s.useState("pendente"),[h,u]=s.useState(""),[x,j]=s.useState(""),[p,f]=s.useState(""),[g,v]=s.useState(null),[N,b]=s.useState(null),[y,C]=s.useState([]),w=r(),S=[{value:"pendente",label:"Pendente",color:"#f39c12"},{value:"contato_realizado",label:"Contato Realizado",color:"#3498db"},{value:"confirmado",label:"Confirmado",color:"#27ae60"},{value:"rejeitado",label:"Rejeitado",color:"#e74c3c"}],E=s.useCallback(async()=>{c(!0);try{const a=new URLSearchParams;d&&a.append("status",d);const s=await e(`/api/inscricoes?${a.toString()}`,{method:"GET"}),r=Array.isArray(s)?s:s?.data||[];i(r),o(null)}catch(a){o(a.message),i([])}finally{c(!1)}},[d]);s.useEffect(()=>{if(!g)return;const e=setTimeout(()=>v(null),3500);return()=>clearTimeout(e)},[g]),s.useEffect(()=>{E()},[E]),s.useEffect(()=>{(async()=>{try{const a=await e("/api/crafters",{method:"GET"}),s=Array.isArray(a)?a:a?.data||[];C(s)}catch{C([])}})()},[]);const L=e=>(e||"").trim().toLowerCase(),_=s.useMemo(()=>{const e={};return t.forEach(a=>{const s=L(a.email);s&&(e[s]||(e[s]=[]),e[s].push(a))}),e},[t]),R=s.useMemo(()=>{const e={};return y.forEach(a=>{const s=L(a.email);s&&(e[s]||(e[s]=[]),e[s].push(a))}),e},[y]),T=s.useMemo(()=>t.filter(e=>{const a=L(e.email);return a&&!(R[a]&&R[a].length>0)}),[t,R]),$=s.useMemo(()=>y.filter(e=>{const a=L(e.email);return a&&!(_[a]&&_[a].length>0)}),[y,_]),I=s.useMemo(()=>{const e=[];return Object.values(_).forEach(a=>{a.length>1&&e.push(...a)}),e},[_]),k=s.useMemo(()=>{const e=[];return Object.entries(_).forEach(([a,s])=>{const r=(R[a]||[])[0];r&&s.forEach(s=>{(s.nome||"").trim().toLowerCase()!==(r.nome||"").trim().toLowerCase()&&e.push({email:a,inscricao:s,crafter:r})})}),e},[_,R]),A=t.filter(e=>{const a=""===d?"confirmado"!==e.status:!d||e.status===d,s=!h||e.nome.toLowerCase().includes(h.toLowerCase())||e.email.toLowerCase().includes(h.toLowerCase())||e.cidade?.toLowerCase().includes(h.toLowerCase())||e.estado?.toLowerCase().includes(h.toLowerCase())||e.area_interesse?.toLowerCase().includes(h.toLowerCase()),r=!x||e.area_interesse===x,t=!p||(()=>{const a=new Date(e.data_inscricao),s=new Date,r=Math.floor((s-a)/864e5);switch(p){case"hoje":return 0===r;case"semana":return r<=7;case"mes":return r<=30;case"trimestre":return r<=90;default:return!0}})();return a&&s&&r&&t});return n?a.jsx("div",{className:"adminContent admin-content",children:a.jsxs("div",{className:"loadingState",children:[a.jsx("div",{className:"spinner"}),a.jsx("p",{children:"Carregando inscri√ß√µes..."})]})}):l?a.jsx("div",{className:"adminContent admin-content",children:a.jsxs("div",{className:"errorState",children:[a.jsx("h2",{children:"Erro ao carregar inscri√ß√µes"}),a.jsx("p",{children:l}),a.jsx("button",{onClick:E,className:"retryBtn",children:"Tentar novamente"})]})}):a.jsxs("div",{className:"adminContent admin-content",children:[g&&a.jsx("div",{role:"status","aria-live":"polite",style:{marginBottom:"12px",padding:"10px 14px",borderRadius:"8px",border:"1px solid",borderColor:"success"===g.type?"#27ae60":"#e74c3c",background:"success"===g.type?"#ecf9f1":"#fee",color:"success"===g.type?"#2c3e50":"#8e2f2f"},children:g.message}),a.jsxs("div",{className:"pageHeader",children:[a.jsx("h1",{className:"title",children:"Inscri√ß√µes de Crafters"}),a.jsx("p",{className:"muted",children:'Gerencie as inscri√ß√µes recebidas atrav√©s do formul√°rio "Quero ser um Crafter"'})]}),a.jsxs("div",{className:"filtersSection filters-section",children:[a.jsx("div",{className:"searchBox",children:a.jsx("input",{type:"text",placeholder:"Buscar por nome, email, cidade, estado ou √°rea...",value:h,onChange:e=>u(e.target.value),className:"searchInput search-input"})}),a.jsxs("div",{className:"filtersRow",children:[a.jsxs("div",{className:"statusFilter",children:[a.jsxs("select",{value:d,onChange:e=>m(e.target.value),className:"statusSelect filter-select",children:[a.jsx("option",{value:"",children:"Todos os status"}),S.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),a.jsx("button",{className:"btn btn-outline",style:{marginLeft:8},onClick:()=>m(e=>""===e?"pendente":""),"aria-label":"Alternar entre pendentes e todos exceto confirmados",children:""===d?"Mostrar pendentes":"Mostrar todos (exceto confirmados)"})]}),a.jsx("div",{className:"areaFilter",children:a.jsxs("select",{value:x,onChange:e=>j(e.target.value),className:"areaSelect filter-select",children:[a.jsx("option",{value:"",children:"Todas as √°reas"}),["Front-end","Back-end","Dados","Design","DevOps","Outros"].map(e=>a.jsx("option",{value:e,children:e},e))]})}),a.jsx("div",{className:"dateFilter",children:a.jsxs("select",{value:p,onChange:e=>f(e.target.value),className:"dateSelect filter-select",children:[a.jsx("option",{value:"",children:"Todas as datas"}),a.jsx("option",{value:"hoje",children:"Hoje"}),a.jsx("option",{value:"semana",children:"√öltima semana"}),a.jsx("option",{value:"mes",children:"√öltimo m√™s"}),a.jsx("option",{value:"trimestre",children:"√öltimo trimestre"})]})})]})]}),a.jsx("div",{className:"stats",children:a.jsxs("span",{className:"stat-item",children:["Total: ",A.length]})}),a.jsxs("div",{className:"section",children:[a.jsx("h2",{children:"üîé Auditoria: Inscri√ß√µes ‚Üî Crafters"}),a.jsx("p",{className:"muted",children:"Verifica sincroniza√ß√£o por email entre inscri√ß√µes e crafters cadastrados."}),a.jsx("div",{style:{margin:"8px 0"},children:a.jsx("button",{className:"btn btn-secondary",onClick:()=>{const e=[];T.forEach(a=>e.push(["inscricao_sem_crafter",a.id,a.nome||"",a.email||"",a.cidade||""])),$.forEach(a=>e.push(["crafter_sem_inscricao",a.id,a.nome||"",a.email||"",""])),I.forEach(a=>e.push(["inscricao_duplicada_email",a.id,a.nome||"",a.email||"",""])),k.forEach(({email:a,inscricao:s,crafter:r})=>{e.push(["nome_divergente_mesmo_email",`${s?.id||""}/${r?.id||""}`,`${s?.nome||""} vs ${r?.nome||""}`.trim(),a||"",""])});const a=[["categoria","id","nome","email","extra"].join(","),...e.map(e=>e.map(e=>String(e).replace(/\n/g," ").replace(/"/g,'"')).join(","))].join("\n"),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),t=document.createElement("a");t.href=r,t.download="auditoria_inscricoes.csv",t.click(),URL.revokeObjectURL(r)},children:"Exportar CSV das inconsist√™ncias"})}),a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Verifica√ß√£o"}),a.jsx("th",{children:"Quantidade"})]})}),a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{"data-label":"Verifica√ß√£o",children:"Inscri√ß√µes sem crafter correspondente"}),a.jsx("td",{"data-label":"Quantidade",children:T.length})]}),a.jsxs("tr",{children:[a.jsx("td",{"data-label":"Verifica√ß√£o",children:"Crafters sem inscri√ß√£o correspondente"}),a.jsx("td",{"data-label":"Quantidade",children:$.length})]}),a.jsxs("tr",{children:[a.jsx("td",{"data-label":"Verifica√ß√£o",children:"Inscri√ß√µes duplicadas por email"}),a.jsx("td",{"data-label":"Quantidade",children:I.length})]}),a.jsxs("tr",{children:[a.jsx("td",{"data-label":"Verifica√ß√£o",children:"Nome divergente para o mesmo email"}),a.jsx("td",{"data-label":"Quantidade",children:k.length})]})]})]})}),a.jsxs("div",{className:"audit-details-grid",style:{marginTop:"12px"},children:[T.length>0&&a.jsxs("div",{className:"audit-card",children:[a.jsx("h4",{children:"Inscri√ß√µes sem Crafter"}),a.jsx("ul",{children:T.map(e=>a.jsxs("li",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsxs("span",{children:[e.nome," ‚Äî ",e.email]}),a.jsx("button",{className:"btn btn-primary btn-small",onClick:()=>{const a=new URLSearchParams({prefill_nome:e.nome||"",prefill_email:e.email||"",scroll:"create-crafter"});w(`/admin/equipes?${a.toString()}`)},children:"Criar Crafter"})]},e.id))})]}),$.length>0&&a.jsxs("div",{className:"audit-card",children:[a.jsx("h4",{children:"Crafters sem Inscri√ß√£o"}),a.jsx("ul",{children:$.map(e=>a.jsxs("li",{children:[e.nome," ‚Äî ",e.email]},e.id))})]}),I.length>0&&a.jsxs("div",{className:"audit-card",children:[a.jsx("h4",{children:"Inscri√ß√µes Duplicadas (Email)"}),a.jsx("ul",{children:I.map(e=>a.jsxs("li",{children:["#",e.id," ‚Äî ",e.nome," ‚Äî ",e.email]},e.id))})]}),k.length>0&&a.jsxs("div",{className:"audit-card",children:[a.jsx("h4",{children:"Nome Divergente (mesmo email)"}),a.jsx("ul",{children:k.map(({email:e,inscricao:s,crafter:r},t)=>a.jsxs("li",{children:[e,': inscri√ß√£o "',s.nome,'" vs crafter "',r.nome,'"']},`${e}-${t}`))})]})]})]}),a.jsx("div",{className:"inscricoesGrid",children:0===A.length?a.jsxs("div",{className:"emptyState",children:[a.jsx("h3",{children:"Nenhuma inscri√ß√£o encontrada"}),a.jsx("p",{children:h||d||x||p?"Tente ajustar os filtros de busca.":"Ainda n√£o h√° inscri√ß√µes de crafters."})]}):A.map(s=>{const r=(n=s.status,S.find(e=>e.value===n)||{value:n,label:n,color:"#95a5a6"});var n,c;return a.jsxs("div",{className:"inscricaoCard card",children:[a.jsxs("div",{className:"cardHeader",children:[a.jsx("h3",{children:s.nome}),a.jsx("div",{className:"statusBadge",style:{backgroundColor:r.color},children:r.label})]}),a.jsxs("div",{className:"cardContent",children:[a.jsxs("div",{className:"infoRow",children:[a.jsx("strong",{children:"Email:"}),a.jsx("a",{href:`mailto:${s.email}`,children:s.email})]}),s.telefone&&a.jsxs("div",{className:"infoRow",children:[a.jsx("strong",{children:"Telefone:"}),a.jsx("span",{children:s.telefone})]}),(s.cidade||s.estado)&&a.jsxs("div",{className:"infoRow",children:[a.jsx("strong",{children:"Localiza√ß√£o:"}),a.jsx("span",{children:[s.cidade,s.estado].filter(Boolean).join(", ")})]}),s.area_interesse&&a.jsxs("div",{className:"infoRow",children:[a.jsx("strong",{children:"√Årea de Interesse:"}),a.jsx("span",{className:"areaTag",children:s.area_interesse})]}),s.mensagem&&a.jsxs("div",{className:"infoRow messageRow",children:[a.jsx("strong",{children:"Mensagem:"}),a.jsx("p",{className:"messageText",children:s.mensagem})]}),a.jsxs("div",{className:"infoRow",children:[a.jsx("strong",{children:"Data da Inscri√ß√£o:"}),a.jsx("span",{children:(c=s.data_inscricao,c?new Date(c).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî")})]})]}),a.jsxs("div",{className:"cardActions",children:[a.jsx("select",{value:s.status,onChange:a=>(async(s,r)=>{if(S.map(e=>e.value).includes(r))try{if(b(s),await e(`/api/inscricoes/${s}/status`,{method:"PUT",body:JSON.stringify({status:r})}),i(e=>e.map(e=>e.id===s?{...e,status:r}:e)),"confirmado"===r)try{const r=(t||[]).find(e=>e.id===s),i=L(r?.email);if(i&&R[i]&&R[i].length>0||!i)v({type:"success",message:"Status atualizado. Crafter j√° existente para este email."});else{const s={nome:String(r?.nome||"").trim(),email:String(r?.email||"").trim(),avatar_url:""};await e("/api/crafters",{method:"POST",body:JSON.stringify(s)});try{const a=await e("/api/crafters",{method:"GET"}),s=Array.isArray(a)?a:a?.data||[];C(s)}catch(a){}v({type:"success",message:"Status atualizado e crafter criado com sucesso."})}}catch(a){v({type:"error",message:`Status atualizado, mas falhou ao criar crafter: ${a.message}`})}else v({type:"success",message:"Status atualizado com sucesso."})}catch(n){v({type:"error",message:`Erro ao atualizar status: ${n.message}`})}finally{b(null);try{await E()}catch(a){}}else v({type:"error",message:"Status inv√°lido selecionado."})})(s.id,a.target.value),className:"statusSelectInline",disabled:N===s.id,children:S.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsx("button",{className:"btn btn-danger",style:{marginLeft:8},onClick:()=>(async a=>{if(window.confirm("Confirma excluir esta inscri√ß√£o?"))try{await e(`/api/inscricoes/${a}`,{method:"DELETE"}),i(e=>e.filter(e=>e.id!==a)),v({type:"success",message:"Inscri√ß√£o exclu√≠da com sucesso."})}catch(s){v({type:"error",message:`Erro ao excluir inscri√ß√£o: ${s.message}`})}})(s.id),"aria-label":`Excluir inscri√ß√£o de ${s.nome}`,children:"Excluir inscri√ß√£o"})]})]},s.id)})})]})};export{t as default};

import{j as e}from"./index-DQkRuPgL.js";import{R as a}from"./router-Bh7m2j_b.js";import{f as r,U as s}from"./useAdminRepo-CbCCtI2A.js";/* empty css                    */import"./realtime-BxkdmVbQ.js";import"./projectsAPI-me_sk8Ob.js";import"./dataCache-D0LcSMWP.js";import"./rankingAPI-BHWt9I6k.js";import"./userAPI-B3dychSI.js";function l(){const{data:l,loading:n,error:i,refresh:o}=r(),[t,d]=a.useState({name:"",email:"",password:"",role:"viewer"}),[c,m]=a.useState(!1),[h,u]=a.useState(""),[p,x]=a.useState(1),[j,b]=a.useState({open:!1,userId:null,name:"",newPassword:"",confirm:"",saving:!1,error:""}),g=l.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.email.toLowerCase().includes(h.toLowerCase())||e.role.toLowerCase().includes(h.toLowerCase())),v=Math.max(1,Math.ceil(g.length/5)),w=g.slice(5*(p-1),5*p),[f,y]=a.useState({}),N=()=>{const e={};return t.name||(e.name="Nome é obrigatório"),t.email||(e.email="Email é obrigatório"),t.email&&!/\S+@\S+\.\S+/.test(t.email)&&(e.email="Email inválido"),t.password||(e.password="Senha é obrigatória"),t.password&&t.password.length<6&&(e.password="Senha deve ter no mínimo 6 caracteres"),e};return e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Usuários"}),e.jsx("div",{className:"filters-section",children:e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr auto auto auto auto"},children:[e.jsx("input",{"aria-label":"Buscar",placeholder:"Buscar (nome/e-mail/role)",value:h,onChange:e=>{u(e.target.value),x(1)}}),e.jsx("button",{className:"btn btn-outline","aria-label":"Página anterior",onClick:()=>x(Math.max(1,p-1)),children:"◀"}),e.jsxs("span",{style:{alignSelf:"center"},children:["Página ",p," / ",v]}),e.jsx("button",{className:"btn btn-outline","aria-label":"Próxima página",onClick:()=>x(Math.min(v,p+1)),children:"▶"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=g.map(e=>`${e.id},${e.name},${e.email},${e.role},${e.status}`).join("\n"),a=new Blob(["id,name,email,role,status\n"+e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="usuarios.csv",s.click(),URL.revokeObjectURL(r)},children:"Exportar CSV"})]})}),n&&e.jsx("p",{children:"Carregando..."}),i&&e.jsx("p",{role:"alert",children:i}),e.jsx("div",{className:"table","aria-busy":n,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"E-mail"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Controle"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===w.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:"Nenhum usuário"})}):w.map(a=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Nome",children:a.name}),e.jsx("td",{"data-label":"E-mail",children:a.email}),e.jsx("td",{"data-label":"Perfil",children:a.role}),e.jsx("td",{"data-label":"Status",children:e.jsx("span",{style:{background:"active"===a.status?"#00E4F2":"#666",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8em",fontWeight:"bold"},children:a.status})}),e.jsx("td",{"data-label":"Controle",children:e.jsx("button",{className:"btn btn-outline",onClick:async()=>{const e=await s.toggleStatus(a.id);e.ok?o():alert(e.error||"Falha ao alternar status")},children:"active"===a.status?"Desativar":"Ativar"})}),e.jsxs("td",{"data-label":"Ações",children:[e.jsxs("select",{"aria-label":"Alterar perfil",value:a.role,onChange:async e=>{const r=e.target.value;if(r!==a.role){const e=await s.update(a.id,{role:r});e.ok?o():alert(e.error||"Falha ao atualizar perfil")}},style:{marginLeft:8},children:[e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"editor",children:"editor"}),e.jsx("option",{value:"viewer",children:"viewer"})]}),e.jsx("button",{className:"btn btn-outline",style:{marginLeft:8},onClick:()=>b({open:!0,userId:a.id,name:a.name,newPassword:"",confirm:"",saving:!1,error:""}),"aria-label":`Editar senha de ${a.name}`,children:"Editar senha"})]})]},a.id))})]})}),e.jsxs("section",{className:"card",style:{marginTop:16},children:[e.jsx("h3",{style:{marginBottom:12},children:"Novo Usuário"}),e.jsxs("div",{className:"formRow",children:[e.jsx("label",{className:"sr-only",htmlFor:"user-name",children:"Nome"}),e.jsx("input",{id:"user-name","aria-label":"Nome",placeholder:"Nome",value:t.name,onChange:e=>d({...t,name:e.target.value}),required:!0}),e.jsx("label",{className:"sr-only",htmlFor:"user-email",children:"E-mail"}),e.jsx("input",{id:"user-email","aria-label":"E-mail",placeholder:"E-mail",type:"email",value:t.email,onChange:e=>d({...t,email:e.target.value}),required:!0}),e.jsx("label",{className:"sr-only",htmlFor:"user-password",children:"Senha"}),e.jsx("input",{id:"user-password","aria-label":"Senha",placeholder:"Senha",type:"password",value:t.password,onChange:e=>d({...t,password:e.target.value}),required:!0}),e.jsxs("select",{"aria-label":"Perfil",value:t.role,onChange:e=>d({...t,role:e.target.value}),children:[e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"editor",children:"editor"}),e.jsx("option",{value:"viewer",children:"viewer"})]}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{const e=N();Object.keys(e).length>0?y(e):(y({}),await(async()=>{m(!0);const e=await s.create(t);m(!1),e.ok?o():alert(e.error)})())},disabled:c||Object.keys(N()).length>0,children:c?"Criando...":"Criar usuário"})]})]}),e.jsxs("div",{className:"formRow",children:[f.name&&e.jsx("span",{style:{color:"red"},children:f.name}),f.email&&e.jsx("span",{style:{color:"red"},children:f.email}),f.password&&e.jsx("span",{style:{color:"red"},children:f.password})]}),j.open&&e.jsxs("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true","aria-label":`Editar senha de ${j.name}`,children:[e.jsxs("div",{className:"modal",children:[e.jsx("h3",{className:"title",children:"Editar senha"}),e.jsxs("p",{className:"muted",children:["Usuário: ",j.name]}),j.error&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["❌ ",j.error]}),e.jsxs("div",{className:"formRow",children:[e.jsx("label",{className:"sr-only",htmlFor:"new-password",children:"Nova senha"}),e.jsx("input",{id:"new-password",type:"password",placeholder:"Nova senha",value:j.newPassword,onChange:e=>b(a=>({...a,newPassword:e.target.value})),"aria-label":"Nova senha"}),e.jsx("label",{className:"sr-only",htmlFor:"confirm-password",children:"Confirmar senha"}),e.jsx("input",{id:"confirm-password",type:"password",placeholder:"Confirmar senha",value:j.confirm,onChange:e=>b(a=>({...a,confirm:e.target.value})),"aria-label":"Confirmar senha"})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:async()=>{const e=(j.newPassword||"").trim(),a=(j.confirm||"").trim();if(e.length<6)b(e=>({...e,error:"Senha deve ter no mínimo 6 caracteres"}));else if(e===a)try{b(e=>({...e,saving:!0,error:""}));const a=await s.update(j.userId,{password:e});a.ok?(b({open:!1,userId:null,name:"",newPassword:"",confirm:"",saving:!1,error:""}),o()):b(e=>({...e,saving:!1,error:a.error||"Falha ao atualizar senha"}))}catch(r){b(e=>({...e,saving:!1,error:r.message||"Erro inesperado"}))}else b(e=>({...e,error:"As senhas não coincidem"}))},disabled:j.saving,children:j.saving?"Salvando…":"Salvar"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>b({open:!1,userId:null,name:"",newPassword:"",confirm:"",saving:!1,error:""}),children:"Cancelar"})]})]}),e.jsx("style",{children:"\n            .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; padding:16px; z-index: 50; }\n            .modal { width: 100%; max-width: 520px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 16px; }\n            .title { color: var(--texto-branco); margin: 0 0 6px; }\n            .muted { color: var(--texto-gelo); }\n            .formRow input { padding: 10px 12px; border-radius: 10px; border:1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.06); color: var(--texto-branco); }\n          "})]})]})}export{l as default};

import{j as e,ax as s,l as a,af as i,a7 as t,am as l,an as r,a9 as n,al as d,ak as c,ay as o,S as j,m as u,ae as h,ah as m,$ as _,a as x}from"./index-BNwvcLYh.js";import{r as v}from"./router-Bh7m2j_b.js";import{a as p,D as b}from"./useAdminRepo-DihnYkvz.js";import{r as N}from"./realtime-BxkdmVbQ.js";import{A as f,S as g}from"./StatusBadge-Doi_MAPz.js";import"./projectsAPI-gL85jKDK.js";import"./dataCache-D0LcSMWP.js";import"./rankingAPI-DYarShkv.js";import"./userAPI-DkphFFhE.js";const k="_page_4k9jj_7",y="_header_4k9jj_13",C="_headerTitle_4k9jj_31",w="_headerIcon_4k9jj_43",S="_exportBtn_4k9jj_85",B="_toast_4k9jj_115",L="_filtersCard_4k9jj_155",A="_filters_4k9jj_155",D="_searchBox_4k9jj_183",E="_searchIcon_4k9jj_195",$="_searchInput_4k9jj_211",I="_pagination_4k9jj_243",R="_pageBtn_4k9jj_265",O="_desafiosGrid_4k9jj_309",P="_emptyCard_4k9jj_323",T="_emptyState_4k9jj_327",G="_emptyIcon_4k9jj_339",V="_desafioCard_4k9jj_355",z="_cardHeader_4k9jj_375",M="_objective_4k9jj_403",U="_cardMeta_4k9jj_417",q="_cardActions_4k9jj_453",F="_editBtn_4k9jj_463",H="_visibilityBtn_4k9jj_463",J="_statusBtn_4k9jj_463",Q="_detailsBtn_4k9jj_463",Y="_detailsSection_4k9jj_541",Z="_detailsGrid_4k9jj_553",K="_detailsList_4k9jj_579",W="_submissionsList_4k9jj_579",X="_submissionItem_4k9jj_621",ee="_score_4k9jj_671",se="_reviewActions_4k9jj_683",ae="_selectSm_4k9jj_697",ie="_inputSm_4k9jj_697",te="_reviewBtn_4k9jj_721",le="_muted_4k9jj_743",re="_formCard_4k9jj_757",ne="_formTitle_4k9jj_767",de="_formGrid_4k9jj_787",ce="_formRow_4k9jj_799",oe="_formGroup_4k9jj_811",je="_input_4k9jj_697",ue="_select_4k9jj_697",he="_textarea_4k9jj_865",me="_checkboxLabel_4k9jj_901",_e="_formActions_4k9jj_933",xe="_saveBtn_4k9jj_949",ve="_cancelBtn_4k9jj_949",pe="_loadingState_4k9jj_1011",be="_spinner_4k9jj_1031";function Ne(){const{data:Ne,loading:fe,refresh:ge}=p(),[ke,ye]=v.useState({name:"",objective:"",description:"",deadline:"",difficulty:"starter",tags:[],reward:"",base_points:0,delivery_type:"link",thumb_url:"",status:"draft",visible:!0}),[Ce,we]=v.useState(null),[Se,Be]=v.useState(!1),[Le,Ae]=v.useState(null),[De,Ee]=v.useState(null),[$e,Ie]=v.useState(!1),[Re,Oe]=v.useState(""),[Pe,Te]=v.useState(""),[Ge,Ve]=v.useState(1),ze=v.useMemo(()=>(Ne||[]).filter(e=>(e.name||"").toLowerCase().includes(Pe.toLowerCase())||(e.objective||"").toLowerCase().includes(Pe.toLowerCase())||(e.status||"").toLowerCase().includes(Pe.toLowerCase())),[Ne,Pe]),Me=Math.max(1,Math.ceil(ze.length/6)),Ue=ze.slice(6*(Ge-1),6*Ge),qe=e=>{Oe(e),setTimeout(()=>Oe(""),2500)},Fe=async e=>{Ie(!0);try{const s=await x(`/api/desafios/${e}`,{method:"GET"});Ee(s?.data?.challenge||s?.challenge||s)}catch{Ee(null)}finally{Ie(!1)}};v.useEffect(()=>{const e=N.subscribe("desafios_changed",()=>{ge(),Le&&Fe(Le)});return()=>e()},[Le,ge]);const He=e=>{switch(e){case"active":return"success";case"closed":return"error";case"archived":return"neutral";default:return"warning"}};return fe?e.jsx("div",{className:k,children:e.jsxs("div",{className:pe,children:[e.jsx("div",{className:be}),e.jsx("p",{children:"Carregando desafios..."})]})}):e.jsxs("div",{className:k,children:[e.jsxs("header",{className:y,children:[e.jsxs("div",{className:C,children:[e.jsx(s,{className:w}),e.jsxs("div",{children:[e.jsx("h1",{children:"Gestão de Desafios"}),e.jsxs("p",{children:[(Ne||[]).length," desafios cadastrados"]})]})]}),e.jsxs("button",{onClick:()=>{const e=ze.map(e=>`${e.id},"${e.name}","${e.objective}",${e.status},${e.visible},${e.deadline||""},${e.base_points||0}`).join("\n"),s=new Blob(["id,name,objective,status,visible,deadline,base_points\n"+e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download="desafios.csv",i.click(),URL.revokeObjectURL(a)},className:S,children:[e.jsx(a,{})," Exportar CSV"]})]}),Re&&e.jsxs("div",{className:B,children:[e.jsx(i,{})," ",Re]}),e.jsx(f,{variant:"elevated",className:L,children:e.jsxs("div",{className:A,children:[e.jsxs("div",{className:D,children:[e.jsx(t,{className:E}),e.jsx("input",{type:"text",placeholder:"Buscar (nome/objetivo/status)...",value:Pe,onChange:e=>{Te(e.target.value),Ve(1)},className:$})]}),e.jsxs("div",{className:I,children:[e.jsx("button",{onClick:()=>Ve(Math.max(1,Ge-1)),disabled:1===Ge,className:R,children:e.jsx(l,{})}),e.jsxs("span",{children:["Página ",Ge," de ",Me]}),e.jsx("button",{onClick:()=>Ve(Math.min(Me,Ge+1)),disabled:Ge===Me,className:R,children:e.jsx(r,{})})]})]})}),e.jsx("div",{className:O,children:0===Ue.length?e.jsx(f,{variant:"outlined",className:P,children:e.jsxs("div",{className:T,children:[e.jsx(s,{className:G}),e.jsx("p",{children:"Nenhum desafio encontrado"})]})}):Ue.map(a=>e.jsxs(f,{variant:"elevated",className:V,children:[e.jsxs("div",{className:z,children:[e.jsx("h3",{children:a.name}),e.jsx(g,{variant:He(a.status),children:a.status})]}),e.jsx("p",{className:M,children:a.objective||"Sem objetivo definido"}),e.jsxs("div",{className:U,children:[e.jsxs("span",{children:[e.jsx(s,{})," ",a.base_points??0," pts"]}),e.jsx("span",{children:a.deadline?new Date(a.deadline).toLocaleDateString("pt-BR"):"Sem prazo"}),e.jsx(g,{variant:a.visible?"info":"neutral",size:"sm",children:a.visible?"Visível":"Oculto"})]}),e.jsxs("div",{className:q,children:[e.jsx("button",{onClick:()=>(e=>{we(e.id),ye({id:e.id,name:e.name,objective:e.objective||"",description:e.description||"",deadline:e.deadline||"",difficulty:e.difficulty||"starter",tags:Array.isArray(e.tags)?e.tags:[],reward:e.reward||"",base_points:Number(e.base_points??0),delivery_type:e.delivery_type||"link",thumb_url:e.thumb_url||"",status:e.status||"draft",visible:!!e.visible}),document.getElementById("desafio-form")?.scrollIntoView({behavior:"smooth"})})(a),className:F,title:"Editar",children:e.jsx(n,{})}),e.jsx("button",{onClick:()=>(async e=>{Be(!0);try{await x(`/api/desafios/${e.id}/visibility`,{method:"PUT",body:JSON.stringify({visible:!e.visible})}),qe("Visibilidade atualizada!"),ge()}finally{Be(!1)}})(a),disabled:Se,className:H,title:a.visible?"Ocultar":"Exibir",children:a.visible?e.jsx(d,{}):e.jsx(c,{})}),e.jsx("button",{onClick:()=>(async e=>{Be(!0);try{const s="closed"===e.status?"active":"closed";await b.setStatus(e.id,s),qe(`Desafio ${"closed"===s?"encerrado":"reaberto"}!`),ge()}finally{Be(!1)}})(a),disabled:Se,className:J,title:"closed"===a.status?"Reabrir":"Encerrar",children:"closed"===a.status?e.jsx(o,{}):e.jsx(j,{})}),e.jsx("button",{onClick:()=>(async e=>{const s=Le===e.id?null:e.id;Ae(s),Ee(null),s&&await Fe(s)})(a),className:Q,title:"Detalhes",children:e.jsx(u,{})})]}),Le===a.id&&e.jsx("div",{className:Y,children:$e?e.jsx("p",{children:"Carregando detalhes..."}):De?e.jsxs("div",{className:Z,children:[e.jsxs("div",{children:[e.jsxs("h4",{children:["Inscrições (",De.registrations?.length||0,")"]}),De.registrations?.length>0?e.jsx("ul",{className:K,children:De.registrations.map(s=>e.jsxs("li",{children:[e.jsxs("span",{children:["Crafter #",s.crafter_id]}),e.jsx("small",{children:new Date(s.at).toLocaleDateString("pt-BR")})]},s.id))}):e.jsx("p",{className:le,children:"Nenhuma inscrição"})]}),e.jsxs("div",{children:[e.jsxs("h4",{children:["Entregas (",De.submissions?.length||0,")"]}),De.submissions?.length>0?e.jsx("ul",{className:W,children:De.submissions.map(s=>e.jsxs("li",{className:X,children:[e.jsxs("div",{children:[e.jsxs("strong",{children:["Crafter #",s.crafter_id]}),e.jsx("small",{children:s.delivery?.url||"-"})]}),e.jsx(g,{variant:"approved"===s.status?"success":"rejected"===s.status?"error":"warning",size:"sm",children:s.status||"submitted"}),e.jsxs("span",{className:ee,children:[s.score??0," pts"]}),e.jsxs("div",{className:se,children:[e.jsxs("select",{defaultValue:s.status||"submitted",id:`status-${s.id}`,className:ae,children:[e.jsx("option",{value:"approved",children:"Aprovar"}),e.jsx("option",{value:"rejected",children:"Reprovar"})]}),e.jsx("input",{type:"number",placeholder:"pts",defaultValue:s.score??De.base_points??0,id:`pts-${s.id}`,className:ie}),e.jsx("button",{onClick:()=>{const e=document.getElementById(`status-${s.id}`)?.value||"approved",a=Number(document.getElementById(`pts-${s.id}`)?.value||0);(async(e,s,a)=>{Be(!0);try{await b.reviewSubmission(e,{status:s,score:a,review:{notes:"",criteria_scores:{}}}),await Fe(Le),qe("Submissão avaliada!")}finally{Be(!1)}})(s.id,e,a)},disabled:Se,className:te,children:"Revisar"})]})]},s.id))}):e.jsx("p",{className:le,children:"Nenhuma entrega"})]})]}):e.jsx("p",{className:le,children:"Erro ao carregar detalhes"})})]},a.id))}),e.jsxs(f,{variant:"elevated",className:re,id:"desafio-form",children:[e.jsx("h2",{className:ne,children:Ce?e.jsxs(e.Fragment,{children:[e.jsx(n,{})," Editar Desafio"]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{})," Novo Desafio"]})}),e.jsxs("div",{className:de,children:[e.jsxs("div",{className:ce,children:[e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Nome *"}),e.jsx("input",{type:"text",placeholder:"Nome do desafio",value:ke.name,onChange:e=>ye({...ke,name:e.target.value}),className:je})]}),e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Objetivo"}),e.jsx("input",{type:"text",placeholder:"Objetivo principal",value:ke.objective,onChange:e=>ye({...ke,objective:e.target.value}),className:je})]})]}),e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{placeholder:"Descrição detalhada...",value:ke.description,onChange:e=>ye({...ke,description:e.target.value}),className:he,rows:"3"})]}),e.jsxs("div",{className:ce,children:[e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Deadline"}),e.jsx("input",{type:"datetime-local",value:ke.deadline,onChange:e=>ye({...ke,deadline:e.target.value}),className:je})]}),e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Dificuldade"}),e.jsxs("select",{value:ke.difficulty,onChange:e=>ye({...ke,difficulty:e.target.value}),className:ue,children:[e.jsx("option",{value:"starter",children:"Starter"}),e.jsx("option",{value:"intermediate",children:"Intermediário"}),e.jsx("option",{value:"pro",children:"Pro"})]})]}),e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Base Points"}),e.jsx("input",{type:"number",min:"0",value:ke.base_points,onChange:e=>ye({...ke,base_points:Number(e.target.value)}),className:je})]})]}),e.jsxs("div",{className:ce,children:[e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Recompensa"}),e.jsx("input",{type:"text",placeholder:"Ex: Badge exclusiva",value:ke.reward,onChange:e=>ye({...ke,reward:e.target.value}),className:je})]}),e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Tipo de Entrega"}),e.jsxs("select",{value:ke.delivery_type,onChange:e=>ye({...ke,delivery_type:e.target.value}),className:ue,children:[e.jsx("option",{value:"link",children:"Link"}),e.jsx("option",{value:"github",children:"GitHub"}),e.jsx("option",{value:"file",children:"Arquivo"})]})]}),e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:ke.status,onChange:e=>ye({...ke,status:e.target.value}),className:ue,children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"active",children:"Ativo"}),e.jsx("option",{value:"closed",children:"Encerrado"}),e.jsx("option",{value:"archived",children:"Arquivado"})]})]})]}),e.jsxs("div",{className:ce,children:[e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Tags (separadas por vírgula)"}),e.jsx("input",{type:"text",placeholder:"react, frontend, api",value:Array.isArray(ke.tags)?ke.tags.join(", "):"",onChange:e=>ye({...ke,tags:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),className:je})]}),e.jsxs("div",{className:oe,children:[e.jsx("label",{children:"Thumbnail URL"}),e.jsx("input",{type:"url",placeholder:"https://...",value:ke.thumb_url,onChange:e=>ye({...ke,thumb_url:e.target.value}),className:je})]}),e.jsx("div",{className:oe,children:e.jsxs("label",{className:me,children:[e.jsx("input",{type:"checkbox",checked:ke.visible,onChange:e=>ye({...ke,visible:e.target.checked})}),"Visível no site"]})})]})]}),e.jsxs("div",{className:_e,children:[e.jsxs("button",{onClick:async()=>{Be(!0);try{const e=Ce?{...ke,id:Ce}:ke;await b.upsert(e),we(null),ye({name:"",objective:"",description:"",deadline:"",difficulty:"starter",tags:[],reward:"",base_points:0,delivery_type:"link",thumb_url:"",status:"draft",visible:!0}),qe(Ce?"Desafio atualizado!":"Desafio criado!"),ge()}finally{Be(!1)}},disabled:Se||!ke.name,className:xe,children:[e.jsx(m,{})," ",Ce?"Atualizar":"Criar"," Desafio"]}),Ce&&e.jsxs("button",{onClick:()=>{we(null),ye({name:"",objective:"",description:"",deadline:"",difficulty:"starter",tags:[],reward:"",base_points:0,delivery_type:"link",thumb_url:"",status:"draft",visible:!0})},className:ve,children:[e.jsx(_,{})," Cancelar"]})]})]})]})}export{Ne as default};

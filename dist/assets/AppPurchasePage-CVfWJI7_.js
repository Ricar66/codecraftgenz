import{u as e,a,j as t,h as i,i as o,k as n,A as r}from"./index-B9S7B1ct.js";import{r as s,R as d,L as l,e as c,f as m,d as u}from"./router-5U3rcizL.js";import{i as p,C as _,g}from"./mercadopago-BDjobIhy.js";import{c as x,b as h,d as f,e as j,r as y,f as b,h as v,s as N}from"./appsAPI-G3iHfGEJ.js";import{N as w}from"./Navbar-Xam8FuIu.js";import{b as C}from"./leadsAPI-Dh1f6z42.js";import{a as S}from"./appModel-ChWjNXiV.js";import"./urlSanitize-MTL8k_kh.js";let P=null,k=!1;function $(){return k&&window.MercadoPago?Promise.resolve():P||(P=new Promise((e,a)=>{if(window.MercadoPago)return k=!0,void e();const t=document.createElement("script");t.src="https://sdk.mercadopago.com/js/v2",t.async=!0,t.onload=()=>{k=!0,e()},t.onerror=()=>{P=null,a(new Error("Falha ao carregar SDK do MercadoPago"))},document.head.appendChild(t)}),P)}const I=({appId:i,amount:o,quantity:n=1,description:r="Compra de aplicativo",onPaymentSuccess:l,onStatus:c,buyer:m={},cardholderEmail:u,identificationType:h,identificationNumber:f,cardholderName:j,deviceId:y,maxInstallments:b=4})=>{const[v,N]=s.useState(!1),[w,C]=s.useState(!0),[S,P]=s.useState(""),{user:k}=e(),I=d.useMemo(()=>({email:m?.email||u||k?.email,docType:m?.docType||h||"CPF",docNumber:m?.docNumber||f,name:m?.name||j,phone:m?.phone,streetName:m?.streetName,zip:m?.zip}),[m?.email,m?.docType,m?.docNumber,m?.name,m?.phone,m?.streetName,m?.zip,u,h,f,j,k?.email]);s.useEffect(()=>{String("").toLowerCase();(async()=>{try{await $();let e="APP_USR-57782f61-a250-4abe-a856-ad9c5860a8a9";if(!e)try{const t=await a("/api/config/mp-public-key",{method:"GET"});e=t?.public_key||t?.data?.public_key||""}catch{}e?(window.__MP_INIT_DONE||(p(e,{locale:"pt-BR"}),window.__MP_INIT_DONE=!0),N(!0)):P("Chave pública do Mercado Pago não configurada")}catch(e){P(e?.message||"Falha ao inicializar Mercado Pago")}finally{C(!1)}})()},[]);const E={amount:Number(o||0),payer:{email:I.email||u,identification:{type:h||I.docType||"CPF",number:f||I.docNumber}}},T={texts:{formTitle:"Dados do Cartão",installmentsSectionTitle:`Parcele em até ${b}x`,cardholderName:{label:"Nome impresso no cartão",placeholder:"Ex: João M. da Silva"},cardholderIdentification:{label:"CPF do titular do cartão"},cardNumber:{label:"Número do cartão"},expirationDate:{label:"Vencimento (MM/AA)"},securityCode:{label:"Cód. de segurança (CVV)"},formSubmit:n>1?`Pagar ${n} licenças`:"Pagar Agora"},visual:{style:{theme:"dark"}},paymentMethods:{maxInstallments:b}};return t.jsxs("div",{style:{marginTop:12},children:[t.jsx("h3",{className:"title",style:{fontSize:"1rem"},children:"Cartão de crédito / débito"}),S&&t.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["❌ ",S]}),w&&t.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:[t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto 12px"}}),t.jsx("p",{children:"Carregando formulário de pagamento..."})]}),v&&!w&&t.jsx(_,{initialization:E,customization:T,onSubmit:async e=>{try{P("");const a=Number(o||0);if(!Number.isFinite(a)||a<=0)throw new Error("Valor de pagamento inválido.");const t=e?.payer?.email||e?.cardholderEmail||I.email||u||void 0,s=e?.payer?.identification||{},d=s?.type||e?.identificationType||I.docType||h||"CPF",m=s?.number||e?.identificationNumber||I.docNumber||f||void 0,p=(e?.cardholder?.name||I.name||"").trim(),_=p?p.split(/\s+/):[],j=_[0]||void 0,v=_.length>1?_.slice(1).join(" "):void 0;let N=e?.payment_method_id||e?.paymentMethodId||e?.paymentMethod?.id;if(!N){const a=e?.bin||e?.card?.bin;if(a&&String(a).length>=6){const e=await g({bin:String(a).slice(0,6)});Array.isArray(e)&&e[0]?.id&&(N=e[0].id)}}if(!N)throw{status:400,details:{message:"payment_method_id é obrigatório (ex.: master, visa, pix, ticket)"}};if(!t)throw{status:400,details:{message:"E-mail do pagador é obrigatório"}};if(!j)throw{status:400,details:{message:"Nome do titular do cartão é obrigatório"}};if(!m)throw{status:400,details:{message:"CPF/CNPJ do titular é obrigatório"}};const w=Number(e?.installments||1),C=Math.min(Math.max(1,w),b),S={token:e?.token,payment_method_id:N,...e?.issuer_id?{issuer_id:e.issuer_id}:{},installments:C,quantity:n,binary_mode:!1,capture:!0,transaction_amount:a,description:String(r||""),payer:{email:t,first_name:j,...v?{last_name:v}:{},identification:{type:d,number:m}},additional_info:{items:[{id:String(i||""),title:String(r||""),quantity:n,unit_price:a/n}],payer:{phone:I.phone?{number:String(I.phone)}:void 0,address:I.zip||I.streetName?{zip_code:String(I.zip||""),street_name:String(I.streetName||"")}:void 0}},metadata:{cardholder_name:p||void 0,cardholder_identification_type:d?String(d):void 0,cardholder_identification_number:m?String(m):void 0,license_quantity:n}},k=y?{deviceId:y}:"undefined"!=typeof window&&(window.MP_DEVICE_SESSION_ID||window.__MP_DEVICE_ID)?{deviceId:window.MP_DEVICE_SESSION_ID||window.__MP_DEVICE_ID}:void 0,$=await x(i,S,k),E=$?.status||$?.data?.status||"pending",T=$?.status_detail||$?.data?.status_detail||"";if("function"==typeof c&&c($),"approved"===E&&"function"==typeof l)l($);else if("rejected"===E){P({cc_rejected_bad_filled_card_number:"Número do cartão inválido. Verifique e tente novamente.",cc_rejected_bad_filled_date:"Data de validade inválida. Verifique e tente novamente.",cc_rejected_bad_filled_other:"Dados do cartão incorretos. Verifique todos os campos.",cc_rejected_bad_filled_security_code:"Código de segurança (CVV) inválido.",cc_rejected_blacklist:"Cartão não autorizado. Use outro cartão.",cc_rejected_call_for_authorize:"Ligue para a operadora do cartão para autorizar.",cc_rejected_card_disabled:"Cartão desabilitado. Contate sua operadora.",cc_rejected_card_error:"Erro no cartão. Tente outro cartão.",cc_rejected_duplicated_payment:"Pagamento duplicado. Verifique seu extrato.",cc_rejected_high_risk:"Pagamento recusado por segurança. Tente outro cartão.",cc_rejected_insufficient_amount:"Saldo insuficiente no cartão.",cc_rejected_invalid_installments:"Parcelas não permitidas para este cartão.",cc_rejected_max_attempts:"Limite de tentativas excedido. Aguarde e tente novamente.",cc_rejected_other_reason:"Pagamento recusado. Tente outro cartão ou forma de pagamento."}[T]||`Pagamento rejeitado: ${T||"motivo não informado"}`)}else if("pending"===E||"in_process"===E)"function"==typeof l&&l($);else{const e=$?.friendly_message||$?.normalized?.mensagem_usuario||"";P(e||`Status do pagamento: ${E}. Verifique os dados e tente novamente.`)}}catch(a){const e=a?.status,t=a?.details||{};if(503===e&&"NO_ACCESS_TOKEN"===t?.error)P("Configuração do Mercado Pago ausente. Contate o suporte.");else if(502===e&&"NETWORK_ERROR"===t?.error)P("Falha de rede ao contatar o Mercado Pago. Tente novamente.");else if(502===e&&(t?.mp_status||t?.message))P(`Pagamento não foi criado (${t?.mp_status||"erro"}: ${String(t?.message||"")})`);else if(400===e&&Array.isArray(t?.cause)&&t.cause.find(e=>"2056"===String(e?.code)))P("Ajustamos o modo binário. Tente novamente.");else if(400===e){const e=Array.isArray(t?.cause)?t.cause[0]?.message||t.cause[0]?.description:"";P(String(t?.message||e||"Dados incompletos do cartão. Verifique e reenvie."))}else P(409===e?"Pagamento já processado ou em andamento. Aguarde alguns segundos e verifique seu e-mail.":422===e?"Dados inválidos. Verifique número do cartão, validade e CVV.":429===e?"Muitas tentativas. Aguarde alguns minutos e tente novamente.":a?.message||"Falha ao processar pagamento")}},onError:e=>{P(e?.message||"Erro no componente de pagamento")},onReady:()=>{}})]})},E=({appId:i,amount:o,quantity:n=1,description:r="Compra de aplicativo",onPaymentSuccess:l,onStatus:c,onError:m,buyer:u={},preferenceId:p,maxInstallments:_=4})=>{const[g,j]=s.useState(!1),[y,b]=s.useState(!0),[v,N]=s.useState(""),[w,C]=s.useState(p||""),[S,P]=s.useState(null),{user:k}=e(),I=s.useRef(null),E=s.useRef(null),T=d.useMemo(()=>({email:u?.email||k?.email||"",name:u?.name||k?.name||"",docType:u?.docType||"CPF",docNumber:u?.docNumber||""}),[u,k]);return s.useEffect(()=>()=>{if(E.current)try{E.current.unmount()}catch(e){}},[]),s.useEffect(()=>{const e=!1;let t=!1,s=!1;const d=setTimeout(()=>{t||s||(b(!1),N("Tempo esgotado ao carregar métodos de pagamento. Recarregue a página."))},2e4);return(async()=>{try{if(await $(),t)return;String("").toLowerCase();let s="APP_USR-57782f61-a250-4abe-a856-ad9c5860a8a9";e;const g=!s||s.includes("xxxx")||s.includes("XXXX");if(!s||g)try{e;const t=await a("/api/config/mp-public-key",{method:"GET"}),i=t?.data?.publicKey||t?.publicKey||t?.public_key||t?.data?.public_key||"";!i||i.includes("xxxx")||i.includes("XXXX")||(s=i)}catch(d){e}if(t)return;if(!s||s.includes("xxxx")||s.includes("XXXX")||s.length<20)return N("Chave pública do Mercado Pago não configurada."),void b(!1);let h=p||"";if(!h&&T.email)try{e;const a=await f(i,{email:T.email,name:T.name});if(t)return;h=a?.id||a?.data?.id||a?.preference_id||"",h&&C(h)}catch(u){}if(t)return;if(await new Promise(e=>setTimeout(e,100)),!I.current)return N("Erro interno: container de pagamento não encontrado."),void b(!1);e;const y=new window.MercadoPago(s,{locale:"pt-BR"}).bricks();e;const v={initialization:{amount:Number(o||0),preferenceId:h||void 0,payer:{email:T.email,firstName:T.name?.split(" ")[0]||"",lastName:T.name?.split(" ").slice(1).join(" ")||"",identification:{type:T.docType||"CPF",number:T.docNumber||""}}},customization:{paymentMethods:{creditCard:"all",debitCard:"all",bankTransfer:"all",ticket:"all",mercadoPago:h?"all":[],maxInstallments:_},visual:{style:{theme:"dark",customVariables:{formBackgroundColor:"#1a1a2e",baseColor:"#00e4f2"}}}},callbacks:{onReady:()=>{b(!1),j(!0)},onSubmit:async({selectedPaymentMethod:a,formData:t})=>{try{if(N(""),"wallet_purchase"===a||"onboarding_credits"===a)return;const s=Number(o||0);if(!Number.isFinite(s)||s<=0)throw new Error("Valor de pagamento inválido.");const d=t?.payer?.email||T.email;if(!d)throw new Error("E-mail do pagador é obrigatório");const u=Number(t?.installments||1),p=Math.min(Math.max(1,u),_),g={token:t?.token,payment_method_id:t?.payment_method_id||a,issuer_id:t?.issuer_id,installments:p,quantity:n,transaction_amount:s,description:String(r||""),payer:{email:d,first_name:t?.payer?.first_name||T.name?.split(" ")[0]||"",last_name:t?.payer?.last_name||T.name?.split(" ").slice(1).join(" ")||"",identification:t?.payer?.identification||{type:T.docType||"CPF",number:T.docNumber||""}},..."pix"===a?{date_of_expiration:new Date(Date.now()+864e5).toISOString()}:{}};e;const h=await x(i,g);e;const f=h?.status||h?.data?.status||"pending",j=t?.payment_method_id||a||"";e;const y="pix"===j||j?.toLowerCase()?.includes("pix")||"pix"===a||"bank_transfer"===a;let b=!1;if(y&&("pending"===f||"in_process"===f)){const e=h?.point_of_interaction?.transaction_data||h?.data?.point_of_interaction?.transaction_data||h?.result?.point_of_interaction?.transaction_data||h?.data?.result?.point_of_interaction?.transaction_data||h?.transaction_data||{qr_code:h?.qr_code||h?.data?.qr_code,qr_code_base64:h?.qr_code_base64||h?.data?.qr_code_base64,ticket_url:h?.ticket_url||h?.data?.ticket_url};if(e&&(e.qr_code||e.qr_code_base64)){const a=h?.data?.payment_id||h?.payment_id||h?.data?.mp_payment_id||"";P({qrCode:e.qr_code,qrCodeBase64:e.qr_code_base64,ticketUrl:e.ticket_url,paymentId:a}),b=!0}}if("function"==typeof c&&c(h),"approved"===f)"function"==typeof l&&l(h);else if("pending"===f||"in_process"===f)b||"function"==typeof l&&l(h);else if("rejected"===f){const e=h?.status_detail||"",a={cc_rejected_bad_filled_card_number:"Número do cartão inválido.",cc_rejected_bad_filled_date:"Data de validade inválida.",cc_rejected_bad_filled_security_code:"Código de segurança (CVV) inválido.",cc_rejected_insufficient_amount:"Saldo insuficiente no cartão.",cc_rejected_high_risk:"Pagamento recusado por segurança.",cc_rejected_other_reason:"Pagamento recusado. Tente outro cartão."}[e]||`Pagamento rejeitado: ${e||"motivo não informado"}`;N(a),"function"==typeof m&&m(new Error(a))}}catch(s){N(s?.message||"Falha ao processar pagamento"),"function"==typeof m&&m(s)}},onError:e=>{N(e?.message||"Erro no componente de pagamento"),"function"==typeof m&&m(e)}}},w=await y.create("payment","paymentBrick_container",v);E.current=w}catch(g){t||(N(g?.message||"Falha ao inicializar Mercado Pago"),b(!1))}finally{s=!0}})(),()=>{t=!0,clearTimeout(d)}},[i,o,n,r,T.email,T.name,T.docType,T.docNumber,p,_,l,c,m]),s.useEffect(()=>{if(!S?.paymentId||!i)return;const e=setInterval(async()=>{try{const a=await h(i,{payment_id:S.paymentId});false,"approved"===(a?.data?.status||a?.status)&&(clearInterval(e),P(null),"function"==typeof l&&l({status:"approved",payment_id:S.paymentId,data:a?.data||a}))}catch(a){}},5e3);return()=>clearInterval(e)},[S?.paymentId,i,l]),S?t.jsxs("div",{style:{marginTop:24,display:"flex",flexDirection:"column",alignItems:"center",maxWidth:480,margin:"24px auto 0",padding:"32px 24px",backgroundColor:"rgba(26, 26, 46, 0.6)",border:"1px solid rgba(0, 228, 242, 0.15)",borderRadius:16},children:[t.jsx("h3",{style:{fontSize:"1.2rem",marginBottom:4,color:"#fff",fontWeight:600},children:"Pague com PIX"}),t.jsx("p",{style:{color:"#00e4f2",marginBottom:20,fontSize:"0.9rem"},children:"Escaneie o QR Code ou copie o codigo abaixo"}),S.qrCodeBase64&&t.jsx("div",{style:{padding:16,backgroundColor:"#fff",borderRadius:12,marginBottom:24,display:"inline-block"},children:t.jsx("img",{src:`data:image/png;base64,${S.qrCodeBase64}`,alt:"QR Code PIX",style:{width:220,height:220,display:"block"}})}),S.qrCode&&t.jsxs("div",{style:{width:"100%",marginBottom:20},children:[t.jsx("p",{style:{fontSize:"0.8rem",color:"#999",marginBottom:8,textAlign:"center"},children:"Codigo PIX (Copia e Cola)"}),t.jsxs("div",{style:{display:"flex",alignItems:"stretch",gap:0,borderRadius:8,overflow:"hidden",border:"1px solid rgba(0, 228, 242, 0.2)"},children:[t.jsx("input",{readOnly:!0,value:S.qrCode,style:{flex:1,padding:"12px 14px",fontSize:"0.75rem",fontFamily:"monospace",backgroundColor:"#0d0d1a",color:"#ccc",border:"none",outline:"none",minWidth:0},onClick:e=>{e.target.select(),navigator.clipboard?.writeText(S.qrCode)}}),t.jsx("button",{onClick:()=>{navigator.clipboard?.writeText(S.qrCode),alert("Codigo PIX copiado!")},style:{padding:"12px 20px",backgroundColor:"#00e4f2",color:"#000",border:"none",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem",whiteSpace:"nowrap"},children:"Copiar"})]})]}),t.jsxs("div",{style:{width:"100%",padding:"14px 16px",backgroundColor:"rgba(0, 228, 242, 0.06)",border:"1px solid rgba(0, 228, 242, 0.15)",borderRadius:10,display:"flex",alignItems:"center",justifyContent:"center",gap:10,marginBottom:8},children:[t.jsx("div",{style:{width:10,height:10,borderRadius:"50%",backgroundColor:"#00e4f2",animation:"pixPulse 1.5s ease-in-out infinite",flexShrink:0}}),t.jsx("p",{style:{fontSize:"0.85rem",color:"#00e4f2",margin:0},children:"Aguardando pagamento... Verificando automaticamente."})]}),t.jsx("style",{children:"@keyframes pixPulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.85); } }"}),t.jsx("p",{style:{fontSize:"0.78rem",color:"#555",marginTop:4,marginBottom:16,textAlign:"center"},children:"Assim que o pagamento for confirmado, voce sera redirecionado automaticamente."}),t.jsx("button",{onClick:()=>P(null),style:{padding:"10px 24px",backgroundColor:"transparent",color:"rgba(0, 228, 242, 0.7)",border:"1px solid rgba(0, 228, 242, 0.25)",borderRadius:8,cursor:"pointer",fontSize:"0.85rem",transition:"all 0.2s"},onMouseEnter:e=>{e.target.style.borderColor="#00e4f2",e.target.style.color="#00e4f2"},onMouseLeave:e=>{e.target.style.borderColor="rgba(0, 228, 242, 0.25)",e.target.style.color="rgba(0, 228, 242, 0.7)"},children:"Escolher outro metodo"})]}):v&&!g?t.jsx("div",{style:{padding:"20px",textAlign:"center"},children:t.jsxs("p",{style:{color:"#FF6B6B"},children:["❌ ",v]})}):t.jsxs("div",{style:{marginTop:16},children:[t.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:12,color:"#fff"},children:"Escolha a forma de pagamento"}),v&&t.jsxs("p",{role:"alert",style:{color:"#FF6B6B",marginBottom:12},children:["❌ ",v]}),y&&t.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#999"},children:[t.jsx("div",{className:"loading-spinner",style:{margin:"0 auto 12px"}}),t.jsx("p",{children:"Carregando métodos de pagamento..."})]}),t.jsx("div",{id:"paymentBrick_container",ref:I,style:{minHeight:y?0:"auto"}})]})},T="_banner_x5d0s_5",B="_content_x5d0s_21",A="_header_x5d0s_33",M="_iconLarge_x5d0s_45",z="_title_x5d0s_69",q="_subtitle_x5d0s_83",D="_benefits_x5d0s_95",F="_benefit_x5d0s_95",R="_actions_x5d0s_139",V="_loginButton_x5d0s_153",W="_registerButton_x5d0s_191",O="_orText_x5d0s_231",L="_disclaimer_x5d0s_241",X="_bannerCompact_x5d0s_259",G="_icon_x5d0s_45",U="_compactText_x5d0s_291",K="_link_x5d0s_301";function H({className:a,compact:i=!1}){const{isAuthenticated:o,loading:n}=e();if(n||o)return null;return i?t.jsxs("div",{className:`${X} ${a||""}`,children:[t.jsx("span",{className:G,children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]})}),t.jsxs("span",{className:U,children:[t.jsx(l,{to:"/login",className:K,children:"Faca login"})," para vincular esta compra a sua conta"]})]}):t.jsxs("div",{className:`${T} ${a||""}`,children:[t.jsxs("div",{className:B,children:[t.jsxs("div",{className:A,children:[t.jsx("span",{className:M,children:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),t.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),t.jsxs("div",{children:[t.jsx("h4",{className:z,children:"Ja tem uma conta?"}),t.jsx("p",{className:q,children:"Faca login para uma experiencia melhor"})]})]}),t.jsx("ul",{className:D,children:["Historico de compras centralizado","Acesso em multiplos dispositivos","Suporte prioritario"].map((e,a)=>t.jsxs("li",{className:F,children:[t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("polyline",{points:"20 6 9 17 4 12"})}),e]},a))}),t.jsxs("div",{className:R,children:[t.jsx(l,{to:"/login",className:V,children:"Fazer Login"}),t.jsx(l,{to:"/register",className:W,children:"Criar Conta"})]}),t.jsx("span",{className:O,children:"ou continue sem login abaixo"})]}),t.jsx("p",{className:L,children:"Voce pode comprar sem login. Basta informar seu email para receber a licenca."})]})}const J={purchasePage:"_purchasePage_1jcux_5",purchaseCard:"_purchaseCard_1jcux_12",title:"_title_1jcux_41",subtitle:"_subtitle_1jcux_53",muted:"_muted_1jcux_60",price:"_price_1jcux_67",platformSection:"_platformSection_1jcux_77",platformLabel:"_platformLabel_1jcux_85",platformBadges:"_platformBadges_1jcux_92",platformBadge:"_platformBadge_1jcux_92",btnGroup:"_btnGroup_1jcux_112",btn:"_btn_1jcux_112",btnPrimary:"_btnPrimary_1jcux_137",btnOutline:"_btnOutline_1jcux_153",buyerSection:"_buyerSection_1jcux_172",warningBox:"_warningBox_1jcux_179",warningIcon:"_warningIcon_1jcux_190",warningText:"_warningText_1jcux_195",formGrid:"_formGrid_1jcux_207",inputWrap:"_inputWrap_1jcux_213",input:"_input_1jcux_213",cardPaymentSection:"_cardPaymentSection_1jcux_251",statusBox:"_statusBox_1jcux_258",statusApproved:"_statusApproved_1jcux_265",statusPending:"_statusPending_1jcux_274",statusRejected:"_statusRejected_1jcux_283",progressWrap:"_progressWrap_1jcux_305",progressBar:"_progressBar_1jcux_309",progress:"_progress_1jcux_305",feedbackSection:"_feedbackSection_1jcux_324",feedbackGrid:"_feedbackGrid_1jcux_330",helpDetails:"_helpDetails_1jcux_373",modalOverlay:"_modalOverlay_1jcux_400",modalCard:"_modalCard_1jcux_413",modalTitle:"_modalTitle_1jcux_427",modalDesc:"_modalDesc_1jcux_435",modalField:"_modalField_1jcux_442",modalLabel:"_modalLabel_1jcux_448",modalError:"_modalError_1jcux_454",modalActions:"_modalActions_1jcux_460",errorMessage:"_errorMessage_1jcux_468"},Q=e=>{if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;const a=e.startsWith("/")?e:`/${e}`;return a.startsWith("/api/")?`${r}${a}`:a.startsWith("/downloads/")?`${r}/api${a}`:`${r}${a}`};const Z={windows:{icon:n,label:"Windows"},macos:{icon:o,label:"macOS"},linux:{icon:i,label:"Linux"}},Y=()=>{const{id:a}=c(),[i]=m(),o=u(),[n,r]=s.useState(null),[l,p]=s.useState(!0),[_,g]=s.useState(""),[x,P]=s.useState(""),[k,$]=s.useState(""),[T]=s.useState(0),[B]=s.useState("idle"),[A]=s.useState(""),[M,z]=s.useState({rating:5,comment:""}),[q,D]=s.useState(1),{user:F}=e(),[R,V]=s.useState({name:String(F?.name||""),email:String(F?.email||""),identification:""}),[W,O]=s.useState(""),[L,X]=s.useState(!1),G="undefined"!=typeof window&&"1"===new URLSearchParams(window.location.search).get("showCard"),[U,K]=s.useState(G),[Y,ee]=s.useState("card"),[ae,te]=s.useState(1),[ie,oe]=s.useState(!1),[ne,re]=s.useState(""),[se,de]=s.useState(""),[le,ce]=s.useState(!1),me=d.useRef(!1),ue=async()=>{const e=[navigator.userAgent||"",navigator.language||"",navigator.platform||"",(screen?.width||"")+"x"+(screen?.height||""),Intl.DateTimeFormat().resolvedOptions().timeZone||""].join("|"),a=(new TextEncoder).encode(e),t=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("").slice(0,32)};s.useEffect(()=>{let e=!0;return(async()=>{try{const t=await j(a);e&&r(t?.data||t)}catch(t){g(t.message||"Erro ao carregar app")}finally{p(!1)}})(),()=>{e=!1}},[a]),s.useEffect(()=>{let e=!1;const a="APP_USR-57782f61-a250-4abe-a856-ad9c5860a8a9",t=()=>{if(e)return!1;if(W)return X(!0),!0;if("undefined"==typeof window)return!1;const t=window.MercadoPago;if(!t)return!1;try{const e=new t(a),o="function"==typeof e.getDeviceId?e.getDeviceId():window.MP_DEVICE_SESSION_ID||"";if(o){const e=String(o);O(e),X(!0);try{window.__MP_DEVICE_ID=e}catch(i){}return!0}}catch(i){}return!1};if(t())return()=>{e=!0};const i=Date.now(),o=setInterval(()=>{t()?(clearInterval(o),e=!0):Date.now()-i>1e4&&(clearInterval(o),e=!0,X(!0))},500);return()=>{e=!0;try{clearInterval(o)}catch(a){}}},[W]),s.useEffect(()=>{const e=i.get("preference_id"),t=i.get("payment_id"),n=i.get("status");(e||t||n)&&(async()=>{try{const i=await h(a,{preference_id:e,payment_id:t,status:n}),r=i?.status||n||"";if(P(r),$(i?.status_detail||""),"approved"===r)return void o(`/apps/${a}/sucesso?payment_id=${t||i?.payment_id||""}&status=approved`)}catch(i){}})()},[a,i,o]);return t.jsxs("div",{className:`${J.purchasePage} page-with-background`,children:[t.jsx(w,{}),t.jsx("div",{className:J.purchaseCard,children:l?t.jsx("p",{className:J.muted,children:"Carregando..."}):_?t.jsxs("p",{className:J.errorMessage,role:"alert",children:[t.jsx("span",{children:"❌"})," ",_]}):t.jsxs(t.Fragment,{children:[t.jsx("h1",{className:J.title,children:n?.name||n?.titulo}),t.jsx("p",{className:J.muted,children:n?.description||n?.mainFeature}),(()=>{const e=(e=>{if(!e)return["windows"];if(Array.isArray(e))return e;if("string"==typeof e)try{return JSON.parse(e)}catch{return[e]}return["windows"]})(n?.platforms);return e.length?t.jsxs("div",{className:J.platformSection,children:[t.jsx("p",{className:J.platformLabel,children:"Disponível para:"}),t.jsx("div",{className:J.platformBadges,children:e.map(e=>{const a=Z[e];if(!a)return null;const i=a.icon;return t.jsxs("span",{className:J.platformBadge,children:[t.jsx(i,{})," ",a.label]},e)})})]}):null})(),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",marginBottom:8,fontSize:"0.9rem",color:"#aaa"},children:"Quantidade de licenças:"}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[t.jsx("button",{className:J.btn,onClick:()=>te(e=>Math.max(1,e-1)),disabled:ae<=1,style:{padding:"8px 16px",fontSize:"1.2rem"},children:"−"}),t.jsx("span",{style:{fontSize:"1.5rem",fontWeight:"bold",minWidth:40,textAlign:"center"},children:ae}),t.jsx("button",{className:J.btn,onClick:()=>te(e=>Math.min(10,e+1)),disabled:ae>=10,style:{padding:"8px 16px",fontSize:"1.2rem"},children:"+"}),t.jsx("span",{style:{fontSize:"0.85rem",color:"#888"},children:"(máx. 10 por compra)"})]}),ae>1&&t.jsx("p",{style:{marginTop:8,fontSize:"0.85rem",color:"#00e4f2"},children:"Cada licença permite instalar em 1 máquina diferente."})]}),t.jsx("p",{className:J.price,children:(()=>{const e=S(n||{}),a=e*ae;return e<=0?"A definir":1===ae?`R$ ${e.toLocaleString("pt-BR",{minimumFractionDigits:2})}`:t.jsxs(t.Fragment,{children:[t.jsxs("span",{style:{fontSize:"0.9rem",color:"#aaa",fontWeight:"normal"},children:[ae,"x R$ ",e.toLocaleString("pt-BR",{minimumFractionDigits:2})," ="," "]}),"R$ ",a.toLocaleString("pt-BR",{minimumFractionDigits:2})]})})()}),t.jsx("p",{className:J.muted,children:ae>1?`Total para ${ae} licenças. Parcele em até 4x sem juros!`:"Preço final do produto. Parcele em até 4x sem juros!"}),t.jsx(H,{}),t.jsx("p",{className:J.muted,style:{marginTop:8},children:"Metodos disponiveis: Cartao de credito/debito, PIX, Boleto e Conta Mercado Pago."}),t.jsxs("div",{className:J.paymentMethodSelector,style:{marginTop:16,marginBottom:16},children:[t.jsx("p",{style:{marginBottom:8,fontSize:"0.9rem",color:"#aaa"},children:"Escolha como deseja pagar:"}),t.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsx("button",{className:`${J.btn} ${"payment"===Y?J.btnPrimary:J.btnOutline}`,onClick:()=>{ee("payment"),D(1)},style:{flex:"1 1 auto",minWidth:140},children:"Todos os Métodos"}),t.jsx("button",{className:`${J.btn} ${"card"===Y?J.btnPrimary:J.btnOutline}`,onClick:()=>{ee("card"),D(1)},style:{flex:"1 1 auto",minWidth:140},children:"Cartão de Crédito"}),t.jsx("button",{className:`${J.btn} ${"wallet"===Y?J.btnPrimary:J.btnOutline}`,onClick:()=>{ee("wallet"),D(1)},style:{flex:"1 1 auto",minWidth:140},children:"Conta Mercado Pago"})]})]}),t.jsx("div",{className:J.btnGroup,children:t.jsx("button",{className:`${J.btn} ${J.btnOutline}`,onClick:async()=>{try{let e=null;try{e=await y(a)}catch{e=null}const t=Q(e?.download_url||"");if(t)return void window.open(t,"_blank","noopener");const i=String(R.email||F?.email||"").trim();if(!i)return re(""),de(""),void oe(!0);const o=await ue(),r=await b({email:i,appId:Number(a),hardwareId:o});if(!r?.licensed)return void alert(r?.message||"Licença não validada.");const s=await v(a,i),d=Q(s?.download_url||"");d?window.open(d,"_blank","noopener"):alert("Download ainda não liberado para este e-mail.");const l=encodeURIComponent(`Ativação de licença - ${n?.name||n?.titulo||"Aplicativo"}`),c=["Olá,","","Concluí o download e estou ativando minha licença.",r?.license_key?`Chave: ${r.license_key}`:void 0,`App: ${n?.name||n?.titulo||""} (ID ${a})`,"Este e-mail será usado para ativar e validar meu software.","","Obrigado."].filter(Boolean),m=encodeURIComponent(c.join("\n"));window.open(`mailto:${i}?subject=${l}&body=${m}`,"_blank")}catch(e){alert("Erro ao processar download: "+e.message)}},disabled:"approved"!==x,children:"Baixar executável"})}),1===q&&t.jsxs("div",{id:"buyer-info-section",className:J.buyerSection,children:[t.jsx("h3",{className:J.subtitle,children:"Dados do comprador"}),t.jsxs("div",{className:J.warningBox,children:[t.jsx("span",{className:J.warningIcon,children:"⚠️"}),t.jsxs("p",{className:J.warningText,children:[t.jsx("strong",{children:"Importante:"})," O e-mail informado abaixo será usado para"," ",t.jsx("strong",{children:"ativar sua licença"})," assim que a compra for aprovada. Verifique se está correto."]})]}),t.jsxs("div",{className:J.formGrid,children:[t.jsxs("div",{className:J.inputWrap,children:[t.jsx("label",{children:"Nome completo"}),t.jsx("input",{className:J.input,"aria-label":"Nome completo",placeholder:"Ex: Ricardo Coradini",value:R.name,onChange:e=>V(a=>({...a,name:e.target.value}))})]}),t.jsxs("div",{className:J.inputWrap,children:[t.jsx("label",{children:"E-mail"}),t.jsx("input",{className:J.input,"aria-label":"E-mail",placeholder:"seu@email.com",type:"email",value:R.email,onChange:e=>V(a=>({...a,email:e.target.value}))})]}),t.jsxs("div",{className:J.inputWrap,children:[t.jsx("label",{children:"CPF"}),t.jsx("input",{className:J.input,"aria-label":"CPF",placeholder:"000.000.000-00",value:R.identification,onChange:e=>V(a=>({...a,identification:String(e.target.value||"").replace(/[^0-9]/g,"").slice(0,11)}))})]})]}),t.jsxs("div",{className:J.formGrid,style:{marginTop:12},children:[t.jsxs("div",{className:J.inputWrap,children:[t.jsx("label",{children:"Telefone (opcional)"}),t.jsx("input",{className:J.input,"aria-label":"Telefone",placeholder:"(11) 99999-9999",value:R.phone||"",onChange:e=>V(a=>({...a,phone:String(e.target.value||"").replace(/[^0-9+\s-]/g,"")}))})]}),t.jsxs("div",{className:J.inputWrap,children:[t.jsx("label",{children:"CEP (opcional)"}),t.jsx("input",{className:J.input,"aria-label":"CEP",placeholder:"00000-000",value:R.zip||"",onChange:e=>V(a=>({...a,zip:String(e.target.value||"").replace(/[^0-9]/g,"").slice(0,8)}))})]}),t.jsxs("div",{className:J.inputWrap,children:[t.jsx("label",{children:"Endereço (rua) (opcional)"}),t.jsx("input",{className:J.input,"aria-label":"Endereço",placeholder:"Rua Exemplo, 123",value:R.streetName||"",onChange:e=>V(a=>({...a,streetName:String(e.target.value||"").replace(/<[^>]*>/g,"").trim()}))})]})]}),t.jsx("p",{className:J.muted,style:{marginTop:8},children:"Preencha nome, e-mail e CPF para continuar. Telefone e endereço ajudam a aprovação do pagamento."}),t.jsx("div",{style:{marginTop:12},children:t.jsx("button",{className:`${J.btn} ${J.btnPrimary}`,onClick:e=>{e.preventDefault();const t=String(R.name||"").trim(),i=String(R.email||"").trim(),o=String(R.identification||"").trim();t&&i&&o?(C({name:t,email:i,phone:R.phone,identification:o,zip:R.zip,streetName:R.streetName},a,n?.name||n?.titulo).catch(()=>{}),D(2),K(!0),setTimeout(()=>{const e=document.getElementById("card-payment-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)):alert("Por favor, preencha nome, e-mail e CPF.")},children:"Continuar para pagamento"})})]}),x&&t.jsxs("p",{className:J.muted,style:{marginTop:12},children:["Status da compra: ",t.jsx("strong",{children:x})]}),2===q&&"payment"===Y&&t.jsx("div",{id:"card-payment-section",className:J.cardPaymentSection,children:t.jsx(E,{appId:a,amount:S(n||{})*ae,quantity:ae,description:n?.name||n?.titulo?`Compra de ${n?.name||n?.titulo}${ae>1?` (${ae} licenças)`:""}`:"Compra de aplicativo",buyer:{name:R.name,email:R.email,docType:"CPF",docNumber:R.identification},onPaymentSuccess:async e=>{P("approved");o(`/apps/${a}/sucesso?payment_id=${e?.payment_id||e?.mp_payment_id||e?.data?.payment_id||e?.id||e?.data?.id||""}&status=approved&quantity=${ae}`)},onStatus:e=>{const a=e?.status||e?.data?.status;a&&P(a)},onError:e=>{}})}),U&&2===q&&"card"===Y&&t.jsx("div",{id:"card-payment-section",className:J.cardPaymentSection,children:t.jsx(I,{appId:a,amount:S(n||{})*ae,quantity:ae,description:n?.name||n?.titulo?`Compra de ${n?.name||n?.titulo}${ae>1?` (${ae} licenças)`:""}`:"Compra de aplicativo",buyer:{name:R.name,email:R.email,docType:"CPF",docNumber:R.identification,phone:R.phone,zip:R.zip,streetName:R.streetName},cardholderEmail:R.email,identificationType:"CPF",identificationNumber:R.identification,deviceId:W,maxInstallments:4,onPaymentSuccess:async e=>{P("approved");o(`/apps/${a}/sucesso?payment_id=${e?.payment_id||e?.mp_payment_id||e?.data?.payment_id||e?.id||e?.data?.id||""}&status=approved&quantity=${ae}`)}})}),2===q&&"wallet"===Y&&t.jsxs("div",{id:"card-payment-section",className:J.cardPaymentSection,children:[t.jsxs("div",{style:{marginBottom:20},children:[t.jsx("h3",{className:J.subtitle,children:"Pagar com sua conta Mercado Pago"}),t.jsx("p",{className:J.muted,children:"Clique no botão abaixo para ser redirecionado ao Mercado Pago e pagar com sua conta, créditos ou saldo disponível."})]}),t.jsx("div",{style:{textAlign:"center"},children:t.jsx("button",{className:`${J.btn} ${J.btnPrimary}`,onClick:async()=>{try{const e=String(R.email||F?.email||"").trim()||void 0,t=String(R.name||F?.name||"").trim()||void 0,i={};e&&(i.email=e),t&&(i.name=t);const o=await f(a,i),n=o?.init_point||o?.data?.init_point||o?.sandbox_init_point||o?.data?.sandbox_init_point||"";n?window.open(n,"_blank","noopener"):alert("Não foi possível iniciar o checkout (Wallet). Verifique os logs ou tente o pagamento direto.")}catch(e){alert(e.message||"Erro ao iniciar checkout (Wallet)")}},style:{fontSize:"1rem",padding:"14px 32px",minWidth:280},children:"Continuar com Mercado Pago"})})]}),"approved"===x&&t.jsxs("div",{className:`${J.statusBox} ${J.statusApproved}`,children:[t.jsx("p",{children:"✔ Pagamento aprovado. Você pode baixar o executável com segurança."}),t.jsxs("ol",{children:[t.jsx("li",{children:'Clique em "Baixar executável" para iniciar o download.'}),t.jsx("li",{children:"Mantenha o arquivo salvo em um local seguro."}),t.jsx("li",{children:"Em caso de dúvida, entre em contato pelo suporte informado na confirmação do pagamento."})]})]}),"pending"===x&&t.jsxs("div",{className:`${J.statusBox} ${J.statusPending}`,children:[t.jsx("p",{children:"⏳ Pagamento pendente. Aguarde a compensação ou utilize outro método."}),t.jsx("p",{className:J.muted,children:"Você poderá baixar o executável assim que o status for atualizado para aprovado."})]}),"rejected"===x&&t.jsxs("div",{className:`${J.statusBox} ${J.statusRejected}`,children:[t.jsx("p",{children:"❌ Pagamento negado."}),k&&t.jsxs(t.Fragment,{children:[t.jsx("p",{children:(pe=k,{cc_rejected_bad_filled_card_number:"Número do cartão inválido. Verifique os dígitos.",cc_rejected_bad_filled_date:"Data de validade inválida. Corrija mês/ano.",cc_rejected_bad_filled_other:"Dados do cartão incompletos ou inválidos.",cc_rejected_bad_filled_security_code:"Código de segurança (CVV) inválido.",cc_rejected_insufficient_amount:"Saldo/limite insuficiente no cartão.",cc_rejected_call_for_authorize:"Banco exige autorização prévia. Ligue para autorizar a compra.",cc_rejected_high_risk:"Transação considerada de alto risco. Tente outro cartão/método.",invalid_payment_method:"Método de pagamento inválido para este cartão.",invalid_token:"Token do cartão inválido. Reenvie os dados.",cc_rejected_duplicated_payment:"Pagamento duplicado. Aguarde a confirmação do primeiro.",payment_attempt_failed:"Tentativa de pagamento falhou. Tente novamente."}[String(pe||"").toLowerCase()]||(pe?`Motivo: ${pe}`:"Pagamento negado. Verifique os dados e tente novamente."))}),t.jsxs("p",{className:J.muted,style:{fontSize:"0.85em"},children:["Código: ",k]})]}),t.jsxs("ul",{children:[t.jsx("li",{children:"Verifique os dados do cartão e tente novamente."}),t.jsx("li",{children:"Se persistir, contate seu banco ou use outro método."})]})]}),"rejected"===x&&"cc_rejected_high_risk"===String(k||"").toLowerCase()&&t.jsxs("div",{className:`${J.statusBox} ${J.statusPending}`,children:[t.jsx("p",{style:{color:"#FFC107"},children:"⚠ Transação sinalizada como alto risco"}),t.jsxs("ul",{children:[t.jsx("li",{children:"Tente outro cartão ou método de pagamento."}),t.jsx("li",{children:"Confirme telefone e endereço corretamente preenchidos."}),t.jsx("li",{children:"Se necessário, solicite liberação ao seu banco."})]})]}),t.jsxs("details",{className:J.helpDetails,children:[t.jsx("summary",{children:"Ajuda"}),t.jsxs("ul",{children:[t.jsx("li",{children:"Se o checkout não abrir, desative bloqueadores de pop-up e tente novamente."}),t.jsx("li",{children:"PIX e boleto podem levar alguns minutos para confirmação."}),t.jsx("li",{children:"Após aprovação, o botão de download fica ativo nesta página."})]})]}),("downloading"===B||"done"===B)&&t.jsxs("div",{"aria-live":"polite",className:J.progressWrap,children:[t.jsx("div",{className:J.progressBar,children:t.jsx("div",{className:J.progress,style:{width:`${T}%`}})}),t.jsx("p",{className:J.muted,children:"done"===B?"Download concluído!":`Baixando... ${T}%`})]}),A&&t.jsxs("p",{className:J.errorMessage,role:"alert",children:[t.jsx("span",{children:"❌"})," ",A]}),"approved"===x&&t.jsxs("section",{className:J.feedbackSection,children:[t.jsx("h3",{className:J.subtitle,children:"Avalie este aplicativo"}),t.jsxs("div",{className:J.feedbackGrid,children:[t.jsxs("label",{children:["Nota",t.jsx("select",{value:M.rating,onChange:e=>z({...M,rating:Number(e.target.value)}),style:{marginLeft:8},children:[5,4,3,2,1].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsx("input",{className:J.input,placeholder:"Comentário",value:M.comment,onChange:e=>z({...M,comment:e.target.value})})]}),t.jsx("button",{className:`${J.btn} ${J.btnOutline}`,style:{marginTop:12},onClick:async()=>{try{await N(a,M),alert("Obrigado pelo feedback!"),z({rating:5,comment:""})}catch(e){alert("Erro ao enviar feedback: "+e.message)}},children:"Enviar feedback"})]})]})}),ie&&t.jsx("div",{className:J.modalOverlay,role:"dialog","aria-modal":"true","aria-labelledby":"confirm-email-title",onClick:()=>{le||(oe(!1),de(""))},children:t.jsxs("div",{className:J.modalCard,onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{id:"confirm-email-title",className:J.modalTitle,children:"Confirmar e-mail da compra"}),t.jsx("p",{className:J.modalDesc,children:"Usaremos este e-mail para validar sua compra e ele será necessário para ativar o software após a instalação."}),t.jsxs("div",{className:J.modalField,children:[t.jsx("label",{className:J.modalLabel,children:"E-mail"}),t.jsx("input",{className:J.input,type:"email",placeholder:"seu@email.com",value:ne,onChange:e=>re(e.target.value)}),se&&t.jsx("div",{className:J.modalError,role:"alert",children:se})]}),t.jsxs("div",{className:J.modalActions,children:[t.jsx("button",{className:`${J.btn} ${J.btnOutline}`,onClick:()=>{le||(oe(!1),de(""))},children:"Cancelar"}),t.jsx("button",{className:`${J.btn} ${J.btnPrimary}`,onClick:async()=>{if(me.current)return;me.current=!0;const e=String(ne||"").trim();if(!e||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return de("Informe um e-mail válido."),void(me.current=!1);try{ce(!0),de("");const t=await ue(),i=await b({email:e,appId:Number(a),hardwareId:t});if(!i?.licensed)return de(i?.message||"Licença não validada."),ce(!1),void(me.current=!1);const o=await v(a,e),r=Q(o?.download_url||"");if(r){oe(!1),window.open(r,"_blank","noopener");const t=encodeURIComponent(`Ativação de licença - ${n?.name||n?.titulo||"Aplicativo"}`),o=["Olá,","","Concluí o download e estou ativando minha licença.",i?.license_key?`Chave: ${i.license_key}`:void 0,`App: ${n?.name||n?.titulo||""} (ID ${a})`,"Este e-mail será usado para ativar e validar meu software.","","Obrigado."].filter(Boolean),s=encodeURIComponent(o.join("\n"));window.open(`mailto:${e}?subject=${t}&body=${s}`,"_blank")}else de("Este e-mail não possui download liberado ainda.")}catch(t){de(t.message||"Erro ao validar e-mail para download.")}finally{ce(!1),me.current=!1}},disabled:le,children:le?"Validando...":"Confirmar e baixar"})]})]})})]});var pe};export{Y as default};

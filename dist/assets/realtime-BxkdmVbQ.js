const t=new class{constructor(){try{this.channel=new BroadcastChannel("cc_admin_updates")}catch{this.channel=null}this.listeners=new Map,this.channel?this.channel.onmessage=t=>{const{type:e,payload:s}=t.data||{};this.emit(e,s)}:window.addEventListener("storage",t=>{if("__cc_broadcast__"===t.key&&t.newValue)try{const{type:e,payload:s}=JSON.parse(t.newValue);this.emit(e,s)}catch{}})}emit(t,e){const s=this.listeners.get(t);if(s&&0!==s.size)for(const n of s)try{n(e)}catch{}}subscribe(t,e){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e),()=>this.unsubscribe(t,e)}unsubscribe(t,e){const s=this.listeners.get(t);s&&s.delete(e)}publish(t,e){const s={type:t,payload:e};if(this.channel)this.channel.postMessage(s);else try{localStorage.setItem("__cc_broadcast__",JSON.stringify(s))}catch{}this.emit(t,e)}};export{t as r};

import{j as e,a,a1 as t,a2 as s,a3 as r,a4 as i,a5 as n,c as l,b as o,x as c,a6 as d,g as u,u as m}from"./index-BNwvcLYh.js";import{r as p,a as h,R as x,h as g,O as j}from"./router-Bh7m2j_b.js";import{C as v}from"./ChallengeCard-DGLyGypG.js";import{s as b}from"./urlSanitize-kq56XB4o.js";import{u as y,a as f,D as N,b as _,c as w,d as C,P as S,e as k,f as A,g as P,U as E,F as R,M as B,R as T}from"./useAdminRepo-DihnYkvz.js";import{r as L}from"./realtime-BxkdmVbQ.js";import{j as I,k as D,l as O,m as F,n as z}from"./appsAPI-Coih7GPG.js";import{d as $}from"./projectsAPI-gL85jKDK.js";import{a as U,g as M}from"./appModel-BtzJpYSB.js";import{A as W}from"./StatusBadge-Doi_MAPz.js";import{r as V,c as G,a as q,S as K,b as H,u as Z,s as Q,d as J,e as X,f as Y,g as ee,h as ae,i as te,j as se,k as re,l as ie,m as ne,n as le,o as oe,p as ce,q as de,t as ue,v as me,w as pe,x as he,D as xe,y as ge,R as je,z as ve,A as be,B as ye,C as fe,E as Ne,F as _e,G as we,H as Ce,I as Se,J as ke,Z as Ae,L as Pe,K as Ee,M as Re,N as Be,O as Te,P as Le,Q as Ie,T as De,U as Oe,V as Fe,W as ze,X as $e,Y as Ue,_ as Me,$ as We,a0 as Ve,a1 as Ge,a2 as qe,a3 as Ke,a4 as He,a5 as Ze,a6 as Qe,a7 as Je,a8 as Xe,a9 as Ye,aa as ea,ab as aa,ac as ta}from"./AreaChart-zknvknMQ.js";/* empty css                    */import"./rankingAPI-DYarShkv.js";import"./userAPI-DkphFFhE.js";import"./dataCache-D0LcSMWP.js";const sa="_projectCard_x92g7_4",ra="_cardHeader_x92g7_54",ia="_thumb_x92g7_63",na="_projectTitle_x92g7_73",la="_statusBadge_x92g7_95",oa="_statusInProgress_x92g7_124",ca="_statusCompleted_x92g7_130",da="_statusPaused_x92g7_136",ua="_statusDefault_x92g7_142",ma="_cardContent_x92g7_149",pa="_projectInfo_x92g7_155",ha="_startDate_x92g7_159",xa="_description_x92g7_180",ga="_readMoreButton_x92g7_209",ja="_progressSection_x92g7_235",va="_progressHeader_x92g7_242",ba="_progressLabel_x92g7_249",ya="_progressPercentage_x92g7_256",fa="_progressBar_x92g7_266",Na="_progressFill_x92g7_275",_a="_progressLow_x92g7_304",wa="_progressMedium_x92g7_308",Ca="_progressHigh_x92g7_312",Sa="_mentorInfo_x92g7_390",ka="_mentorLabel_x92g7_398",Aa="_mentorEmail_x92g7_405",Pa=({project:a,maxDescriptionLength:t=150})=>{const[s,r]=p.useState(!1),[i,n]=p.useState(!1),l=String(a?.description??a?.descricao??"").trim(),o=l.length>t,c=0===l.length?"Sem descrição cadastrada.":s?l:((e,a)=>{const t=String(e||"");return t.length<=a?t:t.substring(0,a).trim()+"..."})(l,t),d="number"==typeof a?.progress?a.progress:"number"==typeof a?.progresso?a.progresso:0,u=a?.title??a?.titulo??a?.nome??"Projeto sem título",m=a?.startDate??a?.data_inicio??a?.createdAt??null,h=a?.status||"ativo",x=a?.thumb_url??a?.thumbUrl??a?.imageUrl??null,g=a?.mentorName||a?.mentor_nome||a?.mentor?.nome||null,j=a?.mentorEmail||a?.mentor_email||a?.mentor?.email||null,v=g&&j;return e.jsxs("article",{className:sa,role:"article","aria-labelledby":`project-${a.id}-title`,children:[e.jsxs("header",{className:ra,children:[e.jsx("img",{src:!i&&x?b(x):"https://placehold.co/400x200/1a1a2e/00E4F2?text=Projeto",alt:`Imagem do projeto ${u}`,className:ia,onError:()=>n(!0),loading:"lazy"}),e.jsx("h3",{id:`project-${a.id}-title`,className:na,children:u}),e.jsx("span",{className:`${la} ${(e=>{switch(String(e).toLowerCase()){case"em andamento":case"ongoing":return oa;case"concluído":case"concluido":case"finalizado":case"completed":return ca;case"pausado":case"paused":return da;default:return ua}})(h)}`,"aria-label":`Status: ${h}`,children:h})]}),e.jsxs("div",{className:ma,children:[e.jsxs("div",{className:pa,children:[e.jsxs("span",{className:ha,"aria-label":"Data de início",children:[e.jsx("strong",{children:"Início:"})," ",(e=>{if(!e)return"—";const a=new Date(e);return isNaN(a.getTime())?"—":a.toLocaleDateString("pt-BR")})(m)]}),v&&e.jsxs("div",{className:Sa,children:[e.jsxs("span",{className:ka,children:[e.jsx("strong",{children:"Mentor:"})," ",g]}),e.jsx("span",{className:Aa,title:j,children:j})]})]}),e.jsxs("div",{className:xa,children:[e.jsx("p",{children:c}),o&&e.jsx("button",{className:ga,onClick:()=>r(!s),"aria-expanded":s,"aria-controls":`project-${a.id}-description`,children:s?"Leia menos":"Leia mais"})]}),e.jsxs("div",{className:ja,children:[e.jsxs("div",{className:va,children:[e.jsx("span",{className:ba,children:"Progresso"}),e.jsxs("span",{className:ya,"aria-label":`${d}% concluído`,children:[d,"%"]})]}),e.jsx("div",{className:fa,role:"progressbar","aria-valuenow":d,"aria-valuemin":"0","aria-valuemax":"100","aria-label":`Progresso do projeto: ${d}%`,children:e.jsx("div",{className:`${Na} ${y=d,y>=80?Ca:y>=50?wa:_a}`,style:{width:`${d}%`}})})]})]})]});var y};function Ea(){return Ea=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)({}).hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ea.apply(null,arguments)}function Ra(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,s)}return t}function Ba(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,a);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var Ta=32,La={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function Ia(e){var a,{data:t,iconType:s,inactiveColor:r}=e,i=16,n=Ta/6,l=Ta/3,o=t.inactive?r:t.color,c=null!=s?s:t.type;if("none"===c)return null;if("plainline"===c)return p.createElement("line",{strokeWidth:4,fill:"none",stroke:o,strokeDasharray:null===(a=t.payload)||void 0===a?void 0:a.strokeDasharray,x1:0,y1:i,x2:Ta,y2:i,className:"recharts-legend-icon"});if("line"===c)return p.createElement("path",{strokeWidth:4,fill:"none",stroke:o,d:"M0,".concat(i,"h").concat(l,"\n            A").concat(n,",").concat(n,",0,1,1,").concat(2*l,",").concat(i,"\n            H").concat(Ta,"M").concat(2*l,",").concat(i,"\n            A").concat(n,",").concat(n,",0,1,1,").concat(l,",").concat(i),className:"recharts-legend-icon"});if("rect"===c)return p.createElement("path",{stroke:"none",fill:o,d:"M0,".concat(4,"h").concat(Ta,"v").concat(24,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(p.isValidElement(t.legendIcon)){var d=function(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?Ra(Object(t),!0).forEach(function(a){Ba(e,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ra(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}({},t);return delete d.legendIcon,p.cloneElement(t.legendIcon,d)}return p.createElement(H,{fill:o,cx:i,cy:i,size:Ta,sizeType:"diameter",type:c})}function Da(e){var{payload:a,iconSize:t,layout:s,formatter:r,inactiveColor:i,iconType:n}=e,l={x:0,y:0,width:Ta,height:Ta},o={display:"horizontal"===s?"inline-block":"block",marginRight:10},c={display:"inline-block",verticalAlign:"middle",marginRight:4};return a.map((a,s)=>{var d=a.formatter||r,u=G({"recharts-legend-item":!0,["legend-item-".concat(s)]:!0,inactive:a.inactive});if("none"===a.type)return null;var m=a.inactive?i:a.color,h=d?d(a.value,a,s):a.value;return p.createElement("li",Ea({className:u,style:o,key:"legend-item-".concat(s)},q(e,a,s)),p.createElement(K,{width:t,height:t,viewBox:l,style:c,"aria-label":"".concat(h," legend icon")},p.createElement(Ia,{data:a,iconType:n,inactiveColor:i})),p.createElement("span",{className:"recharts-legend-item-text",style:{color:m}},h))})}var Oa=e=>{var a=V(e,La),{payload:t,layout:s,align:r}=a;if(!t||!t.length)return null;var i={padding:0,margin:0,textAlign:"horizontal"===s?r:"left"};return p.createElement("ul",{className:"recharts-default-legend",style:i},p.createElement(Da,Ea({},a,{payload:t})))};var Fa=["contextPayload"];function za(){return za=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)({}).hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},za.apply(null,arguments)}function $a(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,s)}return t}function Ua(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?$a(Object(t),!0).forEach(function(a){Ma(e,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$a(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}function Ma(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,a);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function Wa(e){return e.value}function Va(e){var{contextPayload:a}=e,t=function(e,a){if(null==e)return{};var t,s,r=function(e,a){if(null==e)return{};var t={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(-1!==a.indexOf(s))continue;t[s]=e[s]}return t}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)t=i[s],-1===a.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}(e,Fa),s=ie(a,e.payloadUniqBy,Wa),r=Ua(Ua({},t),{},{payload:s});return p.isValidElement(e.content)?p.cloneElement(e.content,r):"function"==typeof e.content?p.createElement(e.content,r):p.createElement(Oa,r)}function Ga(e){var a=te();return p.useEffect(()=>{a(se(e))},[a,e]),null}function qa(e){var a=te();return p.useEffect(()=>(a(re(e)),()=>{a(re({width:0,height:0}))}),[a,e]),null}var Ka={align:"center",iconSize:14,inactiveColor:"#ccc",itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Ha(e){var a=V(e,Ka),t=Z(Q),s=J(),r=X(),{width:i,height:n,wrapperStyle:l,portal:o}=a,[c,d]=Y([t]),u=ee(),m=ae();if(null==u||null==m)return null;var x=u-((null==r?void 0:r.left)||0)-((null==r?void 0:r.right)||0),g=function(e,a,t,s){return"vertical"===e&&null!=a?{height:a}:"horizontal"===e?{width:t||s}:null}(a.layout,n,i,x),j=o?l:Ua(Ua({position:"absolute",width:(null==g?void 0:g.width)||i||"auto",height:(null==g?void 0:g.height)||n||"auto"},function(e,a,t,s,r,i){var n,l,{layout:o,align:c,verticalAlign:d}=a;return e&&(void 0!==e.left&&null!==e.left||void 0!==e.right&&null!==e.right)||(n="center"===c&&"vertical"===o?{left:((s||0)-i.width)/2}:"right"===c?{right:t&&t.right||0}:{left:t&&t.left||0}),e&&(void 0!==e.top&&null!==e.top||void 0!==e.bottom&&null!==e.bottom)||(l="middle"===d?{top:((r||0)-i.height)/2}:"bottom"===d?{bottom:t&&t.bottom||0}:{top:t&&t.top||0}),Ua(Ua({},n),l)}(l,a,r,u,m,c)),l),v=null!=o?o:s;if(null==v||null==t)return null;var b=p.createElement("div",{className:"recharts-legend-wrapper",style:j,ref:d},p.createElement(Ga,{layout:a.layout,align:a.align,verticalAlign:a.verticalAlign,itemSorter:a.itemSorter}),!o&&p.createElement(qa,{width:c.width,height:c.height}),p.createElement(Va,za({},a,g,{margin:r,chartWidth:u,chartHeight:m,contextPayload:t})));return h.createPortal(b,v)}Ha.displayName="Legend";var Za=(e,a,t,s)=>ce(e,"xAxis",a,s),Qa=(e,a,t,s)=>de(e,"xAxis",a,s),Ja=(e,a,t,s)=>ce(e,"yAxis",t,s),Xa=(e,a,t,s)=>de(e,"yAxis",t,s),Ya=ne([le,Za,Ja,Qa,Xa],(e,a,t,s,r)=>me(e,"xAxis")?pe(a,s,!1):pe(t,r,!1));function et(e){return"line"===e.type}var at=ne([ue,(e,a,t,s,r)=>r],(e,a)=>e.filter(et).find(e=>e.id===a)),tt=ne([le,Za,Ja,Qa,Xa,at,Ya,oe],(e,a,t,s,r,i,n,l)=>{var{chartData:o,dataStartIndex:c,dataEndIndex:d}=l;if(null!=i&&null!=a&&null!=t&&null!=s&&null!=r&&0!==s.length&&0!==r.length&&null!=n&&("horizontal"===e||"vertical"===e)){var u,{dataKey:m,data:p}=i;if(null!=(u=null!=p&&p.length>0?p:null==o?void 0:o.slice(c,d+1)))return function(e){var{layout:a,xAxis:t,yAxis:s,xAxisTicks:r,yAxisTicks:i,dataKey:n,bandSize:l,displayedData:o}=e;return o.map((e,o)=>{var c=Te(e,n);if("horizontal"===a){var d=Le({axis:t,ticks:r,bandSize:l,entry:e,index:o}),u=Ie(c)?null:s.scale.map(c);return{x:d,y:null!=u?u:null,value:c,payload:e}}var m=Ie(c)?null:t.scale.map(c),p=Le({axis:s,ticks:i,bandSize:l,entry:e,index:o});return null==m||null==p?null:{x:m,y:p,value:c,payload:e}}).filter(Boolean)}({layout:e,xAxis:a,yAxis:t,xAxisTicks:s,yAxisTicks:r,dataKey:m,bandSize:n,displayedData:u})}}),st=["id"],rt=["type","layout","connectNulls","needClip","shape"],it=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId","id"];function nt(){return nt=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)({}).hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},nt.apply(null,arguments)}function lt(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,s)}return t}function ot(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?lt(Object(t),!0).forEach(function(a){ct(e,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):lt(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}function ct(e,a,t){return(a=function(e){var a=function(e,a){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,a);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==typeof a?a:a+""}(a))in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function dt(e,a){if(null==e)return{};var t,s,r=function(e,a){if(null==e)return{};var t={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(-1!==a.indexOf(s))continue;t[s]=e[s]}return t}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)t=i[s],-1===a.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var ut=e=>{var{dataKey:a,name:t,stroke:s,legendType:r,hide:i}=e;return[{inactive:i,dataKey:a,type:r,color:s,value:ye(t,a),payload:e}]},mt=p.memo(e=>{var{dataKey:a,data:t,stroke:s,strokeWidth:r,fill:i,name:n,hide:l,unit:o,tooltipType:c,id:d}=e,u={dataDefinedOnItem:t,getPosition:Ne,settings:{stroke:s,strokeWidth:r,fill:i,dataKey:a,nameKey:void 0,name:ye(n,a),hide:l,type:c,color:s,unit:o,graphicalItemId:d}};return p.createElement(fe,{tooltipEntrySettings:u})}),pt=(e,a)=>"".concat(a,"px ").concat(e-a,"px");function ht(e,a){for(var t=e.length%2!=0?[...e,0]:e,s=[],r=0;r<a;++r)s=[...s,...t];return s}function xt(e){var{clipPathId:a,points:t,props:s}=e,{dot:r,dataKey:i,needClip:n}=s,{id:l}=s,o=dt(s,st),c=We(o);return p.createElement(Ve,{points:t,dot:r,className:"recharts-line-dots",dotClassName:"recharts-line-dot",dataKey:i,baseProps:c,needClip:n,clipPathId:a})}function gt(e){var{showLabels:a,children:t,points:s}=e,r=p.useMemo(()=>null==s?void 0:s.map(e=>{var a,t,s={x:null!==(a=e.x)&&void 0!==a?a:0,y:null!==(t=e.y)&&void 0!==t?t:0,width:0,lowerWidth:0,upperWidth:0,height:0};return ot(ot({},s),{},{value:e.value,payload:e.payload,viewBox:s,parentViewBox:void 0,fill:void 0})}),[s]);return p.createElement($e,{value:a?r:void 0},t)}function jt(e){var{clipPathId:a,pathRef:t,points:s,strokeDasharray:r,props:i}=e,{type:n,layout:l,connectNulls:o,needClip:c,shape:d}=i,u=dt(i,rt),m=ot(ot({},Ue(u)),{},{fill:"none",className:"recharts-line-curve",clipPath:c?"url(#clipPath-".concat(a,")"):void 0,points:s,type:n,layout:l,connectNulls:o,strokeDasharray:null!=r?r:i.strokeDasharray});return p.createElement(p.Fragment,null,(null==s?void 0:s.length)>1&&p.createElement(Me,nt({shapeType:"curve",option:d},m,{pathRef:t})),p.createElement(xt,{points:s,clipPathId:a,props:i}))}function vt(e){var{clipPathId:a,props:t,pathRef:s,previousPointsRef:r,longestAnimatedLengthRef:i}=e,{points:n,strokeDasharray:l,isAnimationActive:o,animationBegin:c,animationDuration:d,animationEasing:u,animateNewValues:m,width:h,height:x,onAnimationEnd:g,onAnimationStart:j}=t,v=r.current,b=De(n,"recharts-line-"),y=p.useRef(b),[f,N]=p.useState(!1),_=!f,w=p.useCallback(()=>{"function"==typeof g&&g(),N(!1)},[g]),C=p.useCallback(()=>{"function"==typeof j&&j(),N(!0)},[j]),S=function(e){try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch(a){return 0}}(s.current),k=p.useRef(0);y.current!==b&&(k.current=i.current,y.current=b);var A=k.current;return p.createElement(gt,{points:n,showLabels:_},t.children,p.createElement(Oe,{animationId:b,begin:c,duration:d,isActive:o,easing:u,onAnimationEnd:w,onAnimationStart:C,key:b},e=>{var c,d=Fe(A,S+A,e),u=Math.min(d,S);if(o)if(l){var g="".concat(l).split(/[,\s]+/gim).map(e=>parseFloat(e));c=((e,a,t)=>{var s=t.reduce((e,a)=>e+a);if(!s)return pt(a,e);for(var r=Math.floor(e/s),i=e%s,n=a-e,l=[],o=0,c=0;o<t.length;c+=null!==(d=t[o])&&void 0!==d?d:0,++o){var d,u=t[o];if(null!=u&&c+u>i){l=[...t.slice(0,o),i-c];break}}var m=l.length%2==0?[0,n]:[n];return[...ht(t,r),...l,...m].map(e=>"".concat(e,"px")).join(", ")})(u,S,g)}else c=pt(S,u);else c=null==l?void 0:String(l);if(e>0&&S>0&&(r.current=n,i.current=Math.max(i.current,u)),v){var j=v.length/n.length,b=1===e?n:n.map((a,t)=>{var s=Math.floor(t*j);if(v[s]){var r=v[s];return ot(ot({},a),{},{x:Fe(r.x,a.x,e),y:Fe(r.y,a.y,e)})}return ot(ot({},a),{},m?{x:Fe(2*h,a.x,e),y:Fe(x/2,a.y,e)}:{x:a.x,y:a.y})});return r.current=b,p.createElement(jt,{props:t,points:b,clipPathId:a,pathRef:s,strokeDasharray:c})}return p.createElement(jt,{props:t,points:n,clipPathId:a,pathRef:s,strokeDasharray:c})}),p.createElement(ze,{label:t.label}))}function bt(e){var{clipPathId:a,props:t}=e,s=p.useRef(null),r=p.useRef(0),i=p.useRef(null);return p.createElement(vt,{props:t,clipPathId:a,previousPointsRef:s,longestAnimatedLengthRef:r,pathRef:i})}var yt=(e,a)=>{var t,s;return{x:null!==(t=e.x)&&void 0!==t?t:void 0,y:null!==(s=e.y)&&void 0!==s?s:void 0,value:e.value,errorVal:Te(e.payload,a)}};class ft extends p.Component{render(){var{hide:e,dot:a,points:t,className:s,xAxisId:r,yAxisId:i,top:n,left:l,width:o,height:c,id:d,needClip:u,zIndex:m}=this.props;if(e)return null;var h=G("recharts-line",s),x=d,{r:g,strokeWidth:j}=Se(a),v=ke(a),b=2*g+j,y=u?"url(#clipPath-".concat(v?"":"dots-").concat(x,")"):void 0;return p.createElement(Ae,{zIndex:m},p.createElement(Pe,{className:h},u&&p.createElement("defs",null,p.createElement(Ee,{clipPathId:x,xAxisId:r,yAxisId:i}),!v&&p.createElement("clipPath",{id:"clipPath-dots-".concat(x)},p.createElement("rect",{x:l-b/2,y:n-b/2,width:o+b,height:c+b}))),p.createElement(Re,{xAxisId:r,yAxisId:i,data:t,dataPointFormatter:yt,errorBarOffset:0},p.createElement(bt,{props:this.props,clipPathId:x}))),p.createElement(Be,{activeDot:this.props.activeDot,points:t,mainColor:this.props.stroke,itemDataKey:this.props.dataKey,clipPath:y}))}}var Nt={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:"auto",label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0,zIndex:xe.line,type:"linear"};function _t(e){var a=V(e,Nt),{activeDot:t,animateNewValues:s,animationBegin:r,animationDuration:i,animationEasing:n,connectNulls:l,dot:o,hide:c,isAnimationActive:d,label:u,legendType:m,xAxisId:h,yAxisId:x,id:g}=a,j=dt(a,it),{needClip:v}=_e(h,x),b=we(),y=Ce(),f=ge(),N=Z(e=>tt(e,h,x,f,g));if("horizontal"!==y&&"vertical"!==y||null==N||null==b)return null;var{height:_,width:w,x:C,y:S}=b;return p.createElement(ft,nt({},j,{id:g,connectNulls:l,dot:o,activeDot:t,animateNewValues:s,animationBegin:r,animationDuration:i,animationEasing:n,isAnimationActive:d,hide:c,label:u,legendType:m,xAxisId:h,yAxisId:x,points:N,layout:y,height:_,width:w,left:C,top:S,needClip:v}))}function wt(e){var a=V(e,Nt),t=ge();return p.createElement(je,{id:a.id,type:"line"},e=>p.createElement(p.Fragment,null,p.createElement(ve,{legendPayload:ut(a)}),p.createElement(mt,{dataKey:a.dataKey,data:a.data,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:e}),p.createElement(be,{type:"line",id:e,data:a.data,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,dataKey:a.dataKey,hide:a.hide,isPanorama:t}),p.createElement(_t,nt({},a,{id:e}))))}var Ct=p.memo(wt,he);Ct.displayName="Line";const St={dashboard:"_dashboard_1mlt0_7",header:"_header_1mlt0_17",title:"_title_1mlt0_35",subtitle:"_subtitle_1mlt0_49",headerActions:"_headerActions_1mlt0_61",periodoSelect:"_periodoSelect_1mlt0_71",kpiGrid:"_kpiGrid_1mlt0_105",kpiCard:"_kpiCard_1mlt0_119",kpiContent:"_kpiContent_1mlt0_141",kpiIcon:"_kpiIcon_1mlt0_155",kpiInfo:"_kpiInfo_1mlt0_177",kpiLabel:"_kpiLabel_1mlt0_191",kpiValue:"_kpiValue_1mlt0_203",kpiTrend:"_kpiTrend_1mlt0_217",trendUp:"_trendUp_1mlt0_233",trendDown:"_trendDown_1mlt0_241",kpiMuted:"_kpiMuted_1mlt0_249",chartsGrid:"_chartsGrid_1mlt0_261",chartCard:"_chartCard_1mlt0_273",chartContainer:"_chartContainer_1mlt0_283",customTooltip:"_customTooltip_1mlt0_295",tooltipLabel:"_tooltipLabel_1mlt0_309",liveBadge:"_liveBadge_1mlt0_323",liveDot:"_liveDot_1mlt0_345",pulse:"_pulse_1mlt0_1",activitiesList:"_activitiesList_1mlt0_373",activityItem:"_activityItem_1mlt0_391",activityIcon:"_activityIcon_1mlt0_419",activityIconVenda:"_activityIconVenda_1mlt0_441",activityIconUsuario:"_activityIconUsuario_1mlt0_455",activityIconProposta:"_activityIconProposta_1mlt0_469",activityIconDefault:"_activityIconDefault_1mlt0_483",activityContent:"_activityContent_1mlt0_497",activityDesc:"_activityDesc_1mlt0_513",activityTime:"_activityTime_1mlt0_529",activityValue:"_activityValue_1mlt0_539",loadingState:"_loadingState_1mlt0_683",errorState:"_errorState_1mlt0_683",spinner:"_spinner_1mlt0_703",spin:"_spin_1mlt0_703",retryBtn:"_retryBtn_1mlt0_751",refreshBtn:"_refreshBtn_1mlt0_789",spinning:"_spinning_1mlt0_839",noData:"_noData_1mlt0_849",activityStatus:"_activityStatus_1mlt0_869",status_new:"_status_new_1mlt0_887",status_contacted:"_status_contacted_1mlt0_897",status_negotiating:"_status_negotiating_1mlt0_907",status_approved:"_status_approved_1mlt0_917",status_rejected:"_status_rejected_1mlt0_927"},kt={primary:"#D12BF2",secondary:"#00E4F2",purple:"#7A3EF5",success:"#10B981",warning:"#F59E0B",danger:"#ef4444",text:"#e0e0e0",muted:"#a0a0a0"},At=({active:a,payload:t,label:s})=>a&&t&&t.length?e.jsxs("div",{className:St.customTooltip,children:[e.jsx("p",{className:St.tooltipLabel,children:s}),t.map((a,t)=>e.jsxs("p",{style:{color:a.color},children:[a.name,": R$ ",Number(a.value).toLocaleString("pt-BR")]},t))]}):null,Pt=()=>{const[m,h]=p.useState("30d"),[x,g]=p.useState(!0),[j,v]=p.useState(null),[b,y]=p.useState(null),f=p.useCallback(async()=>{g(!0),v(null);try{const e=await async function(e="30d"){const t=await a(`/api/dashboard/stats?periodo=${e}`,{method:"GET"});return t?.data??t}(m);y(e)}catch(e){v(e.message||"Erro ao carregar dados")}finally{g(!1)}},[m]);p.useEffect(()=>{f()},[f]);const N=p.useMemo(()=>b?{faturamentoTotal:b.finance?.paid||0,receitaPendente:b.finance?.pending||0,pipelineB2B:b.proposals?.total||0,novosUsuarios30d:b.users?.total||0,craftersTotal:b.users?.crafters||0,projetosAtivos:b.projects?.active||0,projetosTotal:b.projects?.total||0,appsTotal:b.apps?.total||0,novasPropostas:b.proposals?.new||0}:null,[b]),_=p.useMemo(()=>b?.chartData?b.chartData.map(e=>({mes:e.month,receita:e.revenue,pendente:e.expenses})):[],[b]),w=p.useMemo(()=>{if(!b?.proposals?.byStatus)return[];const e=b.proposals.byStatus;return[{fase:"Novos",quantidade:e.new||0,color:kt.secondary},{fase:"Contatados",quantidade:e.contacted||0,color:kt.purple},{fase:"Negociando",quantidade:e.negotiating||0,color:kt.warning},{fase:"Aprovados",quantidade:e.approved||0,color:kt.success},{fase:"Rejeitados",quantidade:e.rejected||0,color:kt.danger}]},[b]),C=p.useMemo(()=>{if(!b?.projects)return[];const e=b.projects;return[{name:"Ativos",value:e.active||0,color:kt.success},{name:"Finalizados",value:e.completed||0,color:kt.secondary},{name:"Outros",value:Math.max(0,(e.total||0)-(e.active||0)-(e.completed||0)),color:kt.muted}].filter(e=>e.value>0)},[b]),S=p.useMemo(()=>b?.proposals?.recent?b.proposals.recent.map(e=>({id:e.id,descricao:`${e.companyName} - ${e.projectType}`,tipo:"proposta",tempo:new Date(e.createdAt).toLocaleDateString("pt-BR"),status:e.status})):[],[b]),k=a=>{switch(a){case"venda":return e.jsx(u,{className:St.activityIconVenda});case"usuario":return e.jsx(d,{className:St.activityIconUsuario});case"proposta":return e.jsx(i,{className:St.activityIconProposta});default:return e.jsx(c,{className:St.activityIconDefault})}};return x&&!b?e.jsxs("div",{className:St.loadingState,children:[e.jsx("div",{className:St.spinner}),e.jsx("span",{children:"Carregando dashboard..."})]}):j&&!b?e.jsxs("div",{className:St.errorState,children:[e.jsx(t,{size:48,color:kt.danger}),e.jsx("h2",{children:"Erro ao carregar dashboard"}),e.jsx("p",{children:j}),e.jsxs("button",{onClick:f,className:St.retryBtn,children:[e.jsx(s,{})," Tentar novamente"]})]}):e.jsxs("div",{className:St.dashboard,children:[e.jsxs("header",{className:St.header,children:[e.jsxs("div",{children:[e.jsx("h1",{className:St.title,children:"Centro de Comando"}),e.jsx("p",{className:St.subtitle,children:"Visão executiva da CodeCraft Gen-Z"})]}),e.jsxs("div",{className:St.headerActions,children:[e.jsx("button",{onClick:f,className:St.refreshBtn,disabled:x,title:"Atualizar dados",children:e.jsx(s,{className:x?St.spinning:""})}),e.jsxs("select",{value:m,onChange:e=>h(e.target.value),className:St.periodoSelect,children:[e.jsx("option",{value:"7d",children:"Últimos 7 dias"}),e.jsx("option",{value:"30d",children:"Últimos 30 dias"}),e.jsx("option",{value:"90d",children:"Últimos 90 dias"}),e.jsx("option",{value:"365d",children:"Este ano"})]})]})]}),e.jsxs("section",{className:St.kpiGrid,children:[e.jsx(W,{variant:"elevated",className:St.kpiCard,children:e.jsxs("div",{className:St.kpiContent,children:[e.jsx("div",{className:St.kpiIcon,style:{background:"rgba(16, 185, 129, 0.15)"},children:e.jsx(r,{style:{color:kt.success}})}),e.jsxs("div",{className:St.kpiInfo,children:[e.jsx("span",{className:St.kpiLabel,children:"Faturamento Pago"}),e.jsxs("span",{className:St.kpiValue,children:["R$ ",(N?.faturamentoTotal||0).toLocaleString("pt-BR")]}),N?.receitaPendente>0&&e.jsxs("span",{className:St.kpiMuted,children:["+ R$ ",N.receitaPendente.toLocaleString("pt-BR")," pendente"]})]})]})}),e.jsx(W,{variant:"elevated",className:St.kpiCard,children:e.jsxs("div",{className:St.kpiContent,children:[e.jsx("div",{className:St.kpiIcon,style:{background:"rgba(209, 43, 242, 0.15)"},children:e.jsx(i,{style:{color:kt.primary}})}),e.jsxs("div",{className:St.kpiInfo,children:[e.jsx("span",{className:St.kpiLabel,children:"Propostas B2B"}),e.jsx("span",{className:St.kpiValue,children:N?.pipelineB2B||0}),N?.novasPropostas>0&&e.jsxs("span",{className:St.kpiTrend,children:[e.jsx(n,{className:St.trendUp}),"+",N.novasPropostas," novas (7d)"]})]})]})}),e.jsx(W,{variant:"elevated",className:St.kpiCard,children:e.jsxs("div",{className:St.kpiContent,children:[e.jsx("div",{className:St.kpiIcon,style:{background:"rgba(0, 228, 242, 0.15)"},children:e.jsx(l,{style:{color:kt.secondary}})}),e.jsxs("div",{className:St.kpiInfo,children:[e.jsx("span",{className:St.kpiLabel,children:"Usuários / Crafters"}),e.jsxs("span",{className:St.kpiValue,children:[N?.novosUsuarios30d||0," / ",N?.craftersTotal||0]}),e.jsx("span",{className:St.kpiMuted,children:"Total cadastrados"})]})]})}),e.jsx(W,{variant:"elevated",className:St.kpiCard,children:e.jsxs("div",{className:St.kpiContent,children:[e.jsx("div",{className:St.kpiIcon,style:{background:"rgba(122, 62, 245, 0.15)"},children:e.jsx(o,{style:{color:kt.purple}})}),e.jsxs("div",{className:St.kpiInfo,children:[e.jsx("span",{className:St.kpiLabel,children:"Projetos"}),e.jsx("span",{className:St.kpiValue,children:N?.projetosTotal||0}),e.jsxs("span",{className:St.kpiMuted,children:[N?.projetosAtivos||0," ativos | ",N?.appsTotal||0," apps"]})]})]})})]}),e.jsxs("section",{className:St.chartsGrid,children:[e.jsxs(W,{variant:"elevated",className:St.chartCard,children:[e.jsx(W.Header,{title:"Evolução de Receita",subtitle:"Últimos 6 meses",noBorder:!0}),e.jsx(W.Body,{noPadding:!0,children:e.jsx("div",{className:St.chartContainer,children:_.length>0?e.jsx(Ge,{width:"100%",height:280,children:e.jsxs(qe,{data:_,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorReceita",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:kt.success,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:kt.success,stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorPendente",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:kt.warning,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:kt.warning,stopOpacity:0})]})]}),e.jsx(Ke,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(He,{dataKey:"mes",stroke:kt.muted,fontSize:12}),e.jsx(Ze,{stroke:kt.muted,fontSize:12,tickFormatter:e=>`${(e/1e3).toFixed(0)}k`}),e.jsx(Qe,{content:e.jsx(At,{})}),e.jsx(Ha,{wrapperStyle:{color:kt.text}}),e.jsx(Je,{type:"monotone",dataKey:"receita",name:"Receita Paga",stroke:kt.success,fillOpacity:1,fill:"url(#colorReceita)",strokeWidth:2}),e.jsx(Ct,{type:"monotone",dataKey:"pendente",name:"Pendente",stroke:kt.warning,strokeWidth:2,strokeDasharray:"5 5",dot:{fill:kt.warning,strokeWidth:2}})]})}):e.jsx("div",{className:St.noData,children:"Sem dados de receita no período"})})})]}),e.jsxs(W,{variant:"elevated",className:St.chartCard,children:[e.jsx(W.Header,{title:"Distribuição de Projetos",subtitle:"Por status",noBorder:!0}),e.jsx(W.Body,{noPadding:!0,children:e.jsx("div",{className:St.chartContainer,children:C.length>0?e.jsx(Ge,{width:"100%",height:280,children:e.jsxs(Xe,{children:[e.jsx(Ye,{data:C,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",label:({name:e,percent:a})=>`${e} ${(100*a).toFixed(0)}%`,labelLine:{stroke:kt.muted},children:C.map((a,t)=>e.jsx(ea,{fill:a.color},`cell-${t}`))}),e.jsx(Qe,{formatter:e=>[e,"Projetos"],contentStyle:{background:"rgba(10, 10, 15, 0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"}})]})}):e.jsx("div",{className:St.noData,children:"Sem dados de projetos"})})})]}),e.jsxs(W,{variant:"elevated",className:St.chartCard,children:[e.jsx(W.Header,{title:"Funil de Propostas B2B",subtitle:"Por status",noBorder:!0}),e.jsx(W.Body,{noPadding:!0,children:e.jsx("div",{className:St.chartContainer,children:w.some(e=>e.quantidade>0)?e.jsx(Ge,{width:"100%",height:280,children:e.jsxs(aa,{data:w,layout:"vertical",margin:{top:10,right:30,left:80,bottom:10},children:[e.jsx(Ke,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(He,{type:"number",stroke:kt.muted,fontSize:12}),e.jsx(Ze,{type:"category",dataKey:"fase",stroke:kt.muted,fontSize:12}),e.jsx(Qe,{formatter:e=>[e,"Propostas"],contentStyle:{background:"rgba(10, 10, 15, 0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"}}),e.jsx(ta,{dataKey:"quantidade",radius:[0,4,4,0],children:w.map((a,t)=>e.jsx(ea,{fill:a.color},`cell-${t}`))})]})}):e.jsx("div",{className:St.noData,children:"Sem propostas registradas"})})})]}),e.jsxs(W,{variant:"elevated",className:St.chartCard,children:[e.jsx(W.Header,{title:"Propostas Recentes",subtitle:"Últimas solicitações",actions:e.jsxs("span",{className:St.liveBadge,children:[e.jsx("span",{className:St.liveDot})," B2B"]}),noBorder:!0}),e.jsx(W.Body,{noPadding:!0,children:e.jsx("div",{className:St.activitiesList,children:S.length>0?S.map(a=>e.jsxs("div",{className:St.activityItem,children:[e.jsx("div",{className:St.activityIcon,children:k(a.tipo)}),e.jsxs("div",{className:St.activityContent,children:[e.jsx("span",{className:St.activityDesc,children:a.descricao}),e.jsx("span",{className:St.activityTime,children:a.tempo})]}),e.jsx("span",{className:`${St.activityStatus} ${St[`status_${a.status}`]}`,children:a.status})]},a.id)):e.jsx("div",{className:St.noData,children:"Nenhuma proposta recente"})})})]})]}),b?.salesPerApp&&e.jsx("section",{style:{marginTop:"24px"},children:e.jsxs(W,{variant:"elevated",children:[e.jsx(W.Header,{title:"Aplicativos",subtitle:"Vendas e faturamento por app",noBorder:!0}),e.jsx(W.Body,{noPadding:!0,children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.08)"},children:[e.jsx("th",{style:{textAlign:"left",padding:"12px 16px",color:kt.muted,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},children:"#"}),e.jsx("th",{style:{textAlign:"left",padding:"12px 16px",color:kt.muted,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Aplicativo"}),e.jsx("th",{style:{textAlign:"center",padding:"12px 16px",color:kt.muted,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Preço"}),e.jsx("th",{style:{textAlign:"center",padding:"12px 16px",color:kt.muted,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Vendas"}),e.jsx("th",{style:{textAlign:"right",padding:"12px 16px",color:kt.muted,fontSize:"0.8rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Faturamento"})]})}),e.jsx("tbody",{children:b.salesPerApp.map((a,t)=>e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="rgba(255,255,255,0.03)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[e.jsx("td",{style:{padding:"14px 16px",color:kt.muted,fontSize:"0.9rem",fontWeight:700},children:t+1}),e.jsx("td",{style:{padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[a.thumb_url&&e.jsx("img",{src:a.thumb_url,alt:a.app_name,style:{width:36,height:36,borderRadius:8,objectFit:"cover",border:"1px solid rgba(255,255,255,0.1)"},onError:e=>{e.currentTarget.style.display="none"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600,fontSize:"0.95rem"},children:a.app_name})]})}),e.jsxs("td",{style:{padding:"14px 16px",textAlign:"center",color:kt.text,fontSize:"0.9rem"},children:["R$ ",Number(a.price||0).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"center"},children:e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",minWidth:32,padding:"4px 12px",borderRadius:20,background:a.sales_count>0?"rgba(0, 228, 242, 0.12)":"rgba(255,255,255,0.05)",color:a.sales_count>0?kt.secondary:kt.muted,fontWeight:700,fontSize:"0.9rem"},children:a.sales_count})}),e.jsxs("td",{style:{padding:"14px 16px",textAlign:"right",color:a.total_revenue>0?kt.success:kt.muted,fontWeight:700,fontSize:"0.95rem"},children:["R$ ",Number(a.total_revenue).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]},a.app_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{style:{borderTop:"2px solid rgba(255,255,255,0.1)"},children:[e.jsx("td",{colSpan:3,style:{padding:"14px 16px",color:"#fff",fontWeight:700,fontSize:"0.95rem"},children:"Total"}),e.jsx("td",{style:{padding:"14px 16px",textAlign:"center",color:kt.secondary,fontWeight:700,fontSize:"0.95rem"},children:b.salesPerApp.reduce((e,a)=>e+a.sales_count,0)}),e.jsxs("td",{style:{padding:"14px 16px",textAlign:"right",color:kt.success,fontWeight:700,fontSize:"0.95rem"},children:["R$ ",b.salesPerApp.reduce((e,a)=>e+Number(a.total_revenue),0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})})]})})})]})})]})},Et={adminContainer:"_adminContainer_1fzmw_4",collapsed:"_collapsed_1fzmw_11",sidebar:"_sidebar_1fzmw_16",brand:"_brand_1fzmw_32",menu:"_menu_1fzmw_38",menuLink:"_menuLink_1fzmw_43",active:"_active_1fzmw_57",menuText:"_menuText_1fzmw_63",menuIcon:"_menuIcon_1fzmw_67",sidebarToggle:"_sidebarToggle_1fzmw_72",main:"_main_1fzmw_94",topbar:"_topbar_1fzmw_95",welcome:"_welcome_1fzmw_96",btn:"_btn_1fzmw_99",btnDanger:"_btnDanger_1fzmw_102",content:"_content_1fzmw_104"};function Rt(){return e.jsx(Pt,{})}function Bt(){const{data:a,loading:t,error:s,refresh:r}=P(),[i,n]=x.useState({name:"",email:"",password:"",role:"viewer"}),[l,o]=x.useState(!1),[c,d]=x.useState(""),[u,m]=x.useState(1),[p,h]=x.useState({open:!1,userId:null,name:"",newPassword:"",confirm:"",saving:!1,error:""}),g=a.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())||e.email.toLowerCase().includes(c.toLowerCase())||e.role.toLowerCase().includes(c.toLowerCase())),j=Math.max(1,Math.ceil(g.length/5)),v=g.slice(5*(u-1),5*u),[b,y]=x.useState({}),f=()=>{const e={};return i.name||(e.name="Nome é obrigatório"),i.email||(e.email="Email é obrigatório"),i.email&&!/\S+@\S+\.\S+/.test(i.email)&&(e.email="Email inválido"),i.password||(e.password="Senha é obrigatória"),i.password&&i.password.length<6&&(e.password="Senha deve ter no mínimo 6 caracteres"),e};return e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Usuários"}),e.jsx("div",{className:"filters-section",children:e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr auto auto auto auto"},children:[e.jsx("input",{"aria-label":"Buscar",placeholder:"Buscar (nome/e-mail/role)",value:c,onChange:e=>{d(e.target.value),m(1)}}),e.jsx("button",{className:"btn btn-outline","aria-label":"Página anterior",onClick:()=>m(Math.max(1,u-1)),children:"◀"}),e.jsxs("span",{style:{alignSelf:"center"},children:["Página ",u," / ",j]}),e.jsx("button",{className:"btn btn-outline","aria-label":"Próxima página",onClick:()=>m(Math.min(j,u+1)),children:"▶"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=g.map(e=>`${e.id},${e.name},${e.email},${e.role},${e.status}`).join("\n"),a=new Blob(["id,name,email,role,status\n"+e],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download="usuarios.csv",s.click(),URL.revokeObjectURL(t)},children:"Exportar CSV"})]})}),t&&e.jsx("p",{children:"Carregando..."}),s&&e.jsx("p",{role:"alert",children:s}),e.jsx("div",{className:"table","aria-busy":t,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"E-mail"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Controle"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===v.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:"Nenhum usuário"})}):v.map(a=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Nome",children:a.name}),e.jsx("td",{"data-label":"E-mail",children:a.email}),e.jsx("td",{"data-label":"Perfil",children:a.role}),e.jsx("td",{"data-label":"Status",children:e.jsx("span",{style:{background:"active"===a.status?"#00E4F2":"#666",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8em",fontWeight:"bold"},children:a.status})}),e.jsx("td",{"data-label":"Controle",children:e.jsx("button",{className:"btn btn-outline",onClick:async()=>{const e=await E.toggleStatus(a.id);e.ok?r():alert(e.error||"Falha ao alternar status")},children:"active"===a.status?"Desativar":"Ativar"})}),e.jsxs("td",{"data-label":"Ações",children:[e.jsxs("select",{"aria-label":"Alterar perfil",value:a.role,onChange:async e=>{const t=e.target.value;if(t!==a.role){const e=await E.update(a.id,{role:t});e.ok?r():alert(e.error||"Falha ao atualizar perfil")}},style:{marginLeft:8},children:[e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"editor",children:"editor"}),e.jsx("option",{value:"viewer",children:"viewer"})]}),e.jsx("button",{className:"btn btn-outline",style:{marginLeft:8},onClick:()=>h({open:!0,userId:a.id,name:a.name,newPassword:"",confirm:"",saving:!1,error:""}),"aria-label":`Editar senha de ${a.name}`,children:"Editar senha"})]})]},a.id))})]})}),e.jsxs("section",{className:"card",style:{marginTop:16},children:[e.jsx("h3",{style:{marginBottom:12},children:"Novo Usuário"}),e.jsxs("div",{className:"formRow",children:[e.jsx("label",{className:"sr-only",htmlFor:"user-name",children:"Nome"}),e.jsx("input",{id:"user-name","aria-label":"Nome",placeholder:"Nome",value:i.name,onChange:e=>n({...i,name:e.target.value}),required:!0}),e.jsx("label",{className:"sr-only",htmlFor:"user-email",children:"E-mail"}),e.jsx("input",{id:"user-email","aria-label":"E-mail",placeholder:"E-mail",type:"email",value:i.email,onChange:e=>n({...i,email:e.target.value}),required:!0}),e.jsx("label",{className:"sr-only",htmlFor:"user-password",children:"Senha"}),e.jsx("input",{id:"user-password","aria-label":"Senha",placeholder:"Senha",type:"password",value:i.password,onChange:e=>n({...i,password:e.target.value}),required:!0}),e.jsxs("select",{"aria-label":"Perfil",value:i.role,onChange:e=>n({...i,role:e.target.value}),children:[e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"editor",children:"editor"}),e.jsx("option",{value:"viewer",children:"viewer"})]}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{const e=f();Object.keys(e).length>0?y(e):(y({}),await(async()=>{o(!0);const e=await E.create(i);o(!1),e.ok?r():alert(e.error)})())},disabled:l||Object.keys(f()).length>0,children:l?"Criando...":"Criar usuário"})]})]}),e.jsxs("div",{className:"formRow",children:[b.name&&e.jsx("span",{style:{color:"red"},children:b.name}),b.email&&e.jsx("span",{style:{color:"red"},children:b.email}),b.password&&e.jsx("span",{style:{color:"red"},children:b.password})]}),p.open&&e.jsxs("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true","aria-label":`Editar senha de ${p.name}`,children:[e.jsxs("div",{className:"modal",children:[e.jsx("h3",{className:"title",children:"Editar senha"}),e.jsxs("p",{className:"muted",children:["Usuário: ",p.name]}),p.error&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["❌ ",p.error]}),e.jsxs("div",{className:"formRow",children:[e.jsx("label",{className:"sr-only",htmlFor:"new-password",children:"Nova senha"}),e.jsx("input",{id:"new-password",type:"password",placeholder:"Nova senha",value:p.newPassword,onChange:e=>h(a=>({...a,newPassword:e.target.value})),"aria-label":"Nova senha"}),e.jsx("label",{className:"sr-only",htmlFor:"confirm-password",children:"Confirmar senha"}),e.jsx("input",{id:"confirm-password",type:"password",placeholder:"Confirmar senha",value:p.confirm,onChange:e=>h(a=>({...a,confirm:e.target.value})),"aria-label":"Confirmar senha"})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:async()=>{const e=(p.newPassword||"").trim(),a=(p.confirm||"").trim();if(e.length<6)h(e=>({...e,error:"Senha deve ter no mínimo 6 caracteres"}));else if(e===a)try{h(e=>({...e,saving:!0,error:""}));const a=await E.update(p.userId,{password:e});a.ok?(h({open:!1,userId:null,name:"",newPassword:"",confirm:"",saving:!1,error:""}),r()):h(e=>({...e,saving:!1,error:a.error||"Falha ao atualizar senha"}))}catch(t){h(e=>({...e,saving:!1,error:t.message||"Erro inesperado"}))}else h(e=>({...e,error:"As senhas não coincidem"}))},disabled:p.saving,children:p.saving?"Salvando…":"Salvar"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>h({open:!1,userId:null,name:"",newPassword:"",confirm:"",saving:!1,error:""}),children:"Cancelar"})]})]}),e.jsx("style",{children:"\n            .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; padding:16px; z-index: 50; }\n            .modal { width: 100%; max-width: 520px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 16px; }\n            .title { color: var(--texto-branco); margin: 0 0 6px; }\n            .muted { color: var(--texto-gelo); }\n            .formRow input { padding: 10px 12px; border-radius: 10px; border:1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.06); color: var(--texto-branco); }\n          "})]})]})}function Tt(){const{data:a,loading:t,error:s,refresh:r}=C(),[i,n]=x.useState({name:"",specialty:"",bio:"",email:"",phone:"",photo:"",avatar_url:"",status:"published",visible:!0}),[l,o]=x.useState(null),[c,d]=x.useState({}),[u,m]=x.useState(!1),[p,h]=x.useState(""),g=["image/jpeg","image/png","image/webp","image/jpg","image/pjpeg","image/gif","image/svg+xml"],[j,v]=x.useState(""),[y,f]=x.useState(""),[N,_]=x.useState(""),[w,S]=x.useState(1),[k,A]=x.useState(new Set),[P,E]=x.useState(null),R=x.useRef(null),T="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",L=a.filter(e=>(e.name||"").toLowerCase().includes(j.toLowerCase())&&(!y||(e.specialty||"").toLowerCase().includes(y.toLowerCase()))&&(!N||(e.status||"")===N)),I=Math.max(1,Math.ceil(L.length/5)),D=L.slice(5*(w-1),5*w),O=e=>{const a={};return(!e.name||String(e.name).trim().length<2)&&(a.name="Informe um nome válido"),(!e.specialty||String(e.specialty).trim().length<2)&&(a.specialty="Informe a especialidade"),(!e.bio||String(e.bio).trim().length<5)&&(a.bio="Descrição muito curta"),e.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e.email))&&(a.email="E-mail inválido"),e.phone&&String(e.phone).trim().length<8&&(a.phone="Telefone incompleto"),a};x.useEffect(()=>{d(O(i))},[i]);const F=async e=>{0!==k.size&&window.confirm(`Aplicar status "${e}" a ${k.size} mentor(es)?`)&&(await B.bulkSetStatus(Array.from(k),e),r())},z=async e=>{0!==k.size&&window.confirm(`${e?"Exibir":"Ocultar"} ${k.size} mentor(es)?`)&&(await B.bulkSetVisibility(Array.from(k),e),r())},$=({mentorId:a})=>{const[t,s]=x.useState([]);return x.useEffect(()=>{s(B.getHistory(a))},[a]),e.jsx("div",{className:"history",style:{marginTop:8},children:0===t.length?e.jsx("div",{className:"muted",children:"Sem histórico"}):e.jsx("ul",{style:{display:"grid",gap:6},children:t.map(a=>e.jsxs("li",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:8},children:[e.jsx("span",{className:"muted",children:a.type}),e.jsx("span",{children:new Date(a.at).toLocaleString("pt-BR")}),e.jsx("button",{onClick:async()=>{if(!window.confirm(`Reverter evento ${a.id}?`))return;const e=await B.revertHistory(a.id);e.ok||alert(e.error),r()},children:"Reverter este"})]},a.id))})})};return e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Mentores"}),p&&e.jsx("div",{role:"status","aria-live":"polite",className:"saveToast",children:p}),e.jsx("div",{className:"filters-section",children:e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr 1fr auto auto auto"},children:[e.jsx("input",{className:"search-input","aria-label":"Buscar",placeholder:"Buscar por nome",value:j,onChange:e=>{v(e.target.value),S(1)}}),e.jsx("input",{className:"filter-input","aria-label":"Filtrar especialidade",placeholder:"Especialidade",value:y,onChange:e=>{f(e.target.value),S(1)}}),e.jsxs("select",{className:"filter-select","aria-label":"Status",value:N,onChange:e=>{_(e.target.value),S(1)},children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"published",children:"Publicado"})]}),e.jsx("button",{className:"btn btn-outline btn-icon",onClick:()=>S(Math.max(1,w-1)),children:"◀"}),e.jsxs("span",{style:{alignSelf:"center"},children:["Página ",w," / ",I]}),e.jsx("button",{className:"btn btn-outline btn-icon",onClick:()=>S(Math.min(I,w+1)),children:"▶"})]})}),t&&e.jsx("p",{children:"Carregando..."}),s&&e.jsx("p",{role:"alert",children:s}),e.jsx("div",{className:"filters-section",children:e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"auto auto auto auto auto"},children:[e.jsxs("label",{style:{alignSelf:"center"},children:[e.jsx("input",{type:"checkbox",onChange:e=>{return a=e.target.checked,void A(e=>{const t=new Set(e);for(const s of D)a?t.add(s.id):t.delete(s.id);return t});var a}})," Selecionar página"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>F("published"),children:"Status: Publicado"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>F("draft"),children:"Status: Rascunho"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>z(!0),children:"Exibir selecionados"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>z(!1),children:"Ocultar selecionados"})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,margin:"8px 0"},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=R.current;e&&e.scrollBy({left:-360,behavior:"smooth"})},children:"◀"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=R.current;e&&e.scrollBy({left:360,behavior:"smooth"})},children:"▶"})]}),e.jsx("div",{className:"mentorAdminGrid","aria-live":"polite",ref:R,style:{overflowX:"auto"},children:0===D.length?e.jsx("div",{className:"empty",children:"Nenhum mentor"}):D.map(a=>e.jsxs("article",{className:"mentorAdminCard",children:[e.jsxs("div",{className:"left",children:[e.jsx("input",{type:"checkbox","aria-label":`Selecionar ${a.name}`,checked:k.has(a.id),onChange:e=>{return t=a.id,s=e.target.checked,void A(e=>{const a=new Set(e);return s?a.add(t):a.delete(t),a});var t,s}}),e.jsx("div",{className:"avatar",children:a.photo||a.avatar_url?e.jsx("img",{src:b(a.photo||a.avatar_url),alt:`Foto de ${a.name}`,onError:e=>{e.currentTarget.src=T}}):null})]}),e.jsxs("div",{className:"center",children:[e.jsxs("div",{className:"header",children:[e.jsx("span",{className:"name",children:a.name}),e.jsx("span",{className:"spec",children:a.specialty})]}),e.jsxs("div",{className:"contact",children:[e.jsxs("span",{children:["📱 ",a.phone||"(00) 00000-0000"]}),e.jsxs("span",{children:["✉️ ",a.email||"email@exemplo.com"]})]}),e.jsxs("div",{className:"stats",children:[a.created_at?e.jsxs("span",{className:"stat-item",children:["Mentor desde ",new Date(a.created_at).toLocaleDateString("pt-BR",{month:"2-digit",year:"numeric"})]}):null,a.updated_at?e.jsxs("span",{className:"stat-item",children:["Atualizado ",new Date(a.updated_at).toLocaleDateString("pt-BR")]}):null]})]}),e.jsxs("div",{className:"right",children:[e.jsxs("div",{className:"actions btn-group",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>(e=>{o(e.id),n({name:e.name,specialty:e.specialty,bio:e.bio,email:e.email,phone:e.phone,photo:e.photo||e.avatar_url||"",avatar_url:e.avatar_url||"",status:e.status||"draft",visible:!!e.visible})})(a),children:"Editar"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>(async e=>{window.confirm("Confirma remover este mentor?")&&(await B.delete(e),r())})(a.id),children:"Remover"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>(async e=>{await B.undo(e),r()})(a.id),children:"Reverter"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>(async e=>{await B.toggleVisible(e),r()})(a),"aria-label":`Visibilidade ${a.name}`,children:a.visible?"Ocultar":"Exibir"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>E(P===a.id?null:a.id),children:P===a.id?"Fechar histórico":"Histórico"})]}),P===a.id?e.jsx($,{mentorId:a.id}):null]})]},a.id))}),e.jsxs("section",{className:"card",style:{marginTop:16},children:[e.jsx("h3",{style:{marginBottom:12},children:l?"✏️ Editar Mentor":"➕ Novo Mentor"}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"2fr 1fr"},children:[e.jsxs("div",{children:[e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx("input",{"aria-label":"Nome",placeholder:"Nome",value:i.name,onChange:e=>n({...i,name:e.target.value}),"aria-invalid":!!c.name,"aria-required":"true",required:!0}),e.jsx("input",{"aria-label":"Especialidade",placeholder:"Especialidade",value:i.specialty,onChange:e=>n({...i,specialty:e.target.value}),"aria-invalid":!!c.specialty,"aria-required":"true",required:!0})]}),e.jsx("div",{className:"formRow",children:e.jsx("input",{"aria-label":"Bio",placeholder:"Descrição",value:i.bio,onChange:e=>n({...i,bio:e.target.value}),"aria-invalid":!!c.bio,"aria-required":"true",required:!0})}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx("input",{"aria-label":"E-mail",placeholder:"E-mail",type:"email",value:i.email,onChange:e=>n({...i,email:e.target.value}),"aria-invalid":!!c.email}),e.jsx("input",{"aria-label":"Telefone",placeholder:"Telefone",type:"tel",value:i.phone,onChange:e=>n({...i,phone:e.target.value}),"aria-invalid":!!c.phone})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx("input",{"aria-label":"Foto (URL)",placeholder:"Foto (URL)",value:i.photo,onChange:e=>n({...i,photo:e.target.value})}),e.jsx("input",{"aria-label":"Enviar foto",type:"file",accept:g.join(","),onChange:e=>(async e=>{if(!e)return;if(!(e.type&&e.type.startsWith("image/")||g.includes(e.type)))return void alert("Formato inválido. Use imagens (JPEG, PNG, WEBP, GIF, SVG).");if(e.size>5242880)return void alert("Imagem muito grande. Máximo de 5MB.");const a=new FileReader;a.onload=()=>{const e=a.result;n(a=>({...a,photo:String(e),avatar_url:String(e)}))},a.readAsDataURL(e)})(e.target.files?.[0])})]}),e.jsx("div",{className:"formRow",children:e.jsx("input",{"aria-label":"Avatar URL (banco)",placeholder:"Avatar URL (banco)",value:i.avatar_url,onChange:e=>n({...i,avatar_url:e.target.value})})}),e.jsx("div",{className:"formRow",children:e.jsxs("label",{className:"checkbox-row",style:{alignSelf:"center"},children:[e.jsx("input",{type:"checkbox",checked:i.visible,onChange:e=>n({...i,visible:e.target.checked})})," Visível"]})})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:(i.photo||i.avatar_url)&&e.jsx("img",{src:b(i.photo||i.avatar_url),alt:"Preview",style:{width:120,height:120,objectFit:"cover",borderRadius:12,border:"1px solid rgba(255,255,255,0.18)"},onError:e=>{e.currentTarget.src=T}})})]}),e.jsxs("div",{className:"formRow",children:[e.jsx("button",{className:"btn btn-primary",onClick:async()=>{const e=O(i);if(Object.keys(e).length>0)d(e);else{m(!0);try{l?await B.upsert({...i,id:l}):await B.upsert(i),n({name:"",specialty:"",bio:"",email:"",phone:"",photo:"",status:"published",visible:!0}),o(null),h("Mentor salvo com sucesso"),setTimeout(()=>h(""),1800),r()}finally{m(!1)}}},disabled:u||Object.keys(c).length>0,children:u?"Salvando...":l?"Atualizar":"Salvar"}),l&&e.jsx("button",{className:"btn btn-outline",onClick:()=>{o(null),n({name:"",specialty:"",bio:"",email:"",phone:"",photo:"",avatar_url:"",status:"published",visible:!0})},children:"Cancelar"}),e.jsxs("select",{value:i.status,onChange:e=>n({...i,status:e.target.value}),children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"published",children:"Publicado"})]})]})]}),e.jsx("div",{className:"errorRow","aria-live":"polite",children:Object.values(c).length>0&&e.jsx("div",{className:"errorList",children:Object.values(c).map((a,t)=>e.jsx("span",{className:"errorItem",children:a},t))})}),e.jsx("div",{style:{marginTop:12},children:e.jsxs("div",{style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.16)",borderRadius:12,padding:12,maxWidth:600},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"100px 1fr",gap:12},children:[e.jsx("div",{style:{width:100,height:100,borderRadius:12,background:"linear-gradient(135deg, rgba(255,255,255,0.18), rgba(255,255,255,0.06))",border:"1px solid rgba(255,255,255,0.18)",overflow:"hidden"},children:i.photo||i.avatar_url?e.jsx("img",{src:b(i.photo||i.avatar_url),alt:"Prévia da foto",style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{e.currentTarget.src=T}}):null}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"#fff",fontWeight:700},children:i.name||"Nome do mentor"}),e.jsx("div",{style:{color:"#A6A6A6"},children:i.specialty||"Especialidade"}),e.jsx("div",{style:{marginTop:8,color:"#A6A6A6"},children:i.bio||"Descrição curta"})]})]}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,color:"#A6A6A6"},children:[e.jsx("span",{children:i.phone||"(00) 00000-0000"}),e.jsx("span",{children:i.email||"email@exemplo.com"})]})]})})]})}function Lt(){const{data:t,loading:s,error:r,refresh:i}=k(),{user:n}=m(),{crafters:l,pagination:o,loading:c,error:d,reload:u,loadPage:p,search:h}=A({active_only:"true",limit:20,order_by:"points",order_direction:"desc"}),[g,j]=x.useState(!1),[v,b]=x.useState({search:"",min_points:"",max_points:"",active_only:!0,sort:"points_desc"}),[y,f]=x.useState({name:"",avatar_url:"",points:0,active:!0}),[N,_]=x.useState({}),[w,C]=x.useState(!1),[S,P]=x.useState({open:!1,item:null,saving:!1,error:""}),E=x.useMemo(()=>!t||Array.isArray(t)?{top3:[],table:[],all:[]}:{top3:t.top3||[],table:t.table||[],all:t.all||t.crafters||[]},[t]),R=Array.isArray(E.all)?[...E.all].sort((e,a)=>Number(a.points??a.pontos??0)-Number(e.points??e.pontos??0)):[];"undefined"!=typeof window&&Array.isArray(E.all);const[B,L]=x.useState(E.top3||[]),[I,D]=x.useState({});x.useEffect(()=>{if(E.top3){const e=[...E.top3].sort((e,a)=>Number(e.position)-Number(a.position));L(e);const a={};e.forEach(e=>{a[e.position]=e.reward||""}),D(a)}},[E.top3]);const O=async(e,a,t="")=>{j(!0);try{await T.updatePoints(e,{delta:a,reason:t||`Ajuste manual ${a>0?"+":""}${a}`}),i()}finally{j(!1)}},F=async(e,a,t="")=>{j(!0);try{await T.updatePoints(e,{set:a,reason:t||`Definir ${a} pontos`}),i()}finally{j(!1)}},z=async()=>{j(!0);try{const e=(B||[]).map((e,a)=>({crafter_id:e.id,position:a+1,reward:I[a+1]||""})),a=await T.updateTop3(e);if(a&&a.ok&&a.result&&a.result.data&&Array.isArray(a.result.data.top3)){const e=a.result.data.top3.map(e=>({id:e.crafter_id,name:e.name||"",points:Number(e.points||0),avatar_url:e.avatar_url||"",position:e.position})).sort((e,a)=>Number(e.position)-Number(a.position));L(e);const t={};e.forEach(e=>{t[e.position]=e.reward||""}),D(t)}i()}finally{j(!1)}},$=x.useMemo(()=>{let e=[...E.table||[]];return v.search&&(e=e.filter(e=>e.name.toLowerCase().includes(v.search.toLowerCase()))),v.min_points&&(e=e.filter(e=>e.points>=Number(v.min_points))),v.max_points&&(e=e.filter(e=>e.points<=Number(v.max_points))),v.active_only&&(e=e.filter(e=>!1!==e.active)),"points_desc"===v.sort?e.sort((e,a)=>Number(a.points||0)-Number(e.points||0)):"points_asc"===v.sort?e.sort((e,a)=>Number(e.points||0)-Number(a.points||0)):"name_asc"===v.sort?e.sort((e,a)=>String(e.name||"").localeCompare(String(a.name||""))):"name_desc"===v.sort&&e.sort((e,a)=>String(a.name||"").localeCompare(String(e.name||""))),e},[E.table,v]);return s?e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Ranking"}),e.jsx("p",{children:"Carregando..."})]}):r?e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Ranking"}),e.jsx("p",{role:"alert",children:r})]}):e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Ranking"}),e.jsxs("section",{className:"card",style:{marginBottom:"2rem"},children:[e.jsx("h3",{children:"Editor de Pódio"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem",marginBottom:"1rem"},children:[1,2,3].map(a=>{const t=(B||[]).find(e=>e.position===a)||(B||[])[a-1],s=t?.id,r=s&&(B||[]).filter(e=>e.id===t.id).length>1;return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"1rem",border:"2px solid "+(r?"#ff4444":s?"#D12BF2":"rgba(255,255,255,0.1)"),borderRadius:"8px",background:r?"rgba(255,68,68,0.1)":s?"rgba(209,43,242,0.1)":"transparent"},children:[e.jsxs("label",{style:{fontWeight:600,color:r?"#ff4444":"#D12BF2",display:"flex",alignItems:"center",gap:"0.5rem"},children:["Posição ",a,1===a&&"🥇",2===a&&"🥈",3===a&&"🥉",r&&e.jsx("span",{style:{color:"#ff4444",fontSize:"0.8rem"},children:"⚠️ Duplicado"})]}),e.jsxs("select",{value:t?.id||"",onChange:e=>{const t=R.find(a=>a.id===e.target.value);if(t){const e=[...B];e[a-1]={...t,position:a},L(e)}else{const e=[...B];e[a-1]=null,L(e.filter(Boolean))}},style:{border:r?"2px solid #ff4444":"1px solid rgba(255,255,255,0.2)",background:r?"rgba(255,68,68,0.1)":"rgba(0,0,0,0.3)"},children:[e.jsx("option",{value:"",children:"Selecionar crafter"}),R.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.points," pts)"]},a.id))]}),e.jsx("input",{placeholder:"Recompensa (opcional)",value:I[a]||"",onChange:e=>D(t=>({...t,[a]:e.target.value})),style:{border:"1px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.3)",color:"white",padding:"0.5rem",borderRadius:"4px"}}),s&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"#888",marginTop:"0.25rem"},children:[t.points," pontos"]})]},a)})}),e.jsx("div",{style:{marginBottom:"1rem"},children:(()=>{const a=(B||[]).filter(e=>e?.id).map(e=>e.id),t=a.length!==new Set(a).size,s=3===(B||[]).length&&(B||[]).every(e=>e?.id),r=0===(B||[]).length;return t?e.jsxs("div",{style:{padding:"0.75rem",background:"rgba(255,68,68,0.1)",border:"1px solid #ff4444",borderRadius:"6px",color:"#ff4444",display:"flex",alignItems:"center",gap:"0.5rem"},children:["⚠️ ",e.jsx("strong",{children:"Erro:"})," Não é possível selecionar o mesmo crafter em múltiplas posições"]}):s?e.jsxs("div",{style:{padding:"0.75rem",background:"rgba(34,197,94,0.1)",border:"1px solid #22c55e",borderRadius:"6px",color:"#22c55e",display:"flex",alignItems:"center",gap:"0.5rem"},children:["✅ ",e.jsx("strong",{children:"Pódio completo!"})," Pronto para salvar"]}):!r&&a.length>0?e.jsxs("div",{style:{padding:"0.75rem",background:"rgba(251,191,36,0.1)",border:"1px solid #fbbf24",borderRadius:"6px",color:"#fbbf24",display:"flex",alignItems:"center",gap:"0.5rem"},children:["⏳ ",e.jsx("strong",{children:"Pódio incompleto:"})," Selecione crafters para todas as 3 posições"]}):null})()}),e.jsx("div",{className:"formRow",children:(()=>{const a=(B||[]).filter(e=>e?.id).map(e=>e.id),t=a.length!==new Set(a).size,s=3===(B||[]).length&&(B||[]).every(e=>e?.id),r=a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary",onClick:z,disabled:g||!s||t,style:{opacity:!s||t?.5:1,cursor:!s||t?"not-allowed":"pointer"},children:g?"Salvando...":"Salvar Pódio 🚀"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{L([]),D({})},disabled:g||!r,style:{opacity:r?1:.5,cursor:r?"pointer":"not-allowed"},children:"Limpar Pódio"})]})})()})]}),e.jsxs("section",{className:"card",style:{marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{children:"Gerenciar Crafters"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>C(!0),children:"Novo Crafter"})]}),w&&e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Novo crafter",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{width:"min(560px, 92vw)",background:"rgba(20,20,20,0.95)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:12,padding:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("h4",{style:{margin:0},children:"Novo Crafter"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{C(!1),_({})},children:"Fechar"})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx("input",{"aria-label":"Nome",placeholder:"Nome do crafter",value:y.name,onChange:e=>f(a=>({...a,name:e.target.value})),"aria-invalid":!!N.name}),e.jsx("input",{"aria-label":"Avatar URL",placeholder:"Avatar URL (opcional)",value:y.avatar_url,onChange:e=>f(a=>({...a,avatar_url:e.target.value})),"aria-invalid":!!N.avatar_url})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx("input",{"aria-label":"Pontos iniciais",type:"number",placeholder:"Pontos iniciais",value:y.points,onChange:e=>f(a=>({...a,points:Number(e.target.value)})),"aria-invalid":!!N.points}),e.jsxs("label",{style:{alignSelf:"center"},children:[e.jsx("input",{type:"checkbox",checked:y.active,onChange:e=>f(a=>({...a,active:e.target.checked}))})," Ativo"]})]}),y.avatar_url&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:e.jsx("img",{src:y.avatar_url,alt:"Prévia do avatar",style:{width:80,height:80,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(255,255,255,0.2)"}})}),e.jsx("div",{className:"errorRow","aria-live":"polite",children:Object.values(N).length>0&&e.jsx("div",{className:"errorList",children:Object.values(N).map((a,t)=>e.jsx("span",{className:"errorItem",children:a},t))})}),e.jsxs("div",{className:"formRow",children:[e.jsx("button",{className:"btn btn-primary",onClick:async()=>{const e=(e=>{const a={};String(e.name||"").trim()||(a.name="Nome é obrigatório"),(""===e.points||isNaN(Number(e.points)))&&(a.points="Pontos inválidos"),Number(e.points)<0&&(a.points="Pontos não podem ser negativos"),String(e.avatar_url||"").trim()&&(/^https?:\/\/\S+/.test(String(e.avatar_url))||(a.avatar_url="URL do avatar inválida"));return a})(y);if(_(e),!(Object.keys(e).length>0)){j(!0);try{await a("/api/crafters",{method:"POST",body:JSON.stringify(y)}),f({name:"",avatar_url:"",points:0,active:!0}),C(!1),i()}finally{j(!1)}}},disabled:g||Object.keys(N).length>0||!y.name,children:g?"Salvando...":"Salvar crafter"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{C(!1),_({})},children:"Cancelar"})]})]})})]}),e.jsxs("section",{className:"card",style:{marginBottom:"2rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{children:"Crafters Ativos"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{"aria-label":"Buscar por nome",placeholder:"Buscar por nome",value:v.search,onChange:e=>{b(a=>({...a,search:e.target.value})),h(e.target.value)},className:"search-input"}),e.jsx("input",{"aria-label":"Especialização",placeholder:"Especialização",value:v.spec||"",onChange:e=>b(a=>({...a,spec:e.target.value})),className:"filter-input"}),e.jsx("input",{"aria-label":"Pontos mín.",type:"number",placeholder:"Pontos mín.",value:v.min_points,onChange:e=>b(a=>({...a,min_points:e.target.value})),className:"filter-input"}),e.jsx("input",{"aria-label":"Pontos máx.",type:"number",placeholder:"Pontos máx.",value:v.max_points,onChange:e=>b(a=>({...a,max_points:e.target.value})),className:"filter-input"}),e.jsxs("select",{"aria-label":"Ordenar",value:v.sort,onChange:e=>b(a=>({...a,sort:e.target.value})),className:"filter-input",children:[e.jsx("option",{value:"points_desc",children:"Pontos ↓"}),e.jsx("option",{value:"points_asc",children:"Pontos ↑"}),e.jsx("option",{value:"name_asc",children:"Nome A→Z"}),e.jsx("option",{value:"name_desc",children:"Nome Z→A"})]})]})]}),c&&e.jsx("p",{children:"Carregando crafters..."}),d&&e.jsx("p",{role:"alert",children:d}),e.jsx("div",{className:"crafterGrid","aria-busy":c,"aria-live":"polite",children:(()=>{let a=(Array.isArray(l)?l:[]).filter(e=>!v.search||String(e.nome||e.name||"").toLowerCase().includes(String(v.search).toLowerCase())).filter(e=>!v.spec||String(e.nivel||"").toLowerCase().includes(String(v.spec).toLowerCase())).filter(e=>!v.min_points||Number(e.points??e.pontos??0)>=Number(v.min_points)).filter(e=>!v.max_points||Number(e.points??e.pontos??0)<=Number(v.max_points));return"points_desc"===v.sort?a=a.sort((e,a)=>Number(a.points??a.pontos??0)-Number(e.points??e.pontos??0)):"points_asc"===v.sort?a=a.sort((e,a)=>Number(e.points??e.pontos??0)-Number(a.points??a.pontos??0)):"name_asc"===v.sort?a=a.sort((e,a)=>String(e.nome||e.name||"").localeCompare(String(a.nome||a.name||""))):"name_desc"===v.sort&&(a=a.sort((e,a)=>String(a.nome||a.name||"").localeCompare(String(e.nome||e.name||"")))),0===a.length?e.jsx("div",{className:"empty",children:"Nenhum crafter ativo"}):a.map(a=>e.jsxs("article",{className:"crafterCard",onClick:()=>{"admin"===n?.role&&P({open:!0,item:{id:a.id,nome:a.nome||a.name||"",nivel:a.nivel||"",avatar_url:a.avatar_url||"",pontos:Number(a.points??a.pontos??0),ativo:a.active??a.ativo??!0},saving:!1,error:""})},children:[e.jsx("div",{className:"crafterAvatar","aria-hidden":"true",children:a.avatar_url?e.jsx("img",{src:a.avatar_url,alt:""}):null}),e.jsxs("div",{className:"crafterInfo",children:[e.jsx("span",{className:"crafterName",children:a.nome||a.name}),e.jsx("span",{className:"crafterSpec",children:a.nivel||"—"}),e.jsxs("div",{className:"crafterMeta",children:[e.jsxs("span",{className:"crafterPoints",children:[Number(a.points??a.pontos??0)," pts"]}),e.jsx("span",{className:"crafterStatus "+(!1!==(a.active??a.ativo)?"active":"inactive"),children:!1!==(a.active??a.ativo)?"Ativo":"Inativo"})]})]}),e.jsx("div",{className:"crafterActions",children:"admin"===n?.role&&e.jsx("button",{className:"btn btn-outline",onClick:e=>{e.stopPropagation(),P({open:!0,item:{id:a.id,nome:a.nome||a.name||"",nivel:a.nivel||"",avatar_url:a.avatar_url||"",pontos:Number(a.points??a.pontos??0),ativo:a.active??a.ativo??!0},saving:!1,error:""})},children:"Editar"})})]},a.id))})()}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},children:[e.jsxs("span",{style:{color:"#A6A6A6"},children:["Total: ",o.total]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>p(Math.max(1,Number(o.page||1)-1)),disabled:c||!o.hasPrev,children:"◀"}),e.jsxs("span",{children:["Página ",o.page," / ",o.totalPages||1]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>p(Number(o.page||1)+1),disabled:c||!o.hasNext,children:"▶"})]})]})]}),S.open&&e.jsx("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true","aria-label":`Editar crafter ${S.item?.nome||""}`,children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{className:"title",children:"Editar Crafter"}),S.error&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["❌ ",S.error]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx("input",{"aria-label":"Nome",placeholder:"Nome",value:S.item?.nome||"",onChange:e=>P(a=>({...a,item:{...a.item,nome:e.target.value}})),required:!0}),e.jsx("input",{"aria-label":"Especialização",placeholder:"Especialização",value:S.item?.nivel||"",onChange:e=>P(a=>({...a,item:{...a.item,nivel:e.target.value}}))})]}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr 1fr"},children:[e.jsx("input",{"aria-label":"Avatar URL",placeholder:"Avatar URL",value:S.item?.avatar_url||"",onChange:e=>P(a=>({...a,item:{...a.item,avatar_url:e.target.value}}))}),e.jsx("input",{"aria-label":"Pontos",type:"number",placeholder:"Pontos",value:S.item?.pontos??0,onChange:e=>P(a=>({...a,item:{...a.item,pontos:Number(e.target.value)}}))})]}),e.jsxs("label",{className:"checkbox-row",style:{alignSelf:"center"},children:[e.jsx("input",{type:"checkbox",checked:S.item?.ativo??!0,onChange:e=>P(a=>({...a,item:{...a.item,ativo:e.target.checked}}))})," Ativo"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(String(S.item?.nome||"").trim())try{P(e=>({...e,saving:!0,error:""})),await a(`/api/crafters/${S.item.id}`,{method:"PUT",body:JSON.stringify({nome:S.item.nome,nivel:S.item.nivel,avatar_url:S.item.avatar_url,pontos:Number(S.item.pontos||0),ativo:!!S.item.ativo})}),P({open:!1,item:null,saving:!1,error:""}),u()}catch(e){P(a=>({...a,saving:!1,error:e.message||"Falha ao salvar"}))}else P(e=>({...e,error:"Nome é obrigatório"}))},disabled:S.saving||"admin"!==n?.role,children:S.saving?"Salvando…":"Salvar"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>P({open:!1,item:null,saving:!1,error:""}),children:"Cancelar"})]})]})}),e.jsxs("section",{className:"filters-section",style:{marginBottom:"2rem"},children:[e.jsx("h3",{children:"Filtros"}),e.jsxs("div",{className:"formRow",children:[e.jsx("input",{placeholder:"Buscar por nome",value:v.search,onChange:e=>b(a=>({...a,search:e.target.value}))}),e.jsx("input",{type:"number",placeholder:"Pontos mín.",value:v.min_points,onChange:e=>b(a=>({...a,min_points:e.target.value}))}),e.jsx("input",{type:"number",placeholder:"Pontos máx.",value:v.max_points,onChange:e=>b(a=>({...a,max_points:e.target.value}))}),e.jsxs("select",{value:v.sort,onChange:e=>b(a=>({...a,sort:e.target.value})),children:[e.jsx("option",{value:"points_desc",children:"Pontos ↓"}),e.jsx("option",{value:"points_asc",children:"Pontos ↑"}),e.jsx("option",{value:"name_asc",children:"Nome A→Z"}),e.jsx("option",{value:"name_desc",children:"Nome Z→A"})]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:v.active_only,onChange:e=>b(a=>({...a,active_only:e.target.checked}))}),"Apenas ativos"]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{b({search:"",min_points:"",max_points:"",active_only:!0,sort:"points_desc"})},children:"Reset Filtros"})]})]}),e.jsxs("section",{className:"card",style:{marginBottom:"2rem"},children:[e.jsx("h3",{children:"Tabela Geral"}),e.jsx("div",{className:"table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Pos"}),e.jsx("th",{children:"Avatar"}),e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Pontos"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:(Array.isArray($)?$:[]).map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.name,style:{width:32,height:32,borderRadius:"50%"}}):e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:"#D12BF2",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px"},children:t.name.charAt(0).toUpperCase()})}),e.jsx("td",{children:t.name}),e.jsxs("td",{children:[t.points," pts"]}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:600,background:!1!==t.active?"rgba(0, 228, 242, 0.2)":"rgba(255, 255, 255, 0.1)",color:!1!==t.active?"#00E4F2":"rgba(255, 255, 255, 0.6)"},children:!1!==t.active?"Ativo":"Inativo"})}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>O(t.id,10),disabled:g,children:"+10"}),e.jsx("button",{className:"btn btn-sm",onClick:()=>O(t.id,-10),disabled:g,children:"-10"}),e.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>{const e=prompt("Definir pontos:",t.points);null===e||isNaN(e)||F(t.id,Number(e))},disabled:g,children:"SET"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>{window.confirm(`Zerar pontos de ${t.name}?`)&&F(t.id,0,"Zerado pelo admin")},disabled:g,children:"Zerar"}),e.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>(async(e,t)=>{j(!0);try{await a(`/api/crafters/${e}`,{method:"PUT",body:JSON.stringify(t)}),i()}finally{j(!1)}})(t.id,{active:!t.active}),disabled:g,children:!1!==t.active?"Desativar":"Ativar"})]})})]},t.id))})]})})]})]})}function It(){const{data:t,loading:s,error:r,refresh:i}=w(),[n,l]=x.useState({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,thumb_url:"",tags:[]}),[o,c]=x.useState({type:"",msg:""}),[d,u]=x.useState(null),[m,p]=x.useState(""),[h,g]=x.useState(1),j=t.filter(e=>(e.title||e.titulo||"").toLowerCase().includes(m.toLowerCase())||(e.owner||"").toLowerCase().includes(m.toLowerCase())||(e.status||"").toLowerCase().includes(m.toLowerCase())),v=Math.max(1,Math.ceil(j.length/5)),b=j.slice(5*(h-1),5*h);return x.useEffect(()=>{if(b.length>0&&!s&&!r){const e=Vt(".admin-content .table");u(e),e&&e.ok}},[b.length,s,r]),e.jsxs("div",{className:"admin-content",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"title",children:"🎯 Gestão de Projetos"}),e.jsx("p",{className:"muted",children:"Gerencie projetos e integração automática com finanças"})]}),e.jsx("button",{onClick:()=>{const e=j.map(e=>`${e.id},"${e.title}",${e.status},${e.price||0},${e.startDate||""},${e.progress??e.progresso??0}`).join("\n"),a=new Blob(["id,title,status,price,startDate,progress\n"+e],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download="projetos.csv",s.click(),URL.revokeObjectURL(t)},className:"btn btn-primary",children:"📤 Exportar CSV"})]}),e.jsx("div",{className:"filters-section",children:e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr auto auto auto"},children:[e.jsx("input",{"aria-label":"Buscar",placeholder:"🔍 Buscar (título/owner/status)",value:m,onChange:e=>{p(e.target.value),g(1)}}),e.jsx("button",{className:"btn btn-outline",onClick:()=>g(Math.max(1,h-1)),"aria-label":"Página anterior",children:"◀"}),e.jsxs("span",{style:{alignSelf:"center"},children:["Página ",h," / ",v]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>g(Math.min(v,h+1)),"aria-label":"Página seguinte",children:"▶"})]})}),s&&e.jsx("p",{children:"🔄 Carregando..."}),r&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["❌ ",r,String(r).toLowerCase().includes("não é json")&&e.jsx("span",{style:{display:"block",marginTop:4,fontSize:"0.9em"},children:"Verifique se o proxy de /api está configurado; em produção use VITE_ALLOW_EXTERNAL_API e VITE_API_URL ou ajuste o reverse proxy."})]}),o.msg&&e.jsxs("p",{role:"error"===o.type?"alert":"status",style:{color:"error"===o.type?"#FF6B6B":"#00E4F2"},children:["error"===o.type?"❌ ":"✔ "," ",o.msg]}),d&&!1===d.ok&&"error"!==o.type&&e.jsxs("div",{className:"card","data-diag":"projects-invisible",style:{borderColor:"#FF6B6B",color:"#FF6B6B",marginBottom:12},children:["Elementos carregados mas invisíveis. display=",d.display,", visibility=",d.visibility,", opacity=",d.opacity,", z-index=",d.zIndex,". Top element: ",d.top?d.top.cls||d.top.tag:"—"]}),e.jsx("div",{className:"table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Título"}),e.jsx("th",{children:"Owner"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Preço"}),e.jsx("th",{children:"Progresso"}),e.jsx("th",{children:"📝"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===b.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",children:"📭 Nenhum projeto"})}):b.map(a=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Título",style:{fontWeight:"bold"},children:a.title||a.titulo}),e.jsx("td",{"data-label":"Owner",children:a.owner}),e.jsx("td",{"data-label":"Status",children:e.jsx("span",{style:{background:"finalizado"===a.status?"#00E4F2":"ongoing"===a.status?"#FFA500":"#666",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8em",fontWeight:"bold"},children:a.status})}),e.jsxs("td",{"data-label":"Preço",style:{fontWeight:"bold",color:"#00E4F2"},children:["R$ ",U(a).toLocaleString("pt-BR")]}),e.jsx("td",{"data-label":"Progresso",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:60,height:6,background:"#E0E0E0",borderRadius:3},children:e.jsx("div",{style:{width:`${a.progress??a.progresso??0}%`,height:"100%",background:"#00E4F2",borderRadius:3}})}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[a.progress??a.progresso??0,"%"]})]})}),e.jsx("td",{"data-label":"Resumo",title:(a.description||a.descricao||"").slice(0,200),children:String(a.description||a.descricao||"").slice(0,80)||"—"}),e.jsx("td",{"data-label":"Ações",children:e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>l({id:a.id,titulo:a.title||a.titulo||"",owner:a.owner||"",descricao:a.description||a.descricao||"",data_inicio:a.startDate||a.data_inicio||"",status:a.status||"rascunho",preco:a.price??0,progresso:a.progress??0,thumb_url:a.thumb_url||"",tags:a.tags||[]}),children:"✏️"}),e.jsx("button",{className:"btn btn-outline",onClick:async()=>{const e=await S.toggleVisible(a);e.ok?(c({type:"success",msg:"Visibilidade atualizada"}),i()):c({type:"error",msg:e.error||"Falha ao alternar visibilidade"})},"aria-label":`Visibilidade ${a.title||a.titulo||a.id}`,children:String(a.status||"").toLowerCase().includes("rascunho")?"Exibir":"Ocultar"}),e.jsx("button",{className:"btn btn-danger",onClick:async()=>{if(window.confirm("Deletar este projeto?"))try{await $(a.id),c({type:"success",msg:"Projeto deletado com sucesso."}),i()}catch(e){c({type:"error",msg:e.message||"Falha ao deletar projeto"})}},children:"🗑️"})]})})]},a.id))})]})}),e.jsxs("section",{className:"card",style:{padding:20,marginTop:20},children:[e.jsx("h3",{style:{marginBottom:16},children:n.id?"✏️ Editar Projeto":"➕ Novo Projeto"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:16},children:[e.jsx("input",{"aria-label":"Título",placeholder:"Título do projeto",value:n.titulo,onChange:e=>l({...n,titulo:e.target.value})}),e.jsx("input",{"aria-label":"Owner",placeholder:"Responsável/Owner",value:n.owner,onChange:e=>l({...n,owner:e.target.value})}),e.jsx("input",{"aria-label":"Thumb URL",placeholder:"URL da imagem",value:n.thumb_url,onChange:e=>l({...n,thumb_url:e.target.value})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:16},children:[e.jsx("input",{"aria-label":"Data de início",type:"date",value:n.data_inicio,onChange:e=>l({...n,data_inicio:e.target.value})}),e.jsxs("select",{value:n.status,onChange:e=>l({...n,status:e.target.value}),children:[e.jsx("option",{value:"rascunho",children:"📝 Rascunho"}),e.jsx("option",{value:"ongoing",children:"🔄 Andamento"}),e.jsx("option",{value:"finalizado",children:"✅ Finalizado"})]}),e.jsx("input",{"aria-label":"Preço",placeholder:"Preço (R$)",type:"number",value:n.preco,onChange:e=>l({...n,preco:Number(e.target.value)})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:"0.9em"},children:"Progresso:"}),e.jsx("input",{"aria-label":"Progresso",type:"range",min:"0",max:"100",value:n.progresso,onChange:e=>l({...n,progresso:Number(e.target.value)}),style:{flex:1}}),e.jsxs("span",{style:{fontSize:"0.9em",fontWeight:"bold"},children:[n.progresso,"%"]})]})]}),e.jsx("textarea",{"aria-label":"Descrição do Projeto",placeholder:"Descreva brevemente o objetivo e escopo do projeto...",maxLength:500,required:!0,value:n.descricao,onChange:e=>l({...n,descricao:e.target.value}),style:{width:"100%",minHeight:80,resize:"vertical",marginBottom:16}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.9em",color:"#666"},children:"Dica: Controle a visibilidade usando o campo de status (rascunho/ongoing/finalizado)."}),e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn btn-primary",onClick:async()=>{try{if(!String(n.titulo||"").trim()||!String(n.owner||"").trim()||!String(n.status||"").trim())return void c({type:"error",msg:"Preencha título, owner e status."});if(String(n.descricao||"").length<10)return void c({type:"error",msg:"Descrição muito curta. Adicione mais detalhes."});if((e=>{const a=String(e||""),t=/^[a-zA-Z]:\\/.test(a),s=a.startsWith("file:");return t||s})(n.thumb_url))return void c({type:"error",msg:"URL de imagem inválida. Use http(s) ou carregue um link público."});const t=await S.upsert(n);try{if("finalizado"===(n.status||"").toLowerCase()){const e=String(n.owner||"").toLowerCase().includes("admin")?1:2,s={name:n.titulo,mainFeature:(n.descricao||"").split(".").shift(),price:Number(n.preco||0),thumbnail:n.thumb_url||"",project_id:t.id||n.id,ownerId:e};await a(`/api/apps/from-project/${t.id||n.id}`,{method:"POST",body:JSON.stringify(s)})}}catch(e){}l({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,visivel:!1,thumb_url:"",tags:[]}),c({type:"success",msg:n.id?"Projeto atualizado com sucesso.":"Projeto criado com sucesso."}),i()}catch(t){c({type:"error",msg:"Erro ao salvar projeto: "+(t.message||"Falha desconhecida")})}},children:[n.id?"💾 Atualizar":"➕ Criar"," Projeto"]}),n.id&&e.jsx("button",{className:"btn btn-outline",onClick:()=>l({titulo:"",owner:"",descricao:"",data_inicio:"",status:"rascunho",preco:0,progresso:0,thumb_url:"",tags:[]}),children:"❌ Cancelar"})]})]}),n.preco>0&&e.jsx("div",{style:{marginTop:12,padding:12,background:"#E8F5E8",borderRadius:8,border:"1px solid #00E4F2"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:["💰 ",e.jsx("strong",{children:"Integração Financeira:"})," Um registro financeiro será criado automaticamente com valor de R$ ",n.preco.toLocaleString("pt-BR")]})})]}),n.titulo&&e.jsxs("div",{style:{marginTop:20},children:[e.jsx("h4",{style:{marginBottom:12,color:"#666"},children:"👀 Preview do Card Público:"}),e.jsx("div",{style:{maxWidth:600},children:e.jsx(Dt,{form:n})})]})]})}function Dt({form:a}){const t={id:"preview",titulo:a.titulo,owner:a.owner,descricao:a.descricao,data_inicio:a.data_inicio,status:a.status,progresso:a.progresso,thumb_url:a.thumb_url};return e.jsx(Pa,{project:t})}function Ot(){const{data:t,loading:s,error:r,refresh:i}=f(),[n,l]=x.useState({name:"",objective:"",description:"",deadline:"",difficulty:"starter",tags:[],reward:"",base_points:0,delivery_type:"link",thumb_url:"",status:"draft",visible:!0}),[o,c]=x.useState(null),[d,u]=x.useState(!1),[m,p]=x.useState(null),[h,g]=x.useState(null),[j,v]=x.useState(!1),[b,y]=x.useState(""),_=async e=>{v(!0),y("");try{const t=await a(`/api/desafios/${e}`,{method:"GET"});g(t?.data?.challenge||t?.challenge||t)}catch{y("Falha ao carregar detalhes")}finally{v(!1)}};x.useEffect(()=>{const e=L.subscribe("desafios_changed",()=>{i(),m&&_(m)});return()=>e()},[m,i]);const[w,C]=x.useState(""),[S,k]=x.useState(1),A=t.filter(e=>(e.name||"").toLowerCase().includes(w.toLowerCase())||(e.objective||"").toLowerCase().includes(w.toLowerCase())||(e.status||"").toLowerCase().includes(w.toLowerCase())),P=Math.max(1,Math.ceil(A.length/5)),E=A.slice(5*(S-1),5*S);return e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Desafios"}),e.jsx("div",{className:"filters-section",children:e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"1fr auto auto auto auto"},children:[e.jsx("input",{"aria-label":"Buscar",placeholder:"Buscar (nome/objetivo/status)",value:w,onChange:e=>{C(e.target.value),k(1)}}),e.jsx("button",{className:"btn btn-outline",onClick:()=>k(Math.max(1,S-1)),"aria-label":"Página anterior",children:"◀"}),e.jsxs("span",{style:{alignSelf:"center"},children:["Página ",S," / ",P]}),e.jsx("button",{className:"btn btn-outline",onClick:()=>k(Math.min(P,S+1)),"aria-label":"Página seguinte",children:"▶"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{const e=A.map(e=>`${e.id},"${e.name}","${e.objective}",${e.status},${e.visible},${e.deadline||""},${e.base_points||0}`).join("\n"),a=new Blob(["id,name,objective,status,visible,deadline,base_points\n"+e],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download="desafios.csv",s.click(),URL.revokeObjectURL(t)},children:"Exportar CSV"})]})}),s&&e.jsx("p",{children:"Carregando..."}),r&&e.jsx("p",{role:"alert",children:r}),e.jsx("div",{className:"table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Deadline"}),e.jsx("th",{children:"Base points"}),e.jsx("th",{children:"Visível"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===E.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:"Nenhum desafio"})}):E.map(t=>e.jsxs(x.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Nome",children:t.name}),e.jsx("td",{"data-label":"Status",children:t.status}),e.jsx("td",{"data-label":"Deadline",children:t.deadline?new Date(t.deadline).toLocaleString("pt-BR"):"—"}),e.jsx("td",{"data-label":"Base points",children:t.base_points??0}),e.jsx("td",{"data-label":"Visível",children:String(t.visible)}),e.jsx("td",{"data-label":"Ações",children:e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>(e=>{c(e.id),l({id:e.id,name:e.name,objective:e.objective||"",description:e.description||"",deadline:e.deadline||"",difficulty:e.difficulty||"starter",tags:Array.isArray(e.tags)?e.tags:[],reward:e.reward||"",base_points:Number(e.base_points??0),delivery_type:e.delivery_type||"link",thumb_url:e.thumb_url||"",status:e.status||"draft",visible:!!e.visible})})(t),children:"Editar"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>(async e=>{u(!0);try{await a(`/api/desafios/${e.id}/visibility`,{method:"PUT",body:JSON.stringify({visible:!e.visible})}),i()}finally{u(!1)}})(t),"aria-label":`Visibilidade ${t.name}`,disabled:d,children:t.visible?"Ocultar":"Exibir"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>(async e=>{u(!0);try{const a="closed"===e.status?"active":"closed";await N.setStatus(e.id,a),i()}finally{u(!1)}})(t),disabled:d,children:"closed"===t.status?"Reabrir":"Encerrar"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>(async e=>{const a=m===e.id?null:e.id;p(a),g(null),y(""),a&&await _(a)})(t),children:m===t.id?"Fechar detalhes":"Detalhes"})]})})]}),m===t.id&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",children:[j&&e.jsx("p",{children:"Carregando detalhes..."}),b&&e.jsx("p",{role:"alert",children:b}),h&&e.jsx("div",{style:{borderRadius:12,padding:12},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("h4",{children:"Inscrições"}),Array.isArray(h.registrations)&&h.registrations.length>0?e.jsx("ul",{className:"items",children:h.registrations.map(a=>e.jsxs("li",{className:"item",children:[e.jsx("span",{children:a.crafter_id}),e.jsx("span",{children:new Date(a.at).toLocaleString("pt-BR")})]},a.id))}):e.jsx("p",{children:"Nenhuma inscrição"})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"Entregas"}),Array.isArray(h.submissions)&&h.submissions.length>0?e.jsx("ul",{className:"items",children:h.submissions.map(a=>e.jsxs("li",{className:"item",style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr auto",gap:8},children:[e.jsxs("span",{children:[e.jsx("div",{children:e.jsx("strong",{children:a.crafter_id})}),e.jsx("div",{style:{color:"#A6A6A6"},children:a.delivery?.url||"-"})]}),e.jsx("span",{children:a.status||"submitted"}),e.jsxs("span",{children:[a.score??0," pts"]}),e.jsxs("span",{children:[e.jsxs("select",{"aria-label":`Status submissão ${a.id}`,defaultValue:a.status||"submitted",id:`status-${a.id}`,children:[e.jsx("option",{value:"approved",children:"aprovar"}),e.jsx("option",{value:"rejected",children:"reprovar"})]}),e.jsx("input",{"aria-label":`Pontos ${a.id}`,type:"number",placeholder:"+pts",defaultValue:a.score??h.base_points??0,id:`pts-${a.id}`,style:{width:80,marginLeft:6}}),e.jsx("button",{className:"btn btn-primary",style:{marginLeft:6},onClick:async()=>{const e=document.getElementById(`status-${a.id}`),t=document.getElementById(`pts-${a.id}`),s=e?.value||"approved",r=Number(t?.value||0);u(!0);try{await N.reviewSubmission(a.id,{status:s,score:r,review:{notes:"",criteria_scores:{}}}),await _(m)}finally{u(!1)}},children:"Revisar"})]})]},a.id))}):e.jsx("p",{children:"Nenhuma entrega"})]})]})})]})})]},t.id))})]})}),e.jsxs("section",{className:"card",style:{marginTop:16},children:[e.jsx("h3",{style:{marginBottom:12},children:o?"✏️ Editar Desafio":"➕ Novo Desafio"}),e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))"},children:[e.jsx("input",{"aria-label":"Nome",placeholder:"Nome",value:n?.name||"",onChange:e=>l({...n,name:e.target.value})}),e.jsx("input",{"aria-label":"Objetivo",placeholder:"Objetivo",value:n?.objective||"",onChange:e=>l({...n,objective:e.target.value})}),e.jsx("input",{"aria-label":"Descrição",placeholder:"Descrição",value:n?.description||"",onChange:e=>l({...n,description:e.target.value})}),e.jsx("input",{"aria-label":"Deadline",type:"datetime-local",value:n?.deadline||"",onChange:e=>l({...n,deadline:e.target.value})}),e.jsxs("select",{value:n?.difficulty||"starter",onChange:e=>l({...n,difficulty:e.target.value}),children:[e.jsx("option",{value:"starter",children:"Starter"}),e.jsx("option",{value:"intermediate",children:"Intermediário"}),e.jsx("option",{value:"pro",children:"Pro"})]}),e.jsx("input",{"aria-label":"Tags (vírgula)",placeholder:"Tags",value:Array.isArray(n.tags)?n.tags.join(","):"",onChange:e=>l({...n,tags:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)})}),e.jsx("input",{"aria-label":"Recompensa",placeholder:"Recompensa",value:n?.reward||"",onChange:e=>l({...n,reward:e.target.value})}),e.jsx("input",{"aria-label":"Base points",type:"number",min:"0",value:Number(n?.base_points||0),onChange:e=>l({...n,base_points:Number(e.target.value)})}),e.jsxs("select",{value:n?.delivery_type||"link",onChange:e=>l({...n,delivery_type:e.target.value}),children:[e.jsx("option",{value:"link",children:"Link"}),e.jsx("option",{value:"github",children:"GitHub"}),e.jsx("option",{value:"file",children:"File"})]}),e.jsx("input",{"aria-label":"Thumb URL",placeholder:"Thumb URL",value:n?.thumb_url||"",onChange:e=>l({...n,thumb_url:e.target.value})}),e.jsxs("select",{value:n?.status||"draft",onChange:e=>l({...n,status:e.target.value}),children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"active",children:"Ativo"}),e.jsx("option",{value:"closed",children:"Encerrado"}),e.jsx("option",{value:"archived",children:"Arquivado"})]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:!!n?.visible,onChange:e=>l({...n,visible:e.target.checked})})," Visível"]})]}),e.jsxs("div",{className:"btn-group",style:{marginTop:12},children:[e.jsxs("button",{className:"btn btn-primary",onClick:async()=>{u(!0);try{const e=o?{...n,id:o}:n;await N.upsert(e),c(null),l({name:"",objective:"",description:"",deadline:"",difficulty:"starter",tags:[],reward:"",base_points:0,delivery_type:"link",thumb_url:"",status:"draft",visible:!0}),i()}finally{u(!1)}},disabled:d,"aria-busy":d,children:[o?"Atualizar":"Salvar"," desafio"]}),o&&e.jsx("button",{className:"btn btn-outline",onClick:()=>{c(null),l({name:"",objective:"",description:"",deadline:"",difficulty:"starter",tags:[],reward:"",base_points:0,delivery_type:"link",thumb_url:"",status:"draft",visible:!0})},children:"Cancelar edição"})]})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("div",{style:{maxWidth:600},children:e.jsx(Ft,{form:n})})})]})}function Ft({form:a}){const t={id:"preview",name:a.name,objective:a.objective,description:a.description,deadline:a.deadline,base_points:a.base_points,reward:a.reward,status:a.status,visible:a.visible,difficulty:a.difficulty,tags:a.tags,delivery_type:a.delivery_type,thumb_url:a.thumb_url,created_by:"preview",updated_at:(new Date).toISOString()};return e.jsx(v,{challenge:t})}function zt(){const{data:t,loading:s,error:r,refresh:i}=_(),{data:n}=w(),[l,o]=x.useState({item:"",valor:0,status:"pending",type:"other",project_id:"",progress:0}),[c,d]=x.useState(null),[u,m]=x.useState(!1),[p,h]=x.useState({status:"",type:"",project:""}),[g,j]=x.useState("table"),[v,b]=x.useState(""),[y,f]=x.useState(1),N=t.filter(e=>{const a=!v||(e.item||"").toLowerCase().includes(v.toLowerCase())||(e.status||"").toLowerCase().includes(v.toLowerCase()),t=!p.status||e.status===p.status,s=!p.type||e.type===p.type,r=!p.project||e.project_id===p.project;return a&&t&&s&&r}),C=Math.max(1,Math.ceil(N.length/10)),S=N.slice(10*(y-1),10*y),k={total:t.reduce((e,a)=>e+Number(a.valor||0),0),paid:t.filter(e=>"paid"===e.status).reduce((e,a)=>e+Number(a.valor||0),0),pending:t.filter(e=>"pending"===e.status).reduce((e,a)=>e+Number(a.valor||0),0),discount:t.filter(e=>"discount"===e.status).reduce((e,a)=>e+Number(a.valor||0),0),count:t.length},A=e=>{d(e.id),o({item:e.item||"",valor:Number(e.valor||0),status:e.status||"pending",type:e.type||"other",project_id:e.project_id||"",progress:Number(e.progress||0)})},P=async e=>{if(window.confirm("Confirma a exclusão deste registro financeiro?"))try{await a(`/api/financas/${e}`,{method:"DELETE"}),i()}catch(t){alert("Erro ao excluir: "+t.message)}},E=async(e,a)=>{await R.update(e.id,a),i()},B=e=>{const a=n.find(a=>a.id===e);return a?a.title||a.titulo:"Projeto não encontrado"},T={pending:"#FFA500",paid:"#00E4F2",discount:"#D12BF2",cancelled:"#FF6B6B"},L={project:"🎯 Projeto",discount:"💸 Desconto",other:"📋 Outros"};return e.jsxs("div",{className:"admin-content",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"title",children:"💰 Gestão Financeira"}),e.jsx("p",{className:"muted",children:"Gerencie receitas, despesas e integrações com projetos"})]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>j("table"===g?"cards":"table"),children:"table"===g?"📊 Cards":"📋 Tabela"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{const e=R.exportCsv(),a=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download="finance.csv",s.click(),URL.revokeObjectURL(t)},children:"📤 Exportar CSV"})]})]}),e.jsxs("section",{className:"kpis",style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12,marginBottom:20},children:[e.jsxs("div",{className:"card",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.16)",color:"var(--texto-gelo)",textAlign:"center"},children:[e.jsx("h3",{children:"💰 Total"}),e.jsxs("p",{style:{fontSize:"1.5em",fontWeight:"bold",color:"#00E4F2"},children:["R$ ",k.total.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"card",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.16)",color:"var(--texto-gelo)",textAlign:"center"},children:[e.jsx("h3",{children:"✅ Pago"}),e.jsxs("p",{style:{fontSize:"1.5em",fontWeight:"bold",color:"#00E4F2"},children:["R$ ",k.paid.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"card",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.16)",color:"var(--texto-gelo)",textAlign:"center"},children:[e.jsx("h3",{children:"⏳ Pendente"}),e.jsxs("p",{style:{fontSize:"1.5em",fontWeight:"bold",color:"#FFA500"},children:["R$ ",k.pending.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"card",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.16)",color:"var(--texto-gelo)",textAlign:"center"},children:[e.jsx("h3",{children:"💸 Descontos"}),e.jsxs("p",{style:{fontSize:"1.5em",fontWeight:"bold",color:"#D12BF2"},children:["R$ ",k.discount.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"card",style:{background:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.16)",color:"var(--texto-gelo)",textAlign:"center"},children:[e.jsx("h3",{children:"📊 Registros"}),e.jsx("p",{style:{fontSize:"1.5em",fontWeight:"bold",color:"#68007B"},children:k.count})]})]}),e.jsx("section",{className:"filters-section",style:{marginBottom:20},children:e.jsxs("div",{className:"formRow",style:{gridTemplateColumns:"repeat(5, 1fr)"},children:[e.jsx("input",{placeholder:"🔍 Buscar item ou status...",value:v,onChange:e=>{b(e.target.value),f(1)}}),e.jsxs("select",{value:p.status,onChange:e=>{h({...p,status:e.target.value}),f(1)},children:[e.jsx("option",{value:"",children:"Todos os Status"}),e.jsx("option",{value:"pending",children:"⏳ Pendente"}),e.jsx("option",{value:"paid",children:"✅ Pago"}),e.jsx("option",{value:"discount",children:"💸 Desconto"}),e.jsx("option",{value:"cancelled",children:"❌ Cancelado"})]}),e.jsxs("select",{value:p.type,onChange:e=>{h({...p,type:e.target.value}),f(1)},children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),e.jsx("option",{value:"project",children:"🎯 Projeto"}),e.jsx("option",{value:"discount",children:"💸 Desconto"}),e.jsx("option",{value:"other",children:"📋 Outros"})]}),e.jsxs("select",{value:p.project,onChange:e=>{h({...p,project:e.target.value}),f(1)},children:[e.jsx("option",{value:"",children:"Todos os Projetos"}),n.map(a=>e.jsx("option",{value:a.id,children:a.title||a.titulo},a.id))]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("button",{onClick:()=>f(Math.max(1,y-1)),children:"◀"}),e.jsxs("span",{children:["Página ",y,"/",C]}),e.jsx("button",{onClick:()=>f(Math.min(C,y+1)),children:"▶"})]})]})}),s&&e.jsx("p",{children:"🔄 Carregando..."}),r&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["❌ ",r]}),"cards"===g&&e.jsx("section",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:16,marginBottom:20},children:0===S.length?e.jsx("div",{className:"card",style:{gridColumn:"1 / -1",textAlign:"center",padding:40},children:e.jsx("p",{children:"📭 Nenhum registro encontrado"})}):S.map(a=>e.jsxs("div",{className:"card",style:{background:"rgba(255,255,255,0.06)",border:`3px solid ${T[a.status]||"rgba(255,255,255,0.16)"}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,color:"#000"},children:a.item}),e.jsx("p",{style:{margin:"4px 0",color:"#666",fontSize:"0.9em"},children:L[a.type]||a.type})]}),e.jsx("span",{style:{background:T[a.status]||"#ccc",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8em",fontWeight:"bold"},children:a.status})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsxs("p",{style:{fontSize:"1.5em",fontWeight:"bold",color:"#00E4F2",margin:0},children:["R$ ",Number(a.valor||0).toLocaleString("pt-BR")]}),a.project_id&&e.jsxs("p",{style:{margin:"4px 0",color:"#666",fontSize:"0.9em"},children:["🎯 ",B(a.project_id)]}),a.progress>0&&e.jsxs("div",{style:{marginTop:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8em",marginBottom:4},children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[a.progress,"%"]})]}),e.jsx("div",{style:{height:6,background:"#E0E0E0",borderRadius:3},children:e.jsx("div",{style:{width:`${a.progress}%`,height:"100%",background:"#00E4F2",borderRadius:3,transition:"width 0.3s ease"}})})]})]}),e.jsxs("div",{className:"btn-group",style:{justifyContent:"flex-end"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>A(a),children:"✏️"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>E(a,{status:"paid"===a.status?"pending":"paid"}),children:"paid"===a.status?"⏳":"✅"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>P(a.id),children:"🗑️"})]})]},a.id))}),"table"===g&&e.jsx("div",{className:"table",style:{marginBottom:20},children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Projeto"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Progresso"}),e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===S.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",style:{textAlign:"center",padding:40},children:"📭 Nenhum registro encontrado"})}):S.map(a=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Item",style:{fontWeight:"bold"},children:a.item}),e.jsx("td",{"data-label":"Tipo",children:L[a.type]||a.type}),e.jsx("td",{"data-label":"Projeto",children:a.project_id?B(a.project_id):"—"}),e.jsxs("td",{"data-label":"Valor",style:{fontWeight:"bold",color:"#00E4F2"},children:["R$ ",Number(a.valor||0).toLocaleString("pt-BR")]}),e.jsx("td",{"data-label":"Status",children:e.jsx("span",{style:{background:T[a.status]||"#ccc",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8em",fontWeight:"bold"},children:a.status})}),e.jsx("td",{"data-label":"Progresso",children:a.progress>0?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:60,height:6,background:"#E0E0E0",borderRadius:3},children:e.jsx("div",{style:{width:`${a.progress}%`,height:"100%",background:"#00E4F2",borderRadius:3}})}),e.jsxs("span",{style:{fontSize:"0.8em"},children:[a.progress,"%"]})]}):"—"}),e.jsx("td",{"data-label":"Data",children:a.date?new Date(a.date).toLocaleDateString("pt-BR"):"—"}),e.jsx("td",{"data-label":"Ações",children:e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>A(a),children:"✏️"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>E(a,{status:"paid"===a.status?"pending":"paid"}),children:"paid"===a.status?"⏳":"✅"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>P(a.id),children:"🗑️"})]})})]},a.id))})]})}),e.jsxs("section",{className:"card",style:{padding:20},children:[e.jsx("h3",{style:{marginBottom:16},children:c?"✏️ Editar Registro":"➕ Novo Registro Financeiro"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:16},children:[e.jsx("input",{placeholder:"Nome do item/serviço",value:l.item,onChange:e=>o({...l,item:e.target.value})}),e.jsx("input",{type:"number",placeholder:"Valor (R$)",value:l.valor,onChange:e=>o({...l,valor:Number(e.target.value)})}),e.jsxs("select",{value:l.status,onChange:e=>o({...l,status:e.target.value}),children:[e.jsx("option",{value:"pending",children:"⏳ Pendente"}),e.jsx("option",{value:"paid",children:"✅ Pago"}),e.jsx("option",{value:"discount",children:"💸 Desconto"}),e.jsx("option",{value:"cancelled",children:"❌ Cancelado"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12,marginBottom:16},children:[e.jsxs("select",{value:l.type,onChange:e=>o({...l,type:e.target.value}),children:[e.jsx("option",{value:"other",children:"📋 Outros"}),e.jsx("option",{value:"project",children:"🎯 Projeto"}),e.jsx("option",{value:"discount",children:"💸 Desconto"})]}),e.jsxs("select",{value:l.project_id,onChange:e=>o({...l,project_id:e.target.value}),children:[e.jsx("option",{value:"",children:"Selecionar projeto (opcional)"}),n.map(a=>e.jsx("option",{value:a.id,children:a.title||a.titulo},a.id))]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:"0.9em",color:"#666"},children:"Progresso:"}),e.jsx("input",{type:"range",min:"0",max:"100",value:l.progress,onChange:e=>o({...l,progress:Number(e.target.value)}),style:{flex:1}}),e.jsxs("span",{style:{fontSize:"0.9em",fontWeight:"bold"},children:[l.progress,"%"]})]})]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-primary",onClick:async()=>{m(!0);try{const e={...l};e.valor=Number(e.valor),e.progress=Number(e.progress),e.date=(new Date).toISOString(),c?await R.update(c,e):await a("/api/financas",{method:"POST",body:JSON.stringify(e)}),o({item:"",valor:0,status:"pending",type:"other",project_id:"",progress:0}),d(null),i()}catch(e){alert("Erro ao salvar: "+e.message)}finally{m(!1)}},disabled:u||!l.item||!l.valor,children:u?"⏳ Salvando...":c?"💾 Atualizar":"➕ Criar"}),c&&e.jsx("button",{className:"btn btn-outline",onClick:()=>{d(null),o({item:"",valor:0,status:"pending",type:"other",project_id:"",progress:0})},children:"❌ Cancelar"})]})]})]})}function $t(){const{data:a}=y(),[t,s]=x.useState(""),r=a.filter(e=>(e.type||"").toLowerCase().includes(t.toLowerCase())||(e.message||"").toLowerCase().includes(t.toLowerCase()));return e.jsxs("div",{className:"admin-content",children:[e.jsx("h1",{className:"title",children:"Configurações"}),e.jsxs("p",{children:["Nome da plataforma: ",{}.name]}),e.jsx("p",{children:"Paleta base bloqueada"}),e.jsxs("section",{className:"card",style:{marginTop:12},children:[e.jsx("h3",{children:"Filtrar Logs"}),e.jsx("div",{className:"formRow",children:e.jsx("input",{id:"logQuery","aria-label":"Filtro de logs",placeholder:"Digite tipo ou texto...",value:t,onChange:e=>s(e.target.value)})})]}),e.jsx("ul",{className:"items","aria-live":"polite",style:{marginTop:10},children:0===r.length?e.jsx("li",{className:"item",children:"Nenhum log correspondente"}):r.slice(0,50).map(a=>e.jsxs("li",{className:"item",children:[e.jsx("span",{className:"logType",children:a.type}),e.jsx("span",{className:"logMsg",children:a.message}),e.jsx("span",{className:"logAt",children:new Date(a.at).toLocaleString("pt-BR")})]},a.id))})]})}function Ut(){const{user:a,logout:t,hasRole:s}=m(),[r,i]=x.useState(null),[n,l]=x.useState(()=>{if("undefined"==typeof window)return!0;const e=window.localStorage.getItem("admin_sidebar_open");return null===e||"true"===e});return x.useEffect(()=>{const e=setInterval(()=>{try{"undefined"!=typeof window&&window.__global_last_error__&&i(window.__global_last_error__)}catch{}},1e3);return()=>clearInterval(e)},[]),e.jsxs("div",{className:`${Et.adminContainer} ${n?"":Et.collapsed} page-with-background`,children:[e.jsxs("aside",{className:Et.sidebar,"data-expanded":n,children:[e.jsx("div",{className:Et.brand,children:"CodeCraft Gen-Z"}),e.jsxs("nav",{className:Et.menu,children:[e.jsxs(g,{to:"/admin",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"🏠"}),e.jsx("span",{className:Et.menuText,children:"Dashboard"})]}),s(["admin"])&&e.jsxs(g,{to:"/admin/usuarios",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"👤"}),e.jsx("span",{className:Et.menuText,children:"Usuários"})]}),e.jsxs(g,{to:"/admin/mentores",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"🧑‍🏫"}),e.jsx("span",{className:Et.menuText,children:"Mentores"})]}),e.jsxs(g,{to:"/admin/equipes",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"👥"}),e.jsx("span",{className:Et.menuText,children:"Equipes"})]}),e.jsxs(g,{to:"/admin/crafters",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"🛠️"}),e.jsx("span",{className:Et.menuText,children:"Crafters"})]}),e.jsxs(g,{to:"/admin/ranking",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"🏆"}),e.jsx("span",{className:Et.menuText,children:"Ranking"})]}),e.jsxs(g,{to:"/admin/projetos",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"📁"}),e.jsx("span",{className:Et.menuText,children:"Projetos"})]}),e.jsxs(g,{to:"/admin/apps",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"🧱"}),e.jsx("span",{className:Et.menuText,children:"Aplicativos"})]}),e.jsxs(g,{to:"/admin/desafios",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"🎯"}),e.jsx("span",{className:Et.menuText,children:"Desafios"})]}),e.jsxs(g,{to:"/admin/inscricoes",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"📝"}),e.jsx("span",{className:Et.menuText,children:"Inscrições"})]}),e.jsxs(g,{to:"/admin/financas",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"💳"}),e.jsx("span",{className:Et.menuText,children:"Finanças"})]}),e.jsxs(g,{to:"/admin/pagamentos",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"💵"}),e.jsx("span",{className:Et.menuText,children:"Pagamentos"})]}),s(["admin"])&&e.jsxs(g,{to:"/admin/nfse",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"📄"}),e.jsx("span",{className:Et.menuText,children:"NFS-e"})]}),s(["admin"])&&e.jsxs(g,{to:"/admin/licencas",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"🔑"}),e.jsx("span",{className:Et.menuText,children:"Licenças"})]}),e.jsxs(g,{to:"/admin/ideias",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"💡"}),e.jsx("span",{className:Et.menuText,children:"Ideias"})]}),e.jsxs(g,{to:"/admin/propostas",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"💼"}),e.jsx("span",{className:Et.menuText,children:"Propostas B2B"})]}),s(["admin"])&&e.jsxs(g,{to:"/admin/leads",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"📊"}),e.jsx("span",{className:Et.menuText,children:"Leads"})]}),e.jsxs(g,{to:"/admin/config",className:({isActive:e})=>[Et.menuLink,e?Et.active:""].filter(Boolean).join(" "),children:[e.jsx("span",{className:Et.menuIcon,children:"⚙️"}),e.jsx("span",{className:Et.menuText,children:"Config"})]})]}),e.jsx("button",{className:Et.sidebarToggle,onClick:()=>{const e=!n;l(e);try{window.localStorage.setItem("admin_sidebar_open",String(e))}catch{}},"aria-label":n?"Recolher menu":"Expandir menu",children:n?"⟨":"⟩"})]}),e.jsxs("main",{className:Et.main,children:[e.jsxs("header",{className:Et.topbar,children:[e.jsxs("div",{className:Et.welcome,children:["Olá, ",a?.name," ",a?.role?`(${a.role})`:""]}),e.jsx("button",{className:`${Et.btn} ${Et.btnDanger}`,onClick:t,children:"Sair"})]}),e.jsxs("div",{className:Et.content,children:[r&&e.jsxs("div",{className:Et.error,role:"alert",children:[e.jsx("div",{className:Et.fontBold,children:"Aviso: erro global capturado"}),e.jsx("div",{className:Et.textSm,children:r.message})]}),e.jsx(Mt,{children:e.jsx(j,{})})]})]})]})}class Mt extends x.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,a){this.setState({errorInfo:a}),window.__admin_last_error__={message:String(e?.message||e),stack:a?.componentStack}}render(){return this.state.hasError?e.jsxs("div",{role:"alert",style:{padding:"12px",border:"1px solid #ff4444",background:"rgba(255,68,68,0.1)",borderRadius:"8px",color:"#ff4444"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Erro ao renderizar a página admin"}),e.jsx("div",{style:{marginBottom:6},children:String(this.state.error?.message||this.state.error)}),this.state.errorInfo?.componentStack&&e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:12,color:"#aa0000"},children:this.state.errorInfo.componentStack}),e.jsx("div",{style:{marginTop:8,fontSize:12},children:"Consulte o console para mais detalhes."})]}):this.props.children}}function Wt(){const{hasRole:a}=m(),t=["on","true","1","yes"].includes(String("").toLowerCase())||"undefined"!=typeof window&&"1"===new URLSearchParams(window.location.search).get("debug")||"undefined"!=typeof localStorage&&"1"===localStorage.getItem("cc_debug"),[s,r]=x.useState([]),[i,n]=x.useState(!0),[l,o]=x.useState(""),[c,d]=x.useState({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0"}),[u,p]=x.useState("R$ 0,00"),[h,g]=x.useState(null),[j,v]=x.useState(!1),[y,f]=x.useState(""),[N,_]=x.useState(null),w=e=>{try{return Number(e||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}catch{return`R$ ${String(e||0)}`}};x.useEffect(()=>{p(w(c.price||0))},[c.price]);const C=x.useCallback(async()=>{try{n(!0),o("");const e=a(["admin"]),t=await I({page:1,pageSize:100,publicFallback:!e}),s=(Array.isArray(t?.data)?t.data:Array.isArray(t)?t:[]).map(e=>({...e,thumbnail:e.thumbnail||e.thumb_url||e.thumbUrl||"",executableUrl:e.executableUrl||e.executable_url||"",mainFeature:e.mainFeature||e.main_feature||e.short_description||""}));r(s)}catch(e){o(e.message||"Erro ao carregar apps")}finally{n(!1)}},[a,t]);x.useEffect(()=>{C()},[C]),x.useEffect(()=>{if(s.length>0&&!i&&!l){const e=Vt(".admin-content .table");_(e),e&&e.ok}},[s.length,i,l]);return e.jsxs("div",{className:"admin-content",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"title",children:"🧱 Aplicativos"}),e.jsx("p",{className:"muted",children:"Edite cards de aplicativos vinculados a projetos finalizados."})]}),e.jsx("button",{className:"btn btn-outline",onClick:C,children:"🔄 Atualizar"})]}),i&&e.jsx("p",{children:"🔄 Carregando…"}),l&&e.jsxs("p",{role:"alert",style:{color:"#FF6B6B"},children:["❌ ",l]}),N&&!1===N.ok&&e.jsxs("div",{className:"card","data-diag":"apps-invisible",style:{borderColor:"#FF6B6B",color:"#FF6B6B",marginBottom:12},children:["Elementos carregados mas invisíveis. display=",N.display,", visibility=",N.visibility,", opacity=",N.opacity,", z-index=",N.zIndex,". Top element: ",N.top?N.top.cls||N.top.tag:"—"]}),e.jsx("div",{className:"table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Feature"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Preço"}),e.jsx("th",{children:"Thumb"}),e.jsx("th",{children:"Exec URL"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:0===s.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",children:"📭 Nenhum aplicativo"})}):s.map(a=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Nome",children:a.name}),e.jsx("td",{"data-label":"Feature",title:a.mainFeature,children:String(a.mainFeature||"").slice(0,60)}),e.jsx("td",{"data-label":"Status",children:e.jsx("span",{style:{background:"available"===String(a.status||"").toLowerCase()?"#00E4F2":"#666",color:"#fff",padding:"4px 8px",borderRadius:"12px",fontSize:"0.8em",fontWeight:"bold"},children:a.status||"—"})}),e.jsx("td",{"data-label":"Preço",children:w(U(a))}),e.jsx("td",{"data-label":"Thumb",children:e.jsx("img",{src:b(M(a)),alt:"thumbnail",style:{width:48,height:36,objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,255,255,0.18)"},onError:e=>{e.currentTarget.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})}),e.jsx("td",{"data-label":"Exec URL",children:e.jsx("a",{href:a.executableUrl,target:"_blank",rel:"noopener noreferrer",children:"exec"})}),e.jsx("td",{"data-label":"Ações",children:e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>d({id:a.id,name:a.name||"",mainFeature:a.mainFeature||"",description:a.description||"",status:a.status||"draft",price:a.price||0,thumbnail:a.thumbnail||"",exec_url:a.executableUrl||"",version:a.version||"1.0.0"}),children:"✏️"}),e.jsx("button",{className:"btn btn-outline",onClick:async()=>{const e="available"===String(a.status||"").toLowerCase()?"draft":"available";try{await D(a.id,{status:e}),C()}catch(t){alert(t.message||"Falha ao alternar visibilidade")}},"aria-label":`Visibilidade ${a.name||a.id}`,children:"available"===String(a.status||"").toLowerCase()?"Ocultar":"Exibir"}),e.jsx("button",{className:"btn",onClick:()=>window.open(`/apps/${a.id}/compra`,"_blank","noopener"),children:"🛒 Comprar"}),e.jsx("button",{className:"btn btn-danger",onClick:async()=>{if(confirm("Excluir este aplicativo?"))try{await O(a.id),C()}catch(e){alert(e.message||"Falha ao excluir")}},children:"🗑️"})]})})]},a.id))})]})}),e.jsxs("section",{className:"card",style:{padding:16,marginTop:16},children:[e.jsx("h3",{children:c.id?"✏️ Editar App":"➕ Criar novo App"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:[e.jsx("input",{placeholder:"Nome",value:c.name,onChange:e=>d({...c,name:e.target.value})}),e.jsx("input",{placeholder:"Feature principal",value:c.mainFeature,onChange:e=>d({...c,mainFeature:e.target.value})}),e.jsx("input",{placeholder:"Preço (R$)",value:u,onChange:e=>{const a=String(e.target.value||"").replace(/[^0-9]/g,""),t=Number(a||0)/100;d(e=>({...e,price:t}))}})]}),e.jsx("div",{style:{marginTop:12},children:e.jsx("textarea",{placeholder:"Descrição completa",value:c.description,onChange:e=>d({...c,description:e.target.value}),rows:4})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsx("input",{placeholder:"Thumbnail URL",value:c.thumbnail,onChange:e=>d({...c,thumbnail:e.target.value})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx("input",{placeholder:"URL do executável (ex: https://codecraftgenz.com.br/downloads/app.exe)",value:c.exec_url,onChange:e=>d({...c,exec_url:e.target.value})}),e.jsx("small",{style:{color:"rgba(255,255,255,0.6)",fontSize:"11px"},children:"Use URL completa da Hostinger ou /downloads/arquivo.exe do backend"})]})]}),c.id&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:12,marginTop:12},children:[e.jsx("input",{type:"file",accept:".exe",onChange:e=>{const a=e.target.files?.[0]||null;if(g(a),f(""),a){const e=`/downloads/${a.name.replace(/[^a-zA-Z0-9._-]/g,"_").replace(/__+/g,"_")}`;d(a=>({...a,exec_url:e}))}}}),e.jsx("button",{className:"btn btn-outline",disabled:j||!h,onClick:async()=>{try{v(!0),f("");const e=await F(c.id,h),a=e?.data?.executable_url||e?.executable_url||e?.download_url||e?.url;a?(d(e=>({...e,exec_url:a})),f(""),C()):f("Upload ok mas URL não retornada. Verifique console."),g(null)}catch(e){f(e.message||"Falha no upload")}finally{v(!1)}},children:j?"Enviando…":"Enviar executável"}),y&&e.jsxs("span",{style:{alignSelf:"center",color:"#FF6B6B"},children:["❌ ",y]})]}),c.thumbnail&&e.jsx("div",{style:{marginTop:8},children:e.jsx("img",{src:b(c.thumbnail),alt:"Prévia do thumbnail",style:{width:120,height:90,objectFit:"cover",borderRadius:12,border:"1px solid rgba(255,255,255,0.18)"},onError:e=>{e.currentTarget.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12,marginTop:12},children:e.jsxs("select",{value:c.status,onChange:e=>d({...c,status:e.target.value}),children:[e.jsx("option",{value:"draft",children:"Rascunho"}),e.jsx("option",{value:"available",children:"Disponível"})]})}),e.jsxs("div",{className:"btn-group",style:{marginTop:12,display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:async()=>{try{const e={name:c.name,short_description:c.mainFeature,description:c.description,status:c.status,price:Number(c.price||0),thumb_url:c.thumbnail,executable_url:c.exec_url},a=e=>{const a=String(e||""),t=/^[a-zA-Z]:\\/.test(a),s=a.startsWith("file:");return t||s};if(a(c.thumbnail))return void o("Thumbnail URL inválida. Use http(s).");if(a(c.exec_url))return void o("Exec URL inválida. Use http(s).");await D(c.id,e),d({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0"}),C()}catch(e){alert("Erro ao atualizar app: "+e.message)}},disabled:!c.id||!c.name,children:"💾 Salvar"}),e.jsx("button",{className:"btn btn-success",onClick:async()=>{try{const e={name:c.name,short_description:c.mainFeature,description:c.description,status:c.status,price:Number(c.price||0),thumb_url:c.thumbnail,executable_url:c.exec_url},a=e=>{const a=String(e||""),t=/^[a-zA-Z]:\\/.test(a),s=a.startsWith("file:");return t||s};if(!e.name)return void o("Nome é obrigatório");if(a(c.thumbnail))return void o("Thumbnail URL inválida. Use http(s).");if(a(c.exec_url))return void o("Exec URL inválida. Use http(s).");await z(e),d({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:"",version:"1.0.0"}),C()}catch(e){alert("Erro ao criar app: "+e.message)}},disabled:!!c.id||!c.name||c.price<=0,children:"➕ Criar"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>d({id:null,name:"",mainFeature:"",description:"",status:"draft",price:0,thumbnail:"",exec_url:""}),children:"❌ Limpar"})]})]})]})}function Vt(e){try{const a="undefined"!=typeof document?document.querySelector(e):null;if(!a)return{ok:!1,reason:"root_not_found"};const t=getComputedStyle(a),s=a.getBoundingClientRect(),r=s.left+s.width/2,i=s.top+s.height/2,n=document.elementFromPoint(Math.max(0,r),Math.max(0,i)),l=n?{tag:n.tagName,cls:n.className||"",id:n.id||""}:null;return{ok:"none"!==t.display&&"hidden"!==t.visibility&&Number(t.opacity||1)>0&&s.height>0&&s.width>0,display:t.display,visibility:t.visibility,opacity:t.opacity,zIndex:t.zIndex,rect:{w:s.width,h:s.height},top:l}}catch{return{ok:!1,reason:"diagnose_error"}}}export{Wt as Apps,$t as Config,Rt as Dashboard,Ot as Desafios,zt as Financas,Tt as Mentores,It as Projetos,Lt as Ranking,Bt as Usuarios,Ut as default};
